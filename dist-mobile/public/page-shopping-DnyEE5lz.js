import{x as sa,y as aa,z as na,j as e,S as be,A as je,E as Ne,F as we,G as g,B as m,I as G,D as ft,o as gt,p as pt,q as bt,r as jt,H as ra,L as ss,s as Nt,J as Ke,K as N,M as p,N as h,g as ve,O as la,Q as ia,R as ca,T as oa,U as da,V as wt,W as vt,w as ma}from"./page-aichat-CfjA8Ib1.js";import{useEffect as ye,useState as l,useRef as B,useMemo as as}from"react";import{M as ua}from"./page-calendar-zzPcGnZC.js";import{t as r}from"./vendor-toast-CdQ6zwVl.js";import{m as ke}from"./vendor-firebase-BWip-oO3.js";import{F as yt,p as R,X as E,T as Se,k as kt,V as He,Y as ha,N as Oe,t as Ue,Z as xa,j as Ge,O as fa,_ as ga,q as St,o as Ct,h as pa,z as ba,$ as ns,a0 as ja,a1 as Na,a2 as wa}from"./vendor-misc-D1Cv2iiA.js";const rs=["Lebensmittel","Getränke","Haushalt","Hygiene","Tierbedarf","Sonstiges"];function $a(){const{t:V}=sa();ye(()=>{const t=document.createElement("style");return t.textContent=`
      @keyframes scan-line {
        0% { transform: translateY(0); opacity: 0.3; }
        50% { transform: translateY(100%); opacity: 1; }
        100% { transform: translateY(0); opacity: 0.3; }
      }
    `,document.head.appendChild(t),()=>{document.head.contains(t)&&document.head.removeChild(t)}},[]);const{data:S=[],isLoading:ls}=aa(),[C,Ce]=l(null),[is,Ie]=l(!1),[cs,Pe]=l(!1),[Q,Y]=l(""),[os,Ve]=l(null);ye(()=>{if(S.length>0&&!C){const t=S.find(s=>s.isDefault)||S[0];t&&Ce(t.id)}},[S,C]);const{data:Le=[],isLoading:ds,refetch:$}=na(C||void 0),[It,_e]=l(!1),[Pt,Ae]=l(!1),[w,se]=l({name:"",quantity:"1",category:"Lebensmittel",store:""}),[b,q]=l([]),[Lt,At]=l(!1),[ae,Z]=l("camera"),[J,Fe]=l("receipt"),[j,_]=l(!1),[c,We]=l(null),[I,X]=l([]),[P,K]=l([]),[ms,H]=l(0),[L,ze]=l(null),[ne,re]=l(1),[Qe,us]=l(!0),[Ye,hs]=l(!0),[Ze,xs]=l(!0),x=B(null),ee=B(null),Ft=B(null),[d,le]=l(null),[zt,Je]=l(!1),[ie,Xe]=l(null),[Dt,Et]=l(!1),O=B(null),et=B(null),[Tt,Mt]=l(null),De=B(null),[Bt,tt]=l(!1),[st,at]=l(null),[nt,Rt]=l(!1),U=B(null),rt=B(null),[$t,qt]=l(null),ce=as(()=>Le.filter(t=>t.status==="not_bought"),[Le]),te=as(()=>Le.filter(t=>t.status==="bought"),[Le]),[A,lt]=l(!1),[k,oe]=l(new Set),fs=async()=>{if(!w.name.trim()){r.error("Bitte Artikelname eingeben");return}try{await Ke({listId:C||void 0,item:w.name.trim(),quantity:parseInt(w.quantity)||1,category:w.category,estimatedPrice:0,currency:"CHF",store:w.store||null}),r.success("Artikel hinzugefügt"),N(),_e(!1),se({name:"",quantity:"1",category:"Lebensmittel",store:""}),await $()}catch(t){r.error("Fehler: "+p(t)),h()}},gs=()=>{const t={store:"",items:[]};q([...b,t])},ps=t=>{q(b.filter((s,a)=>a!==t))},bs=(t,s)=>{const a=[...b];a[t].store=s,q(a)},js=t=>{const s=[...b];s[t].items.push({id:Date.now().toString()+Math.random().toString(36).substr(2,9),name:"",quantity:"1",category:"Lebensmittel",price:"",articleNumber:"",productInfo:null,saveToDatabase:!1}),q(s)},Ns=(t,s)=>{const a=[...b];a[t].items=a[t].items.filter(n=>n.id!==s),q(a)},F=(t,s,a,n)=>{const o=[...b],i=o[t].items.findIndex(u=>u.id===s);i!==-1&&(o[t].items[i][a]=n,q(o))},ws=(t,s)=>{Xe({groupIndex:t,itemId:s}),Je(!0),setTimeout(()=>vs(),100)},vs=async()=>{try{if(!navigator.mediaDevices||!navigator.mediaDevices.getUserMedia){r.error("Kamera wird nicht unterstützt");return}const t=await navigator.mediaDevices.getUserMedia({video:{facingMode:"environment"}});Mt(t),O.current&&(O.current.srcObject=t,await O.current.play()),Et(!0),ys(),N()}catch(t){r.error("Kamera-Fehler: "+p(t)),h()}},ys=()=>{if(!("BarcodeDetector"in window)){r.error("Barcode-Erkennung nicht unterstützt");return}const t=new window.BarcodeDetector({formats:["ean_13","ean_8","code_128","code_39","upc_a","upc_e"]});De.current=setInterval(async()=>{if(!O.current||!et.current||!Dt)return;const s=O.current,a=et.current,n=a.getContext("2d");if(!(!n||s.readyState!==4)){a.width=s.videoWidth,a.height=s.videoHeight,n.drawImage(s,0,0);try{const o=await t.detect(a);if(o.length>0){const i=o[0].rawValue;Kt(),ie&&(F(ie.groupIndex,ie.itemId,"articleNumber",i),r.success(`Barcode gescannt: ${i}`),N(),await Ls(ie.groupIndex,ie.itemId,i)),Je(!1),Xe(null)}}catch{}}},500)},Kt=()=>{De.current&&(clearInterval(De.current),De.current=null),Tt&&(Tt.getTracks().forEach(t=>t.stop()),Mt(null)),O.current&&(O.current.srcObject=null),Et(!1)},ks=()=>{Kt(),Je(!1),Xe(null)},Ss=(t,s)=>{at({groupIndex:t,itemId:s}),tt(!0),setTimeout(()=>Cs(),100)},Cs=async()=>{try{if(!navigator.mediaDevices||!navigator.mediaDevices.getUserMedia){r.error("Kamera wird nicht unterstützt");return}const t=await navigator.mediaDevices.getUserMedia({video:{facingMode:"environment"}});qt(t),U.current&&(U.current.srcObject=t,await U.current.play()),N()}catch(t){r.error("Kamera-Fehler: "+p(t)),h()}},Is=async()=>{if(!(!U.current||!rt.current||!st)){Rt(!0);try{const t=U.current,s=rt.current;s.width=t.videoWidth,s.height=t.videoHeight;const a=s.getContext("2d");if(a){a.drawImage(t,0,0);const n=s.toDataURL("image/jpeg");await As(st.groupIndex,st.itemId,n),Ht(),tt(!1),at(null)}}catch(t){r.error("Fehler beim Erfassen: "+p(t)),h()}finally{Rt(!1)}}},Ht=()=>{$t&&($t.getTracks().forEach(t=>t.stop()),qt(null)),U.current&&(U.current.srcObject=null)},Ps=()=>{Ht(),tt(!1),at(null)},Ls=async(t,s,a)=>{try{if(!b[t]?.items.find(z=>z.id===s))return;const o=b[t]?.store||"",u=await ke(ve,"searchProductInfo")({articleNumber:a,store:o});u.data&&u.data.productInfo&&(F(t,s,"productInfo",u.data.productInfo),r.success("Produktinformationen gefunden"))}catch(n){console.log("Product info fetch failed:",n)}},As=async(t,s,a)=>{try{const n=b[t]?.items.find(z=>z.id===s);if(!n)return;const o=b[t]?.store||"",u=await ke(ve,"analyzeProductImage")({imageData:a,store:o,articleNumber:n.articleNumber});u.data&&u.data.productInfo?(F(t,s,"productInfo",u.data.productInfo),u.data.articleNumber&&!n.articleNumber&&F(t,s,"articleNumber",u.data.articleNumber),r.success("Produktinformationen erkannt"),N()):r.info("Keine Produktinformationen erkannt")}catch(n){r.error("Fehler bei Analyse: "+p(n)),h()}},Fs=async(t,s)=>{ws(t,s)},zs=async(t,s)=>{Ss(t,s)},Ds=async()=>{try{let t=0;for(const s of b){if(!s.store){r.error("Bitte Laden für alle Gruppen angeben");return}for(const a of s.items){if(!a.name.trim()){r.error("Bitte Artikelname für alle Artikel eingeben");return}await Ke({listId:C||void 0,item:a.name.trim(),quantity:parseInt(a.quantity)||1,category:a.category,estimatedPrice:parseFloat(a.price||"0")*100,currency:"CHF",store:s.store,articleNumber:a.articleNumber||null,productInfo:a.productInfo||null,saveToDatabase:a.saveToDatabase||!1}),t++}}r.success(`${t} Artikel hinzugefügt`),N(),Ae(!1),q([]),await $()}catch(t){r.error("Fehler: "+p(t)),h()}},Ot=async()=>{if(!Q.trim()){r.error("Bitte Listenname eingeben");return}try{const t=await la(Q.trim(),S.length===0);r.success("Liste erstellt"),N(),Pe(!1),Y(""),Ce(t.id)}catch(t){r.error("Fehler: "+p(t)),h()}},Es=async t=>{if(S.length<=1){r.error("Mindestens eine Liste muss vorhanden sein");return}try{if(await ia(t),r.success("Liste gelöscht"),N(),C===t){const s=S.find(a=>a.id!==t);Ce(s?.id||null)}}catch(s){r.error("Fehler: "+p(s)),h()}},Ts=async(t,s,a)=>{try{await ca(t,{name:s,isDefault:a}),r.success("Liste aktualisiert"),N(),Ve(null)}catch(n){r.error("Fehler: "+p(n)),h()}},Ut=async(t,s)=>{try{(s==="bought"?"not_bought":"bought")==="bought"?await oa(t):await da(t,{status:"not_bought"}),wt(),await $()}catch(a){r.error(p(a)),h()}},Ms=async t=>{try{await vt(t),N(),await $()}catch(s){r.error(p(s)),h()}},Bs=async()=>{if(k.size===0){r.error("Bitte wählen Sie mindestens einen Artikel aus");return}try{const t=Array.from(k).map(s=>vt(s));await Promise.all(t),r.success(`${k.size} Artikel gelöscht`),N(),oe(new Set),lt(!1),await $()}catch(t){r.error(p(t)),h()}},Gt=t=>{oe(s=>{const a=new Set(s);return a.has(t)?a.delete(t):a.add(t),a}),wt()},Rs=()=>{const t=new Set([...ce.map(s=>s.id),...te.map(s=>s.id)]);k.size===t.size?oe(new Set):oe(t),wt()},$s=()=>{lt(!1),oe(new Set)},qs=async()=>{try{for(const t of te)await vt(t.id);r.success("Eingekaufte Artikel gelöscht"),N(),await $()}catch(t){r.error(p(t)),h()}},[va,de]=l("idle"),[ya,Vt]=l(0),T=B(null),[ka,Ks]=l({topLeft:{x:10,y:15},topRight:{x:90,y:15},bottomLeft:{x:10,y:75},bottomRight:{x:90,y:75}}),[Sa,Ca]=l(null),[Ia,Pa]=l(!1),me=async()=>{try{if(!navigator.mediaDevices||!navigator.mediaDevices.getUserMedia){r.error("Kamera wird nicht unterstützt"),Z("upload");return}d&&(d.getTracks().forEach(a=>{a.stop()}),le(null),await new Promise(a=>setTimeout(a,100))),x.current&&(x.current.srcObject=null);let t=null,s={video:{facingMode:"environment",width:{ideal:3840},height:{ideal:2160},aspectRatio:{ideal:16/9}},audio:!1};try{t=await navigator.mediaDevices.getUserMedia(s)}catch{s={video:{facingMode:"environment",width:{ideal:1920},height:{ideal:1080}},audio:!1};try{t=await navigator.mediaDevices.getUserMedia(s)}catch{t=await navigator.mediaDevices.getUserMedia({video:{facingMode:"environment"},audio:!1})}}if(!t||t.getVideoTracks().length===0)throw new Error("Kein Kamera-Stream erhalten");if(le(t),de("scanning"),await new Promise(a=>setTimeout(a,50)),x.current){const a=x.current;a.srcObject=t,await new Promise((n,o)=>{const i=setTimeout(()=>{o(new Error("Video-Timeout"))},5e3),u=()=>{clearTimeout(i),a.removeEventListener("loadedmetadata",u),a.removeEventListener("error",z),n()},z=mt=>{clearTimeout(i),a.removeEventListener("loadedmetadata",u),a.removeEventListener("error",z),o(new Error("Video-Fehler"))};if(a.readyState>=2){clearTimeout(i),n();return}a.addEventListener("loadedmetadata",u,{once:!0}),a.addEventListener("error",z,{once:!0})});try{await a.play(),r.success("Kamera aktiv"),_t()}catch{r.success("Kamera aktiv"),_t()}}}catch(t){d&&(d.getTracks().forEach(n=>n.stop()),le(null)),x.current&&(x.current.srcObject=null);const s=t;let a="Kamera-Fehler";s.name==="NotAllowedError"||s.name==="PermissionDeniedError"?a="Kamera-Berechtigung verweigert. Bitte in den Browser-Einstellungen erlauben.":s.name==="NotFoundError"||s.name==="DevicesNotFoundError"?a="Keine Kamera gefunden":s.name==="NotReadableError"||s.name==="TrackStartError"?a="Kamera wird bereits verwendet":s.name==="OverconstrainedError"||s.name==="ConstraintNotSatisfiedError"?a="Kamera-Unterstützung nicht verfügbar":s.message==="Video-Timeout"?a="Kamera-Initialisierung zu langsam":a=`Kamera-Fehler: ${s.message||s.name}`,r.error(a),Z("upload"),de("idle")}},it=()=>{T.current&&(cancelAnimationFrame(T.current),T.current=null),d&&(d.getTracks().forEach(t=>t.stop()),le(null)),de("idle"),Vt(0)},_t=()=>{Ks({topLeft:{x:15,y:10},topRight:{x:85,y:10},bottomLeft:{x:15,y:85},bottomRight:{x:85,y:85}}),de("scanning"),Vt(0)},Hs=()=>{if(!x.current||!ee.current)return;T.current&&(cancelAnimationFrame(T.current),T.current=null),de("capturing");const t=x.current,s=ee.current;s.width=t.videoWidth,s.height=t.videoHeight;const a=s.getContext("2d");a&&(a.imageSmoothingEnabled=!1,a.drawImage(t,0,0),r.success("Foto aufgenommen!"),s.toBlob(async n=>{if(n){it();const o=new File([n],"photo.jpg",{type:"image/jpeg"});await Wt(o)}},"image/jpeg",1))};ye(()=>()=>{!d&&x.current&&x.current.srcObject&&(x.current.srcObject.getTracks().forEach(s=>s.stop()),x.current.srcObject=null)},[d]),ye(()=>()=>{T.current&&(cancelAnimationFrame(T.current),T.current=null),d&&(d.getTracks().forEach(t=>t.stop()),le(null)),x.current&&(x.current.srcObject=null)},[]);const Os=async t=>{const s=t.target.files?.[0];s&&await Wt(s)},Wt=async t=>{_(!0),X([]),We(null);try{const s=new FileReader;s.onload=async()=>{try{const a=s.result.split(",")[1];r.info("Analysiere mit OCR...");const i=(await ke(ve,"analyzeReceipt")({fileData:a,fileType:t.type||"image/jpeg",fileName:t.name||"photo.jpg"})).data;i.success&&i.items&&i.items.length>0?(We({store:i.store||{name:"Unbekannt"},purchase:i.purchase||{},items:i.items,totals:i.totals||{total:0},confidence:i.confidence||50}),X(i.items.map(u=>({...u,selected:!0}))),r.success(`${i.items.length} Artikel erkannt!`)):i.error?.includes("Vision API")||i.error?.includes("PERMISSION_DENIED")?r.error("OCR nicht verfügbar. Google Cloud Vision API muss aktiviert werden.",{duration:5e3}):i.error?.includes("billing")?r.error("Google Cloud Billing erforderlich",{duration:5e3}):i.rawText?r.error("Text erkannt aber keine Artikel gefunden. Versuche bessere Bildqualität.",{duration:4e3}):r.error(i.error||"Keine Artikel erkannt. Bitte bessere Bildqualität verwenden.",{duration:4e3})}catch(a){r.error(p(a)),h()}_(!1)},s.onerror=()=>{r.error("Datei konnte nicht gelesen werden"),h(),_(!1)},s.readAsDataURL(t)}catch(s){r.error(p(s)),h(),_(!1)}},[ct,ue]=l(null),[v,Qt]=l(!1),[Ee,Te]=l(null),[Us,Gs]=l(0),[ot,he]=l(new Set),[La,Vs]=l([]),dt=async()=>{if(!x.current||!ee.current||j)return;const t=Date.now();if(t-Us<1500)return;Gs(t),_(!0),ue(null);const s=x.current,a=ee.current,n=s.videoWidth||1920,o=s.videoHeight||1080,i=Math.max(n,1920),u=Math.max(o,1080);a.width=i,a.height=u;const z=a.getContext("2d",{willReadFrequently:!0,alpha:!1});z&&(z.drawImage(s,0,0,n,o,0,0,i,u),a.toBlob(async mt=>{if(mt)try{const Me=new FileReader;Me.onload=async()=>{const ta=Me.result.split(",")[1];try{const fe=(await ke(ve,"analyzeReceipt")({fileData:ta,fileType:"image/jpeg",fileName:"live-scan-full.jpg"})).data;if(fe.success&&fe.items&&fe.items.length>0){const ut=(fe.rawText||"").split(/[\n\r]+/),Be=fe.items.map((f,M)=>{const Re=(f.name||"Unbekannt").toLowerCase().trim(),ge=(f.unitPrice||f.totalPrice||0).toFixed(2),W=f.articleNumber||"";let pe=-1;for(let D=0;D<ut.length;D++)if(ut[D].includes(f.name||"")||W&&ut[D].includes(W)){pe=D;break}const y=`${Re}_${ge}_${W}_${pe>=0?pe:M}_${M}`;return{item:{name:f.name||"Unbekannt",articleNumber:f.articleNumber,quantity:f.quantity||1,unitPrice:f.unitPrice||f.totalPrice||0,totalPrice:f.totalPrice||f.unitPrice*(f.quantity||1),selected:!0},positionId:y}}).filter(({positionId:f})=>!ot.has(f));if(Be.length>0){const f=new Set(ot);Be.forEach(({positionId:M})=>{f.add(M)}),he(f),K(M=>{const Re=new Set(M.map(y=>{const D=y.name.toLowerCase().trim(),$e=y.unitPrice.toFixed(2),ht=y.articleNumber||"";return`${D}_${$e}_${ht}`})),ge=[...M];let W=0;Be.forEach(({item:y,positionId:D})=>{const $e=y.name.toLowerCase().trim(),ht=y.unitPrice.toFixed(2),xt=y.articleNumber||"",ts=`${$e}_${ht}_${xt}`;Re.has(ts)||xt&&M.some(qe=>qe.articleNumber===xt)||M.some(qe=>qe.name.toLowerCase().trim()===$e&&Math.abs(qe.unitPrice-y.unitPrice)<.01)||(ge.push(y),W++,Re.add(ts))});const pe=ge.reduce((y,D)=>y+D.totalPrice,0);return H(pe),W>0?(r.success(`${W} neue Artikel erkannt!`,{duration:1500}),navigator.vibrate&&navigator.vibrate(200)):Be.length>0&&(v||r.info("Alle Artikel bereits in Liste",{duration:1e3})),ge})}else v||r.info("Alle Artikel bereits erkannt",{duration:1e3})}else v||ue("Keine Artikel erkannt")}catch(Xt){if(!v){const es=p(Xt);ue(es)}h()}_(!1)},Me.readAsDataURL(mt)}catch{h(),_(!1)}},"image/jpeg",.95))};ye(()=>{if(v&&d&&J==="single"){const t=setTimeout(()=>{!j&&d&&dt()},500),s=setInterval(()=>{!j&&d&&dt()},2e3);return Te(s),()=>{clearInterval(s),clearTimeout(t),Te(null)}}else Ee&&(clearInterval(Ee),Te(null))},[v,d,J,j]);const _s=async()=>{await dt()},Ws=()=>{if(!L)return;const t={...L,quantity:ne,totalPrice:L.unitPrice*ne};K(s=>[...s,t]),H(s=>s+t.totalPrice),ze(null),re(1),r.success(`${t.name} (${ne}x) hinzugefügt`),N()},Qs=()=>{ze(null),re(1)},Yt=t=>{K(s=>{const a=s[t];return H(n=>n-a.totalPrice),s.filter((n,o)=>o!==t)})},Zt=(t,s)=>{if(s<1){Yt(t);return}K(a=>{const n=[...a],o=n[t],i=o.totalPrice;return n[t]={...o,quantity:s,totalPrice:o.unitPrice*s},H(u=>u-i+n[t].totalPrice),n})},Ys=async()=>{if(P.length===0){r.error("Keine Artikel gescannt");return}try{for(const t of P)await Ke({listId:C||void 0,item:t.name,quantity:t.quantity||1,category:Jt(t.name),estimatedPrice:(t.totalPrice||t.unitPrice||0)*100,currency:"CHF",store:c?.store?.name||null});r.success(`${P.length} Artikel hinzugefügt!`),K([]),H(0),xe(),await $()}catch(t){r.error("Fehler: "+t.message)}},Zs=async()=>{const t=I.filter(s=>s.selected);if(t.length===0){r.error("Bitte mindestens einen Artikel auswählen");return}try{for(const s of t)await Ke({listId:C||void 0,item:s.name,quantity:s.quantity||1,category:Jt(s.name),estimatedPrice:(s.totalPrice||s.unitPrice||0)*100,currency:"CHF",store:c?.store?.name||null});r.success(`${t.length} Artikel hinzugefügt!`),xe(),await $()}catch(s){r.error("Fehler: "+s.message)}},Js=async()=>{if(c)try{await ke(ve,"saveReceipt")({receiptData:c}),r.success("Quittung gespeichert!")}catch(t){r.error("Fehler: "+t.message)}},Xs=async()=>{if(c)try{await ma({type:"ausgabe",amount:c.totals.total*100,category:"Lebensmittel",notes:`Einkauf bei ${c.store.name}`,date:c.purchase.date||new Date().toISOString().split("T")[0],paymentMethod:c.purchase.paymentMethod||"Karte",currency:"CHF",isRecurring:!1}),r.success("Zu Finanzen hinzugefügt!"),N(),xe()}catch(t){r.error(p(t)),h()}},Jt=t=>{const s=t.toLowerCase(),a={Getränke:["bier","wein","saft","wasser","cola","fanta","sprite","energy","shot","drink"],"Obst & Gemüse":["apfel","orange","banane","tomate","salat","gurke","karotte","bio oran","gemüse"],Milchprodukte:["milch","joghurt","käse","butter","sahne","quark","naturejog"],Fleisch:["fleisch","steak","wurst","schinken","poulet","rind","schwein","ragout"],Backwaren:["brot","brötchen","toast","croissant","kuchen","keks","butterkeks"],Süsswaren:["schoko","bonbon","gummi","chips","zucker","gelatine"]};for(const[n,o]of Object.entries(a))if(o.some(i=>s.includes(i)))return n;return"Lebensmittel"},ea=()=>{At(!0),X([]),Z("camera"),setTimeout(()=>me(),100)},xe=()=>{it(),At(!1),X([]),We(null),K([]),H(0),Fe("receipt"),ze(null),re(1),ue(null),Qt(!1),he(new Set),Vs([]),Ee&&(clearInterval(Ee),Te(null))};return e.jsxs(ua,{title:V("nav.shopping","Einkaufsliste"),showSidebar:!0,children:[e.jsx("div",{className:"mb-4 flex items-center gap-2",children:A?e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"flex-1 flex items-center gap-2",children:[e.jsx(m,{variant:"outline",size:"sm",onClick:Rs,className:"h-11",children:k.size===ce.length+te.length?"Alle abwählen":"Alle auswählen"}),e.jsxs("span",{className:"text-sm text-muted-foreground",children:[k.size," ausgewählt"]})]}),e.jsx(m,{variant:"outline",size:"icon",onClick:$s,className:"h-11 w-11",children:e.jsx(E,{className:"w-5 h-5"})}),k.size>0&&e.jsx(m,{variant:"destructive",size:"icon",onClick:Bs,className:"h-11 w-11",children:e.jsx(Se,{className:"w-5 h-5"})})]}):e.jsxs(e.Fragment,{children:[e.jsxs(be,{value:C||"",onValueChange:t=>Ce(t),disabled:ls,children:[e.jsx(je,{className:"flex-1 h-11",children:e.jsx(Ne,{placeholder:"Liste wählen"})}),e.jsx(we,{children:S.map(t=>e.jsxs(g,{value:t.id,children:[t.name," ",t.isDefault&&"(Standard)"]},t.id))})]}),e.jsx(m,{variant:"outline",size:"icon",onClick:()=>Ie(!0),className:"h-11 w-11",children:e.jsx(yt,{className:"w-5 h-5"})}),e.jsx(m,{variant:"outline",size:"icon",onClick:()=>lt(!0),className:"h-11 w-11",children:e.jsx(R,{className:"w-5 h-5"})})]})}),e.jsxs("div",{className:"mobile-card mb-4 bg-primary text-primary-foreground",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-3",children:[e.jsx(kt,{className:"w-6 h-6 opacity-70"}),e.jsx("p",{className:"text-sm opacity-70 font-medium",children:S.find(t=>t.id===C)?.name||V("shopping.list","Einkaufsliste")})]}),e.jsx("p",{className:"text-3xl font-semibold mb-2",children:ce.length}),e.jsx("p",{className:"text-sm opacity-60",children:V("shopping.itemsOpen","Artikel offen")})]}),ds?e.jsx("div",{className:"text-center py-8 text-muted-foreground",children:V("common.loading","Laden...")}):ce.length===0?e.jsxs("div",{className:"mobile-card text-center py-8",children:[e.jsx(R,{className:"w-10 h-10 mx-auto status-success mb-2"}),e.jsx("p",{className:"text-muted-foreground",children:V("shopping.empty","Liste ist leer")})]}):e.jsx("div",{className:"space-y-3 mb-4",children:ce.map(t=>e.jsxs("div",{className:`mobile-card flex items-center gap-4 py-3 ${A&&k.has(t.id)?"ring-2 ring-primary":""}`,onClick:A?()=>Gt(t.id):void 0,children:[A?e.jsx("div",{className:"w-6 h-6 rounded border-2 border-border flex items-center justify-center shrink-0",children:k.has(t.id)&&e.jsx(R,{className:"w-4 h-4 text-primary"})}):e.jsx("button",{onClick:()=>Ut(t.id,t.status),className:"w-6 h-6 rounded border-2 border-border flex items-center justify-center shrink-0"}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("p",{className:"font-medium truncate",children:t.item}),e.jsxs("p",{className:"text-xs text-muted-foreground",children:[t.quantity>1&&`${t.quantity}x • `,t.category,t.store&&` • ${t.store}`]})]}),!A&&e.jsx("button",{onClick:()=>Ms(t.id),className:"w-10 h-10 rounded-lg flex items-center justify-center text-muted-foreground active:opacity-80",children:e.jsx(Se,{className:"w-4 h-4"})})]},t.id))}),te.length>0&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsxs("p",{className:"text-xs font-medium text-muted-foreground uppercase tracking-wider",children:[V("shopping.bought","Eingekauft")," (",te.length,")"]}),!A&&e.jsx("button",{onClick:qs,className:"text-xs status-error active:opacity-80",children:V("shopping.clearBought","Löschen")})]}),e.jsx("div",{className:"space-y-3 opacity-60",children:te.map(t=>e.jsxs("div",{className:`mobile-card flex items-center gap-4 py-3 ${A&&k.has(t.id)?"ring-2 ring-primary opacity-100":""}`,onClick:A?()=>Gt(t.id):void 0,children:[A?e.jsx("div",{className:"w-6 h-6 rounded border-2 border-border flex items-center justify-center shrink-0",children:k.has(t.id)&&e.jsx(R,{className:"w-4 h-4 text-primary"})}):e.jsx("button",{onClick:()=>Ut(t.id,t.status),className:"w-6 h-6 rounded bg-status-success flex items-center justify-center shrink-0",children:e.jsx(R,{className:"w-4 h-4 status-success"})}),e.jsx("p",{className:"font-medium line-through flex-1 truncate",children:t.item})]},t.id))})]}),It&&e.jsx("div",{className:"fixed inset-0 z-50 bg-black/50 flex items-end",children:e.jsxs("div",{className:"bg-background w-full rounded-t-2xl p-6 safe-bottom animate-in slide-in-from-bottom",children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsx("h2",{className:"text-lg font-semibold",children:"Artikel hinzufügen"}),e.jsx("button",{onClick:()=>_e(!1),className:"w-10 h-10 rounded-lg bg-muted flex items-center justify-center",children:e.jsx(E,{className:"w-5 h-5"})})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsx("div",{children:e.jsx(G,{value:w.name,onChange:t=>se({...w,name:t.target.value}),placeholder:"Artikelname",className:"mobile-input",autoFocus:!0})}),e.jsxs("div",{className:"flex gap-3",children:[e.jsx("div",{className:"w-20",children:e.jsx(G,{type:"number",value:w.quantity,onChange:t=>se({...w,quantity:t.target.value}),placeholder:"1",className:"mobile-input text-center",min:"1"})}),e.jsx("div",{className:"flex-1",children:e.jsxs(be,{value:w.category,onValueChange:t=>se({...w,category:t}),children:[e.jsx(je,{className:"mobile-input",children:e.jsx(Ne,{})}),e.jsx(we,{children:rs.map(t=>e.jsx(g,{value:t,children:t},t))})]})})]}),e.jsx("div",{children:e.jsxs(be,{value:w.store||"none",onValueChange:t=>se({...w,store:t==="none"?"":t}),children:[e.jsx(je,{className:"mobile-input",children:e.jsx(Ne,{placeholder:"Laden (optional)"})}),e.jsxs(we,{children:[e.jsx(g,{value:"none",children:"Kein Laden"}),e.jsx(g,{value:"Migros",children:"Migros"}),e.jsx(g,{value:"Coop",children:"Coop"}),e.jsx(g,{value:"Aldi",children:"Aldi"}),e.jsx(g,{value:"Lidl",children:"Lidl"}),e.jsx(g,{value:"Denner",children:"Denner"})]})]})}),e.jsx(m,{onClick:fs,className:"w-full mobile-btn bg-primary text-primary-foreground mt-4",children:"Hinzufügen"})]})]})}),e.jsx(ft,{open:Pt,onOpenChange:Ae,children:e.jsxs(gt,{className:"!fixed !top-[50%] !left-[50%] !right-auto !bottom-auto !translate-x-[-50%] !translate-y-[-50%] !w-[90vw] !max-w-2xl !max-h-[90vh] !rounded-3xl !m-0 !overflow-hidden !shadow-2xl !flex !flex-col",children:[e.jsxs(pt,{className:"px-5 pt-5 pb-3 flex-shrink-0",children:[e.jsx(bt,{className:"text-lg font-semibold",children:"Mehrere Artikel hinzufügen"}),e.jsx(jt,{className:"sr-only",children:"Fügen Sie mehrere Artikel gruppiert nach Laden hinzu"})]}),e.jsxs("div",{className:"px-5 pb-2 overflow-y-auto flex-1 min-h-0 space-y-4",children:[b.length===0&&e.jsxs("div",{className:"text-center py-8 text-muted-foreground",children:[e.jsx(He,{className:"w-12 h-12 mx-auto mb-3 opacity-50"}),e.jsx("p",{children:"Keine Laden-Gruppen vorhanden"}),e.jsx("p",{className:"text-sm mt-1",children:'Klicken Sie auf "Laden hinzufügen" um zu beginnen'})]}),b.map((t,s)=>e.jsxs("div",{className:"border rounded-xl p-4 space-y-3 bg-muted/30",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(He,{className:"w-4 h-4 text-muted-foreground"}),e.jsxs(be,{value:t.store||"none",onValueChange:a=>bs(s,a==="none"?"":a),children:[e.jsx(je,{className:"flex-1 h-9",children:e.jsx(Ne,{placeholder:"Laden wählen"})}),e.jsxs(we,{children:[e.jsx(g,{value:"none",children:"Laden wählen"}),e.jsx(g,{value:"Migros",children:"Migros"}),e.jsx(g,{value:"Coop",children:"Coop"}),e.jsx(g,{value:"Aldi",children:"Aldi"}),e.jsx(g,{value:"Lidl",children:"Lidl"}),e.jsx(g,{value:"Denner",children:"Denner"}),e.jsx(g,{value:"Volg",children:"Volg"}),e.jsx(g,{value:"Spar",children:"Spar"})]})]}),e.jsx(m,{variant:"ghost",size:"sm",onClick:()=>ps(s),className:"h-9 w-9 p-0",children:e.jsx(E,{className:"w-4 h-4"})})]}),e.jsxs("div",{className:"space-y-2",children:[t.items.map(a=>e.jsx("div",{className:"bg-background rounded-lg p-3 space-y-2 border",children:e.jsxs("div",{className:"flex items-start gap-2",children:[e.jsxs("div",{className:"flex-1 space-y-2",children:[e.jsxs("div",{className:"flex gap-2",children:[e.jsx(G,{placeholder:"Artikelname *",value:a.name,onChange:n=>F(s,a.id,"name",n.target.value),className:"flex-1 h-9"}),e.jsx(G,{type:"number",placeholder:"Menge",value:a.quantity,onChange:n=>F(s,a.id,"quantity",n.target.value),className:"w-20 h-9",min:"1"})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(be,{value:a.category,onValueChange:n=>F(s,a.id,"category",n),children:[e.jsx(je,{className:"flex-1 h-9",children:e.jsx(Ne,{})}),e.jsx(we,{children:rs.map(n=>e.jsx(g,{value:n,children:n},n))})]}),e.jsx(G,{type:"number",step:"0.01",placeholder:"Preis (CHF)",value:a.price,onChange:n=>F(s,a.id,"price",n.target.value),className:"w-24 h-9"})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(G,{placeholder:"Artikelnummer (EAN/Barcode)",value:a.articleNumber,onChange:n=>F(s,a.id,"articleNumber",n.target.value),className:"flex-1 h-9"}),e.jsx(m,{variant:"outline",size:"sm",onClick:()=>Fs(s,a.id),className:"h-9",title:"Barcode scannen",children:e.jsx(ha,{className:"w-4 h-4"})}),e.jsx(m,{variant:"outline",size:"sm",onClick:()=>zs(s,a.id),className:"h-9",title:"Produktinfo scannen",children:e.jsx(Oe,{className:"w-4 h-4"})})]}),a.productInfo&&e.jsxs("div",{className:"bg-muted/50 rounded p-2 text-xs space-y-1",children:[a.productInfo.brand&&e.jsxs("p",{children:[e.jsx("strong",{children:"Marke:"})," ",a.productInfo.brand]}),a.productInfo.description&&e.jsxs("p",{children:[e.jsx("strong",{children:"Beschreibung:"})," ",a.productInfo.description]}),a.productInfo.price&&e.jsxs("p",{children:[e.jsx("strong",{children:"Preis:"})," CHF ",a.productInfo.price]}),a.productInfo.imageUrl&&e.jsx("img",{src:a.productInfo.imageUrl,alt:"Produkt",className:"w-full h-24 object-contain mt-2 rounded"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(ra,{checked:a.saveToDatabase||!1,onCheckedChange:n=>F(s,a.id,"saveToDatabase",n)}),e.jsx(ss,{className:"text-xs",children:"Für zukünftige Käufe speichern"})]})]}),e.jsx(m,{variant:"ghost",size:"sm",onClick:()=>Ns(s,a.id),className:"h-9 w-9 p-0",children:e.jsx(Se,{className:"w-4 h-4"})})]})},a.id)),e.jsxs(m,{variant:"outline",size:"sm",onClick:()=>js(s),className:"w-full h-9",children:[e.jsx(Ue,{className:"w-4 h-4 mr-2"}),"Artikel hinzufügen"]})]})]},s)),e.jsxs(m,{variant:"outline",onClick:gs,className:"w-full",children:[e.jsx(He,{className:"w-4 h-4 mr-2"}),"Laden hinzufügen"]})]}),e.jsxs(Nt,{className:"px-5 pb-3 pt-2 gap-2.5 flex-shrink-0",children:[e.jsx(m,{variant:"outline",onClick:()=>{Ae(!1),q([])},className:"h-11 min-h-[44px] flex-1 rounded-xl text-sm font-medium",children:"Abbrechen"}),e.jsxs(m,{onClick:Ds,disabled:b.length===0||b.every(t=>t.items.length===0),className:"h-11 min-h-[44px] flex-1 rounded-xl text-sm font-medium",children:[b.reduce((t,s)=>t+s.items.length,0)," Artikel hinzufügen"]})]})]})}),Lt&&e.jsxs("div",{className:"fixed inset-0 z-50 bg-black flex flex-col",children:[e.jsxs("div",{className:"flex items-center justify-between p-4 bg-black/50",children:[e.jsx("h2",{className:"text-white font-semibold",children:"Liste scannen"}),e.jsx("button",{onClick:xe,className:"w-10 h-10 rounded-lg bg-white/20 flex items-center justify-center",children:e.jsx(E,{className:"w-5 h-5 text-white"})})]}),e.jsxs("div",{className:"flex gap-2 px-4 py-2",children:[e.jsxs("button",{onClick:()=>{Fe("receipt"),Z("camera"),me()},className:`flex-1 py-2 px-3 rounded-lg flex items-center justify-center gap-1.5 text-sm ${J==="receipt"&&ae==="camera"?"bg-white text-black":"bg-white/20 text-white"}`,children:[e.jsx(xa,{className:"w-4 h-4"}),"Quittung"]}),e.jsxs("button",{onClick:async()=>{Fe("single"),Z("camera"),K([]),H(0),he(new Set),ze(null),ue(null),await me()},className:`flex-1 py-2 px-3 rounded-lg flex items-center justify-center gap-1.5 text-sm ${J==="single"?"bg-white text-black":"bg-white/20 text-white"}`,children:[e.jsx(Ge,{className:"w-4 h-4"}),"Einzeln"]}),e.jsxs("button",{onClick:()=>{Fe("receipt"),Z("upload"),it()},className:`flex-1 py-2 px-3 rounded-lg flex items-center justify-center gap-1.5 text-sm ${ae==="upload"?"bg-white text-black":"bg-white/20 text-white"}`,children:[e.jsx(fa,{className:"w-4 h-4"}),"Upload"]})]}),ae==="camera"&&J==="receipt"&&I.length===0&&e.jsxs("div",{className:"flex-1 relative",children:[e.jsx("video",{ref:x,autoPlay:!0,playsInline:!0,muted:!0,preload:"auto",className:"absolute inset-0 w-full h-full object-cover"}),e.jsx("canvas",{ref:ee,className:"hidden"}),d&&e.jsxs("div",{className:"absolute inset-0 pointer-events-none",children:[e.jsx("div",{className:"absolute inset-8 border-2 border-white/60 rounded-lg"}),e.jsx("div",{className:"absolute top-8 left-8 w-6 h-6 border-t-4 border-l-4 border-white rounded-tl"}),e.jsx("div",{className:"absolute top-8 right-8 w-6 h-6 border-t-4 border-r-4 border-white rounded-tr"}),e.jsx("div",{className:"absolute bottom-8 left-8 w-6 h-6 border-b-4 border-l-4 border-white rounded-bl"}),e.jsx("div",{className:"absolute bottom-8 right-8 w-6 h-6 border-b-4 border-r-4 border-white rounded-br"})]}),e.jsx("div",{className:"absolute top-4 left-4 right-4 z-20",children:e.jsx("div",{className:"bg-black/60 rounded-lg p-3 text-center",children:e.jsx("p",{className:"text-white text-sm font-medium",children:j?"Analysiere...":"Quittung fotografieren"})})}),e.jsx("div",{className:"absolute bottom-8 left-0 right-0 z-20",children:d?e.jsxs("div",{className:"flex justify-center items-center gap-4",children:[e.jsx("button",{onClick:xe,className:"w-12 h-12 rounded-full bg-white/20 flex items-center justify-center active:opacity-80",children:e.jsx(E,{className:"w-6 h-6 text-white"})}),e.jsx("button",{onClick:Hs,disabled:j,className:"w-20 h-20 rounded-full bg-white shadow-lg flex items-center justify-center active:opacity-80 border-4 border-white/50",children:j?e.jsx("div",{className:"w-8 h-8 border-3 border-gray-300 border-t-gray-600 rounded-full animate-spin"}):e.jsx("div",{className:"w-14 h-14 rounded-full bg-white"})}),e.jsx("div",{className:"w-12 h-12"})]}):e.jsx("div",{className:"flex justify-center",children:e.jsxs("button",{onClick:me,className:"px-6 py-3 rounded-full bg-white shadow-lg flex items-center justify-center gap-2 active:opacity-80",children:[e.jsx(Oe,{className:"w-5 h-5 text-gray-800"}),e.jsx("span",{className:"font-medium text-gray-800",children:"Kamera starten"})]})})})]}),ae==="camera"&&J==="single"&&e.jsxs("div",{className:"flex-1 flex flex-col bg-background w-full h-full overflow-hidden",children:[e.jsx("div",{className:"w-full px-4 py-3 bg-background/95 backdrop-blur-sm border-b border-border/50 flex-shrink-0",children:e.jsxs("div",{className:"flex items-center justify-between gap-3",children:[e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[e.jsx("div",{className:`w-2 h-2 rounded-full ${d?"bg-green-500 animate-pulse":"bg-gray-400"}`}),e.jsx("p",{className:"text-xs font-medium text-muted-foreground",children:d?"Kamera aktiv":"Kamera inaktiv"})]}),e.jsx("p",{className:"text-sm font-bold truncate",children:j?"Analysiere...":v?`${ot.size} Positionen erkannt`:P.length>0?`${P.length} Artikel gescannt`:"Bereit zum Scannen"})]}),e.jsxs("button",{onClick:()=>Qt(!v),disabled:!d,className:`px-3 py-2 rounded-lg flex items-center gap-1.5 flex-shrink-0 transition-all ${v&&d?"bg-green-500 text-white shadow-lg":"bg-muted text-muted-foreground"} ${d?"":"opacity-50"}`,children:[e.jsx("div",{className:`w-2 h-2 rounded-full ${v&&d?"bg-white":"bg-foreground/50"}`}),e.jsx("span",{className:"text-xs font-semibold",children:"Auto"})]})]})}),e.jsxs("div",{className:"flex-1 flex flex-col w-full overflow-hidden min-h-0 relative",children:[e.jsxs("div",{className:"relative bg-black w-full flex-1 flex-shrink-0 min-h-0",children:[e.jsx("video",{ref:x,autoPlay:!0,playsInline:!0,muted:!0,preload:"auto",className:"absolute inset-0 w-full h-full object-cover",style:{minWidth:"100%",minHeight:"100%"}}),e.jsx("canvas",{ref:ee,className:"hidden"}),d&&v&&e.jsxs("div",{className:"absolute inset-0 pointer-events-none",children:[j&&e.jsx("div",{className:"absolute left-0 right-0 h-1 bg-green-500/50",style:{top:"50%",animation:"scan-line 1.5s ease-in-out infinite",boxShadow:"0 0 20px rgba(16, 185, 129, 0.6)",transform:"translateY(-50%)"}}),e.jsx("div",{className:"absolute top-4 left-1/2 transform -translate-x-1/2 z-10",children:e.jsxs("div",{className:"bg-green-500/90 backdrop-blur-sm text-white px-4 py-2 rounded-full text-xs font-semibold flex items-center gap-2 shadow-lg",children:[e.jsx("div",{className:"w-2 h-2 bg-white rounded-full animate-pulse"}),j?"Analysiere...":`Live-Scan (${P.length} Artikel)`]})})]}),d&&!v&&e.jsx("div",{className:"absolute top-4 left-1/2 transform -translate-x-1/2 z-10",children:e.jsx("div",{className:"bg-black/60 backdrop-blur-sm text-white px-4 py-2 rounded-full text-xs font-medium",children:"Quittung vollständig sichtbar machen"})}),d&&!L&&e.jsx("div",{className:"absolute bottom-0 left-0 right-0 z-20 p-4 bg-gradient-to-t from-black/80 via-black/40 to-transparent",children:e.jsx("button",{onClick:_s,disabled:j,className:`w-full py-4 rounded-xl shadow-2xl flex items-center justify-center gap-3 transition-all transform ${j?"bg-gray-600/90":"bg-green-500 hover:bg-green-600 active:scale-95"}`,children:j?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"w-6 h-6 border-2 border-white/30 border-t-white rounded-full animate-spin"}),e.jsx("span",{className:"font-bold text-white text-lg",children:"Analysiere..."})]}):e.jsxs(e.Fragment,{children:[e.jsx(Ge,{className:"w-6 h-6 text-white"}),e.jsx("span",{className:"font-bold text-white text-lg",children:"ALLE SCANNEN"})]})})}),!d&&e.jsxs("div",{className:"absolute inset-0 flex flex-col items-center justify-center bg-gradient-to-b from-black/90 to-black/70",children:[e.jsxs("div",{className:"text-center mb-8",children:[e.jsx("div",{className:"w-20 h-20 mx-auto mb-4 rounded-full bg-white/10 backdrop-blur-sm flex items-center justify-center",children:e.jsx(Oe,{className:"w-10 h-10 text-white"})}),e.jsx("p",{className:"text-white text-lg font-semibold mb-2",children:"Kamera starten"}),e.jsx("p",{className:"text-white/70 text-sm",children:"Für das Scannen von Quittungen"})]}),e.jsxs("button",{onClick:me,className:"px-8 py-4 rounded-xl bg-white shadow-2xl flex items-center justify-center gap-3 hover:bg-gray-50 active:scale-95 transition-all",children:[e.jsx(Oe,{className:"w-6 h-6 text-gray-800"}),e.jsx("span",{className:"font-bold text-gray-800 text-base",children:"Kamera aktivieren"})]})]})]}),e.jsxs("div",{className:"flex-1 overflow-y-auto bg-background w-full p-4 min-h-0",children:[ct&&!L&&e.jsxs("div",{className:"mb-4 p-4 bg-red-500/10 border border-red-500/30 rounded-xl backdrop-blur-sm",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx("div",{className:"w-2 h-2 rounded-full bg-red-500"}),e.jsx("p",{className:"text-red-600 font-semibold text-sm",children:"Fehler"})]}),e.jsx("p",{className:"text-red-600 font-medium text-center text-sm",children:ct}),e.jsx("p",{className:"text-red-500/70 text-xs text-center mt-1",children:"Quittung näher halten und erneut scannen"})]}),L&&e.jsxs("div",{className:"mb-4 p-5 bg-green-500/10 border border-green-500/40 rounded-xl backdrop-blur-sm",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-3",children:[e.jsx("div",{className:"w-2 h-2 rounded-full bg-green-500 animate-pulse"}),e.jsx("p",{className:"text-green-600 font-bold text-sm",children:"ERKANNT"})]}),e.jsxs("div",{className:"bg-background/80 backdrop-blur-sm rounded-lg p-4 mb-4 border border-border/50",children:[e.jsx("p",{className:"font-bold text-base mb-1",children:L.name}),e.jsxs("p",{className:"text-xs text-muted-foreground",children:["CHF ",L.unitPrice.toFixed(2)," pro Stück"]})]}),e.jsxs("div",{className:"flex items-center justify-center gap-4 mb-4",children:[e.jsx("button",{onClick:()=>re(t=>Math.max(1,t-1)),className:"w-11 h-11 rounded-full bg-muted flex items-center justify-center text-xl font-bold active:scale-95 transition-transform",children:"−"}),e.jsx("div",{className:"w-16 h-11 rounded-lg bg-background border border-border flex items-center justify-center",children:e.jsx("span",{className:"text-2xl font-bold",children:ne})}),e.jsx("button",{onClick:()=>re(t=>t+1),className:"w-11 h-11 rounded-full bg-muted flex items-center justify-center text-xl font-bold active:scale-95 transition-transform",children:"+"})]}),e.jsxs("div",{className:"text-center mb-4 p-3 bg-background/50 rounded-lg border border-border/50",children:[e.jsx("p",{className:"text-xs text-muted-foreground mb-1",children:"Total"}),e.jsxs("p",{className:"text-xl font-bold",children:["CHF ",(L.unitPrice*ne).toFixed(2)]})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs("button",{onClick:Qs,className:"flex-1 py-3 rounded-lg bg-muted flex items-center justify-center gap-2 text-sm font-semibold active:scale-95 transition-transform",children:[e.jsx(E,{className:"w-4 h-4"}),"Abbrechen"]}),e.jsxs("button",{onClick:Ws,className:"flex-1 py-3 rounded-lg bg-green-500 text-white flex items-center justify-center gap-2 text-sm font-semibold shadow-lg active:scale-95 transition-transform",children:[e.jsx(R,{className:"w-4 h-4"}),"Hinzufügen"]})]})]}),!L&&P.length===0&&!ct&&e.jsxs("div",{className:"text-center py-8",children:[e.jsx("div",{className:"w-16 h-16 mx-auto mb-4 rounded-full bg-muted/50 flex items-center justify-center",children:e.jsx(Ge,{className:"w-8 h-8 text-muted-foreground/40"})}),e.jsx("p",{className:"text-base font-bold text-foreground mb-2",children:"Artikel scannen"}),e.jsx("p",{className:"text-xs text-muted-foreground/70 px-4",children:v?e.jsx(e.Fragment,{children:"Auto-Scan aktiv: Quittung in den Rahmen halten"}):e.jsx(e.Fragment,{children:'Quittung in den Rahmen halten und "ALLE SCANNEN" drücken'})})]}),P.length>0&&e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center justify-between mb-3 p-3 bg-green-500/10 rounded-xl border border-green-500/30 backdrop-blur-sm",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-8 h-8 rounded-full bg-green-500/20 flex items-center justify-center",children:e.jsx(kt,{className:"w-4 h-4 text-green-600"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-muted-foreground",children:"Gesamt"}),e.jsxs("p",{className:"font-bold text-sm",children:[P.reduce((t,s)=>t+s.quantity,0)," Artikel"]})]})]}),e.jsxs("div",{className:"text-right",children:[e.jsx("p",{className:"text-xs text-muted-foreground",children:"Total"}),e.jsxs("p",{className:"text-xl font-bold text-green-600",children:["CHF ",ms.toFixed(2)]})]})]}),e.jsx("div",{className:"space-y-2.5 mb-3",children:P.map((t,s)=>e.jsxs("div",{className:"p-3 bg-muted/80 backdrop-blur-sm rounded-xl border border-border/50",children:[e.jsxs("div",{className:"flex items-start justify-between mb-2.5",children:[e.jsxs("div",{className:"flex items-center gap-2.5 flex-1 min-w-0",children:[e.jsx("div",{className:"w-9 h-9 rounded-full bg-green-500 text-white text-xs font-bold flex items-center justify-center flex-shrink-0 shadow-sm",children:t.quantity}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("p",{className:"font-bold text-sm mb-0.5 truncate",children:t.name}),e.jsxs("p",{className:"text-xs text-muted-foreground",children:["CHF ",t.unitPrice.toFixed(2)," pro Stück"]})]})]}),e.jsx("button",{onClick:()=>Yt(s),className:"w-8 h-8 rounded-full bg-red-500/10 flex items-center justify-center flex-shrink-0 active:scale-95 transition-transform",children:e.jsx(E,{className:"w-4 h-4 text-red-500"})})]}),e.jsxs("div",{className:"flex items-center justify-between pt-2 border-t border-border/50",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{onClick:()=>Zt(s,t.quantity-1),className:"w-9 h-9 rounded-full bg-background border border-border flex items-center justify-center text-lg font-bold active:scale-95 transition-transform",children:"−"}),e.jsx("div",{className:"w-10 h-9 rounded-lg bg-background border border-border flex items-center justify-center",children:e.jsx("span",{className:"text-lg font-bold",children:t.quantity})}),e.jsx("button",{onClick:()=>Zt(s,t.quantity+1),className:"w-9 h-9 rounded-full bg-background border border-border flex items-center justify-center text-lg font-bold active:scale-95 transition-transform",children:"+"})]}),e.jsxs("div",{className:"text-right",children:[e.jsx("p",{className:"text-xs text-muted-foreground",children:"Total"}),e.jsxs("p",{className:"font-bold text-base",children:["CHF ",t.totalPrice.toFixed(2)]})]})]})]},s))}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs("button",{onClick:()=>{he(new Set),r.success("Positionen zurückgesetzt")},className:"px-3 py-2.5 rounded-lg bg-muted flex items-center justify-center gap-1.5 text-xs font-semibold active:scale-95 transition-transform",children:[e.jsx(ga,{className:"w-3.5 h-3.5"}),"Reset"]}),e.jsxs("button",{onClick:()=>{K([]),H(0),he(new Set)},className:"flex-1 py-2.5 rounded-lg bg-muted flex items-center justify-center gap-1.5 text-xs font-semibold active:scale-95 transition-transform",children:[e.jsx(Se,{className:"w-3.5 h-3.5"}),"Alle löschen"]}),e.jsxs("button",{onClick:Ys,className:"flex-1 py-2.5 rounded-lg bg-primary text-primary-foreground flex items-center justify-center gap-1.5 text-xs font-semibold shadow-lg active:scale-95 transition-transform",children:[e.jsx(R,{className:"w-3.5 h-3.5"}),"Fertig"]})]})]})]})]})]}),ae==="upload"&&I.length===0&&e.jsxs("div",{className:"flex-1 flex items-center justify-center p-4",children:[e.jsxs("button",{onClick:()=>Ft.current?.click(),className:"w-full max-w-sm p-8 border-2 border-dashed border-white/30 rounded-xl text-center",children:[e.jsx(yt,{className:"w-12 h-12 mx-auto text-white/50 mb-4"}),e.jsx("p",{className:"text-white font-medium",children:"Foto auswählen"}),e.jsx("p",{className:"text-white/50 text-sm mt-2",children:"JPG, PNG oder PDF"})]}),e.jsx("input",{ref:Ft,type:"file",accept:"image/*,application/pdf",capture:"environment",className:"hidden",onChange:Os})]}),j&&e.jsx("div",{className:"flex-1 flex items-center justify-center",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"w-12 h-12 border-2 border-white/30 border-t-white rounded-full animate-spin mx-auto mb-4"}),e.jsx("p",{className:"text-white",children:"Analysiere Liste..."})]})}),c&&I.length>0&&e.jsx("div",{className:"flex-1 bg-background overflow-y-auto",children:e.jsxs("div",{className:"p-4 space-y-4",children:[e.jsxs("div",{className:"bg-muted rounded-xl overflow-hidden",children:[e.jsxs("button",{onClick:()=>us(!Qe),className:"w-full p-3 flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(He,{className:"w-4 h-4 text-primary"}),e.jsx("span",{className:"font-medium",children:"Geschäft"})]}),Qe?e.jsx(St,{className:"w-4 h-4"}):e.jsx(Ct,{className:"w-4 h-4"})]}),Qe&&e.jsxs("div",{className:"px-3 pb-3 space-y-1",children:[e.jsx("p",{className:"font-semibold text-lg",children:c.store.name}),c.store.address&&e.jsx("p",{className:"text-sm text-muted-foreground",children:c.store.address}),c.store.city&&e.jsxs("p",{className:"text-sm text-muted-foreground",children:[c.store.postalCode," ",c.store.city]}),e.jsxs("div",{className:"flex gap-4 mt-2 text-xs text-muted-foreground",children:[c.purchase.date&&e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx(pa,{className:"w-3 h-3"}),new Date(c.purchase.date).toLocaleDateString("de-CH")]}),c.purchase.time&&e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx(ba,{className:"w-3 h-3"}),c.purchase.time]})]})]})]}),e.jsxs("div",{className:"bg-muted rounded-xl overflow-hidden",children:[e.jsxs("button",{onClick:()=>hs(!Ye),className:"w-full p-3 flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(kt,{className:"w-4 h-4 text-primary"}),e.jsxs("span",{className:"font-medium",children:["Artikel (",I.length,")"]}),e.jsxs("span",{className:"text-xs bg-primary text-primary-foreground px-2 py-0.5 rounded-full",children:[I.filter(t=>t.selected).length," ausgewählt"]})]}),Ye?e.jsx(St,{className:"w-4 h-4"}):e.jsx(Ct,{className:"w-4 h-4"})]}),Ye&&e.jsxs("div",{className:"px-3 pb-3",children:[e.jsx("div",{className:"flex justify-end mb-2",children:e.jsx("button",{onClick:()=>X(t=>t.map(s=>({...s,selected:!I.every(a=>a.selected)}))),className:"text-xs text-primary",children:I.every(t=>t.selected)?"Alle abwählen":"Alle auswählen"})}),e.jsx("div",{className:"space-y-2 max-h-64 overflow-y-auto",children:I.map((t,s)=>e.jsx("div",{className:`p-2.5 rounded-lg border ${t.selected?"bg-background border-primary":"bg-background/50 border-border"}`,onClick:()=>X(a=>a.map((n,o)=>o===s?{...n,selected:!n.selected}:n)),children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:`w-5 h-5 rounded border-2 ${t.selected?"bg-primary border-primary":"border-border"} flex items-center justify-center shrink-0`,children:t.selected&&e.jsx(R,{className:"w-3 h-3 text-white"})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("p",{className:"font-medium text-sm truncate",children:t.name}),e.jsxs("p",{className:"text-xs text-muted-foreground",children:[t.articleNumber&&e.jsxs("span",{className:"mr-2",children:["#",t.articleNumber]}),t.quantity,"x à CHF ",t.unitPrice.toFixed(2)]})]}),e.jsxs("p",{className:"font-semibold text-sm shrink-0",children:["CHF ",t.totalPrice.toFixed(2)]})]})},s))})]})]}),e.jsxs("div",{className:"bg-muted rounded-xl overflow-hidden",children:[e.jsxs("button",{onClick:()=>xs(!Ze),className:"w-full p-3 flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(ns,{className:"w-4 h-4 text-primary"}),e.jsx("span",{className:"font-medium",children:"Zahlung"})]}),Ze?e.jsx(St,{className:"w-4 h-4"}):e.jsx(Ct,{className:"w-4 h-4"})]}),Ze&&e.jsxs("div",{className:"px-3 pb-3 space-y-2",children:[c.totals.subtotal&&e.jsxs("div",{className:"flex justify-between text-sm",children:[e.jsx("span",{className:"text-muted-foreground",children:"Zwischensumme"}),e.jsxs("span",{children:["CHF ",c.totals.subtotal.toFixed(2)]})]}),c.totals.rounding&&e.jsxs("div",{className:"flex justify-between text-sm",children:[e.jsx("span",{className:"text-muted-foreground",children:"Rundung"}),e.jsxs("span",{children:["CHF ",c.totals.rounding.toFixed(2)]})]}),e.jsxs("div",{className:"flex justify-between font-semibold text-lg pt-2 border-t",children:[e.jsx("span",{children:"Total"}),e.jsxs("span",{children:["CHF ",c.totals.total.toFixed(2)]})]}),c.purchase.paymentMethod&&e.jsxs("div",{className:"flex items-center gap-2 text-xs text-muted-foreground",children:[e.jsx(ns,{className:"w-3 h-3"}),c.purchase.paymentMethod]})]})]}),e.jsxs("div",{className:"flex items-center justify-center gap-2 text-xs text-muted-foreground",children:[e.jsx("div",{className:`w-2 h-2 rounded-full ${c.confidence>=70?"bg-green-500":c.confidence>=40?"bg-yellow-500":"bg-red-500"}`}),"Erkennungsqualität: ",c.confidence,"%"]}),e.jsxs("div",{className:"space-y-2 pt-2",children:[e.jsxs(m,{onClick:Zs,className:"w-full",children:[e.jsx(Ue,{className:"w-4 h-4 mr-2"}),I.filter(t=>t.selected).length," Artikel zur Liste"]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(m,{variant:"outline",onClick:Js,className:"flex-1",children:[e.jsx(ja,{className:"w-4 h-4 mr-1"}),"Speichern"]}),e.jsxs(m,{variant:"outline",onClick:Xs,className:"flex-1",children:[e.jsx(Na,{className:"w-4 h-4 mr-1"}),"Zu Finanzen"]})]})]})]})})]}),zt&&e.jsxs("div",{className:"fixed inset-0 z-[100] bg-black flex flex-col",children:[e.jsxs("div",{className:"flex items-center justify-between p-4 bg-black/50",children:[e.jsx("h2",{className:"text-white font-semibold",children:"Barcode scannen"}),e.jsx("button",{onClick:ks,className:"w-10 h-10 rounded-lg bg-white/20 flex items-center justify-center",children:e.jsx(E,{className:"w-5 h-5 text-white"})})]}),e.jsxs("div",{className:"flex-1 relative flex items-center justify-center",children:[e.jsx("video",{ref:O,autoPlay:!0,playsInline:!0,className:"w-full h-full object-cover"}),e.jsx("canvas",{ref:et,className:"hidden"}),e.jsx("div",{className:"absolute inset-0 flex items-center justify-center",children:e.jsx("div",{className:"w-64 h-32 border-2 border-white rounded-lg"})}),Dt&&e.jsx("div",{className:"absolute bottom-20 left-0 right-0 text-center",children:e.jsx("p",{className:"text-white bg-black/50 px-4 py-2 rounded-lg inline-block",children:"Barcode in den Rahmen positionieren"})})]})]}),Bt&&e.jsxs("div",{className:"fixed inset-0 z-[100] bg-black flex flex-col",children:[e.jsxs("div",{className:"flex items-center justify-between p-4 bg-black/50",children:[e.jsx("h2",{className:"text-white font-semibold",children:"Produkt fotografieren"}),e.jsx("button",{onClick:Ps,className:"w-10 h-10 rounded-lg bg-white/20 flex items-center justify-center",children:e.jsx(E,{className:"w-5 h-5 text-white"})})]}),e.jsxs("div",{className:"flex-1 relative flex items-center justify-center",children:[e.jsx("video",{ref:U,autoPlay:!0,playsInline:!0,className:"w-full h-full object-cover"}),e.jsx("canvas",{ref:rt,className:"hidden"}),nt&&e.jsx("div",{className:"absolute inset-0 flex items-center justify-center bg-black/50",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"w-12 h-12 border-2 border-white/30 border-t-white rounded-full animate-spin mx-auto mb-4"}),e.jsx("p",{className:"text-white",children:"Analysiere Produkt..."})]})})]}),e.jsx("div",{className:"p-4 bg-black/50",children:e.jsx(m,{onClick:Is,disabled:nt,className:"w-full bg-primary text-primary-foreground",children:nt?"Analysiere...":"Foto aufnehmen"})})]}),e.jsx(ft,{open:is,onOpenChange:Ie,children:e.jsxs(gt,{className:"!fixed !top-[50%] !left-[50%] !right-auto !bottom-auto !translate-x-[-50%] !translate-y-[-50%] !w-[85vw] !max-w-sm !max-h-[90vh] !rounded-3xl !m-0 !overflow-hidden !shadow-2xl !flex !flex-col",children:[e.jsxs(pt,{className:"px-5 pt-5 pb-3 flex-shrink-0",children:[e.jsx(bt,{className:"text-lg font-semibold",children:"Einkaufslisten"}),e.jsx(jt,{className:"sr-only",children:"Verwalten Sie Ihre Einkaufslisten"})]}),e.jsx("div",{className:"px-5 pb-2 overflow-y-auto flex-1 min-h-0 space-y-2",children:S.map(t=>e.jsx("div",{className:"flex items-center gap-2 p-3 border rounded-lg",children:os===t.id?e.jsxs("div",{className:"flex-1 flex items-center gap-2",children:[e.jsx(G,{value:Q,onChange:s=>Y(s.target.value),className:"flex-1 h-9",placeholder:"Listenname",autoFocus:!0}),e.jsx(m,{size:"sm",onClick:()=>Ts(t.id,Q),className:"h-9",children:e.jsx(R,{className:"w-4 h-4"})}),e.jsx(m,{variant:"ghost",size:"sm",onClick:()=>{Ve(null),Y("")},className:"h-9",children:e.jsx(E,{className:"w-4 h-4"})})]}):e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("p",{className:"font-medium",children:t.name}),t.isDefault&&e.jsx("p",{className:"text-xs text-muted-foreground",children:"Standard"})]}),e.jsx(m,{variant:"ghost",size:"sm",onClick:()=>{Ve(t.id),Y(t.name)},className:"h-9 w-9 p-0",children:e.jsx(yt,{className:"w-4 h-4"})}),!t.isDefault&&e.jsx(m,{variant:"ghost",size:"sm",onClick:()=>Es(t.id),className:"h-9 w-9 p-0 text-red-500",children:e.jsx(Se,{className:"w-4 h-4"})})]})},t.id))}),e.jsxs(Nt,{className:"px-5 pb-3 pt-2 gap-2.5 flex-shrink-0",children:[e.jsx(m,{variant:"outline",onClick:()=>Ie(!1),className:"h-11 min-h-[44px] flex-1 rounded-xl text-sm font-medium",children:"Schließen"}),e.jsxs(m,{onClick:()=>{Ie(!1),Pe(!0)},className:"h-11 min-h-[44px] flex-1 rounded-xl text-sm font-medium",children:[e.jsx(Ue,{className:"w-4 h-4 mr-2"}),"Neue Liste"]})]})]})}),e.jsx(ft,{open:cs,onOpenChange:Pe,children:e.jsxs(gt,{className:"!fixed !top-[50%] !left-[50%] !right-auto !bottom-auto !translate-x-[-50%] !translate-y-[-50%] !w-[85vw] !max-w-sm !max-h-fit !rounded-3xl !m-0 !overflow-visible !shadow-2xl !flex !flex-col",children:[e.jsxs(pt,{className:"px-5 pt-5 pb-3 flex-shrink-0",children:[e.jsx(bt,{className:"text-lg font-semibold",children:"Neue Liste erstellen"}),e.jsx(jt,{className:"sr-only",children:"Erstellen Sie eine neue Einkaufsliste"})]}),e.jsx("div",{className:"space-y-3 px-5 pb-2 overflow-y-auto flex-1 min-h-0",children:e.jsxs("div",{className:"w-full",children:[e.jsx(ss,{className:"text-sm font-medium",children:"Listenname *"}),e.jsx(G,{value:Q,onChange:t=>Y(t.target.value),placeholder:"z.B. Wochenendeinkauf",className:"h-11 min-h-[44px] mt-1.5 rounded-xl w-full",onKeyDown:t=>{t.key==="Enter"&&Ot()}})]})}),e.jsxs(Nt,{className:"px-5 pb-3 pt-2 gap-2.5 flex-shrink-0",children:[e.jsx(m,{variant:"outline",onClick:()=>{Pe(!1),Y("")},className:"h-11 min-h-[44px] flex-1 rounded-xl text-sm font-medium",children:"Abbrechen"}),e.jsx(m,{onClick:Ot,disabled:!Q.trim(),className:"h-11 min-h-[44px] flex-1 rounded-xl text-sm font-medium",children:"Erstellen"})]})]})}),!It&&!Lt&&!Pt&&!zt&&!Bt&&!A&&e.jsxs("div",{className:"fixed right-4 bottom-20 flex flex-col gap-3 safe-bottom",children:[e.jsx("button",{onClick:ea,className:"w-12 h-12 rounded-full bg-secondary text-secondary-foreground shadow-lg flex items-center justify-center active:opacity-80 transition-opacity",children:e.jsx(Ge,{className:"w-5 h-5"})}),e.jsx("button",{onClick:()=>Ae(!0),className:"w-12 h-12 rounded-full bg-secondary text-secondary-foreground shadow-lg flex items-center justify-center active:opacity-80 transition-opacity",title:"Mehrere Artikel hinzufügen",children:e.jsx(wa,{className:"w-5 h-5"})}),e.jsx("button",{onClick:()=>_e(!0),className:"w-14 h-14 rounded-full bg-primary text-primary-foreground shadow-lg flex items-center justify-center active:opacity-80 transition-opacity",children:e.jsx(Ue,{className:"w-6 h-6"})})]})]})}export{$a as M};
