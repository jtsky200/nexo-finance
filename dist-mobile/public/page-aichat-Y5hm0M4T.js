import*as ke from"react";import Ot,{createContext as Lt,useContext as _t,useMemo as pe,useRef as G,useCallback as ie,useState as N,useEffect as Z}from"react";import"./vendor-i18n-CxwOOByA.js";import{s as mn,c as fn,X as Ze,W as Ut,C as at,a as xt,b as $t,S as Ht,d as hn,e as gn,f as pn,g as Ae,M as xn,L as vt,h as wt,B as ot,U as rt,i as Ue,j as $e,k as Ye,F as Kt,l as it,m as bn,H as yn,T as vn,n as wn,o as Wt,p as Yt,q as jn,P as Nn,I as Dn,r as Ct,t as qt,A as Sn,u as Cn,v as En,w as kn,x as An,y as In,E as Fn,z as Tn,D as Rn,G as zn,J as Mn,K as Pn,N as Et,O as Bn}from"./vendor-misc-BRDLU_5e.js";import{u as Je,L as On}from"./vendor-router-CMtzw8r1.js";import{S as Ln,R as _n,C as Un,a as $n,D as Hn,T as Kn,P as Wn,O as Yn,b as qn,c as Gn,d as Vn,I as Zn,V as Jn,e as Xn,f as Qn,g as es,h as ts,i as ns,j as ss,k as as,l as rs,m as is,n as os,o as ls,p as cs,q as ds,r as us,s as ms}from"./vendor-ui-DVrlQOBx.js";import{t as fs,c as hs}from"./vendor-utils-BNe0Xlio.js";import{i as gs,g as ps,a as xs,b as bs,c as ys,d as vs,o as ws,s as js,G as Ns,e as Ds,f as Ss,h as Cs,q as ue,w as ye,j as qe,T as kt,k as lt,l as Ge,m as $}from"./vendor-firebase-VgF4ygFz.js";import{t as w}from"./vendor-toast-CdQ6zwVl.js";import{c as Es}from"./vendor-api-CiTlhuVb.js";const ks="modulepreload",As=function(t){return"/"+t},At={},Is=function(n,s,i){let r=Promise.resolve();if(s&&s.length>0){let g=function(u){return Promise.all(u.map(h=>Promise.resolve(h).then(f=>({status:"fulfilled",value:f}),f=>({status:"rejected",reason:f}))))};document.getElementsByTagName("link");const c=document.querySelector("meta[property=csp-nonce]"),d=c?.nonce||c?.getAttribute("nonce");r=g(s.map(u=>{if(u=As(u),u in At)return;At[u]=!0;const h=u.endsWith(".css"),f=h?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${u}"]${f}`))return;const p=document.createElement("link");if(p.rel=h?"stylesheet":ks,h||(p.as="script"),p.crossOrigin="",p.href=u,d&&p.setAttribute("nonce",d),document.head.appendChild(p),h)return new Promise((y,a)=>{p.addEventListener("load",y),p.addEventListener("error",()=>a(new Error(`Unable to preload CSS for ${u}`)))})}))}function o(c){const d=new Event("vite:preloadError",{cancelable:!0});if(d.payload=c,window.dispatchEvent(d),!d.defaultPrevented)throw c}return r.then(c=>{for(const d of c||[])d.status==="rejected"&&o(d.reason);return n().catch(o)})};var $a=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function Ha(t){return t&&t.__esModule&&Object.prototype.hasOwnProperty.call(t,"default")?t.default:t}var mt={exports:{}},He={};/**
 * @license React
 * react-jsx-runtime.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var It;function Fs(){if(It)return He;It=1;var t=Ot,n=Symbol.for("react.element"),s=Symbol.for("react.fragment"),i=Object.prototype.hasOwnProperty,r=t.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,o={key:!0,ref:!0,__self:!0,__source:!0};function c(d,g,u){var h,f={},p=null,y=null;u!==void 0&&(p=""+u),g.key!==void 0&&(p=""+g.key),g.ref!==void 0&&(y=g.ref);for(h in g)i.call(g,h)&&!o.hasOwnProperty(h)&&(f[h]=g[h]);if(d&&d.defaultProps)for(h in g=d.defaultProps,g)f[h]===void 0&&(f[h]=g[h]);return{$$typeof:n,type:d,key:p,ref:y,props:f,_owner:r.current}}return He.Fragment=s,He.jsx=c,He.jsxs=c,He}var Ft;function Ts(){return Ft||(Ft=1,mt.exports=Fs()),mt.exports}var e=Ts();const Rs=(t,n,s,i)=>{const r=[s,{code:n,...i||{}}];if(t?.services?.logger?.forward)return t.services.logger.forward(r,"warn","react-i18next::",!0);Ie(r[0])&&(r[0]=`react-i18next:: ${r[0]}`),t?.services?.logger?.warn?t.services.logger.warn(...r):console?.warn&&console.warn(...r)},Tt={},Gt=(t,n,s,i)=>{Ie(s)&&Tt[s]||(Ie(s)&&(Tt[s]=new Date),Rs(t,n,s,i))},Vt=(t,n)=>()=>{if(t.isInitialized)n();else{const s=()=>{setTimeout(()=>{t.off("initialized",s)},0),n()};t.on("initialized",s)}},bt=(t,n,s)=>{t.loadNamespaces(n,Vt(t,s))},Rt=(t,n,s,i)=>{if(Ie(s)&&(s=[s]),t.options.preload&&t.options.preload.indexOf(n)>-1)return bt(t,s,i);s.forEach(r=>{t.options.ns.indexOf(r)<0&&t.options.ns.push(r)}),t.loadLanguages(n,Vt(t,i))},zs=(t,n,s={})=>!n.languages||!n.languages.length?(Gt(n,"NO_LANGUAGES","i18n.languages were undefined or empty",{languages:n.languages}),!0):n.hasLoadedNamespace(t,{lng:s.lng,precheck:(i,r)=>{if(s.bindI18n&&s.bindI18n.indexOf("languageChanging")>-1&&i.services.backendConnector.backend&&i.isLanguageChangingTo&&!r(i.isLanguageChangingTo,t))return!1}}),Ie=t=>typeof t=="string",Ms=t=>typeof t=="object"&&t!==null,Ps=/&(?:amp|#38|lt|#60|gt|#62|apos|#39|quot|#34|nbsp|#160|copy|#169|reg|#174|hellip|#8230|#x2F|#47);/g,Bs={"&amp;":"&","&#38;":"&","&lt;":"<","&#60;":"<","&gt;":">","&#62;":">","&apos;":"'","&#39;":"'","&quot;":'"',"&#34;":'"',"&nbsp;":" ","&#160;":" ","&copy;":"©","&#169;":"©","&reg;":"®","&#174;":"®","&hellip;":"…","&#8230;":"…","&#x2F;":"/","&#47;":"/"},Os=t=>Bs[t],Ls=t=>t.replace(Ps,Os);let yt={bindI18n:"languageChanged",bindI18nStore:"",transEmptyNodeValue:"",transSupportBasicHtmlNodes:!0,transWrapTextNodes:"",transKeepBasicHtmlNodesFor:["br","strong","i","p"],useSuspense:!0,unescape:Ls,transDefaultProps:void 0};const _s=(t={})=>{yt={...yt,...t}},Us=()=>yt;let Zt;const $s=t=>{Zt=t},Hs=()=>Zt,Ka={type:"3rdParty",init(t){_s(t.options.react),$s(t)}},Ks=Lt();class Ws{constructor(){this.usedNamespaces={}}addUsedNamespaces(n){n.forEach(s=>{this.usedNamespaces[s]||(this.usedNamespaces[s]=!0)})}getUsedNamespaces(){return Object.keys(this.usedNamespaces)}}const Ys=(t,n)=>Ie(n)?n:Ms(n)&&Ie(n.defaultValue)?n.defaultValue:Array.isArray(t)?t[t.length-1]:t,qs={t:Ys,ready:!1},Gs=()=>()=>{},Jt=(t,n={})=>{const{i18n:s}=n,{i18n:i,defaultNS:r}=_t(Ks)||{},o=s||i||Hs();o&&!o.reportNamespaces&&(o.reportNamespaces=new Ws),o||Gt(o,"NO_I18NEXT_INSTANCE","useTranslation: You will need to pass in an i18next instance by using initReactI18next");const c=pe(()=>({...Us(),...o?.options?.react,...n}),[o,n]),{useSuspense:d,keyPrefix:g}=c,u=r||o?.options?.defaultNS,h=Ie(u)?[u]:u||["translation"],f=pe(()=>h,h);o?.reportNamespaces?.addUsedNamespaces?.(f);const p=G(0),y=ie(A=>{if(!o)return Gs;const{bindI18n:D,bindI18nStore:F}=c,W=()=>{p.current+=1,A()};return D&&o.on(D,W),F&&o.store.on(F,W),()=>{D&&D.split(" ").forEach(te=>o.off(te,W)),F&&F.split(" ").forEach(te=>o.store.off(te,W))}},[o,c]),a=G(),b=ie(()=>{if(!o)return qs;const A=!!(o.isInitialized||o.initializedStoreOnce)&&f.every(V=>zs(V,o,c)),D=n.lng||o.language,F=p.current,W=a.current;if(W&&W.ready===A&&W.lng===D&&W.keyPrefix===g&&W.revision===F)return W;const L={t:o.getFixedT(D,c.nsMode==="fallback"?f:f[0],g),ready:A,lng:D,keyPrefix:g,revision:F};return a.current=L,L},[o,f,g,c,n.lng]),[C,I]=N(0),{t:B,ready:ee}=mn.useSyncExternalStore(y,b,b);Z(()=>{if(o&&!ee&&!d){const A=()=>I(D=>D+1);n.lng?Rt(o,n.lng,f,A):bt(o,f,A)}},[o,n.lng,f,ee,d,C]);const K=o||{},J=G(null),ne=G(),X=A=>{const D=Object.getOwnPropertyDescriptors(A);D.__original&&delete D.__original;const F=Object.create(Object.getPrototypeOf(A),D);if(!Object.prototype.hasOwnProperty.call(F,"__original"))try{Object.defineProperty(F,"__original",{value:A,writable:!1,enumerable:!1,configurable:!1})}catch{}return F},oe=pe(()=>{const A=K,D=A?.language;let F=A;A&&(J.current&&J.current.__original===A?ne.current!==D?(F=X(A),J.current=F,ne.current=D):F=J.current:(F=X(A),J.current=F,ne.current=D));const W=[B,F,ee];return W.t=B,W.i18n=F,W.ready=ee,W},[B,K,ee,K.resolvedLanguage,K.language,K.languages]);if(o&&d&&!ee)throw new Promise(A=>{const D=()=>A();n.lng?Rt(o,n.lng,f,D):bt(o,f,D)});return oe},Vs=Es(),Zs={apiKey:"AIzaSyCZ8V17HUVMlBKXK0ftrMURS-XP2zIsOps",authDomain:"nexo-jtsky100.firebaseapp.com",projectId:"nexo-jtsky100",storageBucket:"nexo-jtsky100.firebasestorage.app",messagingSenderId:"859320186482",appId:"1:859320186482:web:0c9dcca5d8ce613aaf34eb",measurementId:"G-G8PX4GB2YF"},ct=gs(Zs),Me=ps(ct),Ve=xs(ct),H=bs(ct,"us-central1");typeof window<"u"&&ys(ct);const Xt=Lt(void 0);function Wa({children:t}){const[n,s]=N(null),[i,r]=N(!0),[o,c]=N(null);Z(()=>(vs(Me).then(b=>{b?.user&&s(b.user)}).catch(b=>{}),ws(Me,b=>{s(b),r(!1)})),[]);const d=async(a,b)=>{try{c(null);const C=await Ss(Me,a,b)}catch(C){let I="Anmeldung fehlgeschlagen";switch(C.code){case"auth/invalid-email":I="Ungültige E-Mail-Adresse";break;case"auth/user-disabled":I="Dieses Konto wurde deaktiviert";break;case"auth/user-not-found":I="Kein Konto mit dieser E-Mail gefunden";break;case"auth/wrong-password":I="Falsches Passwort";break;case"auth/invalid-credential":I="Ungültige Anmeldedaten";break;default:I=C.message||"Ein Fehler ist aufgetreten"}throw c(I),new Error(I)}},g=async(a,b)=>{try{c(null);const C=await Cs(Me,a,b)}catch(C){let I="Registrierung fehlgeschlagen";switch(C.code){case"auth/email-already-in-use":I="Diese E-Mail wird bereits verwendet";break;case"auth/invalid-email":I="Ungültige E-Mail-Adresse";break;case"auth/weak-password":I="Passwort ist zu schwach";break;default:I=C.message||"Ein Fehler ist aufgetreten"}throw c(I),new Error(I)}},u=async()=>{try{c(null);const a=new Ns;a.addScope("email"),a.addScope("profile"),a.setCustomParameters({prompt:"select_account"}),await Ds(Me,a)}catch(a){let b="Ein Fehler ist aufgetreten";switch(a.code){case"auth/unauthorized-domain":b="Diese Domain ist nicht autorisiert. Bitte kontaktieren Sie den Administrator.";break;case"auth/operation-not-allowed":b="Google Sign-In ist nicht aktiviert.";break;case"auth/network-request-failed":b="Netzwerkfehler. Bitte überprüfen Sie Ihre Internetverbindung.";break;default:b=a.message||"Ein unbekannter Fehler ist aufgetreten"}throw c(b),new Error(b)}},h=async()=>{try{await js(Me)}catch{throw new Error("Abmeldung fehlgeschlagen")}},f=d,p=u,y=h;return e.jsx(Xt.Provider,{value:{user:n,loading:i,error:o,signIn:d,signUp:g,signInWithGoogle:u,signOut:h,loginWithEmail:f,loginWithGoogle:p,logout:y},children:t})}function Xe(){const t=_t(Xt);if(t===void 0)throw new Error("useAuth must be used within an AuthProvider");return t}const Js={maxRetries:3,initialDelay:1e3,maxDelay:1e4,backoffMultiplier:2,retryableErrors:["network","timeout","ECONNRESET","ETIMEDOUT","ENOTFOUND","EAI_AGAIN","500","502","503","504"]};function Xs(t,n){if(!t)return!1;const s=t.message?.toLowerCase()||"",i=t.code?.toLowerCase()||"",r=t.status?.toString()||"";return n.some(o=>{const c=o.toLowerCase();return s.includes(c)||i.includes(c)||r.includes(c)})}function Qs(t,n){const s=n.initialDelay*Math.pow(n.backoffMultiplier,t);return Math.min(s,n.maxDelay)}async function ea(t,n={}){const s={...Js,...n};let i;for(let r=0;r<=s.maxRetries;r++)try{return await t()}catch(o){if(i=o,r>=s.maxRetries||!Xs(o,s.retryableErrors))break;const c=Qs(r,s);await new Promise(d=>setTimeout(d,c))}throw i}async function Ce(t,n,s={}){return ea(async()=>(await t(n)).data,s)}const jt={maxRetries:3,initialDelay:1e3},Qe={maxRetries:2,initialDelay:500};function ta(t){const[n,s]=N([]),[i,r]=N(!0),[o,c]=N(null),{user:d}=Xe();return Z(()=>{if(!d){s([]),r(!1);return}r(!0);let u=ue(qe(Ve,"reminders"),ye("userId","==",d.uid));t?.status&&(u=ue(u,ye("status","==",t.status))),t?.startDate&&(u=ue(u,ye("dueDate",">=",kt.fromDate(t.startDate)))),t?.endDate&&(u=ue(u,ye("dueDate","<=",kt.fromDate(t.endDate)))),u=ue(u,lt("dueDate"));const h=Ge(u,f=>{try{const p=f.docs.map(y=>{const a=y.data();if(!a)return null;let b=new Date;if(a.dueDate){if(a.dueDate.toDate&&typeof a.dueDate.toDate=="function")b=a.dueDate.toDate();else if(a.dueDate instanceof Date)b=a.dueDate;else if(typeof a.dueDate=="string"){const B=new Date(a.dueDate);isNaN(B.getTime())||(b=B)}}let C=new Date;if(a.createdAt){if(a.createdAt.toDate&&typeof a.createdAt.toDate=="function")C=a.createdAt.toDate();else if(a.createdAt instanceof Date)C=a.createdAt;else if(typeof a.createdAt=="string"){const B=new Date(a.createdAt);isNaN(B.getTime())||(C=B)}}let I=new Date;if(a.updatedAt){if(a.updatedAt.toDate&&typeof a.updatedAt.toDate=="function")I=a.updatedAt.toDate();else if(a.updatedAt instanceof Date)I=a.updatedAt;else if(typeof a.updatedAt=="string"){const B=new Date(a.updatedAt);isNaN(B.getTime())||(I=B)}}return{id:y.id,userId:a.userId||d.uid,title:a.title||"",type:a.type||"erinnerung",dueDate:b,isAllDay:a.isAllDay||!1,amount:a.amount||null,currency:a.currency||"CHF",notes:a.notes||null,recurrenceRule:a.recurrenceRule||null,personId:a.personId||null,personName:a.personName||null,status:a.status||"offen",createdAt:C,updatedAt:I}}).filter(y=>y!==null);s(p),c(null)}catch(p){c(p),console.error("[useReminders] Error processing snapshot:",p)}finally{r(!1)}},f=>{f?.code==="failed-precondition"&&(console.error("[useReminders] Firestore index missing:",f.message),w.error("Index fehlt - Bitte Firebase Console prüfen")),c(f),r(!1),console.error("[useReminders] Snapshot error:",f)});return()=>h()},[d,t?.startDate,t?.endDate,t?.status]),{data:n,isLoading:i,error:o,refetch:()=>{s(u=>[...u])}}}async function Qt(t){const n=$(H,"createReminder");return Ce(n,t,jt)}async function Ya(t,n){const s=$(H,"updateReminder");await Ce(s,{id:t,...n},Qe)}async function qa(t){const n=$(H,"deleteReminder");await Ce(n,{id:t},Qe)}function Ga(t){const[n,s]=N([]),[i,r]=N(!0),[o,c]=N(null),{user:d}=Xe();return Z(()=>{if(!d){s([]),r(!1);return}r(!0);let u=ue(qe(Ve,"financeEntries"),ye("userId","==",d.uid));u=ue(u,lt("date","desc"));const h=Ge(u,f=>{try{const p=f.docs.map(y=>{const a=y.data();if(!a)return null;let b=new Date;if(a.date){if(a.date.toDate&&typeof a.date.toDate=="function")b=a.date.toDate();else if(a.date instanceof Date)b=a.date;else if(typeof a.date=="string"){const B=new Date(a.date);isNaN(B.getTime())||(b=B)}}let C=new Date;if(a.createdAt){if(a.createdAt.toDate&&typeof a.createdAt.toDate=="function")C=a.createdAt.toDate();else if(a.createdAt instanceof Date)C=a.createdAt;else if(typeof a.createdAt=="string"){const B=new Date(a.createdAt);isNaN(B.getTime())||(C=B)}}let I=new Date;if(a.updatedAt){if(a.updatedAt.toDate&&typeof a.updatedAt.toDate=="function")I=a.updatedAt.toDate();else if(a.updatedAt instanceof Date)I=a.updatedAt;else if(typeof a.updatedAt=="string"){const B=new Date(a.updatedAt);isNaN(B.getTime())||(I=B)}}return{id:y.id,userId:a.userId||d.uid,type:a.type||"ausgabe",category:a.category||"",description:a.description||"",amount:a.amount||0,currency:a.currency||"CHF",paymentMethod:a.paymentMethod||"Karte",date:b,isRecurring:a.isRecurring||!1,recurrenceRule:a.recurrenceRule||null,createdAt:C,updatedAt:I}}).filter(y=>y!==null);s(p),c(null)}catch(p){c(p),console.error("[useFinanceEntries] Error processing snapshot:",p)}finally{r(!1)}},f=>{f?.code==="failed-precondition"&&(console.error("[useFinanceEntries] Firestore index missing:",f.message),w.error("Index fehlt - Bitte Firebase Console prüfen")),c(f),r(!1),console.error("[useFinanceEntries] Snapshot error:",f)});return()=>h()},[d,t?.startDate,t?.endDate,t?.type]),{data:n,isLoading:i,error:o,refetch:()=>{s(u=>[...u])}}}async function en(t){const n=$(H,"createFinanceEntry");return Ce(n,t,jt)}async function Va(t,n){const s=$(H,"updateFinanceEntry");await Ce(s,{id:t,...n},Qe)}function Za(t){const[n,s]=N([]),[i,r]=N(!0),[o,c]=N(null);return Z(()=>{(async()=>{try{r(!0),c(null);const f=((await $(H,"getTaxProfiles")({})).data.profiles||[]).map(p=>({...p,createdAt:p.createdAt?.toDate?p.createdAt.toDate():p.createdAt?new Date(p.createdAt):new Date,updatedAt:p.updatedAt?.toDate?p.updatedAt.toDate():p.updatedAt?new Date(p.updatedAt):new Date}));s(f)}catch(g){console.error("Error fetching tax profiles:",g),c(g),s([])}finally{r(!1)}})()},[t]),{data:n,isLoading:i,error:o}}async function Ja(t){await $(H,"deleteTaxProfile")({id:t})}function Xa(){const[t,n]=N([]),[s,i]=N(!0),[r,o]=N(null),{user:c}=Xe();return Z(()=>{if(!c){n([]),i(!1);return}i(!0);let g=ue(qe(Ve,"people"),ye("userId","==",c.uid));try{g=ue(g,lt("createdAt","desc"))}catch{console.warn("[usePeople] Index missing for createdAt, using unsorted query")}const u=Ge(g,h=>{try{const p=h.docs.map(y=>{const a=y.data();if(!a)return null;let b=new Date;if(a.createdAt){if(a.createdAt.toDate&&typeof a.createdAt.toDate=="function")b=a.createdAt.toDate();else if(a.createdAt instanceof Date)b=a.createdAt;else if(typeof a.createdAt=="string"){const I=new Date(a.createdAt);isNaN(I.getTime())||(b=I)}}let C=new Date;if(a.updatedAt){if(a.updatedAt.toDate&&typeof a.updatedAt.toDate=="function")C=a.updatedAt.toDate();else if(a.updatedAt instanceof Date)C=a.updatedAt;else if(typeof a.updatedAt=="string"){const I=new Date(a.updatedAt);isNaN(I.getTime())||(C=I)}}return{id:y.id,userId:a.userId||c.uid,name:a.name||"",email:a.email||null,phone:a.phone||null,totalOwed:a.totalOwed||0,currency:a.currency||"CHF",createdAt:b,updatedAt:C}}).filter(y=>y!==null).sort((y,a)=>a.createdAt.getTime()-y.createdAt.getTime());n(p),o(null)}catch(f){o(f),console.error("[usePeople] Error processing snapshot:",f)}finally{i(!1)}},h=>{if(h?.code==="failed-precondition"){console.error("[usePeople] Firestore index missing:",h.message);const f=ue(qe(Ve,"people"),ye("userId","==",c.uid)),p=Ge(f,y=>{try{const a=y.docs.map(b=>{const C=b.data();return C?{id:b.id,userId:C.userId||c.uid,name:C.name||"",email:C.email||null,phone:C.phone||null,totalOwed:C.totalOwed||0,currency:C.currency||"CHF",createdAt:C.createdAt?.toDate?.()||new Date,updatedAt:C.updatedAt?.toDate?.()||new Date}:null}).filter(b=>b!==null);n(a.sort((b,C)=>C.createdAt.getTime()-b.createdAt.getTime())),o(null)}catch(a){o(a),console.error("[usePeople] Error processing fallback snapshot:",a)}finally{i(!1)}},y=>{o(y),i(!1),console.error("[usePeople] Fallback snapshot error:",y)});return()=>p()}else o(h),i(!1),console.error("[usePeople] Snapshot error:",h)});return()=>u()},[c]),{data:t,isLoading:s,error:r,refetch:()=>{n(g=>[...g])}}}async function Qa(t){const n=$(H,"createPerson");return Ce(n,t,jt)}async function er(t,n){const s=$(H,"updatePerson");await Ce(s,{personId:t,...n},Qe)}async function tr(t){const n=$(H,"deletePerson");await Ce(n,{personId:t},Qe)}function nr(t){const[n,s]=N([]),[i,r]=N(!0),[o,c]=N(null),[d,g]=N(0);return Z(()=>{(async()=>{try{r(!0);const a=(await $(H,"getShoppingList")({status:t})).data.items.map(b=>({...b,boughtAt:b.boughtAt?.toDate?b.boughtAt.toDate():b.boughtAt?new Date(b.boughtAt):null,createdAt:b.createdAt?.toDate?b.createdAt.toDate():new Date(b.createdAt),updatedAt:b.updatedAt?.toDate?b.updatedAt.toDate():new Date(b.updatedAt)}));s(a),c(null)}catch(f){c(f)}finally{r(!1)}})()},[t,d]),{data:n,isLoading:i,error:o,refetch:()=>g(h=>h+1)}}async function na(t){return(await $(H,"createShoppingItem")(t)).data}async function sr(t){await $(H,"deleteShoppingItem")({itemId:t})}async function ar(t,n,s){return(await $(H,"markShoppingItemAsBought")({itemId:t,actualPrice:n,createExpense:s})).data}function sa(){const[t,n]=N([]),[s,i]=N(!0),[r,o]=N(null),{user:c}=Xe();return Z(()=>{if(!c){n([]),i(!1);return}i(!0);const g=ue(qe(Ve,"chatConversations"),ye("userId","==",c.uid),lt("updatedAt","desc")),u=Ge(g,h=>{try{const f=h.docs.map(p=>{const y=p.data();let a=new Date;y.createdAt&&(y.createdAt.toDate?a=y.createdAt.toDate().toISOString():typeof y.createdAt=="string"?a=y.createdAt:a=new Date(y.createdAt).toISOString());let b=new Date;return y.updatedAt&&(y.updatedAt.toDate?b=y.updatedAt.toDate().toISOString():typeof y.updatedAt=="string"?b=y.updatedAt:b=new Date(y.updatedAt).toISOString()),{id:p.id,userId:y.userId||c.uid,title:y.title||"Neue Konversation",messages:y.messages||[],createdAt:a,updatedAt:b}});f.sort((p,y)=>{const a=typeof p.updatedAt=="string"?new Date(p.updatedAt).getTime():p.updatedAt.getTime();return(typeof y.updatedAt=="string"?new Date(y.updatedAt).getTime():y.updatedAt.getTime())-a}),n(f),o(null)}catch(f){console.error("Error processing chat conversations:",f),o(f)}finally{i(!1)}},h=>{h.code==="permission-denied"?console.warn("[useChatConversations] Permission denied - user may not be authenticated"):h.code==="failed-precondition"?(console.warn("[useChatConversations] Index missing - query may need an index"),w.error("Index fehlt. Bitte warten Sie, bis der Index erstellt wurde.")):console.error("[useChatConversations] Firestore listener error:",h),o(h),i(!1),n([])});return()=>u()},[c]),{data:t,isLoading:s,error:r,refetch:async()=>{}}}const Ke=new Map,aa=300*1e3,ra=500;function tn(t,n){const[s,i]=N(null),[r,o]=N(!1),[c,d]=N(null),g=G(null);return Z(()=>{if(g.current&&(clearTimeout(g.current),g.current=null),!t){i(null),d(null),o(!1);return}const h=`${t.toISOString().split("T")[0]}_${n||"no-location"}`,f=Ke.get(h);if(f&&Date.now()-f.timestamp<aa){i(f.data),d(f.error),o(!1);return}return g.current=setTimeout(async()=>{try{if(o(!0),d(null),!n){const b=new Error("Location ist erforderlich. Bitte in den Einstellungen einen Standort eingeben.");d(b),i(null),o(!1),Ke.set(h,{data:null,timestamp:Date.now(),error:b});return}const a=(await $(H,"getWeather")({date:t.toISOString(),location:n})).data;if(a)i(a),d(null),Ke.set(h,{data:a,timestamp:Date.now(),error:null});else{const b=new Date;b.setHours(0,0,0,0);const C=new Date(t);C.setHours(0,0,0,0);const I=C<b?new Error("Historische Wetterdaten sind nur aus dem Cache verfügbar."):new Error("Keine Wetterdaten verfügbar. Bitte überprüfen Sie den Standort in den Einstellungen.");d(I),i(null),Ke.set(h,{data:null,timestamp:Date.now(),error:I})}}catch(p){p?.code!=="internal"&&!p?.message?.includes("ERR_INSUFFICIENT_RESOURCES")&&console.error("[useWeather] Error:",p);const y=p?.message||p?.code||"Unbekannter Fehler beim Laden der Wetterdaten",a=new Error(y);d(a),i(null),Ke.set(h,{data:null,timestamp:Date.now(),error:a})}finally{o(!1)}},ra),()=>{g.current&&(clearTimeout(g.current),g.current=null)}},[t?.toISOString(),n]),{data:s,isLoading:r,error:c}}function Nt(){const[t,n]=N(null),[s,i]=N(!0),[r,o]=N(null);Z(()=>{(async()=>{try{i(!0),o(null);const h=(await $(H,"getUserSettings")({})).data;n(h)}catch(g){o(g)}finally{i(!1)}})()},[]);const c=ie(async d=>{try{return await $(H,"updateUserSettings")(d),n(u=>u?{...u,...d}:d),{success:!0}}catch(g){throw o(g),g}},[]);return{settings:t,isLoading:s,error:r,updateSettings:c}}async function ia(t){return(await $(H,"createChatConversation")(t)).data}async function oa(t,n){await $(H,"updateChatConversation")({id:t,...n})}async function la(){return(await $(H,"clearAllChatConversations")({})).data}function z(...t){return fs(hs(t))}const ca=fn("inline-flex items-center justify-center gap-2 whitespace-nowrap rounded-md text-sm font-medium transition-all disabled:pointer-events-none disabled:opacity-50 [&_svg]:pointer-events-none [&_svg:not([class*='size-'])]:size-4 shrink-0 [&_svg]:shrink-0 outline-none focus-visible:border-ring focus-visible:ring-ring/50 focus-visible:ring-[3px] aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive",{variants:{variant:{default:"bg-primary text-primary-foreground hover:bg-primary/90",destructive:"bg-destructive text-white hover:bg-destructive/90 focus-visible:ring-destructive/20 dark:focus-visible:ring-destructive/40 dark:bg-destructive/60",outline:"border bg-transparent shadow-xs hover:bg-accent dark:bg-transparent dark:border-input dark:hover:bg-input/50",secondary:"bg-secondary text-secondary-foreground hover:bg-secondary/80",ghost:"hover:bg-accent dark:hover:bg-accent/50",link:"text-primary underline-offset-4 hover:underline"},size:{default:"h-9 px-4 py-2 has-[>svg]:px-3",sm:"h-8 rounded-md gap-1.5 px-3 has-[>svg]:px-2.5",lg:"h-10 rounded-md px-6 has-[>svg]:px-4",icon:"size-9","icon-sm":"size-8","icon-lg":"size-10"}},defaultVariants:{variant:"default",size:"default"}});function U({className:t,variant:n,size:s,asChild:i=!1,...r}){const o=i?Ln:"button";return e.jsx(o,{"data-slot":"button",className:z(ca({variant:n,size:s,className:t})),...r})}function da({className:t,...n}){return e.jsx("div",{"data-slot":"card",className:z("bg-card text-card-foreground flex flex-col gap-6 rounded-xl border py-6 shadow-sm",t),...n})}function rr({className:t,...n}){return e.jsx("div",{"data-slot":"card-header",className:z("@container/card-header grid auto-rows-min grid-rows-[auto_auto] items-start gap-2 px-6 has-data-[slot=card-action]:grid-cols-[1fr_auto] [.border-b]:pb-6",t),...n})}function ir({className:t,...n}){return e.jsx("div",{"data-slot":"card-title",className:z("leading-none font-semibold",t),...n})}function or({className:t,...n}){return e.jsx("div",{"data-slot":"card-description",className:z("text-muted-foreground text-sm",t),...n})}function ua({className:t,...n}){return e.jsx("div",{"data-slot":"card-content",className:z("px-6",t),...n})}const et="glassEffectEnabled";function nn(){const{settings:t,updateSettings:n,isLoading:s}=Nt(),[i,r]=N(()=>{if(t?.glassEffectEnabled!==void 0)return t.glassEffectEnabled;const c=localStorage.getItem(et);return c!==null?c==="true":!0});return Z(()=>{if(!s&&t?.glassEffectEnabled!==void 0)r(t.glassEffectEnabled);else if(!s&&!t?.glassEffectEnabled){const c=localStorage.getItem(et);if(c!==null){const d=c==="true";n({glassEffectEnabled:d}).then(()=>{localStorage.removeItem(et)}).catch(console.error),r(d)}}},[t?.glassEffectEnabled,s,n]),Z(()=>{!s&&n&&(n({glassEffectEnabled:i}).catch(console.error),localStorage.setItem(et,String(i)))},[i,s,n]),{isEnabled:i,toggle:()=>{r(c=>!c)},setIsEnabled:r}}const sn=ke.createContext({isComposing:()=>!1,setComposing:()=>{},justEndedComposing:()=>!1,markCompositionEnd:()=>{}}),Dt=()=>ke.useContext(sn);function ve({...t}){const n=ke.useRef(!1),s=ke.useRef(!1),i=ke.useRef(null),r=ke.useMemo(()=>({isComposing:()=>n.current,setComposing:o=>{n.current=o},justEndedComposing:()=>s.current,markCompositionEnd:()=>{s.current=!0,i.current&&clearTimeout(i.current),i.current=setTimeout(()=>{s.current=!1},150)}}),[]);return e.jsx(sn.Provider,{value:r,children:e.jsx(_n,{"data-slot":"dialog",...t})})}function ma({...t}){return e.jsx(Wn,{"data-slot":"dialog-portal",...t})}function an({className:t,...n}){return e.jsx(Yn,{"data-slot":"dialog-overlay",className:z("data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 fixed inset-0 z-50 bg-black/50",t),...n})}an.displayName="DialogOverlay";function we({className:t,children:n,showCloseButton:s=!0,onEscapeKeyDown:i,...r}){const{isComposing:o}=Dt(),c=ke.useCallback(d=>{if(d.isComposing||o()){d.preventDefault();return}i?.(d)},[o,i]);return e.jsxs(ma,{"data-slot":"dialog-portal",children:[e.jsx(an,{}),e.jsxs(Un,{"data-slot":"dialog-content",className:z("bg-background data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 fixed top-0 left-0 right-0 bottom-0 z-50 flex flex-col w-full h-full border-0 shadow-lg duration-200 sm:top-[50%] sm:left-[50%] sm:right-auto sm:bottom-auto sm:translate-x-[-50%] sm:translate-y-[-50%] sm:max-w-lg sm:h-auto sm:max-h-[90vh] sm:rounded-lg sm:border sm:m-4 sm:flex sm:flex-col",t),onEscapeKeyDown:c,...r,children:[n,s&&e.jsxs($n,{"data-slot":"dialog-close",className:"ring-offset-background focus:ring-ring data-[state=open]:bg-accent data-[state=open]:text-muted-foreground absolute top-4 right-4 rounded-xs opacity-70 transition-opacity hover:opacity-100 focus:ring-2 focus:ring-offset-2 focus:outline-hidden disabled:pointer-events-none [&_svg]:pointer-events-none [&_svg]:shrink-0 [&_svg:not([class*='size-'])]:size-4",children:[e.jsx(Ze,{}),e.jsx("span",{className:"sr-only",children:"Close"})]})]})]})}function je({className:t,...n}){return e.jsx("div",{"data-slot":"dialog-header",className:z("flex flex-col gap-2 text-center sm:text-left",t),...n})}function Ne({className:t,...n}){return e.jsx("div",{"data-slot":"dialog-footer",className:z("flex flex-col-reverse gap-2 sm:flex-row sm:justify-end",t),...n})}function De({className:t,...n}){return e.jsx(Kn,{"data-slot":"dialog-title",className:z("text-lg leading-none font-semibold",t),...n})}function Se({className:t,...n}){return e.jsx(Hn,{"data-slot":"dialog-description",className:z("text-muted-foreground text-sm",t),...n})}function fa({selectedDate:t}){const{settings:n,isLoading:s}=Nt(),i=n?.weatherLocation||"Zurich, CH",{data:r,isLoading:o,error:c}=tn(t,i);Ot.useEffect(()=>{},[t,i,s,r,o,c]);const d=u=>{switch(u){case"sun":return e.jsx(Ht,{className:"w-5 h-5"});case"cloud-sun":return e.jsx($t,{className:"w-5 h-5"});case"cloud":return e.jsx(at,{className:"w-5 h-5"});case"rain":return e.jsx(xt,{className:"w-5 h-5"});case"snow":return e.jsx(xt,{className:"w-5 h-5"});default:return e.jsx(at,{className:"w-5 h-5"})}};if(!t)return null;const g=t.toLocaleDateString("de-CH",{weekday:"long",day:"numeric",month:"long"});return e.jsxs("div",{className:"p-3 border-b border-border",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("h4",{className:"text-xs font-semibold text-muted-foreground",children:"Wetter"}),e.jsx("span",{className:"text-[10px] text-muted-foreground",children:g})]}),o?e.jsx("div",{className:"flex items-center justify-center py-4",children:e.jsx("div",{className:"text-xs text-muted-foreground",children:"Lädt..."})}):r?e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[d(r.icon),e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-baseline gap-1",children:[e.jsxs("span",{className:"text-lg font-bold",children:[r.temperature,"°"]}),e.jsx("span",{className:"text-xs text-muted-foreground",children:"C"})]}),e.jsx("div",{className:"text-[10px] text-muted-foreground",children:r.condition})]})]}),r.humidity!==void 0&&r.windSpeed!==void 0&&e.jsxs("div",{className:"flex gap-3 text-[9px] text-muted-foreground pt-1 border-t border-border/50",children:[e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(Ut,{className:"w-3 h-3"}),e.jsxs("span",{children:[r.windSpeed," km/h"]})]}),e.jsx("div",{children:e.jsxs("span",{children:["Luftfeuchtigkeit: ",r.humidity,"%"]})})]})]}):c?e.jsxs("div",{className:"space-y-1",children:[e.jsx("div",{className:"text-xs text-muted-foreground text-center py-2",children:c.message||"Fehler beim Laden der Wetterdaten"}),e.jsxs("div",{className:"text-[10px] text-muted-foreground/70 text-center",children:["Standort: ",i]})]}):s?e.jsx("div",{className:"flex items-center justify-center py-4",children:e.jsx("div",{className:"text-xs text-muted-foreground",children:"Lädt Einstellungen..."})}):e.jsxs("div",{className:"space-y-1",children:[e.jsx("div",{className:"text-xs text-muted-foreground text-center py-2",children:"Keine Wetterdaten verfügbar"}),e.jsxs("div",{className:"text-[10px] text-muted-foreground/70 text-center",children:["Standort: ",i]})]})]})}function lr(t){if(!t||!t.includes("T"))throw new Error("Invalid datetime-local format. Expected: YYYY-MM-DDTHH:mm");const[n,s]=t.split("T"),[i,r,o]=n.split("-").map(Number),[c,d]=s?s.split(":").map(Number):[0,0];return new Date(i,r-1,o,c,d,0,0)}function cr(t,n){if(!t)return"N/A";try{let s;if(t?.toDate&&typeof t.toDate=="function")s=t.toDate();else if(typeof t=="string")s=new Date(t);else if(t instanceof Date)s=t;else return"N/A";if(isNaN(s.getTime()))return"N/A";const i=s.getDate().toString().padStart(2,"0"),r=(s.getMonth()+1).toString().padStart(2,"0"),o=s.getFullYear();return n?.includeTime,`${i}.${r}.${o}`}catch{return"N/A"}}function tt(t){if(!t)return tt(new Date);try{let n;if(t?.toDate&&typeof t.toDate=="function")n=t.toDate();else if(typeof t=="string")n=new Date(t);else if(t instanceof Date)n=t;else return tt(new Date);if(isNaN(n.getTime()))return tt(new Date);const s=n.getFullYear(),i=(n.getMonth()+1).toString().padStart(2,"0"),r=n.getDate().toString().padStart(2,"0"),o=n.getHours().toString().padStart(2,"0"),c=n.getMinutes().toString().padStart(2,"0");return`${s}-${i}-${r}T${o}:${c}`}catch{return tt(new Date)}}function zt(t,n=!1){if(!t)return"N/A";try{let s;if(t?.toDate&&typeof t.toDate=="function")s=t.toDate();else if(typeof t=="string")s=new Date(t);else if(t instanceof Date)s=t;else return"N/A";if(isNaN(s.getTime()))return"N/A";const i=s.getHours().toString().padStart(2,"0"),r=s.getMinutes().toString().padStart(2,"0");if(n){const o=s.getSeconds().toString().padStart(2,"0");return`${i}:${r}:${o}`}return`${i}:${r}`}catch{return"N/A"}}function Mt(t){if(!t)return"";try{let n;if(typeof t=="object"&&t!==null&&"toDate"in t&&typeof t.toDate=="function")n=t.toDate();else if(t instanceof Date)n=t;else if(typeof t=="string"){if(!t.includes("T")&&t.match(/^\d{4}-\d{2}-\d{2}$/))return t;n=new Date(t)}else n=new Date(t);if(isNaN(n.getTime()))return"";const s=n.getFullYear(),i=String(n.getMonth()+1).padStart(2,"0"),r=String(n.getDate()).padStart(2,"0");return`${s}-${i}-${r}`}catch{return""}}function de(t){if(!(t instanceof Date)||isNaN(t.getTime()))throw new Error("Invalid date: must be a valid Date object");const n=t.getFullYear(),s=String(t.getMonth()+1).padStart(2,"0"),i=String(t.getDate()).padStart(2,"0");return`${n}-${s}-${i}`}function ce(t){if(!t)return"";try{let n;if(typeof t=="string")if(t.match(/^\d{4}-\d{2}-\d{2}$/)){const[o,c,d]=t.split("-").map(Number);n=new Date(o,c-1,d)}else n=new Date(t);else if(t instanceof Date)n=t;else return"";if(isNaN(n.getTime()))return"";const s=String(n.getDate()).padStart(2,"0"),i=String(n.getMonth()+1).padStart(2,"0"),r=n.getFullYear();return`${s}.${i}.${r}`}catch{return""}}function _e(t){if(!t)return"";try{t=t.trim();const n=t.split(".");if(n.length===3){const s=parseInt(n[0],10),i=parseInt(n[1],10),r=parseInt(n[2],10);if(isNaN(s)||isNaN(i)||isNaN(r))return"";const o=new Date(r,i-1,s);return o.getDate()!==s||o.getMonth()!==i-1||o.getFullYear()!==r?"":`${r}-${String(i).padStart(2,"0")}-${String(s).padStart(2,"0")}`}return t.match(/^\d{4}-\d{2}-\d{2}$/)?t:""}catch{return""}}function dr(t){if(!t)return"";try{let n;if(typeof t=="string")if(t.includes("T")){const[d,g]=t.split("T"),[u,h,f]=d.split("-").map(Number),[p,y]=g?g.split(":").map(Number):[0,0];n=new Date(u,h-1,f,p,y)}else if(t.match(/^\d{4}-\d{2}-\d{2}$/)){const[d,g,u]=t.split("-").map(Number);n=new Date(d,g-1,u)}else n=new Date(t);else if(t instanceof Date)n=t;else return"";if(isNaN(n.getTime()))return"";const s=String(n.getDate()).padStart(2,"0"),i=String(n.getMonth()+1).padStart(2,"0"),r=n.getFullYear(),o=String(n.getHours()).padStart(2,"0"),c=String(n.getMinutes()).padStart(2,"0");return`${s}.${i}.${r} ${o}:${c}`}catch{return""}}function ur(t){if(!t)return"";try{t=t.trim();const n=t.split(" ");if(n.length===2){const s=n[0],i=n[1],r=s.split(".");if(r.length===3){const o=parseInt(r[0],10),c=parseInt(r[1],10),d=parseInt(r[2],10),g=i.split(":"),u=g.length>=1?parseInt(g[0],10):0,h=g.length>=2?parseInt(g[1],10):0;if(isNaN(o)||isNaN(c)||isNaN(d)||isNaN(u)||isNaN(h))return"";const f=new Date(d,c-1,o,u,h);return f.getDate()!==o||f.getMonth()!==c-1||f.getFullYear()!==d?"":`${d}-${String(c).padStart(2,"0")}-${String(o).padStart(2,"0")}T${String(u).padStart(2,"0")}:${String(h).padStart(2,"0")}`}}return t.match(/^\d{4}-\d{2}-\d{2}T\d{2}:\d{2}/)?t:""}catch{return""}}function ha(){const[,t]=Je(),[n,s]=N(new Date),[i,r]=N([]),[o,c]=N(!1),[d,g]=N(null),[u,h]=N(null),[f,p]=N(!1),[y,a]=N(!1),[b,C]=N(!1),[I,B]=N(!1),[ee,K]=N(ce(new Date)),[J,ne]=N(ce(new Date)),{data:X=[]}=ta(),{settings:oe}=Nt(),A=oe?.weatherLocation||"Zurich, CH",D=d?new Date(d.getFullYear(),d.getMonth(),d.getDate()):null,{data:F,isLoading:W}=tn(D,A);Z(()=>{if(!d){const m=new Date,v=new Date(m.getFullYear(),m.getMonth(),m.getDate());g(v)}},[]);const te=["Januar","Februar","März","April","Mai","Juni","Juli","August","September","Oktober","November","Dezember"],L=["Mo","Di","Mi","Do","Fr","Sa","So"],V=ie(async()=>{try{c(!0);const m=$(H,"getCalendarEvents"),v=$(H,"getVacations"),E=$(H,"getSchoolSchedules"),O=$(H,"getSchoolHolidays"),R=new Date(n.getFullYear(),n.getMonth()-1,1),M=new Date(n.getFullYear(),n.getMonth()+2,0),[j,T,_,P]=await Promise.all([m({startDate:R.toISOString(),endDate:M.toISOString()}).catch(()=>({data:{events:[]}})),v({startDate:R.toISOString(),endDate:M.toISOString()}).catch(()=>({data:{vacations:[]}})),E({startDate:R.toISOString(),endDate:M.toISOString()}).catch(()=>({data:{schedules:[]}})),O({startDate:R.toISOString(),endDate:M.toISOString()}).catch(()=>({data:{holidays:[]}}))]),Y=j.data,ae=T.data,he=_.data,dt=P.data,ut=[...Y.events||[],...(ae.vacations||[]).map(Q=>({id:`vacation-${Q.id}`,type:"work",title:Q.title||"Ferien",date:Q.startDate,description:Q.description})),...(he.schedules||[]).map(Q=>({id:`school-${Q.id}`,type:"school",title:Q.childName?`${Q.childName} - Schule`:"Schule",date:Q.date,schoolType:Q.type})),...(dt.holidays||[]).map(Q=>({id:`holiday-${Q.id}`,type:"school-holiday",title:Q.title||"Schulferien",date:Q.date}))];r(ut)}catch{}finally{c(!1)}},[n]);Z(()=>{V()},[V]);const Fe=m=>{const v=new Date(m),E=v.getDay(),O=v.getDate()-(E===0?6:E-1);return new Date(v.setDate(O))},me=pe(()=>{const m=Fe(n),v=[],E=O=>{const R=de(O),M=i.filter(P=>{if(!P.date)return!1;let Y=Mt(P.date);if(!Y&&typeof P.date=="string"){const ae=P.date.split("T")[0];ae.match(/^\d{4}-\d{2}-\d{2}/)&&(Y=ae)}return Y===R}),T=X.filter(P=>{if(!P.dueDate)return!1;let Y;if(P.dueDate instanceof Date)Y=P.dueDate;else if(typeof P.dueDate=="string")Y=new Date(P.dueDate);else return!1;return isNaN(Y.getTime())?!1:de(Y)===R}).map(P=>{let Y="appointment";P.type==="termin"?Y="appointment":P.type==="zahlung"?Y="due":P.type==="aufgabe"&&(Y="reminder");let ae;if(P.dueDate instanceof Date)ae=P.dueDate;else if(typeof P.dueDate=="string")ae=new Date(P.dueDate);else throw new Error(`Invalid dueDate for reminder ${P.id}`);return{id:`reminder-${P.id}`,type:Y,title:P.title,date:de(ae),time:P.isAllDay?void 0:zt(ae),description:P.notes||void 0,status:P.status}}),_=[...M];for(const P of T)_.some(Y=>Y.id===P.id)||_.push(P);return _};for(let O=0;O<7;O++){const R=new Date(m);R.setDate(m.getDate()+O);const M=E(R);v.push({date:R,events:M})}return v},[n,i,X]),xe=()=>{const m=new Date(n);m.setDate(m.getDate()-7),s(m)},Te=()=>{const m=new Date(n);m.setDate(m.getDate()+7),s(m)},se=()=>{s(new Date)},fe=m=>{const v=new Date;return m.toDateString()===v.toDateString()},Re=m=>{const v=new Date(m.getFullYear(),m.getMonth(),m.getDate());console.log("[SidebarCalendar] handleDayClick:",{originalDate:m.toISOString(),normalizedDate:v.toISOString(),dateStr:de(v)}),g(v),p(!0)},ze=m=>{const v=new Date(m.getFullYear(),m.getMonth(),m.getDate());g(v)},Ee=m=>{h(m),a(!0)},x=pe(()=>{if(!d)return console.log("[SidebarCalendar] dayEvents - no selectedDate"),[];const m=new Date(d.getFullYear(),d.getMonth(),d.getDate()),v=de(m);console.log("[SidebarCalendar] dayEvents filter - START:",{selectedDate:d.toISOString(),normalizedSelectedDate:m.toISOString(),dateStr:v,totalEvents:i.length,totalReminders:X.length});const E=i.filter(j=>{if(!j.date)return console.log("[SidebarCalendar] Event skipped - no date:",j.title),!1;let T=Mt(j.date);if(!T&&typeof j.date=="string"){const P=j.date.split("T")[0];P.match(/^\d{4}-\d{2}-\d{2}/)&&(T=P,console.log("[SidebarCalendar] Using fallback date extraction for filter:",T))}if(!T)return console.log("[SidebarCalendar] Event skipped - invalid date:",j.title,j.date),!1;const _=T===v;return _&&console.log("[SidebarCalendar] Event matched:",{eventTitle:j.title,eventDate:j.date,eventDateStr:T,selectedDateStr:v}),_}),O=X.filter(j=>{if(!j.dueDate)return!1;let T;if(j.dueDate instanceof Date)T=j.dueDate;else if(typeof j.dueDate=="string")T=new Date(j.dueDate);else return!1;return isNaN(T.getTime())?!1:de(T)===v});console.log("[SidebarCalendar] Reminders for date:",{dateStr:v,remindersForDate:O.length,reminders:O.map(j=>({id:j.id,title:j.title,dueDate:j.dueDate}))});const R=O.map(j=>{let T="appointment";j.type==="termin"?T="appointment":j.type==="zahlung"?T="due":j.type==="aufgabe"&&(T="reminder");let _;if(j.dueDate instanceof Date)_=j.dueDate;else if(typeof j.dueDate=="string")_=new Date(j.dueDate);else throw new Error(`Invalid dueDate for reminder ${j.id}`);return{id:`reminder-${j.id}`,type:T,title:j.title,date:de(_),time:j.isAllDay?void 0:zt(_),description:j.notes||void 0,status:j.status}}),M=[...E];for(const j of R)M.some(T=>T.id===j.id)||M.push(j);return console.log("[SidebarCalendar] dayEvents filter - RESULT:",{selectedDate:m.toISOString(),dateStr:v,filteredFromEvents:E.length,fromReminders:R.length,totalDayEvents:M.length,allDayEvents:M.map(j=>({id:j.id,title:j.title,date:j.date,type:j.type}))}),M},[d,i,X]),k=m=>{switch(m){case"due":return"bg-pink-500";case"reminder":case"appointment":case"termin":return"bg-orange-500";case"work":return"bg-slate-400";case"vacation":case"frei":return"bg-emerald-400";case"school-holiday":return"bg-sky-400";case"school":return"bg-purple-400";case"hort":return"bg-fuchsia-500";default:return"bg-gray-500"}};return e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"p-2 border-b border-border",children:[e.jsxs("div",{className:"flex items-center justify-between mb-1.5",children:[e.jsx(U,{variant:"ghost",size:"sm",onClick:xe,className:"h-5 w-5 p-0 min-w-0",children:e.jsx(hn,{className:"w-3 h-3"})}),e.jsx("div",{className:"flex-1 text-center px-1",children:e.jsxs("h3",{className:"text-[11px] font-semibold leading-tight",children:[te[n.getMonth()]," ",n.getFullYear()]})}),e.jsx(U,{variant:"ghost",size:"sm",onClick:Te,className:"h-5 w-5 p-0 min-w-0",children:e.jsx(gn,{className:"w-3 h-3"})})]}),e.jsx("div",{className:"grid grid-cols-7 gap-0",children:L.map((m,v)=>{const E=me[v],O=E?fe(E.date):!1;return e.jsxs("div",{className:"flex flex-col items-center",children:[e.jsx("div",{className:"text-center text-[10px] font-medium text-muted-foreground mb-1 w-full",children:m}),E&&e.jsxs("button",{onClick:()=>{ze(E.date),Re(E.date)},className:z("w-full aspect-square min-h-[28px] max-h-[30px] rounded-sm transition-colors flex flex-col items-center justify-center relative","text-foreground",d&&E.date.toDateString()===d.toDateString()?"bg-primary/20 ring-1 ring-primary":O?"bg-primary text-primary-foreground font-semibold":"hover:bg-muted/50"),children:[e.jsx("span",{className:"text-[12px] leading-none font-medium",children:E.date.getDate()}),E.events.length>0&&e.jsx("div",{className:"absolute bottom-0.5 left-0 right-0 flex gap-0.5 justify-center",children:E.events.slice(0,2).map((R,M)=>e.jsx("div",{onClick:j=>{j.stopPropagation(),Ee(R)},className:z("h-0.5 w-0.5 rounded-full",k(R.type)),title:R.title},M))})]})]},v)})}),e.jsx(U,{variant:"ghost",size:"sm",onClick:se,className:"w-full h-6 mt-1.5 text-[10px]",children:"Heute"})]}),e.jsx(fa,{selectedDate:d}),e.jsx(ve,{open:f,onOpenChange:p,children:e.jsxs(we,{className:"!fixed !top-[50%] !left-[50%] !right-auto !bottom-auto !translate-x-[-50%] !translate-y-[-50%] !w-[85vw] !max-w-sm !max-h-[85vh] !rounded-3xl !m-0 !overflow-y-auto !shadow-2xl",children:[e.jsxs(je,{className:"px-5 pt-5 pb-3 sticky top-0 bg-background z-10 border-b border-border",children:[e.jsx(Se,{className:"sr-only",children:"Details für den ausgewählten Tag mit Wetter, Terminen und Schnellaktionen"}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx(De,{className:"text-lg font-semibold",children:d?.toLocaleDateString("de-CH",{weekday:"long",day:"numeric",month:"long",year:"numeric"})}),e.jsx(U,{variant:"ghost",size:"sm",onClick:()=>p(!1),className:"h-8 w-8 p-0",children:e.jsx(Ze,{className:"h-4 w-4"})})]})]}),e.jsxs("div",{className:"space-y-4 px-5 pb-2",children:[e.jsxs("div",{className:"bg-muted/30 rounded-xl p-4 space-y-3",children:[e.jsx("div",{className:"flex items-center justify-between",children:e.jsxs("h3",{className:"text-sm font-semibold flex items-center gap-2",children:[e.jsx(at,{className:"w-4 h-4"}),"Wetter"]})}),W?e.jsx("div",{className:"flex items-center justify-center py-4",children:e.jsx("div",{className:"text-xs text-muted-foreground",children:"Lädt Wetterdaten..."})}):F?e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[F.icon==="sun"&&e.jsx(Ht,{className:"w-6 h-6 text-yellow-500"}),F.icon==="cloud-sun"&&e.jsx($t,{className:"w-6 h-6 text-gray-500"}),F.icon==="cloud"&&e.jsx(at,{className:"w-6 h-6 text-gray-500"}),F.icon==="rain"&&e.jsx(xt,{className:"w-6 h-6 text-blue-500"}),e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-baseline gap-1",children:[e.jsxs("span",{className:"text-2xl font-bold",children:[F.temperature,"°"]}),e.jsx("span",{className:"text-sm text-muted-foreground",children:"C"})]}),e.jsx("div",{className:"text-xs text-muted-foreground",children:F.condition})]})]}),(F.humidity!==void 0||F.windSpeed!==void 0)&&e.jsxs("div",{className:"flex gap-4 text-xs text-muted-foreground pt-2 border-t border-border/50",children:[F.windSpeed!==void 0&&e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(Ut,{className:"w-3 h-3"}),e.jsxs("span",{children:[F.windSpeed," km/h"]})]}),F.humidity!==void 0&&e.jsx("div",{children:e.jsxs("span",{children:["Luftfeuchtigkeit: ",F.humidity,"%"]})})]})]}):e.jsx("div",{className:"text-xs text-muted-foreground text-center py-2",children:"Keine Wetterdaten verfügbar"})]}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-sm font-semibold mb-2",children:"Termine & Events"}),x.length===0?e.jsx("p",{className:"text-sm text-muted-foreground text-center py-4 bg-muted/30 rounded-lg",children:"Keine Events an diesem Tag"}):e.jsx("div",{className:"space-y-2",children:x.map(m=>e.jsx(da,{className:"cursor-pointer hover:bg-muted/50 transition-colors",onClick:()=>{p(!1),Ee(m)},children:e.jsx(ua,{className:"p-3",children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("div",{className:z("w-3 h-3 rounded-full mt-1 flex-shrink-0",k(m.type))}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("p",{className:"font-medium text-sm truncate",children:m.title}),m.time&&e.jsx("p",{className:"text-xs text-muted-foreground mt-1",children:m.time}),m.personName&&e.jsx("p",{className:"text-xs text-muted-foreground mt-1",children:m.personName})]})]})})},m.id))})]}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-sm font-semibold mb-2",children:"Schnellaktionen"}),e.jsxs("div",{className:"grid grid-cols-2 gap-2",children:[e.jsxs(U,{variant:"outline",onClick:()=>{C(!0)},className:"h-auto py-3 flex flex-col items-center gap-2 rounded-xl",children:[e.jsx(pn,{className:"w-5 h-5"}),e.jsx("span",{className:"text-xs",children:"Termin erstellen"})]}),e.jsxs(U,{variant:"outline",onClick:()=>{B(!0)},className:"h-auto py-3 flex flex-col items-center gap-2 rounded-xl",children:[e.jsx(Ae,{className:"w-5 h-5"}),e.jsx("span",{className:"text-xs",children:"Finanz-Eintrag"})]})]})]})]}),e.jsxs(Ne,{className:"px-5 pb-3 pt-2 sticky bottom-0 bg-background border-t border-border",children:[e.jsx(U,{variant:"outline",onClick:()=>{try{p(!1),setTimeout(()=>{try{t("/calendar")}catch(m){console.error("Navigation error:",m),w.error("Fehler beim Navigieren zum Kalender")}},100)}catch(m){console.error("Dialog close error:",m),w.error("Fehler beim Schließen des Dialogs")}},className:"h-11 min-h-[44px] flex-1 rounded-xl text-sm font-medium",children:"Zum Kalender"}),e.jsx(U,{variant:"default",onClick:()=>p(!1),className:"h-11 min-h-[44px] flex-1 rounded-xl text-sm font-medium",children:"Schließen"})]})]})}),e.jsx(ve,{open:b,onOpenChange:m=>{C(m),m&&K(ce(d||new Date))},children:e.jsxs(we,{className:"!fixed !top-[50%] !left-[50%] !right-auto !bottom-auto !translate-x-[-50%] !translate-y-[-50%] !w-[85vw] !max-w-sm !max-h-fit !rounded-3xl !m-0 !overflow-visible !shadow-2xl",children:[e.jsxs(je,{className:"px-5 pt-5 pb-3",children:[e.jsx(De,{className:"text-lg font-semibold",children:"Termin erstellen"}),e.jsx(Se,{className:"sr-only",children:"Erstellen Sie einen neuen Termin mit Titel, Datum, Uhrzeit und optionalen Notizen"})]}),e.jsxs("div",{className:"px-5 pb-2 space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium mb-1 block",children:"Titel"}),e.jsx("input",{type:"text",id:"reminder-title",placeholder:"z.B. Arzttermin",className:"w-full px-3 py-2 border border-border rounded-lg text-sm",autoFocus:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium mb-1 block",children:"Datum"}),e.jsx("input",{type:"text",id:"reminder-date",placeholder:"DD.MM.YYYY",value:ee,onChange:m=>{const v=m.target.value;K(v)},onBlur:m=>{const v=_e(m.target.value);v?K(ce(v)):m.target.value&&d&&K(ce(d))},className:"w-full px-3 py-2 border border-border rounded-lg text-sm"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium mb-1 block",children:"Uhrzeit (optional)"}),e.jsx("input",{type:"time",id:"reminder-time",className:"w-full px-3 py-2 border border-border rounded-lg text-sm"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium mb-1 block",children:"Notizen (optional)"}),e.jsx("textarea",{id:"reminder-notes",placeholder:"Weitere Details...",rows:3,className:"w-full px-3 py-2 border border-border rounded-lg text-sm resize-none"})]})]}),e.jsxs(Ne,{className:"px-5 pb-3 pt-2",children:[e.jsx(U,{variant:"outline",onClick:()=>C(!1),className:"h-11 min-h-[44px] flex-1 rounded-xl text-sm font-medium",children:"Abbrechen"}),e.jsx(U,{variant:"default",onClick:async()=>{try{const m=document.getElementById("reminder-title"),v=document.getElementById("reminder-date"),E=document.getElementById("reminder-time"),O=document.getElementById("reminder-notes");if(!m.value.trim()){w.error("Bitte gib einen Titel ein");return}const R=_e(v.value);if(!R){w.error("Bitte gib ein gültiges Datum ein (DD.MM.YYYY)");return}const M=new Date(R);if(E.value){const[j,T]=E.value.split(":");M.setHours(parseInt(j),parseInt(T))}else M.setHours(12,0);await Qt({title:m.value.trim(),type:"termin",dueDate:M,isAllDay:!E.value,notes:O.value.trim()||null}),w.success("Termin erstellt"),C(!1),p(!1),V()}catch(m){w.error(m.message||"Fehler beim Erstellen des Termins")}},className:"h-11 min-h-[44px] flex-1 rounded-xl text-sm font-medium",children:"Erstellen"})]})]})}),e.jsx(ve,{open:I,onOpenChange:m=>{B(m),m&&ne(ce(d||new Date))},children:e.jsxs(we,{className:"!fixed !top-[50%] !left-[50%] !right-auto !bottom-auto !translate-x-[-50%] !translate-y-[-50%] !w-[85vw] !max-w-sm !max-h-fit !rounded-3xl !m-0 !overflow-visible !shadow-2xl",children:[e.jsxs(je,{className:"px-5 pt-5 pb-3",children:[e.jsx(De,{className:"text-lg font-semibold",children:"Finanz-Eintrag erstellen"}),e.jsx(Se,{className:"sr-only",children:"Erstellen Sie einen neuen Finanz-Eintrag mit Beschreibung, Betrag, Typ und Datum"})]}),e.jsxs("div",{className:"px-5 pb-2 space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium mb-1 block",children:"Beschreibung"}),e.jsx("input",{type:"text",id:"finance-description",placeholder:"z.B. Einkauf, Gehalt",className:"w-full px-3 py-2 border border-border rounded-lg text-sm",autoFocus:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium mb-1 block",children:"Betrag (CHF)"}),e.jsx("input",{type:"number",id:"finance-amount",placeholder:"0.00",step:"0.01",className:"w-full px-3 py-2 border border-border rounded-lg text-sm"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium mb-1 block",children:"Typ"}),e.jsxs("select",{id:"finance-type",className:"w-full px-3 py-2 border border-border rounded-lg text-sm",children:[e.jsx("option",{value:"einnahme",children:"Einnahme"}),e.jsx("option",{value:"ausgabe",children:"Ausgabe"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium mb-1 block",children:"Datum"}),e.jsx("input",{type:"text",id:"finance-date",placeholder:"DD.MM.YYYY",value:J,onChange:m=>{const v=m.target.value;ne(v)},onBlur:m=>{const v=_e(m.target.value);v?ne(ce(v)):m.target.value&&d&&ne(ce(d))},className:"w-full px-3 py-2 border border-border rounded-lg text-sm"})]})]}),e.jsxs(Ne,{className:"px-5 pb-3 pt-2",children:[e.jsx(U,{variant:"outline",onClick:()=>B(!1),className:"h-11 min-h-[44px] flex-1 rounded-xl text-sm font-medium",children:"Abbrechen"}),e.jsx(U,{variant:"default",onClick:async()=>{try{const m=document.getElementById("finance-description"),v=document.getElementById("finance-amount"),E=document.getElementById("finance-type"),O=document.getElementById("finance-date");if(!m.value.trim()){w.error("Bitte gib eine Beschreibung ein");return}const R=_e(O.value);if(!R){w.error("Bitte gib ein gültiges Datum ein (DD.MM.YYYY)");return}if(!v.value||parseFloat(v.value)<=0){w.error("Bitte gib einen gültigen Betrag ein");return}await en({description:m.value.trim(),amount:Math.round(parseFloat(v.value)*100),type:E.value,date:new Date(R),category:"Sonstiges",currency:"CHF",isRecurring:!1}),w.success("Finanz-Eintrag erstellt"),B(!1),p(!1)}catch(m){w.error(m.message||"Fehler beim Erstellen des Finanz-Eintrags")}},className:"h-11 min-h-[44px] flex-1 rounded-xl text-sm font-medium",children:"Erstellen"})]})]})}),e.jsx(ve,{open:y,onOpenChange:a,children:e.jsxs(we,{className:"!fixed !top-[50%] !left-[50%] !right-auto !bottom-auto !translate-x-[-50%] !translate-y-[-50%] !w-[85vw] !max-w-sm !max-h-fit !rounded-3xl !m-0 !overflow-visible !shadow-2xl",children:[e.jsxs(je,{className:"px-5 pt-5 pb-3",children:[e.jsx(De,{className:"text-lg font-semibold",children:u?.title}),e.jsx(Se,{className:"sr-only",children:"Detaillierte Informationen zum ausgewählten Event"})]}),e.jsxs("div",{className:"space-y-3 px-5 pb-2",children:[u?.date&&e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-muted-foreground mb-1",children:"Datum"}),e.jsx("p",{className:"text-sm",children:new Date(u.date).toLocaleDateString("de-CH",{weekday:"long",day:"numeric",month:"long",year:"numeric"})})]}),u?.time&&e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-muted-foreground mb-1",children:"Uhrzeit"}),e.jsx("p",{className:"text-sm",children:u.time})]}),u?.description&&e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-muted-foreground mb-1",children:"Beschreibung"}),e.jsx("p",{className:"text-sm",children:u.description})]}),u?.personName&&e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-muted-foreground mb-1",children:"Person"}),e.jsx("p",{className:"text-sm",children:u.personName})]}),u?.amount&&e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-muted-foreground mb-1",children:"Betrag"}),e.jsxs("p",{className:"text-sm",children:["CHF ",u.amount.toFixed(2)]})]})]}),e.jsxs(Ne,{className:"px-5 pb-3 pt-2",children:[e.jsx(U,{variant:"outline",onClick:()=>{a(!1),t("/calendar")},className:"h-11 min-h-[44px] w-full rounded-xl text-sm font-medium",children:"Zum Kalender"}),e.jsx(U,{variant:"outline",onClick:()=>a(!1),className:"h-11 min-h-[44px] w-full rounded-xl text-sm font-medium",children:"Schließen"})]})]})})]})}const ga=[{path:"/",icon:xn,label:"Assistent"},{path:"/dashboard",icon:vt,label:"Dashboard"},{path:"/calendar",icon:wt,label:"Kalender"},{path:"/reminders",icon:ot,label:"Erinnerungen"},{path:"/finance",icon:Ae,label:"Finanzen"},{path:"/people",icon:rt,label:"Personen"},{path:"/bills",icon:Ue,label:"Rechnungen"},{path:"/documents",icon:$e,label:"Dokumente"},{path:"/shopping",icon:Ye,label:"Einkaufen"},{path:"/taxes",icon:Kt,label:"Steuern"},{path:"/settings",icon:it,label:"Einstellungen"}];function pa({open:t,onClose:n,currentChatId:s,onSelectChat:i,onNewChat:r}){const[o]=Je(),{user:c}=Xe(),{isEnabled:d}=nn(),g=()=>{if(c?.displayName){const u=c.displayName.split(" ");return u.length>=2?(u[0][0]+u[1][0]).toUpperCase():c.displayName.substring(0,2).toUpperCase()}return c?.email?c.email.substring(0,2).toUpperCase():"U"};return e.jsxs(e.Fragment,{children:[t&&e.jsx("div",{className:z("fixed inset-0 z-40 transition-opacity",d?"bg-black/5":"bg-black/50"),onClick:n}),e.jsx("aside",{className:z("fixed top-0 left-0 h-full w-full max-w-sm z-50 transform transition-transform duration-300 ease-in-out shadow-xl",t?"translate-x-0":"-translate-x-full",d?"bg-background/95 backdrop-blur-md":"bg-background"),"aria-label":"Hauptnavigation","aria-hidden":!t,children:e.jsxs("div",{className:"flex flex-col h-full",children:[e.jsx("div",{className:"p-4 border-b border-border",children:e.jsxs("div",{className:"flex items-center gap-3 mb-3",children:[e.jsx("button",{onClick:n,className:"p-2 hover:bg-muted rounded-lg transition-colors","aria-label":"Menü schließen",tabIndex:t?0:-1,children:e.jsx(Ze,{className:"w-5 h-5"})}),e.jsx("h2",{className:"text-lg font-semibold flex-1",children:"Menü"})]})}),e.jsxs("div",{className:"flex-1 overflow-y-auto",children:[e.jsxs("div",{className:"p-4 border-b border-border",children:[e.jsx("h3",{className:"text-xs font-semibold text-muted-foreground uppercase tracking-wider mb-3",children:"Navigation"}),e.jsx("nav",{className:"space-y-1",children:ga.map(u=>{const h=u.icon,f=o===u.path;return e.jsx(On,{href:u.path,children:e.jsxs("button",{onClick:n,className:z("w-full flex items-center gap-3 px-3 py-2.5 rounded-lg transition-colors text-left min-h-[44px]",f?"bg-primary/10 text-primary font-medium":"text-foreground hover:bg-muted"),"aria-label":`Zu ${u.label} navigieren`,"aria-current":f?"page":void 0,"aria-pressed":f,type:"button",role:"menuitem",tabIndex:t?0:-1,children:[e.jsx(h,{className:"w-5 h-5 flex-shrink-0","aria-hidden":"true"}),e.jsx("span",{className:"text-sm",children:u.label})]})},u.path)})})]}),e.jsx(ha,{})]}),e.jsx("div",{className:"p-4 border-t border-border",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-10 h-10 rounded-full bg-primary text-primary-foreground flex items-center justify-center flex-shrink-0 text-sm font-medium",children:c?.photoURL?e.jsx("img",{src:c.photoURL,alt:c?.displayName||"Benutzerprofilbild",className:"w-10 h-10 rounded-full object-cover"}):e.jsx("span",{"aria-label":"Benutzerinitialen",children:g()})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("p",{className:"text-sm font-medium truncate",children:c?.displayName||"Benutzer"}),e.jsx("p",{className:"text-xs text-muted-foreground truncate",children:c?.email||"Nicht angemeldet"})]})]})})]})})]})}function rn(){return sa()}async function ft(t){try{if(t.id&&!t.id.startsWith("chat_"))await oa(t.id,{title:t.title,messages:t.messages});else{const n=await ia({title:t.title,messages:t.messages});t.id=n.id}}catch(n){throw n}}async function xa(){try{return{deletedCount:(await la()).deletedCount}}catch(t){throw t}}function ht(t,n){return n.find(s=>s.id===t)||null}function ba(t){return t.length<=50?t:t.substring(0,50)+"..."}function Pt(){const t=`chat_${Date.now()}_${Math.random().toString(36).substring(2,9)}`,n=new Date().toISOString();return{id:t,userId:"",title:"Neue Konversation",messages:[],createdAt:n,updatedAt:n}}function ya({title:t,showSidebar:n=!1,showQuickActions:s=!1,quickActions:i=[],currentChatId:r,onSelectChat:o,onNewChat:c,sidebarOpen:d,onSidebarToggle:g}){Je();const[u,h]=N(!1),{isEnabled:f}=nn(),[p,y]=N(!1),[a,b]=N(!1),[C,I]=N(!1),{data:B,refetch:ee}=rn(),K=G(null),J=d!==void 0?d:u,ne=g||h;Z(()=>{p&&ee()},[p,ee]),Z(()=>{const A=D=>{K.current&&!K.current.contains(D.target)&&y(!1)};return document.addEventListener("mousedown",A),()=>document.removeEventListener("mousedown",A)},[]);const X=A=>{const D=typeof A=="string"?new Date(A):typeof A=="number"?new Date(A):A,W=new Date().getTime()-D.getTime(),te=Math.floor(W/(1e3*60*60*24));return te===0?"Heute":te===1?"Gestern":te<7?`${te} Tage`:D.toLocaleDateString("de-DE",{day:"2-digit",month:"2-digit"})},oe=async()=>{if(B.length===0){w.info("Keine Chats zum Löschen vorhanden");return}I(!0);try{const A=await xa();w.success(`${A.deletedCount} Chat${A.deletedCount!==1?"s":""} gelöscht`),b(!1),y(!1),await ee(),c&&c()}catch(A){console.error("Fehler beim Löschen aller Chats:",A),w.error("Fehler beim Löschen der Chats")}finally{I(!1)}};return e.jsxs(e.Fragment,{children:[n&&e.jsx(pa,{open:J,onClose:()=>ne(!1),currentChatId:r,onSelectChat:o,onNewChat:c}),e.jsx("header",{className:z("fixed top-0 left-0 right-0 z-40 border-b safe-top",f?"bg-background/95 backdrop-blur-md border-border/30":"bg-background border-border"),children:e.jsxs("div",{className:"px-4 h-14 flex items-center gap-3",children:[e.jsx("div",{className:"flex-1 flex items-center justify-center",children:e.jsx("h1",{className:"text-lg font-semibold text-center",children:t})}),c&&e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{onClick:()=>{c&&c()},className:"p-2 hover:bg-muted rounded-lg transition-colors","aria-label":"Neue Konversation",children:e.jsx(bn,{className:"w-5 h-5"})}),e.jsxs("div",{className:"relative",ref:K,children:[e.jsx("button",{onClick:()=>{y(!p),p||ee()},className:"p-2 hover:bg-muted rounded-lg transition-colors","aria-label":"Chat-Verlauf",children:e.jsx(yn,{className:"w-5 h-5"})}),p&&e.jsxs("div",{className:"absolute top-full right-0 mt-2 w-72 bg-background border border-border rounded-lg shadow-lg z-50 overflow-hidden max-h-[60vh] flex flex-col",children:[e.jsxs("div",{className:"p-3 border-b border-border flex items-center justify-between",children:[e.jsx("h3",{className:"text-sm font-semibold",children:"Chat-Verlauf"}),e.jsx("button",{onClick:()=>y(!1),className:"p-1 hover:bg-muted rounded transition-colors",children:e.jsx(Ze,{className:"w-4 h-4"})})]}),e.jsx("div",{className:"overflow-y-auto",children:B.length===0?e.jsx("p",{className:"text-sm text-muted-foreground py-4 px-3 text-center",children:"Noch keine Konversationen"}):e.jsx("div",{className:"p-2",children:B.map(A=>{const D=r===A.id;return e.jsx("button",{onClick:()=>{o&&o(A.id),y(!1)},className:z("w-full flex items-center justify-between gap-2 px-3 py-2.5 rounded-lg transition-colors text-left",D?"bg-primary/10 text-primary":"hover:bg-muted"),children:e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("p",{className:z("text-sm truncate",D&&"font-medium"),children:A.title}),e.jsx("p",{className:"text-xs text-muted-foreground mt-0.5",children:X(A.updatedAt)})]})},A.id)})})}),B.length>0&&e.jsx("div",{className:"p-3 border-t border-border",children:e.jsxs("button",{onClick:()=>b(!0),className:"w-full flex items-center justify-center gap-2 px-3 py-2 rounded-lg bg-destructive/10 hover:bg-destructive/20 text-destructive transition-colors text-sm font-medium",disabled:C,children:[e.jsx(vn,{className:"w-4 h-4"}),e.jsx("span",{children:"Alle löschen"})]})})]})]})]})]})}),a&&e.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black/50 p-4",children:e.jsxs("div",{className:"bg-background border border-border rounded-lg shadow-lg max-w-sm w-full p-6",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[e.jsx("div",{className:"p-2 rounded-full bg-destructive/10",children:e.jsx(wn,{className:"w-5 h-5 text-destructive"})}),e.jsx("h3",{className:"text-lg font-semibold",children:"Alle Chats löschen?"})]}),e.jsxs("p",{className:"text-sm text-muted-foreground mb-6",children:["Diese Aktion kann nicht rückgängig gemacht werden. Alle ",B.length," Chat",B.length!==1?"s":""," werden permanent gelöscht."]}),e.jsxs("div",{className:"flex gap-3",children:[e.jsx("button",{onClick:()=>b(!1),className:"flex-1 px-4 py-2 rounded-lg border border-border hover:bg-muted transition-colors text-sm font-medium",disabled:C,children:"Abbrechen"}),e.jsx("button",{onClick:oe,className:"flex-1 px-4 py-2 rounded-lg bg-destructive text-destructive-foreground hover:bg-destructive/90 transition-colors text-sm font-medium",disabled:C,children:C?"Löschen...":"Ja, alle löschen"})]})]})})]})}function nt(t){const n=G(t);n.current=t;const s=G(null);return s.current||(s.current=function(...i){return n.current.apply(this,i)}),s.current}function on(t={}){const{onKeyDown:n,onCompositionStart:s,onCompositionEnd:i}=t,r=G(!1),o=G(null),c=G(null),d=nt(f=>{o.current&&(clearTimeout(o.current),o.current=null),c.current&&(clearTimeout(c.current),c.current=null),r.current=!0,s?.(f)}),g=nt(f=>{o.current=setTimeout(()=>{c.current=setTimeout(()=>{r.current=!1})}),i?.(f)}),u=nt(f=>{if(r.current&&(f.key==="Escape"||f.key==="Enter"&&!f.shiftKey)){f.stopPropagation();return}n?.(f)}),h=nt(()=>r.current);return{onCompositionStart:d,onCompositionEnd:g,onKeyDown:u,isComposing:h}}function be({className:t,type:n,onKeyDown:s,onCompositionStart:i,onCompositionEnd:r,...o}){const c=Dt(),{onCompositionStart:d,onCompositionEnd:g,onKeyDown:u}=on({onKeyDown:h=>{const f=h.nativeEvent.isComposing||c.justEndedComposing();h.key==="Enter"&&f||s?.(h)},onCompositionStart:h=>{c.setComposing(!0),i?.(h)},onCompositionEnd:h=>{c.markCompositionEnd(),setTimeout(()=>{c.setComposing(!1)},100),r?.(h)}});return e.jsx("input",{type:n,"data-slot":"input",className:z("file:text-foreground placeholder:text-muted-foreground selection:bg-primary selection:text-primary-foreground dark:bg-input/30 border-input h-9 w-full min-w-0 rounded-md border bg-transparent px-3 py-1 text-base shadow-xs transition-[color,box-shadow] outline-none file:inline-flex file:h-7 file:border-0 file:bg-transparent file:text-sm file:font-medium disabled:pointer-events-none disabled:cursor-not-allowed disabled:opacity-50 md:text-sm","focus-visible:border-ring focus-visible:ring-ring/50 focus-visible:ring-[3px]","aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive",t),onCompositionStart:d,onCompositionEnd:g,onKeyDown:u,...o})}function re({className:t,...n}){return e.jsx(qn,{"data-slot":"label",className:z("flex items-center gap-2 text-sm leading-none font-medium select-none group-data-[disabled=true]:pointer-events-none group-data-[disabled=true]:opacity-50 peer-disabled:cursor-not-allowed peer-disabled:opacity-50",t),...n})}function Pe({...t}){return e.jsx(Gn,{"data-slot":"select",...t})}function Be({...t}){return e.jsx(Jn,{"data-slot":"select-value",...t})}function Oe({className:t,size:n="default",children:s,...i}){return e.jsxs(Vn,{"data-slot":"select-trigger","data-size":n,className:z("border-input data-[placeholder]:text-muted-foreground [&_svg:not([class*='text-'])]:text-muted-foreground focus-visible:border-ring focus-visible:ring-ring/50 aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive dark:bg-input/30 dark:hover:bg-input/50 flex w-fit items-center justify-between gap-2 rounded-md border bg-transparent px-3 py-2 text-sm whitespace-nowrap shadow-xs transition-[color,box-shadow] outline-none focus-visible:ring-[3px] disabled:cursor-not-allowed disabled:opacity-50 data-[size=default]:h-9 data-[size=sm]:h-8 *:data-[slot=select-value]:line-clamp-1 *:data-[slot=select-value]:flex *:data-[slot=select-value]:items-center *:data-[slot=select-value]:gap-2 [&_svg]:pointer-events-none [&_svg]:shrink-0 [&_svg:not([class*='size-'])]:size-4",t),...i,children:[s,e.jsx(Zn,{asChild:!0,children:e.jsx(Wt,{className:"size-4 opacity-50"})})]})}function Le({className:t,children:n,position:s="popper",align:i="center",...r}){return e.jsx(Xn,{children:e.jsxs(Qn,{"data-slot":"select-content",className:z("bg-popover text-popover-foreground data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 relative z-50 max-h-(--radix-select-content-available-height) min-w-[8rem] origin-(--radix-select-content-transform-origin) overflow-x-hidden overflow-y-auto rounded-md border shadow-md",s==="popper"&&"data-[side=bottom]:translate-y-1 data-[side=left]:-translate-x-1 data-[side=right]:translate-x-1 data-[side=top]:-translate-y-1",t),position:s,align:i,...r,children:[e.jsx(va,{}),e.jsx(es,{className:z("p-1",s==="popper"&&"h-[var(--radix-select-trigger-height)] w-full min-w-[var(--radix-select-trigger-width)] scroll-my-1"),children:n}),e.jsx(wa,{})]})})}function le({className:t,children:n,...s}){return e.jsxs(ts,{"data-slot":"select-item",className:z("focus:bg-accent focus:text-accent-foreground [&_svg:not([class*='text-'])]:text-muted-foreground relative flex w-full cursor-default items-center gap-2 rounded-sm py-1.5 pr-8 pl-2 text-sm outline-hidden select-none data-[disabled]:pointer-events-none data-[disabled]:opacity-50 [&_svg]:pointer-events-none [&_svg]:shrink-0 [&_svg:not([class*='size-'])]:size-4 *:[span]:last:flex *:[span]:last:items-center *:[span]:last:gap-2",t),...s,children:[e.jsx("span",{className:"absolute right-2 flex size-3.5 items-center justify-center",children:e.jsx(ns,{children:e.jsx(Yt,{className:"size-4"})})}),e.jsx(ss,{children:n})]})}function va({className:t,...n}){return e.jsx(as,{"data-slot":"select-scroll-up-button",className:z("flex cursor-default items-center justify-center py-1",t),...n,children:e.jsx(jn,{className:"size-4"})})}function wa({className:t,...n}){return e.jsx(rs,{"data-slot":"select-scroll-down-button",className:z("flex cursor-default items-center justify-center py-1",t),...n,children:e.jsx(Wt,{className:"size-4"})})}function ja({className:t,...n}){return e.jsx(is,{"data-slot":"switch",className:z("peer data-[state=checked]:bg-primary data-[state=unchecked]:bg-input focus-visible:border-ring focus-visible:ring-ring/50 dark:data-[state=unchecked]:bg-input/80 inline-flex h-[1.15rem] w-8 shrink-0 items-center rounded-full border border-transparent shadow-xs transition-all outline-none focus-visible:ring-[3px] disabled:cursor-not-allowed disabled:opacity-50",t),...n,children:e.jsx(os,{"data-slot":"switch-thumb",className:z("bg-background dark:data-[state=unchecked]:bg-foreground dark:data-[state=checked]:bg-primary-foreground pointer-events-none block size-4 rounded-full ring-0 transition-transform data-[state=checked]:translate-x-[calc(100%-2px)] data-[state=unchecked]:translate-x-0")})})}const Na={light:10,medium:20,heavy:30,success:[50,50,50],error:[100,50,100],warning:[50,100,50],selection:5};function St(t="medium"){if(!navigator.vibrate)return;const n=Na[t];try{navigator.vibrate(n)}catch{}}function gt(){St("success")}function Da(){St("error")}function mr(){St("selection")}function Sa(t){const n=t,s=n?.data?.requestId||n?.requestId||null;if(n?.code==="unavailable"||n?.message?.includes("network")||n?.message?.includes("fetch"))return{title:"Verbindungsfehler",message:"Keine Internetverbindung. Bitte überprüfen Sie Ihre Netzwerkverbindung und versuchen Sie es erneut.",action:"Erneut versuchen",retryable:!0};if(n?.code==="deadline-exceeded"||n?.message?.includes("timeout"))return{title:"Zeitüberschreitung",message:"Die Anfrage hat zu lange gedauert. Bitte versuchen Sie es erneut.",action:"Erneut versuchen",retryable:!0};if(n?.code==="permission-denied"||n?.message?.includes("permission"))return{title:"Berechtigung verweigert",message:"Sie haben keine Berechtigung für diese Aktion. Bitte kontaktieren Sie den Administrator.",retryable:!1};if(n?.code==="unauthenticated"||n?.message?.includes("auth")||n?.message?.includes("login"))return{title:"Anmeldung erforderlich",message:"Bitte melden Sie sich an, um fortzufahren.",action:"Anmelden",retryable:!1};if(n?.code==="not-found"||n?.message?.includes("not found"))return{title:"Nicht gefunden",message:"Die angeforderte Ressource wurde nicht gefunden.",retryable:!1};if(n?.code==="invalid-argument"||n?.message?.includes("validation")||n?.message?.includes("invalid"))return{title:"Ungültige Eingabe",message:n?.message||"Bitte überprüfen Sie Ihre Eingabe und versuchen Sie es erneut.",retryable:!1};if(n?.code==="resource-exhausted"||n?.message?.includes("quota"))return{title:"Kontingent überschritten",message:"Das Tageslimit wurde erreicht. Bitte versuchen Sie es später erneut.",retryable:!1};if(n?.message?.includes("billing")||n?.message?.includes("Billing"))return{title:"Abrechnungsfehler",message:"Google Cloud Billing ist erforderlich. Bitte kontaktieren Sie den Administrator.",retryable:!1};if(n?.code?.startsWith("functions/"))return{title:"Server-Fehler",message:`Ein Fehler ist aufgetreten: ${n.code.replace("functions/","")}. Bitte versuchen Sie es später erneut.`,action:"Erneut versuchen",retryable:!0};let i=n?.message||n?.toString()||"Ein unbekannter Fehler ist aufgetreten.";return s&&(i+=`

Request ID: ${s.substring(0,8)}...`),{title:"Fehler",message:i.length>200?`${i.substring(0,200)}...`:i,action:"Erneut versuchen",retryable:!0,requestId:s||void 0}}function Ca(t){return Sa(t).message}function Ea({className:t,children:n,...s}){return e.jsxs(ls,{"data-slot":"scroll-area",className:z("relative",t),...s,children:[e.jsx(cs,{"data-slot":"scroll-area-viewport",className:"focus-visible:ring-ring/50 size-full rounded-[inherit] transition-[color,box-shadow] outline-none focus-visible:ring-[3px] focus-visible:outline-1",children:n}),e.jsx(ka,{}),e.jsx(ds,{})]})}function ka({className:t,orientation:n="vertical",...s}){return e.jsx(us,{"data-slot":"scroll-area-scrollbar",orientation:n,className:z("hidden opacity-0 w-0 h-0 invisible pointer-events-none",t),...s,children:e.jsx(ms,{"data-slot":"scroll-area-thumb",className:"hidden opacity-0 w-0 h-0"})})}const Aa={"layout-dashboard":vt,calendar:wt,bell:ot,wallet:Ae,users:rt,"file-text":Kt,folder:$e,"scan-line":$e,"shopping-cart":Ye,receipt:Ue,"clipboard-list":Ue,settings:it,check:Yt,plus:qt,search:Mn,edit:zn,trash:Rn,clock:Tn,euro:Fn,"trending-up":In,"trending-down":An,info:kn,"alert-circle":En},Ia={dashboard:{path:"/",icon:vt},calendar:{path:"/calendar",icon:wt},reminders:{path:"/reminders",icon:ot},finances:{path:"/finance",icon:Ae},finance:{path:"/finance",icon:Ae},finanzen:{path:"/finance",icon:Ae},people:{path:"/people",icon:rt},personen:{path:"/people",icon:rt},invoices:{path:"/bills",icon:Ue},bills:{path:"/bills",icon:Ue},rechnungen:{path:"/bills",icon:Ue},documents:{path:"/documents",icon:$e},dokumente:{path:"/documents",icon:$e},shopping:{path:"/shopping",icon:Ye},einkaufsliste:{path:"/shopping",icon:Ye},settings:{path:"/settings",icon:it},einstellungen:{path:"/settings",icon:it}};function Fa({content:t,onNavigate:n}){const s=pe(()=>{const i=[],r=t.length>1e4?t.substring(0,1e4)+"...":t;let o=0,c=0;const d=/\[(nav|icon):([a-zA-Z0-9_-]+)(?:[|｜]([^\]]+))?\]/g;let g;const u=[];for(;(g=d.exec(r))!==null;)u.push({index:g.index,type:g[1],key:g[2],label:g[3],endIndex:g.index+g[0].length});for(const h of u){if(h.index>o){const f=r.slice(o,h.index);i.push(e.jsx("span",{dangerouslySetInnerHTML:{__html:pt(f)}},`text-${c++}`))}if(h.type==="nav"&&h.label){const f=h.key,p=h.label,y=Ia[f];if(y&&n){const a=y.icon;i.push(e.jsxs("button",{onClick:b=>{b.preventDefault(),b.stopPropagation();try{n(y.path)}catch{}},className:"inline-flex items-center gap-1.5 px-2 py-1 mx-0.5 rounded-lg bg-primary/10 hover:bg-primary/20 text-primary font-medium text-sm transition-all duration-200 cursor-pointer border border-primary/20 hover:border-primary/40 hover:shadow-sm",title:`Zu ${p} navigieren`,children:[e.jsx(a,{className:"size-4"}),e.jsx("span",{className:"underline decoration-dotted underline-offset-2",children:st(p)})]},`nav-${c++}`))}else i.push(e.jsx("span",{className:"font-medium text-primary",children:st(p)},`nav-text-${c++}`))}else if(h.type==="icon"){const f=h.key,p=Aa[f];p?i.push(e.jsx(p,{className:"inline-block size-4 mx-0.5 align-text-bottom text-primary"},`icon-${c++}`)):i.push(e.jsxs("span",{children:["[",st(f),"]"]},`unknown-${c++}`))}o=h.endIndex}if(o<r.length){const h=r.slice(o);i.push(e.jsx("span",{dangerouslySetInnerHTML:{__html:pt(h)}},`text-${c++}`))}return i.length>0?i:[e.jsx("span",{dangerouslySetInnerHTML:{__html:pt(r)}},"full")]},[t,n]);return e.jsx("div",{className:"prose prose-sm max-w-none",children:s})}function st(t){const n=document.createElement("div");return n.textContent=t,n.innerHTML}function pt(t){let n=st(t);return n=n.replace(/\*\*(.+?)\*\*/g,"<strong>$1</strong>").replace(/__(.+?)__/g,"<strong>$1</strong>"),n=n.replace(new RegExp("(?<!\\*)\\*(?!\\*)(.+?)(?<!\\*)\\*(?!\\*)","g"),"<em>$1</em>"),n=n.replace(/`(.+?)`/g,'<code class="bg-muted px-1.5 py-0.5 rounded text-sm font-mono">$1</code>'),n=n.replace(/\n/g,"<br />"),n}function Ta({messages:t,onSendMessage:n,isLoading:s=!1,placeholder:i="Nachricht eingeben...",className:r,height:o="100%",emptyStateMessage:c="Beginne eine Unterhaltung mit dem Assistenten",suggestedPrompts:d}){const{t:g,i18n:u}=Jt(),[,h]=Je(),[f,p]=N(""),y=G(null),a=G(null),b=G(null),C=G(null),I=G(null),B=G(null),[ee,K]=N(!1),[J,ne]=N(null),[X,oe]=N(!1),A=G(null),D=G(null),F=G(null),W=ie(async x=>{h(x);const{eventBus:k,Events:m}=await Is(async()=>{const{eventBus:v,Events:E}=await import("./eventBus-CWDWdm45.js");return{eventBus:v,Events:E}},[]);setTimeout(()=>{k.emit(m.CHAT_DIALOG_OPEN)},300)},[h]),te=pe(()=>t.filter(x=>x.role!=="system"),[t]),L=pe(()=>d?d.map(x=>typeof x=="string"?{text:x,icon:"tag"}:x):[],[d]),V=ie(()=>{const x=y.current?.querySelector("[data-radix-scroll-area-viewport]");x&&requestAnimationFrame(()=>{x.scrollTo({top:x.scrollHeight,behavior:"smooth"})})},[]);Z(()=>{te.length>0&&V()},[te.length,V]);const[Fe,me]=N({bottom:0,left:0});Z(()=>{if(X&&D.current){const x=D.current.getBoundingClientRect();me({bottom:window.innerHeight-x.top+8,left:x.left})}},[X]),Z(()=>{const x=k=>{const m=k.target,v=F.current?.contains(m),E=D.current?.contains(m),O=A.current?.contains(m);!v&&!E&&!O&&oe(!1)};if(X)return document.addEventListener("mousedown",x),document.addEventListener("touchstart",x),()=>{document.removeEventListener("mousedown",x),document.removeEventListener("touchstart",x)}},[X]);const xe=ie(x=>{x.preventDefault();const k=f.trim();if(!(!k||s)){if(k.length>1e4){w.error("Nachricht ist zu lang. Bitte kürze sie auf maximal 10.000 Zeichen.");return}if(s){w.info("Bitte warte auf die Antwort...");return}try{n(k),p(""),V(),C.current?.focus()}catch{w.error("Fehler beim Senden der Nachricht. Bitte versuche es erneut.")}}},[f,s,n,V]),Te=ie(x=>{x.key==="Enter"&&!x.shiftKey&&(x.preventDefault(),xe(x))},[xe]),se=ie(x=>{s||(n(x),V())},[s,n,V]),fe=ie(async x=>{if(x.size>10485760){w.error(`Datei ist zu groß. Maximal ${(10485760/1024/1024).toFixed(0)}MB erlaubt.`);return}if(!x.name||x.name.length>255){w.error("Ungültiger Dateiname.");return}const m=w.loading("Datei wird hochgeladen...");try{const v=await Promise.race([new Promise((M,j)=>{const T=new FileReader;T.onload=()=>{const _=T.result;if(!_||!_.includes(",")){j(new Error("Ungültiges Dateiformat"));return}M(_.split(",")[1])},T.onerror=()=>j(new Error("Fehler beim Lesen der Datei")),T.readAsDataURL(x)}),new Promise((M,j)=>setTimeout(()=>j(new Error("Upload-Timeout")),3e4))]),E=$(H,"uploadAIChatFile"),O=await Promise.race([E({fileName:x.name,fileData:v,fileType:x.type}),new Promise((M,j)=>setTimeout(()=>j(new Error("Upload-Timeout")),6e4))]);if(!O?.data)throw new Error("Keine Antwort vom Server erhalten");const R=O.data;if(!R.fileUrl||!R.fileName)throw new Error("Ungültige Server-Antwort");w.dismiss(m),n(`[Datei: ${R.fileName}](${R.fileUrl})`),w.success("Datei erfolgreich hochgeladen")}catch(v){w.dismiss(m);const E=v.message||"Unbekannter Fehler";w.error(`Fehler beim Hochladen: ${E}`)}},[n]),Re=ie(async x=>{if(!x.type.startsWith("image/")){w.error("Bitte wähle ein Bild aus (JPG, PNG, GIF, etc.)");return}const k=5*1024*1024;if(x.size>k){w.error(`Bild ist zu groß. Maximal ${(k/1024/1024).toFixed(0)}MB erlaubt.`);return}if(!x.name||x.name.length>255){w.error("Ungültiger Dateiname.");return}const m=w.loading("Bild wird hochgeladen...");try{const v=await Promise.race([new Promise((M,j)=>{const T=new FileReader;T.onload=()=>{const _=T.result;if(!_||!_.includes(",")){j(new Error("Ungültiges Bildformat"));return}M(_.split(",")[1])},T.onerror=()=>j(new Error("Fehler beim Lesen des Bildes")),T.readAsDataURL(x)}),new Promise((M,j)=>setTimeout(()=>j(new Error("Upload-Timeout")),3e4))]),E=$(H,"uploadAIChatImage"),O=await Promise.race([E({fileName:x.name,fileData:v,fileType:x.type}),new Promise((M,j)=>setTimeout(()=>j(new Error("Upload-Timeout")),6e4))]);if(!O?.data)throw new Error("Keine Antwort vom Server erhalten");const R=O.data;if(!R.imageUrl||!R.fileName)throw new Error("Ungültige Server-Antwort");w.dismiss(m),n(`![${R.fileName}](${R.imageUrl})`),w.success("Bild erfolgreich hochgeladen")}catch(v){w.dismiss(m);const E=v.message||"Unbekannter Fehler";w.error(`Fehler beim Hochladen: ${E}`)}},[n]),ze=ie(async()=>{if(ee&&J){try{J.stop(),K(!1),w.info("Aufnahme wird verarbeitet...")}catch{K(!1),w.error("Fehler beim Stoppen der Aufnahme")}return}try{if(!navigator.mediaDevices||!navigator.mediaDevices.getUserMedia){w.error("Mikrofon-Zugriff wird von diesem Browser nicht unterstützt.");return}const x=await Promise.race([navigator.mediaDevices.getUserMedia({audio:!0}),new Promise((E,O)=>setTimeout(()=>O(new Error("Mikrofon-Zugriff-Timeout")),1e4))]),k=new MediaRecorder(x),m=[];let v=null;k.ondataavailable=E=>{E.data.size>0&&m.push(E.data)},k.onstop=async()=>{v&&clearTimeout(v);const E=new Blob(m,{type:"audio/webm"}),O=10*1024*1024;if(E.size>O){w.error("Audio-Aufnahme ist zu groß. Bitte kürze die Aufnahme."),x.getTracks().forEach(M=>M.stop());return}const R=w.loading("Audio wird transkribiert...");try{const M=await Promise.race([new Promise((P,Y)=>{const ae=new FileReader;ae.onload=()=>{const he=ae.result;if(!he||!he.includes(",")){Y(new Error("Ungültiges Audioformat"));return}P(he.split(",")[1])},ae.onerror=()=>Y(new Error("Fehler beim Lesen der Audio-Datei")),ae.readAsDataURL(E)}),new Promise((P,Y)=>setTimeout(()=>Y(new Error("Audio-Verarbeitung-Timeout")),3e4))]),j=$(H,"transcribeAIChatAudio"),T=await Promise.race([j({audioData:M,mimeType:"audio/webm"}),new Promise((P,Y)=>setTimeout(()=>Y(new Error("Transkription-Timeout")),6e4))]);if(!T?.data)throw new Error("Keine Antwort vom Server erhalten");const _=T.data;if(_.transcription&&_.transcription.trim())p(_.transcription.trim()),C.current?.focus(),w.dismiss(R),w.success("Spracheingabe erfolgreich");else throw new Error("Keine Transkription erhalten")}catch(M){w.dismiss(R);const j=M.message||"Unbekannter Fehler";w.error(`Fehler bei der Transkription: ${j}`)}finally{x.getTracks().forEach(M=>M.stop())}},k.onerror=E=>{w.error("Fehler bei der Aufnahme"),K(!1),x.getTracks().forEach(O=>O.stop())},v=setTimeout(()=>{k.state==="recording"&&(k.stop(),w.warning("Maximale Aufnahmezeit erreicht (5 Minuten)"))},300*1e3),k.start(),ne(k),K(!0),w.info("Aufnahme gestartet... (Klicke erneut zum Stoppen)")}catch(x){K(!1);const k=x.message||"Unbekannter Fehler";k.includes("permission")||k.includes("denied")?w.error("Mikrofon-Zugriff wurde verweigert. Bitte erlaube den Zugriff in den Browser-Einstellungen."):k.includes("not found")||k.includes("not available")?w.error("Kein Mikrofon gefunden. Bitte verbinde ein Mikrofon."):w.error(`Mikrofon-Fehler: ${k}`)}},[ee,J]);ie(()=>{const k=u.language==="de"?"en":"de";u.changeLanguage(k),localStorage.setItem("language",k),w.success(k==="de"?"Sprache auf Deutsch geändert":"Language changed to English")},[u]);const Ee=()=>e.jsxs("form",{ref:b,onSubmit:xe,className:"w-full",children:[e.jsx("input",{ref:I,type:"file",className:"hidden",onChange:x=>{const k=x.target.files?.[0];k&&fe(k),x.target.value=""},accept:"*/*"}),e.jsx("input",{ref:B,type:"file",className:"hidden",onChange:x=>{const k=x.target.files?.[0];k&&(Re(k),oe(!1)),x.target.value=""},accept:"image/*"}),e.jsx("div",{className:"w-full max-w-full mx-auto",children:e.jsxs("div",{className:"flex items-center gap-2 px-2",style:{alignItems:"center"},children:[e.jsxs("div",{className:"flex-1 relative",children:[e.jsx("button",{ref:D,type:"button",onClick:()=>oe(!X),className:"absolute left-2 top-1/2 -translate-y-1/2 w-8 h-8 rounded-full bg-transparent hover:bg-muted/50 transition-colors flex items-center justify-center active:scale-95 z-10","aria-label":"Mehr Optionen",disabled:s,children:e.jsx(qt,{className:"w-4 h-4 text-muted-foreground"})}),e.jsx("textarea",{ref:C,value:f,onChange:x=>p(x.target.value),onKeyDown:Te,placeholder:i,rows:1,className:"w-full pl-10 pr-4 py-3 rounded-2xl bg-muted border-0 text-base text-foreground placeholder:text-muted-foreground focus:outline-none focus:ring-2 focus:ring-primary/20 transition-all resize-none overflow-y-auto min-h-[44px] max-h-[120px] leading-relaxed",style:{height:"auto",minHeight:"44px"},disabled:s,onInput:x=>{const k=x.target;k.style.height="auto",k.style.height=`${Math.min(k.scrollHeight,120)}px`}})]}),f.trim()?e.jsx("button",{type:"submit",disabled:s,className:"w-10 h-10 rounded-full bg-primary text-primary-foreground hover:bg-primary/90 transition-colors flex items-center justify-center active:scale-95 shadow-md self-center","aria-label":s?"Wird gesendet...":"Nachricht senden",children:s?e.jsx(Ct,{className:"w-5 h-5 animate-spin"}):e.jsx(Sn,{className:"w-5 h-5"})}):e.jsx("button",{type:"button",onClick:ze,className:z("transition-colors flex items-center justify-center active:scale-95 self-center p-2",ee?"text-red-500 hover:text-red-600":"text-foreground hover:text-foreground/80"),"aria-label":"Spracheingabe",disabled:s,children:e.jsx(Cn,{className:z("w-7 h-7",ee?"text-red-500":"text-foreground")})})]})})]});return e.jsxs(e.Fragment,{children:[X&&e.jsxs("div",{ref:F,className:"fixed bg-background border border-border rounded-lg shadow-2xl z-[99999] min-w-[200px] overflow-hidden",style:{bottom:`${Fe.bottom}px`,left:`${Fe.left}px`},children:[e.jsxs("button",{type:"button",onClick:()=>{I.current?.click(),oe(!1)},className:"w-full flex items-center gap-3 px-4 py-3 hover:bg-muted transition-colors text-left",children:[e.jsx(Nn,{className:"w-5 h-5 text-muted-foreground"}),e.jsx("span",{className:"text-sm",children:"Datei anhängen"})]}),e.jsxs("button",{type:"button",onClick:()=>{B.current?.click(),oe(!1)},className:"w-full flex items-center gap-3 px-4 py-3 hover:bg-muted transition-colors text-left",children:[e.jsx(Dn,{className:"w-5 h-5 text-muted-foreground"}),e.jsx("span",{className:"text-sm",children:"Bild hinzufügen"})]})]}),e.jsx("div",{ref:a,className:z("flex flex-col bg-background text-foreground",r),style:{height:o},children:te.length===0?e.jsxs("div",{className:"flex flex-col h-full animate-in fade-in duration-300 pb-20",children:[e.jsx("div",{className:"flex-1 flex items-center justify-center px-4",children:e.jsx("div",{className:"w-full max-w-2xl"})}),L.length>0&&e.jsx("div",{className:"fixed bottom-24 left-0 right-0 px-4 pb-2 z-[1] pointer-events-none",children:e.jsx("div",{className:"w-full max-w-2xl mx-auto",children:e.jsx("div",{className:"overflow-x-auto scrollbar-hide -mx-4 px-4 pointer-events-auto",children:e.jsx("div",{className:"flex gap-3",style:{width:"max-content"},children:L.map((x,k)=>{const m=x.subtitle&&x.subtitle.trim().length>0;return e.jsxs("button",{onClick:()=>se(x.text),disabled:s,className:"flex-shrink-0 w-[calc(40vw-1rem)] min-w-[140px] max-w-[160px] rounded-xl bg-muted hover:bg-muted/80 active:bg-muted/70 px-2.5 py-2 text-left transition-all duration-200 disabled:cursor-not-allowed disabled:opacity-50 shadow-sm",type:"button",children:[e.jsx("p",{className:"font-medium text-xs text-foreground mb-0.5 line-clamp-2 leading-tight",children:x.text}),m&&e.jsx("p",{className:"text-[10px] text-muted-foreground line-clamp-2 leading-tight",children:x.subtitle})]},k)})})})})}),e.jsx("div",{className:"fixed bottom-0 left-0 right-0 w-full bg-background px-4 py-3 safe-bottom",style:{paddingBottom:"max(0.75rem, env(safe-area-inset-bottom))"},children:e.jsx("div",{className:"w-full max-w-2xl mx-auto",children:Ee()})})]}):e.jsxs(e.Fragment,{children:[e.jsx("div",{ref:y,className:"flex-1 overflow-hidden pb-32",children:e.jsx(Ea,{className:"h-full [&>div>div]:!overflow-y-auto [&>div>div]:[-ms-overflow-style:none] [&>div>div]:[scrollbar-width:none] [&>div>div::-webkit-scrollbar]:hidden",children:e.jsxs("div",{className:"flex flex-col p-4 space-y-4 pb-6",children:[te.map((x,k)=>e.jsx("div",{className:z("flex gap-3 animate-in fade-in slide-in-from-bottom-2 duration-300",x.role==="user"?"justify-end":"justify-start"),children:e.jsx("div",{className:z("max-w-[85%] select-text",x.role==="user"?"bg-primary text-primary-foreground rounded-2xl px-4 py-3 text-base":"text-foreground text-base"),onClick:m=>{m.target.closest("button, a")||m.stopPropagation()},onMouseDown:m=>{m.target.closest("button, a")||m.stopPropagation()},children:x.role==="assistant"?e.jsx(Fa,{content:x.content,onNavigate:W}):e.jsx("p",{className:"whitespace-pre-wrap leading-relaxed",children:x.content})})},k)),s&&e.jsx("div",{className:"flex items-start gap-4 justify-start animate-in fade-in duration-200",children:e.jsx("div",{className:"rounded-lg bg-muted px-4 py-3",children:e.jsx(Ct,{className:"size-4 animate-spin text-muted-foreground"})})})]})})}),L.length>0&&e.jsx("div",{className:"fixed bottom-24 left-0 right-0 px-4 pb-2 z-[1] pointer-events-none",children:e.jsx("div",{className:"w-full max-w-2xl mx-auto",children:e.jsx("div",{className:"overflow-x-auto scrollbar-hide -mx-4 px-4 pointer-events-auto",children:e.jsx("div",{className:"flex gap-3",style:{width:"max-content"},children:L.map((x,k)=>{const m=x.subtitle&&x.subtitle.trim().length>0;return e.jsxs("button",{onClick:()=>se(x.text),disabled:s,className:"flex-shrink-0 w-[calc(40vw-1rem)] min-w-[140px] max-w-[160px] rounded-xl bg-muted hover:bg-muted/80 active:bg-muted/70 px-2.5 py-2 text-left transition-all duration-200 disabled:cursor-not-allowed disabled:opacity-50 shadow-sm",type:"button",children:[e.jsx("p",{className:"font-medium text-xs text-foreground mb-0.5 line-clamp-2 leading-tight",children:x.text}),m&&e.jsx("p",{className:"text-[10px] text-muted-foreground line-clamp-2 leading-tight",children:x.subtitle})]},k)})})})})}),e.jsx("div",{className:"fixed bottom-0 left-0 right-0 w-full bg-background/95 backdrop-blur-sm px-4 py-3 safe-bottom flex-shrink-0 z-30",style:{paddingBottom:"max(0.75rem, env(safe-area-inset-bottom))"},children:e.jsx("div",{className:"w-full max-w-2xl mx-auto",children:Ee()})})]})})]})}function Bt({className:t,onKeyDown:n,onCompositionStart:s,onCompositionEnd:i,...r}){const o=Dt(),{onCompositionStart:c,onCompositionEnd:d,onKeyDown:g}=on({onKeyDown:u=>{const h=u.nativeEvent.isComposing||o.justEndedComposing();u.key==="Enter"&&!u.shiftKey&&h||n?.(u)},onCompositionStart:u=>{o.setComposing(!0),s?.(u)},onCompositionEnd:u=>{o.markCompositionEnd(),setTimeout(()=>{o.setComposing(!1)},100),i?.(u)}});return e.jsx("textarea",{"data-slot":"textarea",className:z("border-input placeholder:text-muted-foreground focus-visible:border-ring focus-visible:ring-ring/50 aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive dark:bg-input/30 flex field-sizing-content min-h-16 w-full rounded-md border bg-transparent px-3 py-2 text-base shadow-xs transition-[color,box-shadow] outline-none focus-visible:ring-[3px] disabled:cursor-not-allowed disabled:opacity-50 md:text-sm",t),onCompositionStart:c,onCompositionEnd:d,onKeyDown:g,...r})}const We={role:"system",content:"Du bist ein hilfreicher Assistent für die Nexo-Anwendung. Du hilfst Benutzern bei Fragen zu Finanzen, Rechnungen, Terminen und anderen Funktionen der App."};function fr(){const{t}=Jt();Je();const{data:n,isLoading:s,refetch:i}=rn(),[r,o]=N(null),[c,d]=N(!1),[g,u]=N(!1),[h,f]=N(!1),[p,y]=N(!1),[a,b]=N(!1),[C,I]=N(!1),[B,ee]=N(!1),[K,J]=N(null),ne=G(null),X=G(null),oe=G(null),A=G(null),[D,F]=N({title:"",type:"termin",dueDate:"",isAllDay:!1,amount:"",currency:"CHF",notes:""}),[W,te]=N(!1),[L,V]=N({type:"ausgabe",amount:"",category:"",description:"",date:de(new Date),paymentMethod:"Karte"}),[Fe,me]=N(ce(new Date)),[xe,Te]=N(!1),[se,fe]=N({name:"",quantity:"1",category:"Lebensmittel",store:""}),[Re,ze]=N(!1),Ee=["Lebensmittel","Getränke","Haushalt","Hygiene","Tierbedarf","Sonstiges"],x=async()=>{if(!se.name){w.error("Bitte Artikelname eingeben");return}ze(!0);try{await na({item:se.name,quantity:parseInt(se.quantity)||1,category:se.category,estimatedPrice:0,currency:"EUR",unit:null}),w.success("Artikel zur Einkaufsliste hinzugefügt"),b(!1),fe({name:"",quantity:"1",category:"Lebensmittel",store:""})}catch(l){w.error("Fehler beim Hinzufügen des Artikels"),console.error(l)}finally{ze(!1)}},k={income:["Gehalt","Freelance","Investitionen","Geschenk","Sonstiges"],expense:["Lebensmittel","Transport","Wohnen","Unterhaltung","Gesundheit","Kleidung","Bildung","Rechnung","Sonstiges"]},m=async()=>{if(!L.amount||!L.category){w.error("Bitte Betrag und Kategorie eingeben");return}Te(!0);try{await en({type:L.type,category:L.category,amount:Math.round(parseFloat(L.amount)*100),currency:"CHF",date:new Date(L.date),paymentMethod:L.paymentMethod,notes:L.description||"",status:L.type==="ausgabe"?"open":void 0}),w.success(L.type==="einnahme"?"Einnahme hinzugefügt":"Ausgabe hinzugefügt");const l=de(new Date);y(!1),V({type:"ausgabe",amount:"",category:"",description:"",date:l,paymentMethod:"Karte"}),me(ce(l))}catch(l){w.error("Fehler beim Erstellen des Eintrags"),console.error(l)}finally{Te(!1)}};Z(()=>{!s&&n.length>0&&!r&&o(n[0].id)},[s,n,r]);const[v,E]=N([We]),O=G(null),R=G(!1);Z(()=>{if(r&&r!==O.current)if(O.current=r,n.length>0){const l=ht(r,n);l&&l.messages.length>0?E(l.messages):E([We])}else E([We])},[r,n]),Z(()=>{if(!R.current&&r&&v.length>1){const l=setTimeout(async()=>{R.current=!0;try{const S=ht(r,n);if(S){const q=v.find(ge=>ge.role==="user");q&&S.title==="Neue Konversation"&&(S.title=ba(q.content)),S.messages=v,S.updatedAt=new Date().toISOString(),await ft(S)}}catch{}finally{R.current=!1}},1e3);return()=>clearTimeout(l)}},[v,r,n]);const M=ie(async()=>{try{const l=Pt();await ft(l),o(l.id),E([We]),await i(),w.success("Neue Konversation gestartet")}catch(l){console.error("Error creating new chat:",l);let S="Fehler beim Erstellen der neuen Konversation";l?.code==="unauthenticated"||l?.message?.includes("unauthenticated")?S="Bitte melde dich an, um eine neue Konversation zu erstellen":l?.code==="permission-denied"||l?.message?.includes("permission")?S="Keine Berechtigung zum Erstellen einer Konversation":l?.message?S=`Fehler: ${l.message}`:typeof l=="string"&&(S=`Fehler: ${l}`),w.error(S)}},[i]),j=ie(l=>{o(l);const S=ht(l,n);S&&S.messages.length>0?E(S.messages):E([We])},[n]),T=Vs.ai.chat.useMutation({onSuccess:l=>{const S={role:"assistant",content:l.content};E(q=>[...q,S])},onError:l=>{let S="Ein unbekannter Fehler ist aufgetreten.";l.message.includes("<!doctype")||l.message.includes("Unexpected token")||l.message.includes("Failed to fetch")?S="Der Server ist nicht erreichbar oder gibt eine ungültige Antwort zurück. Bitte stelle sicher, dass der Server läuft und du eine Internetverbindung hast.":l.message.includes("Unable to transform")||l.message.includes("NetworkError")?S="Fehler bei der Datenübertragung. Bitte überprüfe deine Internetverbindung und versuche es erneut.":l.data?.code==="UNAUTHORIZED"||l.message.includes("unauthenticated")?S="Du bist nicht angemeldet. Bitte melde dich an.":l.data?.code==="INTERNAL_SERVER_ERROR"||l.message.includes("500")?S="Ein Serverfehler ist aufgetreten. Bitte versuche es später erneut.":l.message.includes("timeout")||l.message.includes("Timeout")?S="Die Anfrage hat zu lange gedauert. Bitte versuche es erneut.":l.message.includes("rate limit")||l.message.includes("429")?S="Zu viele Anfragen. Bitte warte einen Moment und versuche es erneut.":S=l.message||"Ein Fehler ist aufgetreten.";const q={role:"assistant",content:`**Fehler aufgetreten**

${S}

Bitte versuche es erneut oder starte eine neue Konversation.`};E(ge=>[...ge,q]),w.error("Fehler beim Senden der Nachricht")}}),_=ie(async l=>{if(l.length>1e4){w.error("Nachricht ist zu lang. Bitte kürze sie auf maximal 10.000 Zeichen.");return}if(!r)try{const q=Pt();await ft(q),o(q.id),await i()}catch{w.error("Fehler beim Erstellen der Konversation");return}if(v.filter(q=>q.role==="user").length>=50){w.warning("Zu viele Nachrichten in dieser Konversation. Bitte starte eine neue Konversation.");return}try{const q={role:"user",content:l},ge=[...v,q];E(ge),T.mutate({messages:ge})}catch{w.error("Fehler beim Senden der Nachricht. Bitte versuche es erneut.")}},[v,T,r,i]),P=pe(()=>[{text:"Wie funktioniert die Rechnungsverwaltung?",subtitle:"Lerne die Rechnungsverwaltung kennen",icon:"receipt"},{text:"Wie erstelle ich eine Erinnerung?",subtitle:"Erstelle Termine und Erinnerungen",icon:"bell"},{text:"Wie verwalte ich meine Finanzen?",subtitle:"Verwalte Einnahmen und Ausgaben",icon:"wallet"},{text:"Was kann ich mit der Einkaufsliste machen?",subtitle:"Verwalte deine Einkaufsliste",icon:"shoppingCart"},{text:"Wie funktioniert das Raten-System?",subtitle:"Lerne Ratenzahlungen zu verwalten",icon:"calendar"},{text:"Wie scanne ich eine Rechnung?",subtitle:"Erfasse Rechnungen automatisch",icon:"scan"}],[]),Y=v.some(l=>l.role==="user"),ae=()=>r&&n.length>0&&n.find(S=>S.id===r)?.title||"Assistent",he=pe(()=>[{id:"reminder",label:"Erinnerung erstellen",path:"#",icon:ot,onClick:()=>u(!0)},{id:"scan",label:"Rechnung scannen",path:"#",icon:$e,onClick:()=>{f(!0),J(null)}},{id:"finance",label:"Finanzübersicht",path:"#",icon:Ae,onClick:()=>y(!0)},{id:"shopping",label:"Einkaufsliste",path:"#",icon:Ye,onClick:()=>b(!0)}],[]),dt=async()=>{if(!D.title||!D.dueDate){w.error("Bitte füllen Sie Titel und Datum aus");return}te(!0);try{const l=D.amount?Math.round(parseFloat(D.amount)*100):void 0;await Qt({title:D.title,type:D.type,dueDate:new Date(D.dueDate),isAllDay:D.isAllDay,amount:l,currency:D.currency,notes:D.notes||""}),w.success("Erinnerung erstellt"),u(!1),F({title:"",type:"termin",dueDate:"",isAllDay:!1,amount:"",currency:"CHF",notes:""})}catch(l){w.error("Fehler beim Erstellen der Erinnerung"),console.error(l)}finally{te(!1)}},ut=async()=>{try{const l=await navigator.mediaDevices.getUserMedia({video:{facingMode:"environment"}});A.current=l,ne.current&&(ne.current.srcObject=l),I(!0),gt()}catch(l){w.error(Ca(l)),Da()}},Q=()=>{A.current&&(A.current.getTracks().forEach(l=>l.stop()),A.current=null),I(!1)},ln=()=>{if(ne.current&&X.current){const l=ne.current,S=X.current;S.width=l.videoWidth,S.height=l.videoHeight;const q=S.getContext("2d");if(q){q.drawImage(l,0,0);const ge=S.toDataURL("image/jpeg");J(ge),Q(),gt()}}},cn=l=>{const S=l.target.files?.[0];if(S){const q=new FileReader;q.onload=ge=>{const un=ge.target?.result;J(un),gt()},q.readAsDataURL(S)}},dn=async()=>{if(K){const l={role:"user",content:`![Gescanntes Bild](${K})`};E(S=>[...S,l]),J(null),f(!1),w.success("Scan zum Chat hinzugefügt");try{T.mutate({messages:[...v,l]})}catch(S){console.error("Error sending scan to chat:",S)}}};return Z(()=>()=>{h||Q()},[h]),e.jsxs("div",{className:"min-h-screen bg-background flex flex-col safe-area-inset",children:[e.jsx(ya,{title:ae(),showSidebar:!0,showQuickActions:!0,quickActions:he,currentChatId:r||void 0,onSelectChat:j,onNewChat:M,sidebarOpen:c,onSidebarToggle:d}),he.length>0&&e.jsxs("div",{className:"fixed top-14 left-0 right-0 z-30 px-4 py-3 flex flex-row gap-3 justify-center safe-top",style:{paddingTop:"max(0.75rem, env(safe-area-inset-top))"},children:[e.jsx("button",{onClick:()=>d(!0),className:"w-12 h-12 rounded-full bg-background hover:bg-muted border border-border transition-colors flex items-center justify-center active:scale-95 shadow-sm","aria-label":"Menü öffnen","aria-expanded":c,"aria-controls":"sidebar-menu",title:"Menü öffnen",children:e.jsx(Pn,{className:"w-5 h-5 text-foreground"})}),he.map(l=>{const S=l.icon;return e.jsx("button",{onClick:l.onClick,className:"w-12 h-12 rounded-full bg-background hover:bg-muted border border-border transition-colors flex items-center justify-center active:scale-95 shadow-sm","aria-label":l.label,title:l.label,children:S&&e.jsx(S,{className:"w-5 h-5 text-foreground"})},l.id)})]}),e.jsx("div",{className:"flex-1 overflow-hidden flex flex-col bg-background",style:{paddingTop:he.length>0?"7rem":"3.5rem"},children:e.jsx("div",{className:"flex-1 flex flex-col w-full overflow-hidden min-h-0",children:e.jsx(Ta,{messages:v,onSendMessage:_,isLoading:T.isPending,placeholder:t("common.typeMessage","Nachricht eingeben..."),height:"100%",emptyStateMessage:"Wähle eine Frage oder stelle deine eigene",suggestedPrompts:Y?[]:P})})}),e.jsx(ve,{open:g,onOpenChange:l=>{u(l),l||F({title:"",type:"termin",dueDate:"",isAllDay:!1,amount:"",currency:"CHF",notes:""})},children:e.jsxs(we,{className:"!fixed !top-[50%] !left-[50%] !right-auto !bottom-auto !translate-x-[-50%] !translate-y-[-50%] !w-[85vw] !max-w-sm !max-h-[90vh] !rounded-3xl !m-0 !overflow-hidden !shadow-2xl !flex !flex-col",children:[e.jsxs(je,{className:"px-4 pt-3.5 pb-2.5 flex-shrink-0",children:[e.jsx(De,{className:"text-lg font-semibold",children:"Erinnerung erstellen"}),e.jsx(Se,{className:"sr-only",children:"Erstellen Sie eine neue Erinnerung basierend auf der Chat-Konversation"})]}),e.jsxs("div",{className:"space-y-2.5 px-4 pb-2.5 overflow-y-auto flex-1 min-h-0",children:[e.jsxs("div",{className:"w-full",children:[e.jsx(re,{className:"text-sm font-medium",children:"Titel *"}),e.jsx(be,{value:D.title,onChange:l=>F({...D,title:l.target.value}),placeholder:"Titel",className:"h-11 min-h-[44px] mt-1.5 rounded-xl w-full"})]}),e.jsxs("div",{className:"w-full",children:[e.jsx(re,{className:"text-sm font-medium",children:"Typ *"}),e.jsxs(Pe,{value:D.type,onValueChange:l=>F({...D,type:l}),children:[e.jsx(Oe,{className:"h-11 min-h-[44px] mt-1.5 rounded-xl w-full",children:e.jsx(Be,{})}),e.jsxs(Le,{children:[e.jsx(le,{value:"termin",children:"Termin"}),e.jsx(le,{value:"zahlung",children:"Zahlung"}),e.jsx(le,{value:"aufgabe",children:"Aufgabe"})]})]})]}),e.jsxs("div",{className:"w-full",children:[e.jsx(re,{className:"text-sm font-medium",children:"Datum & Uhrzeit *"}),e.jsx("div",{className:"relative w-full mt-1.5",children:e.jsx(be,{type:"datetime-local",placeholder:"Datum & Uhrzeit auswählen",value:D.dueDate,onChange:l=>{F({...D,dueDate:l.target.value})},className:"h-11 min-h-[44px] rounded-xl w-full",style:{boxSizing:"border-box",fontSize:"16px",height:"44px",minHeight:"44px",maxHeight:"44px",padding:"0.5rem 0.75rem",lineHeight:"1.5rem",appearance:"none",WebkitAppearance:"none",MozAppearance:"textfield"}})})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(ja,{checked:D.isAllDay,onCheckedChange:l=>F({...D,isAllDay:l})}),e.jsx(re,{className:"text-sm font-medium",children:"Ganztägig"})]}),D.type==="zahlung"&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"w-full",children:[e.jsx(re,{className:"text-sm font-medium",children:"Betrag"}),e.jsx(be,{type:"number",step:"0.01",value:D.amount,onChange:l=>F({...D,amount:l.target.value}),placeholder:"0.00",className:"h-11 min-h-[44px] mt-1.5 rounded-xl w-full"})]}),e.jsxs("div",{className:"w-full",children:[e.jsx(re,{className:"text-sm font-medium",children:"Währung"}),e.jsxs(Pe,{value:D.currency,onValueChange:l=>F({...D,currency:l}),children:[e.jsx(Oe,{className:"h-11 min-h-[44px] mt-1.5 rounded-xl w-full",children:e.jsx(Be,{})}),e.jsxs(Le,{children:[e.jsx(le,{value:"CHF",children:"CHF"}),e.jsx(le,{value:"EUR",children:"EUR"}),e.jsx(le,{value:"USD",children:"USD"})]})]})]})]}),e.jsxs("div",{className:"w-full",children:[e.jsx(re,{className:"text-sm font-medium",children:"Notizen"}),e.jsx(Bt,{value:D.notes,onChange:l=>F({...D,notes:l.target.value}),placeholder:"Notizen...",className:"mt-1.5 min-h-[90px] rounded-xl w-full"})]})]}),e.jsxs(Ne,{className:"px-4 pb-3 pt-2.5 gap-2.5 flex-shrink-0",children:[e.jsx(U,{variant:"outline",onClick:()=>u(!1),className:"h-11 min-h-[44px] flex-1 rounded-xl text-sm font-medium",children:"Abbrechen"}),e.jsx(U,{onClick:dt,disabled:W,className:"h-11 min-h-[44px] flex-1 rounded-xl text-sm font-medium",children:W?"Speichert...":"Erstellen"})]})]})}),e.jsx(ve,{open:h,onOpenChange:l=>{f(l),l||(Q(),J(null))},children:e.jsxs(we,{className:"!fixed !top-[50%] !left-[50%] !right-auto !bottom-auto !translate-x-[-50%] !translate-y-[-50%] !w-[85vw] !max-w-sm !max-h-fit !rounded-3xl !m-0 !overflow-visible !shadow-2xl",children:[e.jsxs(je,{className:"px-5 pt-5 pb-3",children:[e.jsx(De,{className:"text-lg font-semibold",children:"Rechnung scannen"}),e.jsx(Se,{className:"sr-only",children:"Scannen Sie eine Rechnung mit der Kamera oder laden Sie ein Bild hoch"})]}),e.jsxs("div",{className:"space-y-3 px-5 pb-2",children:[!C&&!K&&e.jsxs("div",{className:"space-y-2.5",children:[e.jsxs(U,{onClick:ut,className:"w-full h-11 flex items-center justify-center gap-2 rounded-xl text-sm font-medium",children:[e.jsx(Et,{className:"w-4 h-4"}),"Kamera öffnen"]}),e.jsxs("div",{className:"relative",children:[e.jsx("input",{ref:oe,type:"file",accept:"image/*",onChange:cn,className:"hidden"}),e.jsxs(U,{variant:"outline",onClick:()=>oe.current?.click(),className:"w-full h-11 flex items-center justify-center gap-2 rounded-xl text-sm font-medium",children:[e.jsx(Bn,{className:"w-4 h-4"}),"Bild hochladen"]})]})]}),C&&e.jsxs("div",{className:"space-y-2.5",children:[e.jsxs("div",{className:"relative bg-black rounded-xl overflow-hidden aspect-video",children:[e.jsx("video",{ref:ne,autoPlay:!0,playsInline:!0,className:"w-full h-full object-cover"}),e.jsx("canvas",{ref:X,className:"hidden"})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(U,{variant:"outline",onClick:Q,className:"flex-1 h-11 rounded-xl text-sm font-medium",children:[e.jsx(Ze,{className:"w-4 h-4 mr-2"}),"Abbrechen"]}),e.jsxs(U,{onClick:ln,className:"flex-1 h-11 rounded-xl text-sm font-medium",children:[e.jsx(Et,{className:"w-4 h-4 mr-2"}),"Aufnehmen"]})]})]}),K&&e.jsxs("div",{className:"space-y-2.5",children:[e.jsx("div",{className:"relative bg-black rounded-xl overflow-hidden",children:e.jsx("img",{src:K,alt:"Gescanntes Bild",className:"w-full h-auto"})}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(U,{variant:"outline",onClick:()=>{J(null),I(!1)},className:"flex-1 h-11 rounded-xl text-sm font-medium",children:"Neu scannen"}),e.jsx(U,{onClick:dn,className:"flex-1 h-11 rounded-xl text-sm font-medium",children:"Zum Chat hinzufügen"})]})]})]}),e.jsx(Ne,{className:"px-5 pb-3 pt-2",children:e.jsx(U,{variant:"outline",onClick:()=>{f(!1),Q(),J(null)},className:"h-11 min-h-[44px] w-full rounded-xl text-sm font-medium",children:"Schließen"})})]})}),e.jsx(ve,{open:p,onOpenChange:l=>{if(y(l),l){const S=de(new Date);V(q=>({...q,date:S})),me(ce(S))}else{const S=de(new Date);V({type:"ausgabe",amount:"",category:"",description:"",date:S,paymentMethod:"Karte"}),me(ce(S))}},children:e.jsxs(we,{className:"!fixed !top-[50%] !left-[50%] !right-auto !bottom-auto !translate-x-[-50%] !translate-y-[-50%] !w-[85vw] !max-w-sm !max-h-fit !rounded-3xl !m-0 !overflow-visible !shadow-2xl",children:[e.jsxs(je,{className:"px-5 pt-5 pb-3",children:[e.jsx(De,{className:"text-lg font-semibold",children:"Einnahme / Ausgabe"}),e.jsx(Se,{className:"sr-only",children:"Erstellen Sie einen neuen Finanz-Eintrag für Einnahmen oder Ausgaben"})]}),e.jsxs("div",{className:"space-y-3 px-5 pb-2",children:[e.jsxs("div",{children:[e.jsx(re,{className:"text-sm font-medium",children:"Typ *"}),e.jsxs(Pe,{value:L.type,onValueChange:l=>{V({...L,type:l,category:""})},children:[e.jsx(Oe,{className:"h-11 min-h-[44px] mt-1.5 rounded-xl",children:e.jsx(Be,{})}),e.jsxs(Le,{children:[e.jsx(le,{value:"einnahme",children:"Einnahme"}),e.jsx(le,{value:"ausgabe",children:"Ausgabe"})]})]})]}),e.jsxs("div",{children:[e.jsx(re,{children:"Betrag *"}),e.jsx(be,{type:"number",step:"0.01",value:L.amount,onChange:l=>V({...L,amount:l.target.value}),placeholder:"0.00",className:"h-11 min-h-[44px] mt-1.5 rounded-xl"})]}),e.jsxs("div",{children:[e.jsx(re,{className:"text-sm font-medium",children:"Kategorie *"}),e.jsxs(Pe,{value:L.category,onValueChange:l=>V({...L,category:l}),children:[e.jsx(Oe,{className:"h-11 min-h-[44px] mt-1.5 rounded-xl",children:e.jsx(Be,{placeholder:"Kategorie wählen"})}),e.jsx(Le,{children:(L.type==="einnahme"?k.income:k.expense).map(l=>e.jsx(le,{value:l,children:l},l))})]})]}),e.jsxs("div",{children:[e.jsx(re,{className:"text-sm font-medium",children:"Datum *"}),e.jsx(be,{type:"text",placeholder:"DD.MM.YYYY",value:Fe,onChange:l=>{const S=l.target.value;me(S);const q=_e(S);q&&V({...L,date:q})},onBlur:l=>{const S=_e(l.target.value);S?(V({...L,date:S}),me(ce(S))):l.target.value&&me(ce(L.date))},className:"h-11 min-h-[44px] mt-1.5 rounded-xl"})]}),e.jsxs("div",{children:[e.jsx(re,{children:"Zahlungsmethode"}),e.jsxs(Pe,{value:L.paymentMethod,onValueChange:l=>V({...L,paymentMethod:l}),children:[e.jsx(Oe,{className:"h-11 min-h-[44px] mt-1.5 rounded-xl",children:e.jsx(Be,{})}),e.jsxs(Le,{children:[e.jsx(le,{value:"Karte",children:"Karte"}),e.jsx(le,{value:"Bar",children:"Bar"}),e.jsx(le,{value:"Überweisung",children:"Überweisung"}),e.jsx(le,{value:"Andere",children:"Andere"})]})]})]}),e.jsxs("div",{children:[e.jsx(re,{children:"Beschreibung"}),e.jsx(Bt,{value:L.description,onChange:l=>V({...L,description:l.target.value}),placeholder:"Beschreibung...",className:"mt-1 min-h-[80px]"})]})]}),e.jsxs(Ne,{className:"px-5 pb-3 pt-2 gap-2.5",children:[e.jsx(U,{variant:"outline",onClick:()=>y(!1),className:"h-11 min-h-[44px] flex-1 rounded-xl text-sm font-medium",children:"Abbrechen"}),e.jsx(U,{onClick:m,disabled:xe,className:"h-11 min-h-[44px] flex-1 rounded-xl text-sm font-medium",children:xe?"Speichert...":"Erstellen"})]})]})}),e.jsx(ve,{open:a,onOpenChange:l=>{b(l),l||fe({name:"",quantity:"1",category:"Lebensmittel",store:""})},children:e.jsxs(we,{className:"!fixed !top-[50%] !left-[50%] !right-auto !bottom-auto !translate-x-[-50%] !translate-y-[-50%] !w-[85vw] !max-w-sm !max-h-fit !rounded-3xl !m-0 !overflow-visible !shadow-2xl",children:[e.jsxs(je,{className:"px-5 pt-5 pb-3",children:[e.jsx(De,{className:"text-lg font-semibold",children:"Artikel zur Einkaufsliste hinzufügen"}),e.jsx(Se,{className:"sr-only",children:"Fügen Sie einen neuen Artikel zur Einkaufsliste hinzu"})]}),e.jsxs("div",{className:"space-y-3 px-5 pb-2",children:[e.jsxs("div",{children:[e.jsx(re,{className:"text-sm font-medium",children:"Artikelname *"}),e.jsx(be,{value:se.name,onChange:l=>fe({...se,name:l.target.value}),placeholder:"z.B. Milch",className:"h-11 min-h-[44px] mt-1.5 rounded-xl"})]}),e.jsxs("div",{children:[e.jsx(re,{className:"text-sm font-medium",children:"Menge"}),e.jsx(be,{type:"number",min:"1",value:se.quantity,onChange:l=>fe({...se,quantity:l.target.value}),placeholder:"1",className:"h-11 min-h-[44px] mt-1.5 rounded-xl"})]}),e.jsxs("div",{children:[e.jsx(re,{className:"text-sm font-medium",children:"Kategorie"}),e.jsxs(Pe,{value:se.category,onValueChange:l=>fe({...se,category:l}),children:[e.jsx(Oe,{className:"h-11 min-h-[44px] mt-1.5 rounded-xl",children:e.jsx(Be,{})}),e.jsx(Le,{children:Ee.map(l=>e.jsx(le,{value:l,children:l},l))})]})]}),e.jsxs("div",{children:[e.jsx(re,{className:"text-sm font-medium",children:"Geschäft (optional)"}),e.jsx(be,{value:se.store,onChange:l=>fe({...se,store:l.target.value}),placeholder:"z.B. Migros",className:"h-11 min-h-[44px] mt-1.5 rounded-xl"})]})]}),e.jsxs(Ne,{className:"px-5 pb-3 pt-2 gap-2.5",children:[e.jsx(U,{variant:"outline",onClick:()=>b(!1),className:"h-11 min-h-[44px] flex-1 rounded-xl text-sm font-medium",children:"Abbrechen"}),e.jsx(U,{onClick:x,disabled:Re,className:"h-11 min-h-[44px] flex-1 rounded-xl text-sm font-medium",children:Re?"Speichert...":"Hinzufügen"})]})]})})]})}export{nn as $,Be as A,U as B,pa as C,ve as D,Le as E,le as F,na as G,gt as H,be as I,Da as J,ar as K,re as L,mr as M,Ca as N,sr as O,ya as P,$a as Q,Ha as R,Pe as S,Ka as T,rr as U,ir as V,or as W,ja as X,Va as Y,Ya as Z,Xe as _,Ga as a,tt as a0,dr as a1,cr as a2,ur as a3,Bt as a4,lr as a5,qa as a6,Qa as a7,er as a8,tr as a9,Za as aa,Ja as ab,Wa as ac,fr as ad,Is as ae,Vs as af,Xa as b,z as c,Nt as d,tn as e,ce as f,H as g,Me as h,de as i,e as j,zt as k,da as l,ua as m,Mt as n,we as o,je as p,De as q,Se as r,Ne as s,_e as t,ta as u,Qt as v,en as w,Jt as x,nr as y,Oe as z};
