const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["backgroundTaskManager-DuxFkiIE.js","eventBus-CWDWdm45.js","workflowOrchestrator-BZtQc-WZ.js"])))=>i.map(i=>d[i]);
import{Z as $t,j as e,d as qe,l as Re,_ as qt,$ as Qt,a0 as Wt,m as Pe,B as T,x as De,a as St,u as it,z as Gt,i as Ie,A as W,Q as Z,L as F,S as X,K as J,M as ee,N as te,O as E,I as ie,f as He,t as Ve,R as Ct,a1 as Zt,w as Yt,G as Se,H as ae,a2 as Je,v as Et,a3 as lt,a4 as _t,a5 as _e,a6 as Me,a7 as Xt,D as pe,o as fe,p as je,q as be,r as ye,a8 as ut,a9 as et,s as ve,aa as Jt,ab as es,c as Te,b as At,ac as ts,ad as ss,ae as ns,g as Oe,af as as,ag as rs,ah as is,ai as mt,aj as Xe,ak as Rt,h as ls}from"./page-aichat-DvB7HPKg.js";import{i as os}from"./vendor-i18n-CxwOOByA.js";import{createRoot as cs}from"react-dom/client";import{T as Qe,h as ds,Q as us}from"./vendor-api-DQ9LBwtN.js";import{u as ot,L as Be,S as ms,R as ce}from"./vendor-router-D1H6RP3t.js";import{bw as hs,v as Pt,bx as Ft,by as Bt,A as tt,y as st,x as ht,bz as nt,B as at,k as xt,g as It,e as xe,F as We,J as Ge,X as Ee,bA as xs,bB as gs,bC as rt,bD as gt,t as Fe,N as ps,O as Tt,p as ge,z as Ke,j as fs,bE as zt,bF as js,bG as pt,S as ft,bH as bs,bI as vs,bJ as ys,bK as Ns,bL as ws,bM as Ds,bN as ks,bO as Ss,bP as jt,bQ as Lt,T as Ze,bR as Cs,a1 as Es,h as As,U as bt,bS as Rs,bT as Ps,bU as Fs,bV as Mt,r as Bs,bW as Is,bX as Ts,bY as zs,bZ as Ls,G as Ms,b_ as Os}from"./vendor-misc-CSrXB4F2.js";import{T as Us,t as p}from"./vendor-toast-CdQ6zwVl.js";import{createContext as Hs,useState as j,useEffect as me,useContext as Vs,Component as Ks,useMemo as se,useRef as Ne,useCallback as $s}from"react";import{M as we,S as Q,B as ke,a as qs}from"./page-calendar-Cl0jz9YD.js";import{R as vt,B as Qs,C as Ws,X as Gs,Y as Zs,T as yt,L as Ys,a as Nt,P as _s,b as Xs,c as Js}from"./vendor-charts-CXiYf6wP.js";import{M as en}from"./page-shopping-BUKRRYvG.js";import{t as tn,L as sn,u as nn,v as an,w as rn,x as ln}from"./vendor-ui-CXLUC216.js";import{m as Ue}from"./vendor-firebase-Dj6H5_d8.js";import{f as on,d as cn}from"./vendor-dates-gcsEV1c3.js";import"./vendor-utils-BNe0Xlio.js";import"react-dom";(function(){const n=document.createElement("link").relList;if(n&&n.supports&&n.supports("modulepreload"))return;for(const r of document.querySelectorAll('link[rel="modulepreload"]'))i(r);new MutationObserver(r=>{for(const c of r)if(c.type==="childList")for(const v of c.addedNodes)v.tagName==="LINK"&&v.rel==="modulepreload"&&i(v)}).observe(document,{childList:!0,subtree:!0});function d(r){const c={};return r.integrity&&(c.integrity=r.integrity),r.referrerPolicy&&(c.referrerPolicy=r.referrerPolicy),r.crossOrigin==="use-credentials"?c.credentials="include":r.crossOrigin==="anonymous"?c.credentials="omit":c.credentials="same-origin",c}function i(r){if(r.ep)return;r.ep=!0;const c=d(r);fetch(r.href,c)}})();const dn={de:{translation:{nav:{dashboard:"Dashboard",reminders:"Erinnerungen",finance:"Finanzen",bills:"Rechnungen",shopping:"Einkaufsliste",taxes:"Steuern",settings:"Einstellungen",logout:"Abmelden"},auth:{login:"Anmelden",logout:"Abmelden"},dashboard:{title:"Dashboard",upcomingEvents:"Anstehende Termine & Zahlungen",upcomingReminders:"Anstehende Termine & Zahlungen",appointments:"Termine & Aufgaben",pendingBills:"Offene Rechnungen",noAppointments:"Keine anstehenden Termine",noBills:"Keine offenen Rechnungen",viewAll:"Alle anzeigen",financeOverview:"Finanzübersicht (aktueller Monat)",taxStatus:"Steuer-Status",quickActions:"Schnellaktionen",noEvents:"Keine anstehenden Ereignisse",noReminders:"Keine anstehenden Erinnerungen",addReminder:"Erinnerung hinzufügen",addExpense:"Ausgabe hinzufügen",addEntry:"Eintrag hinzufügen",viewFinances:"Finanzen anzeigen",viewTaxProfile:"Steuerprofil anzeigen"},bills:{title:"Rechnungen",description:"Verwalten Sie Ihre Rechnungen und Zahlungserinnerungen",add:"Rechnung hinzufügen",edit:"Rechnung bearbeiten",scan:"Scannen",scanInvoice:"Rechnung scannen",total:"Gesamt",open:"Offen",overdue:"Überfällig",paid:"Bezahlt",pending:"Ausstehend",paidTab:"Bezahlt",noPending:"Keine ausstehenden Rechnungen",noPaid:"Noch keine bezahlten Rechnungen",addFirst:"Erste Rechnung hinzufügen",pendingPayments:"Offene Zahlungen",search:"Suchen...",filterStatus:"Status",titleField:"Titel / Beschreibung",titlePlaceholder:"z.B. Stromrechnung März",amount:"Betrag",currency:"Währung",dueDate:"Fälligkeitsdatum",paymentDetails:"Zahlungsdetails",creditor:"Empfänger",reference:"Referenz / Mitteilung",recurrence:"Wiederholung",noRecurrence:"Keine Wiederholung",quarterly:"Vierteljährlich",notes:"Notizen",notesPlaceholder:"Optionale Notizen...",dialogDescription:"Erfassen Sie die Rechnungsdetails",markAsPaid:"Als bezahlt markieren",markedAsPaid:"Als bezahlt markiert und Ausgabe erstellt",created:"Rechnung erstellt",updated:"Rechnung aktualisiert",deleted:"Rechnung gelöscht",confirmDelete:"Möchten Sie diese Rechnung wirklich löschen?",dataImported:"Rechnungsdaten übernommen",status:{paid:"Bezahlt",overdue:"Überfällig",dueSoon:"Bald fällig",pending:"Offen"},errors:{required:"Bitte füllen Sie alle Pflichtfelder aus."}},finance:{title:"Finanzen",add:"Eintrag hinzufügen",pageTitle:"Finanzen",pageDescription:"Verwalten Sie Ihre Einnahmen und Ausgaben",overview:"Übersicht",income:"Einnahmen",expenses:"Ausgaben",people:"Rechnungen",shoppingList:"Einkaufsliste",totalIncome:"Gesamteinnahmen",totalExpenses:"Gesamtausgaben",balance:"Saldo",allEntries:"Alle Einträge",noEntries:"Noch keine Einträge erfasst",noExpenses:"Keine Ausgaben",addEntry:"Eintrag hinzufügen",addIncome:"Einnahme hinzufügen",addExpense:"Ausgabe hinzufügen",category:"Kategorie",amount:"Betrag",date:"Datum",description:"Beschreibung",status:"Status",open:"Offen",paid:"Bezahlt",person:"Person",addPerson:"Person hinzufügen",personName:"Name",personAdded:"Person erfolgreich hinzugefügt",namePlaceholder:"Name eingeben",phone:"Telefon",noPeople:"Noch keine Personen erfasst",openAmount:"Offener Betrag",viewDetails:"Details anzeigen",notes:"Notizen",paymentMethod:"Zahlungsmethode",personDeleted:"Person erfolgreich gelöscht",invoices:"Rechnungen",addInvoice:"Rechnung hinzufügen",editInvoice:"Rechnung bearbeiten",deleteInvoice:"Rechnung löschen",invoiceAmount:"Betrag",invoiceDescription:"Beschreibung",invoiceDate:"Datum",invoiceStatus:"Status",invoiceAdded:"Rechnung erfolgreich hinzugefügt",invoiceUpdated:"Rechnung erfolgreich aktualisiert",invoiceDeleted:"Rechnung erfolgreich gelöscht",statusUpdated:"Status erfolgreich aktualisiert",noInvoices:"Noch keine Rechnungen erfasst",postponed:"Verschoben",confirmDelete:"Möchten Sie diese Rechnung wirklich löschen?",confirmDeletePerson:"Möchten Sie diese Person und alle zugehörigen Rechnungen wirklich löschen?",totalInvoices:"Rechnungen gesamt",openInvoices:"Offene Rechnungen",errors:{nameRequired:"Name ist erforderlich",amountRequired:"Betrag ist erforderlich",descriptionRequired:"Beschreibung ist erforderlich"},filterByCategory:"Nach Kategorie filtern",allCategories:"Alle Kategorien",showingCategory:"Zeigt",noIncome:"Keine Einnahmen vorhanden",monthlyOverview:"Monatsübersicht",last6Months:"Einnahmen vs. Ausgaben der letzten 6 Monate",exportSuccess:"Export erfolgreich",exportError:"Export fehlgeschlagen",recurring:"Wiederkehrend",recurrenceRule:"Wiederholungsregel",daily:"Täglich",weekly:"Wöchentlich",monthly:"Monatlich",yearly:"Jährlich",recurringHint:"Dieser Eintrag wird automatisch wiederholt erstellt.",budget:"Budget",budgets:"Budgets",setBudget:"Budget festlegen",budgetAmount:"Budget-Betrag",budgetUsed:"Verbraucht",budgetRemaining:"Verbleibend",budgetExceeded:"Budget überschritten",noBudgets:"Noch keine Budgets festgelegt",addBudget:"Budget hinzufügen",editBudget:"Budget bearbeiten",deleteBudget:"Budget löschen",budgetPeriod:"Zeitraum",categoryBreakdown:"Ausgaben nach Kategorie"},invoice:{scanTitle:"Rechnung scannen",scanDescription:"Laden Sie ein Bild der Rechnung hoch oder scannen Sie den QR-Code.",upload:"Hochladen",camera:"Kamera",manual:"Manuell",dropOrClick:"Bild hier ablegen oder klicken",supportedFormats:"JPG, PNG oder PDF",clickToChange:"Klicken um ein anderes Bild zu wählen",processing:"Verarbeite...",startCamera:"Kamera starten",capture:"Aufnehmen",qrCodeData:"QR-Code Daten",pasteQrData:"QR-Code Daten hier einfügen...",parseQr:"QR-Code parsen",dataExtracted:"Daten extrahiert",amount:"Betrag",creditor:"Empfänger",reference:"Referenz",message:"Mitteilung",useData:"Daten übernehmen",scan:"Scannen",scanInvoice:"Rechnung scannen",paymentDetails:"Zahlungsdetails",dataImported:"Daten wurden übernommen",qrDetected:"QR-Code erkannt!",qrNotSwiss:"QR-Code erkannt, aber kein Schweizer Zahlungs-QR.",noQrFound:"Kein QR-Code gefunden. Sie können die Daten manuell eingeben.",manualEntry:"QR-Code-Erkennung nicht verfügbar. Bitte geben Sie die Daten manuell ein.",qrParsed:"QR-Code-Daten erfolgreich geparst!",invalidQr:"Ungültige QR-Code-Daten.",invalidFileType:"Ungültiger Dateityp. Bitte laden Sie ein Bild oder PDF hoch.",processingError:"Fehler bei der Bildverarbeitung.",cameraError:"Kamera konnte nicht gestartet werden.",enterQrData:"Bitte geben Sie die QR-Code-Daten ein.",browserNotSupported:"QR-Code-Erkennung wird in diesem Browser nicht unterstützt. Bitte verwenden Sie Chrome oder Edge.",autoScanning:"Automatische Erkennung aktiv...",cameraInactive:"Kamera nicht aktiv",autoScanHint:"Der QR-Code wird automatisch erkannt, sobald er im Kamerabild erscheint."},shopping:{title:"Einkaufsliste",short:"Einkaufsliste",description:"Verwalten Sie Ihre Einkäufe und Budget",addItem:"Artikel hinzufügen",item:"Artikel",quantity:"Menge",estimatedPrice:"Geschätzter Preis",actualPrice:"Tatsächlicher Preis",category:"Kategorie",notBought:"Nicht eingekauft",bought:"Eingekauft",totalBudget:"Gesamtbudget",spent:"Ausgegeben",remaining:"Verbleibend",noItems:"Keine Artikel in der Liste",markAsBought:"Als eingekauft markieren",createExpense:"Ausgabe erstellen"},reminders:{title:"Erinnerungen",add:"Erinnerung hinzufügen",edit:"Erinnerung bearbeiten",description:"Verwalten Sie Ihre Termine, Zahlungen und Aufgaben",pageDescription:"Verwalten Sie Ihre Termine und Aufgaben",dialogDescription:"Erstellen Sie eine neue Erinnerung für Termine, Zahlungen oder Aufgaben",reminderTitle:"Titel",titleField:"Titel",titlePlaceholder:"z.B. Zahnarzttermin",addReminder:"Erinnerung hinzufügen",type:"Typ",types:{termin:"Termin",zahlung:"Zahlung",aufgabe:"Aufgabe"},appointment:"Termin",payment:"Zahlung",task:"Aufgabe",dueDate:"Fälligkeitsdatum",allDay:"Ganztägig",status:{label:"Status",offen:"Offen",erledigt:"Erledigt",überfällig:"Überfällig",open:"Offen",done:"Erledigt",overdue:"Überfällig"},open:"Offen",completed:"Erledigt",overdue:"Überfällig",amount:"Betrag",currency:"Währung",notes:"Notizen",notesPlaceholder:"Optionale Notizen...",recurrence:"Wiederholung",noRecurrence:"Keine Wiederholung",noReminders:"Keine Erinnerungen vorhanden",total:"Gesamt",pendingPayments:"Offene Zahlungen",search:"Suchen...",filterType:"Typ",filterStatus:"Status",upcoming:"Anstehend",past:"Vergangen",noUpcoming:"Keine anstehenden Erinnerungen",noPast:"Keine vergangenen Erinnerungen",addFirst:"Erste Erinnerung erstellen",markDone:"Als erledigt markieren",markOpen:"Wieder öffnen",confirmDelete:"Möchten Sie diese Erinnerung wirklich löschen?",created:"Erinnerung erstellt",updated:"Erinnerung aktualisiert",deleted:"Erinnerung gelöscht",statusUpdated:"Status aktualisiert",errors:{required:"Bitte füllen Sie alle Pflichtfelder aus."}},taxes:{title:"Steuern",description:"Verwalten Sie Ihre Steuerprofile für verschiedene Jahre",year:"Steuerjahr",canton:"Kanton",selectCanton:"Kanton wählen",noCanton:"Kein Kanton ausgewählt",status:{unvollständig:"Unvollständig",vollständig:"Vollständig",eingereicht:"Eingereicht",draft:"Entwurf",submitted:"Eingereicht",completed:"Abgeschlossen"},addProfile:"Neues Steuerprofil",newProfile:"Neues Steuerprofil",editProfile:"Steuerprofil bearbeiten",noProfiles:"Keine Steuerprofile vorhanden",createFirst:"Erstellen Sie Ihr erstes Steuerprofil, um zu beginnen.",profileDescription:"Erfassen Sie Ihre Steuerdaten für das gewählte Jahr",profileCreated:"Steuerprofil erfolgreich erstellt",profileUpdated:"Steuerprofil erfolgreich aktualisiert",profileDeleted:"Steuerprofil erfolgreich gelöscht",statusUpdated:"Status erfolgreich aktualisiert",errorCreating:"Fehler beim Erstellen des Profils",errorUpdating:"Fehler beim Aktualisieren des Profils",errorDeleting:"Fehler beim Löschen des Profils",confirmDelete:"Steuerprofil löschen?",confirmDeleteDescription:"Möchten Sie dieses Steuerprofil wirklich löschen? Diese Aktion kann nicht rückgängig gemacht werden.",personalInfo:"Persönliches",maritalStatus:"Zivilstand",selectMaritalStatus:"Wählen",single:"Ledig",married:"Verheiratet",divorced:"Geschieden",widowed:"Verwitwet",registeredPartnership:"Eingetragene Partnerschaft",children:"Kinder",incomeSection:"Einkommen",grossIncome:"Bruttoeinkommen",otherIncome:"Andere Einkünfte",other:"andere",deductionsSection:"Abzüge",deductions:"Abzüge",totalDeductions:"Gesamtabzüge (CHF)",taxableIncome:"Steuerbares Einkommen",notes:"Notizen",notesPlaceholder:"Zusätzliche Informationen..."},settings:{title:"Einstellungen",description:"Verwalten Sie Ihre Kontoeinstellungen",profile:"Profil",profileDescription:"Verwalten Sie Ihre persönlichen Informationen",name:"Name",namePlaceholder:"Ihr Name",email:"E-Mail",emailHint:"E-Mail kann nicht geändert werden",preferences:"Präferenzen",preferencesDescription:"Passen Sie Ihre App-Einstellungen an",language:"Sprache",currency:"Währung",canton:"Kanton",selectCanton:"Wählen Sie Ihren Kanton",cantonHint:"Wird für Steuerberechnungen verwendet",appearance:"Darstellung",appearanceDescription:"Passen Sie das Erscheinungsbild der App an",darkMode:"Dunkler Modus",darkModeDescription:"Dunkles Farbschema aktivieren",theme:"Design",notifications:"Benachrichtigungen",notificationsDescription:"Verwalten Sie Ihre Benachrichtigungseinstellungen",enableNotifications:"Benachrichtigungen aktivieren",notificationsHint:"Erhalten Sie Erinnerungen für anstehende Termine und Zahlungen",save:"Speichern",saved:"Einstellungen gespeichert",errorSaving:"Fehler beim Speichern",reset:"Zurücksetzen"},common:{add:"Hinzufügen",edit:"Bearbeiten",delete:"Löschen",cancel:"Abbrechen",save:"Speichern",close:"Schließen",search:"Suchen",filter:"Filtern",sort:"Sortieren",loading:"Wird geladen...",error:"Fehler",success:"Erfolg",confirm:"Bestätigen",yes:"Ja",no:"Nein"}}},en:{translation:{nav:{dashboard:"Dashboard",reminders:"Reminders",finance:"Finance",bills:"Bills",shopping:"Shopping List",taxes:"Taxes",settings:"Settings",logout:"Logout"},auth:{login:"Login",logout:"Logout"},dashboard:{title:"Dashboard",upcomingEvents:"Upcoming Appointments & Payments",appointments:"Appointments & Tasks",pendingBills:"Pending Bills",noAppointments:"No upcoming appointments",noBills:"No pending bills",viewAll:"View all",financeOverview:"Finance Overview (Current Month)",taxStatus:"Tax Status",quickActions:"Quick Actions",noEvents:"No upcoming events",addReminder:"Add Reminder",addExpense:"Add Expense",viewFinances:"View Finances"},bills:{title:"Bills",description:"Manage your bills and payment reminders",add:"Add Bill",edit:"Edit Bill",scan:"Scan",scanInvoice:"Scan Invoice",total:"Total",open:"Open",overdue:"Overdue",paid:"Paid",pending:"Pending",paidTab:"Paid",noPending:"No pending bills",noPaid:"No paid bills yet",addFirst:"Add first bill",pendingPayments:"Pending Payments",search:"Search...",filterStatus:"Status",titleField:"Title / Description",titlePlaceholder:"e.g. Electricity bill March",amount:"Amount",currency:"Currency",dueDate:"Due Date",paymentDetails:"Payment Details",creditor:"Creditor",reference:"Reference / Message",recurrence:"Recurrence",noRecurrence:"No recurrence",quarterly:"Quarterly",notes:"Notes",notesPlaceholder:"Optional notes...",dialogDescription:"Enter the bill details",markAsPaid:"Mark as paid",markedAsPaid:"Marked as paid and expense created",created:"Bill created",updated:"Bill updated",deleted:"Bill deleted",confirmDelete:"Are you sure you want to delete this bill?",dataImported:"Bill data imported",status:{paid:"Paid",overdue:"Overdue",dueSoon:"Due Soon",pending:"Open"},errors:{required:"Please fill in all required fields."}},finance:{pageTitle:"Finance",pageDescription:"Manage your income and expenses",overview:"Overview",income:"Income",expenses:"Expenses",people:"Invoices",shoppingList:"Shopping List",totalIncome:"Total Income",totalExpenses:"Total Expenses",balance:"Balance",noEntries:"No entries yet",addEntry:"Add Entry",addIncome:"Add Income",addExpense:"Add Expense",category:"Category",amount:"Amount",date:"Date",description:"Description",status:"Status",open:"Open",paid:"Paid",person:"Person",addPerson:"Add Person",personName:"Name",personAdded:"Person added successfully",namePlaceholder:"Enter name",phone:"Phone",noPeople:"No people added yet",openAmount:"Open Amount",viewDetails:"View Details",notes:"Notes",paymentMethod:"Payment Method",personDeleted:"Person deleted successfully",invoices:"Invoices",addInvoice:"Add Invoice",editInvoice:"Edit Invoice",deleteInvoice:"Delete Invoice",invoiceAmount:"Amount",invoiceDescription:"Description",invoiceDate:"Date",invoiceStatus:"Status",invoiceAdded:"Invoice added successfully",invoiceUpdated:"Invoice updated successfully",invoiceDeleted:"Invoice deleted successfully",statusUpdated:"Status updated successfully",noInvoices:"No invoices yet",postponed:"Postponed",confirmDelete:"Are you sure you want to delete this invoice?",confirmDeletePerson:"Are you sure you want to delete this person and all associated invoices?",totalInvoices:"Total Invoices",openInvoices:"Open Invoices",errors:{nameRequired:"Name is required",amountRequired:"Amount is required",descriptionRequired:"Description is required"},filterByCategory:"Filter by category",allCategories:"All categories",showingCategory:"Showing",noIncome:"No income entries",monthlyOverview:"Monthly Overview",last6Months:"Income vs. Expenses over the last 6 months",exportSuccess:"Export successful",exportError:"Export failed",recurring:"Recurring",recurrenceRule:"Recurrence Rule",daily:"Daily",weekly:"Weekly",monthly:"Monthly",yearly:"Yearly",recurringHint:"This entry will be automatically recreated.",budget:"Budget",budgets:"Budgets",setBudget:"Set Budget",budgetAmount:"Budget Amount",budgetUsed:"Used",budgetRemaining:"Remaining",budgetExceeded:"Budget exceeded",noBudgets:"No budgets set yet",addBudget:"Add Budget",editBudget:"Edit Budget",deleteBudget:"Delete Budget",budgetPeriod:"Period",categoryBreakdown:"Expenses by Category"},invoice:{scanTitle:"Scan Invoice",scanDescription:"Upload an image of the invoice or scan the QR code.",upload:"Upload",camera:"Camera",manual:"Manual",dropOrClick:"Drop image here or click",supportedFormats:"JPG, PNG or PDF",clickToChange:"Click to choose another image",processing:"Processing...",startCamera:"Start Camera",capture:"Capture",qrCodeData:"QR Code Data",pasteQrData:"Paste QR code data here...",parseQr:"Parse QR Code",dataExtracted:"Data extracted",amount:"Amount",creditor:"Recipient",reference:"Reference",message:"Message",useData:"Use Data",scan:"Scan",scanInvoice:"Scan Invoice",paymentDetails:"Payment Details",dataImported:"Data has been imported",qrDetected:"QR code detected!",qrNotSwiss:"QR code detected, but not a Swiss payment QR.",noQrFound:"No QR code found. You can enter the data manually.",manualEntry:"QR code detection not available. Please enter the data manually.",qrParsed:"QR code data successfully parsed!",invalidQr:"Invalid QR code data.",invalidFileType:"Invalid file type. Please upload an image or PDF.",processingError:"Error processing image.",cameraError:"Could not start camera.",enterQrData:"Please enter the QR code data.",browserNotSupported:"QR code detection is not supported in this browser. Please use Chrome or Edge.",autoScanning:"Auto-detection active...",cameraInactive:"Camera not active",autoScanHint:"The QR code will be automatically detected once it appears in the camera view."},shopping:{title:"Shopping List",description:"Manage your shopping and budget",addItem:"Add Item",item:"Item",quantity:"Quantity",estimatedPrice:"Estimated Price",actualPrice:"Actual Price",category:"Category",notBought:"Not Bought",bought:"Bought",totalBudget:"Total Budget",spent:"Spent",remaining:"Remaining",noItems:"No items in the list",markAsBought:"Mark as Bought",createExpense:"Create Expense"},reminders:{title:"Reminders",add:"Add Reminder",edit:"Edit Reminder",description:"Manage your appointments, payments and tasks",pageTitle:"Reminders",pageDescription:"Manage your appointments and tasks",dialogDescription:"Create a new reminder for appointments, payments or tasks",reminderTitle:"Title",titleField:"Title",titlePlaceholder:"e.g. Dentist appointment",addReminder:"Add Reminder",type:"Type",types:{termin:"Appointment",zahlung:"Payment",aufgabe:"Task"},appointment:"Appointment",payment:"Payment",task:"Task",dueDate:"Due Date",allDay:"All Day",status:{label:"Status",offen:"Open",erledigt:"Completed",überfällig:"Overdue",open:"Open",done:"Completed",overdue:"Overdue"},open:"Open",completed:"Completed",overdue:"Overdue",amount:"Amount",currency:"Currency",notes:"Notes",notesPlaceholder:"Optional notes...",recurrence:"Recurrence",noRecurrence:"No recurrence",noReminders:"No reminders",total:"Total",pendingPayments:"Pending Payments",search:"Search...",filterType:"Type",filterStatus:"Status",upcoming:"Upcoming",past:"Past",noUpcoming:"No upcoming reminders",noPast:"No past reminders",addFirst:"Create first reminder",markDone:"Mark as completed",markOpen:"Reopen",confirmDelete:"Are you sure you want to delete this reminder?",created:"Reminder created",updated:"Reminder updated",deleted:"Reminder deleted",statusUpdated:"Status updated",errors:{required:"Please fill in all required fields."}},taxes:{title:"Taxes",description:"Manage your tax profiles for different years",year:"Tax Year",canton:"Canton",selectCanton:"Select Canton",noCanton:"No canton selected",status:{unvollständig:"Incomplete",vollständig:"Complete",eingereicht:"Submitted",draft:"Draft",submitted:"Submitted",completed:"Completed"},addProfile:"New Tax Profile",newProfile:"New Tax Profile",editProfile:"Edit Tax Profile",noProfiles:"No tax profiles",createFirst:"Create your first tax profile to get started.",profileDescription:"Enter your tax data for the selected year",profileCreated:"Tax profile created successfully",profileUpdated:"Tax profile updated successfully",profileDeleted:"Tax profile deleted successfully",statusUpdated:"Status updated successfully",errorCreating:"Error creating profile",errorUpdating:"Error updating profile",errorDeleting:"Error deleting profile",confirmDelete:"Delete tax profile?",confirmDeleteDescription:"Are you sure you want to delete this tax profile? This action cannot be undone.",personalInfo:"Personal Info",maritalStatus:"Marital Status",selectMaritalStatus:"Select",single:"Single",married:"Married",divorced:"Divorced",widowed:"Widowed",registeredPartnership:"Registered Partnership",children:"Children",incomeSection:"Income",grossIncome:"Gross Income",otherIncome:"Other Income",other:"other",deductionsSection:"Deductions",deductions:"Deductions",totalDeductions:"Total Deductions (CHF)",taxableIncome:"Taxable Income",notes:"Notes",notesPlaceholder:"Additional information..."},settings:{title:"Settings",description:"Manage your account settings",profile:"Profile",profileDescription:"Manage your personal information",name:"Name",namePlaceholder:"Your name",email:"Email",emailHint:"Email cannot be changed",preferences:"Preferences",preferencesDescription:"Customize your app settings",language:"Language",currency:"Currency",canton:"Canton",selectCanton:"Select your canton",cantonHint:"Used for tax calculations",appearance:"Appearance",appearanceDescription:"Customize the look and feel of the app",darkMode:"Dark Mode",darkModeDescription:"Enable dark color scheme",theme:"Theme",notifications:"Notifications",notificationsDescription:"Manage your notification settings",enableNotifications:"Enable notifications",notificationsHint:"Receive reminders for upcoming appointments and payments",save:"Save",saved:"Settings saved",errorSaving:"Error saving settings",reset:"Reset"},common:{add:"Add",edit:"Edit",delete:"Delete",cancel:"Cancel",save:"Save",close:"Close",search:"Search",filter:"Filter",sort:"Sort",loading:"Loading...",error:"Error",success:"Success",confirm:"Confirm",yes:"Yes",no:"No"}}}};os.use($t).init({resources:dn,lng:"de",fallbackLng:"de",interpolation:{escapeValue:!1}});const un=({...t})=>{const{theme:n="system"}=hs();return e.jsx(Us,{theme:n,className:"toaster group",style:{"--normal-bg":"var(--popover)","--normal-text":"var(--popover-foreground)","--normal-border":"var(--border)"},...t})},Ot=Hs(void 0);function mn({children:t,defaultTheme:n="light",switchable:d=!1}){const{settings:i,updateSettings:r}=qe(),[c,v]=j(()=>{if(d){const f=i?.theme;if(f&&(f==="light"||f==="dark"))return f;const k=localStorage.getItem("theme");return k&&(k==="light"||k==="dark")?k:(k&&r&&(r({theme:k}).catch(console.error),localStorage.removeItem("theme")),n)}return n});me(()=>{d&&i?.theme&&(i.theme==="light"||i.theme==="dark")&&v(i.theme)},[i?.theme,d]),me(()=>{const f=document.documentElement;c==="dark"?f.classList.add("dark"):f.classList.remove("dark"),d&&r&&(r({theme:c}).catch(console.error),localStorage.setItem("theme",c))},[c,d,r]);const y=d?()=>{v(f=>f==="light"?"dark":"light")}:void 0;return e.jsx(Ot.Provider,{value:{theme:c,toggleTheme:y,switchable:d},children:t})}function hn(){const t=Vs(Ot);if(!t)throw new Error("useTheme must be used within ThemeProvider");return t}function xn(t,n){const d={...n,timestamp:new Date().toISOString(),userAgent:typeof window<"u"?window.navigator.userAgent:void 0,url:typeof window<"u"?window.location.href:void 0};console.error("Error:",{message:t.message,stack:t.stack,...d})}class gn extends Ks{constructor(n){super(n),this.state={hasError:!1,error:null,errorInfo:null}}static getDerivedStateFromError(n){return{hasError:!0,error:n,errorInfo:null}}componentDidCatch(n,d){xn(n,{componentStack:d.componentStack,errorBoundary:!0}),this.setState({error:n,errorInfo:d})}handleReset=()=>{this.setState({hasError:!1,error:null,errorInfo:null})};render(){return this.state.hasError?this.props.fallback?this.props.fallback:e.jsx(pn,{error:this.state.error,errorInfo:this.state.errorInfo,onReset:this.handleReset}):this.props.children}}function pn({error:t,errorInfo:n,onReset:d}){const[,i]=ot();return e.jsx("div",{className:"min-h-screen bg-background flex items-center justify-center p-4",children:e.jsxs(Re,{className:"w-full max-w-md",children:[e.jsxs(qt,{children:[e.jsxs("div",{className:"flex items-center gap-3 mb-2",children:[e.jsx(Pt,{className:"w-8 h-8 text-destructive"}),e.jsx(Qt,{children:"Ein Fehler ist aufgetreten"})]}),e.jsx(Wt,{children:"Die Anwendung ist auf einen unerwarteten Fehler gestoßen. Bitte versuchen Sie es erneut."})]}),e.jsxs(Pe,{className:"space-y-4",children:[!1,e.jsxs("div",{className:"flex flex-col gap-2",children:[e.jsxs(T,{onClick:d,className:"w-full h-10 min-h-[44px]",variant:"default",children:[e.jsx(Ft,{className:"w-4 h-4 mr-2"}),"Erneut versuchen"]}),e.jsxs(T,{onClick:()=>{i("/"),d()},className:"w-full h-10 min-h-[44px]",variant:"outline",children:[e.jsx(Bt,{className:"w-4 h-4 mr-2"}),"Zur Startseite"]})]})]})]})})}function fn(){const{t}=De(),{data:n=[],isLoading:d}=St(),{data:i=[],isLoading:r}=it({status:"offen"}),{data:c=[],isLoading:v}=Gt(),{totalIncome:y,totalExpenses:f,balance:k,monthlyTrend:x}=se(()=>{const o=new Date,h=o.getMonth(),I=o.getFullYear(),K=h===0?11:h-1,D=h===0?I-1:I,L=n.filter(C=>{const B=C.date?.toDate?C.date.toDate():new Date(C.date);return C.type==="einnahme"&&B.getMonth()===h&&B.getFullYear()===I}).reduce((C,B)=>C+B.amount,0)/100,re=n.filter(C=>{const B=C.date?.toDate?C.date.toDate():new Date(C.date);return C.type==="ausgabe"&&C.status==="paid"&&B.getMonth()===h&&B.getFullYear()===I}).reduce((C,B)=>C+B.amount,0)/100,P=n.filter(C=>{const B=C.date?.toDate?C.date.toDate():new Date(C.date);return C.type==="einnahme"&&B.getMonth()===K&&B.getFullYear()===D}).reduce((C,B)=>C+B.amount,0)/100,O=n.filter(C=>{const B=C.date?.toDate?C.date.toDate():new Date(C.date);return C.type==="ausgabe"&&C.status==="paid"&&B.getMonth()===K&&B.getFullYear()===D}).reduce((C,B)=>C+B.amount,0)/100,ne=n.filter(C=>C.type==="einnahme").reduce((C,B)=>C+B.amount,0)/100,Y=n.filter(C=>C.type==="ausgabe"&&C.status==="paid").reduce((C,B)=>C+B.amount,0)/100,_=P>0?(L-P)/P*100:0,G=O>0?(re-O)/O*100:0;return{totalIncome:ne,totalExpenses:Y,balance:ne-Y,monthlyTrend:{income:_,expenses:G,currentMonthIncome:L,currentMonthExpenses:re}}},[n]),w=i.filter(o=>o.status==="offen").length,A=c.filter(o=>!o.bought).length,S=o=>`CHF ${o.toFixed(2)}`,z=d||r||v;return e.jsx(we,{title:"Übersicht",showSidebar:!0,children:z?e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"mobile-card mb-4 bg-primary text-primary-foreground",children:[e.jsx(Q,{className:"h-4 w-20 mb-2 bg-primary-foreground/20"}),e.jsx(Q,{className:"h-9 w-32 mb-4 bg-primary-foreground/20"}),e.jsxs("div",{className:"flex gap-6 mt-4 pt-4 border-t border-primary-foreground/20",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx(Q,{className:"h-3 w-16 mb-1 bg-primary-foreground/20"}),e.jsx(Q,{className:"h-6 w-24 bg-primary-foreground/20"})]}),e.jsxs("div",{className:"flex-1",children:[e.jsx(Q,{className:"h-3 w-16 mb-1 bg-primary-foreground/20"}),e.jsx(Q,{className:"h-6 w-24 bg-primary-foreground/20"})]})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-3 mb-6",children:[e.jsx(Q,{className:"h-20 w-full rounded-lg"}),e.jsx(Q,{className:"h-20 w-full rounded-lg"})]}),e.jsx(Q,{className:"h-4 w-24 mb-4"}),e.jsxs("div",{className:"flex flex-col gap-6",children:[e.jsx(Q,{className:"h-16 w-full rounded-lg"}),e.jsx(Q,{className:"h-16 w-full rounded-lg"}),e.jsx(Q,{className:"h-16 w-full rounded-lg"})]})]}):e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"mobile-card mb-4 bg-primary text-primary-foreground",children:[e.jsx("p",{className:"text-sm opacity-70 mb-2",children:t("finance.balance","Saldo")}),e.jsx("p",{className:"text-3xl font-semibold mb-4",children:S(k)}),e.jsxs("div",{className:"flex gap-6 mt-4 pt-4 border-t border-primary-foreground/20",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("p",{className:"text-xs opacity-60 mb-1",children:t("finance.income","Einnahmen")}),e.jsxs("p",{className:"text-lg font-medium flex items-center gap-1.5",children:[e.jsx(tt,{className:"w-5 h-5 opacity-70"}),S(y)]}),x.income!==0&&e.jsxs("p",{className:`text-xs mt-1 flex items-center gap-1 ${x.income>0?"text-green-300":"text-red-300"}`,children:[x.income>0?e.jsx(st,{className:"w-3 h-3"}):e.jsx(ht,{className:"w-3 h-3"}),Math.abs(x.income).toFixed(1),"% vs. Vormonat"]})]}),e.jsxs("div",{className:"flex-1",children:[e.jsx("p",{className:"text-xs opacity-60 mb-1",children:t("finance.expenses","Ausgaben")}),e.jsxs("p",{className:"text-lg font-medium flex items-center gap-1.5",children:[e.jsx(nt,{className:"w-5 h-5 opacity-70"}),S(f)]}),x.expenses!==0&&e.jsxs("p",{className:`text-xs mt-1 flex items-center gap-1 ${x.expenses<0?"text-green-300":"text-red-300"}`,children:[x.expenses<0?e.jsx(ht,{className:"w-3 h-3"}):e.jsx(st,{className:"w-3 h-3"}),Math.abs(x.expenses).toFixed(1),"% vs. Vormonat"]})]})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-3 mb-6",children:[e.jsx(Be,{href:"/reminders",children:e.jsxs("div",{className:"mobile-card flex items-center gap-3 active:opacity-80 transition-opacity",children:[e.jsx("div",{className:"w-10 h-10 rounded-lg bg-status-warning flex items-center justify-center",children:e.jsx(at,{className:"w-5 h-5 status-warning"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-2xl font-semibold",children:w}),e.jsx("p",{className:"text-xs text-muted-foreground",children:t("reminders.open","Offen")})]})]})}),e.jsx(Be,{href:"/shopping",children:e.jsxs("div",{className:"mobile-card flex items-center gap-3 active:opacity-80 transition-opacity",children:[e.jsx("div",{className:"w-10 h-10 rounded-lg bg-status-success flex items-center justify-center",children:e.jsx(xt,{className:"w-5 h-5 status-success"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-2xl font-semibold",children:A}),e.jsx("p",{className:"text-xs text-muted-foreground",children:t("shopping.items","Artikel")})]})]})})]}),e.jsx("p",{className:"text-xs font-medium text-muted-foreground mb-4 uppercase tracking-wider",children:t("dashboard.quickActions","Schnellzugriff")}),e.jsxs("div",{className:"flex flex-col gap-6",children:[e.jsx(Be,{href:"/finance",className:"block",children:e.jsxs("div",{className:"mobile-card flex items-center justify-between active:opacity-80 transition-opacity py-4",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:"w-12 h-12 rounded-lg bg-muted flex items-center justify-center flex-shrink-0",children:e.jsx(It,{className:"w-6 h-6 text-foreground"})}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-base",children:t("nav.finance","Finanzen")}),e.jsxs("p",{className:"text-xs text-muted-foreground mt-0.5",children:[n.length," ",t("finance.entries","Einträge")]})]})]}),e.jsx(xe,{className:"w-5 h-5 text-muted-foreground flex-shrink-0 ml-2"})]})}),e.jsx(Be,{href:"/bills",className:"block",children:e.jsxs("div",{className:"mobile-card flex items-center justify-between active:opacity-80 transition-opacity py-4",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:"w-12 h-12 rounded-lg bg-muted flex items-center justify-center flex-shrink-0",children:e.jsx(We,{className:"w-6 h-6 text-foreground"})}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-base",children:t("nav.bills","Rechnungen")}),e.jsx("p",{className:"text-xs text-muted-foreground mt-0.5",children:t("bills.manage","Verwalten")})]})]}),e.jsx(xe,{className:"w-5 h-5 text-muted-foreground flex-shrink-0 ml-2"})]})}),e.jsx(Be,{href:"/shopping",className:"block",children:e.jsxs("div",{className:"mobile-card flex items-center justify-between active:opacity-80 transition-opacity py-4",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:"w-12 h-12 rounded-lg bg-muted flex items-center justify-center flex-shrink-0",children:e.jsx(xt,{className:"w-6 h-6 text-foreground"})}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-base",children:t("nav.shopping","Einkaufsliste")}),e.jsxs("p",{className:"text-xs text-muted-foreground mt-0.5",children:[A," ",t("shopping.itemsOpen","offen")]})]})]}),e.jsx(xe,{className:"w-5 h-5 text-muted-foreground flex-shrink-0 ml-2"})]})})]})]})})}function jn({onRefresh:t,threshold:n=80,disabled:d=!1}){const[i,r]=j({isRefreshing:!1,pullDistance:0,canRefresh:!1}),c=Ne(0),v=Ne(0),y=Ne(!1),f=Ne(null);me(()=>{if(d)return;const w=f.current;if(!w)return;const A=o=>{w.scrollTop===0&&(c.current=o.touches[0].clientY,y.current=!0)},S=o=>{if(!y.current)return;v.current=o.touches[0].clientY;const h=Math.max(0,v.current-c.current);h>0&&(o.preventDefault(),r({isRefreshing:!1,pullDistance:h,canRefresh:h>=n}))},z=async()=>{if(y.current)if(y.current=!1,i.canRefresh&&!i.isRefreshing){r({isRefreshing:!0,pullDistance:n,canRefresh:!0});try{await t()}catch(o){console.error("[PullToRefresh] Error:",o)}finally{r({isRefreshing:!1,pullDistance:0,canRefresh:!1})}}else r({isRefreshing:!1,pullDistance:0,canRefresh:!1})};return w.addEventListener("touchstart",A,{passive:!1}),w.addEventListener("touchmove",S,{passive:!1}),w.addEventListener("touchend",z),()=>{w.removeEventListener("touchstart",A),w.removeEventListener("touchmove",S),w.removeEventListener("touchend",z)}},[d,t,n,i.canRefresh,i.isRefreshing]);const k=Math.min(i.pullDistance/n,1),x=i.pullDistance>0||i.isRefreshing;return{containerRef:f,isRefreshing:i.isRefreshing,pullProgress:k,shouldShowIndicator:x,pullDistance:i.pullDistance}}function Ut(t,n){const{headers:d,rows:i,title:r}=t,c=[];r&&(c.push(r),c.push("")),c.push(d.join(",")),i.forEach(x=>{const w=x.map(A=>{const S=String(A);return S.includes(",")||S.includes('"')||S.includes(`
`)?`"${S.replace(/"/g,'""')}"`:S});c.push(w.join(","))});const v="\uFEFF"+c.join(`
`),y=new Blob([v],{type:"text/csv;charset=utf-8;"}),f=URL.createObjectURL(y),k=document.createElement("a");k.href=f,k.download=n||`export_${new Date().toISOString().split("T")[0]}.csv`,k.click(),URL.revokeObjectURL(f)}function bn(t,n){const{headers:d,rows:i,title:r}=t;let c=`
    <!DOCTYPE html>
    <html lang="de">
    <head>
      <meta charset="UTF-8">
      <title>${r||"Export"}</title>
      <style>
        @media print {
          @page {
            margin: 1cm;
          }
        }
        body {
          font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
          padding: 20px;
          color: #333;
        }
        h1 {
          margin-bottom: 20px;
          font-size: 24px;
        }
        table {
          width: 100%;
          border-collapse: collapse;
          margin-top: 20px;
        }
        th, td {
          border: 1px solid #ddd;
          padding: 8px 12px;
          text-align: left;
        }
        th {
          background-color: #f5f5f5;
          font-weight: 600;
        }
        tr:nth-child(even) {
          background-color: #f9f9f9;
        }
        .footer {
          margin-top: 30px;
          text-align: center;
          font-size: 12px;
          color: #666;
        }
      </style>
    </head>
    <body>
      ${r?`<h1>${r}</h1>`:""}
      <table>
        <thead>
          <tr>
            ${d.map(k=>`<th>${k}</th>`).join("")}
          </tr>
        </thead>
        <tbody>
          ${i.map(k=>`
            <tr>
              ${k.map(x=>`<td>${String(x)}</td>`).join("")}
            </tr>
          `).join("")}
        </tbody>
      </table>
      <div class="footer">
        <p>Exportiert am ${new Date().toLocaleDateString("de-CH",{day:"2-digit",month:"long",year:"numeric",hour:"2-digit",minute:"2-digit"})}</p>
      </div>
    </body>
    </html>
  `;const v=new Blob([c],{type:"text/html;charset=utf-8"}),y=URL.createObjectURL(v),f=window.open(y,"_blank");if(!f)throw new Error("Pop-up blockiert. Bitte erlauben Sie Pop-ups für diese Website.");f.onload=()=>{setTimeout(()=>{f.print(),setTimeout(()=>URL.revokeObjectURL(y),1e3)},250)}}function vn(t){const n=["Datum","Typ","Kategorie","Betrag (CHF)","Zahlungsmethode","Status","Notizen"],d=t.map(i=>{const c=(i.date?.toDate?i.date.toDate():new Date(i.date)).toLocaleDateString("de-CH"),v=i.type==="einnahme"?"Einnahme":"Ausgabe",y=(i.amount/100).toFixed(2),f=i.status==="paid"?"Bezahlt":i.type==="einnahme"?"-":"Offen";return[c,v,i.category||"",y,i.paymentMethod||"",f,i.notes||""]});Ut({headers:n,rows:d,title:"Finanzübersicht"},`finanzen_${new Date().toISOString().split("T")[0]}.csv`)}function yn(t,n){const d=["Datum","Typ","Kategorie","Betrag (CHF)","Status"],i=t.map(r=>{const v=(r.date?.toDate?r.date.toDate():new Date(r.date)).toLocaleDateString("de-CH"),y=r.type==="einnahme"?"Einnahme":"Ausgabe",f=(r.amount/100).toFixed(2),k=r.status==="paid"?"Bezahlt":r.type==="einnahme"?"-":"Offen";return[v,y,r.category||"",f,k]});n&&(i.push(["","","ZUSAMMENFASSUNG","",""]),i.push(["","","Einnahmen",`CHF ${n.income.toFixed(2)}`,""]),i.push(["","","Ausgaben",`CHF ${n.expenses.toFixed(2)}`,""]),i.push(["","","Saldo",`CHF ${n.balance.toFixed(2)}`,""])),bn({headers:d,rows:i,title:"Finanzübersicht"})}function Nn(t){const n=["Titel","Typ","Fälligkeitsdatum","Betrag (CHF)","Status","Notizen"],d=t.map(i=>{const c=(i.dueDate instanceof Date?i.dueDate:new Date(i.dueDate)).toLocaleDateString("de-CH",{day:"2-digit",month:"2-digit",year:"numeric"}),v=i.amount?(i.amount/100).toFixed(2):"",y={termin:"Termin",zahlung:"Zahlung",aufgabe:"Aufgabe"};return[i.title,y[i.type]||i.type,c,v,i.status==="erledigt"?"Erledigt":i.status==="überfällig"?"Überfällig":"Offen",i.notes||""]});Ut({headers:n,rows:d,title:"Erinnerungen"},`erinnerungen_${new Date().toISOString().split("T")[0]}.csv`)}const wt={income:["Gehalt","Freelance","Investitionen","Geschenk","Sonstiges"],expense:["Lebensmittel","Transport","Wohnen","Unterhaltung","Gesundheit","Kleidung","Bildung","Rechnung","Sonstiges"]};function wn(){const{t}=De(),{data:n=[],isLoading:d,refetch:i}=St(),[r,c]=j("all"),[v,y]=j(!1),[f,k]=j("ausgabe"),[x,w]=j(""),[A,S]=j("all"),[z,o]=j("all"),[h,I]=j(!1),{containerRef:K,isRefreshing:D,pullProgress:L,shouldShowIndicator:re}=jn({onRefresh:async()=>{await i()},disabled:d}),[P,O]=j({category:"",amount:"",date:Ie(new Date),notes:"",paymentMethod:"Karte",isRecurring:!1,recurrenceRule:"monthly"}),ne=se(()=>n.filter(a=>a.type==="einnahme"),[n]),Y=se(()=>n.filter(a=>a.type==="ausgabe"),[n]),_=se(()=>ne.reduce((a,b)=>a+b.amount,0)/100,[ne]),G=se(()=>Y.filter(a=>a.status==="paid").reduce((a,b)=>a+b.amount,0)/100,[Y]),C=_-G,B=se(()=>{const a={},b=new Date;for(let g=5;g>=0;g--){const H=new Date(b.getFullYear(),b.getMonth()-g,1),de=`${H.getFullYear()}-${String(H.getMonth()+1).padStart(2,"0")}`;a[de]={income:0,expenses:0}}return n.forEach(g=>{const H=g.date&&typeof g.date=="object"&&"toDate"in g.date?g.date.toDate():new Date(g.date),de=`${H.getFullYear()}-${String(H.getMonth()+1).padStart(2,"0")}`;if(a[de]){const Ae=g.amount/100;g.type==="einnahme"?a[de].income+=Ae:g.type==="ausgabe"&&g.status==="paid"&&(a[de].expenses+=Ae)}}),Object.entries(a).map(([g,H])=>{const[de,Ae]=g.split("-");return{month:new Date(parseInt(de),parseInt(Ae)-1).toLocaleDateString("de-CH",{month:"short",year:"2-digit"}),income:Math.round(H.income*100)/100,expenses:Math.round(H.expenses*100)/100}})},[n]),le=se(()=>{const a={};return Y.filter(b=>b.status==="paid").forEach(b=>{const g=b.amount/100;a[b.category]=(a[b.category]||0)+g}),Object.entries(a).map(([b,g])=>({name:b,value:Math.round(g*100)/100})).sort((b,g)=>g.value-b.value).slice(0,8)},[Y]),m=["#ef4444","#f97316","#eab308","#22c55e","#3b82f6","#8b5cf6","#ec4899","#06b6d4"],R=se(()=>{const a=new Set;return n.forEach(b=>{b.category&&a.add(b.category)}),Array.from(a).sort()},[n]),l=se(()=>{let a=n;switch(r){case"income":a=ne;break;case"expenses":a=Y;break;default:a=n}if(A!=="all"&&(a=a.filter(b=>b.category===A)),z!=="all"){const b=new Date,g=new Date;switch(z){case"week":g.setDate(b.getDate()-7);break;case"month":g.setMonth(b.getMonth()-1);break;case"year":g.setFullYear(b.getFullYear()-1);break}a=a.filter(H=>(H.date&&typeof H.date=="object"&&"toDate"in H.date?H.date.toDate():new Date(H.date))>=g)}if(x.trim()){const b=x.toLowerCase();a=a.filter(g=>g.category?.toLowerCase().includes(b)||g.notes?.toLowerCase().includes(b)||g.paymentMethod?.toLowerCase().includes(b))}return a.sort((b,g)=>{const H=b.date&&typeof b.date=="object"&&"toDate"in b.date?b.date.toDate():new Date(b.date);return(g.date&&typeof g.date=="object"&&"toDate"in g.date?g.date.toDate():new Date(g.date)).getTime()-H.getTime()})},[r,n,ne,Y,A,z,x]),s=a=>`CHF ${(a/100).toFixed(2)}`,N=a=>{try{return(a?.toDate?a.toDate():new Date(a)).toLocaleDateString("de-CH",{day:"2-digit",month:"2-digit",year:"numeric"})}catch{return"N/A"}},U=async(a,b)=>{try{await Zt(a,{status:b}),p.success(b==="paid"?"Als bezahlt markiert":"Status geändert"),await i()}catch(g){p.error("Fehler: "+g.message)}},$=async()=>{if(!P.category||!P.amount){p.error("Bitte Kategorie und Betrag eingeben");return}try{await Yt({type:f,category:P.category,amount:Math.round(parseFloat(P.amount)*100),currency:"CHF",date:new Date(P.date),paymentMethod:P.paymentMethod,notes:P.notes,status:f==="ausgabe"?"open":void 0,isRecurring:P.isRecurring,recurrenceRule:P.isRecurring?P.recurrenceRule:void 0}),p.success(f==="einnahme"?"Einnahme hinzugefügt":"Ausgabe hinzugefügt"),ie(),y(!1),O({category:"",amount:"",date:Ie(new Date),notes:"",paymentMethod:"Karte",isRecurring:!1,recurrenceRule:"monthly"}),await i()}catch(a){p.error(Se(a)),ae()}},oe=a=>{k(a),O({category:"",amount:"",date:Ie(new Date),notes:"",paymentMethod:"Karte",isRecurring:!1,recurrenceRule:"monthly"}),y(!0)};return e.jsxs(we,{title:t("nav.finance","Finanzen"),showSidebar:!0,children:[re&&e.jsx("div",{className:"fixed top-16 left-0 right-0 flex items-center justify-center z-40 transition-all duration-200 pointer-events-none",style:{transform:`translateY(${Math.max(-60,L*60-60)}px)`,opacity:Math.min(L*1.5,1)},children:e.jsxs("div",{className:"bg-background border border-border shadow-lg rounded-lg px-4 py-2 flex items-center gap-2",children:[e.jsx(Ft,{className:`w-5 h-5 text-primary transition-transform ${D?"animate-spin":""}`,style:{transform:`rotate(${L*180}deg)`}}),e.jsx("span",{className:"text-sm font-medium",children:D?"Aktualisiere...":L>=1?"Loslassen zum Aktualisieren":"Ziehen zum Aktualisieren"})]})}),e.jsxs("div",{ref:K,className:"h-full overflow-y-auto",children:[e.jsxs("div",{className:"grid grid-cols-3 gap-3 mb-4",children:[e.jsxs("div",{className:"mobile-card text-center py-4",children:[e.jsx("p",{className:"text-xs text-muted-foreground mb-1.5",children:t("finance.income","Einnahmen")}),e.jsx("p",{className:"text-lg font-semibold status-success",children:_.toFixed(0)})]}),e.jsxs("div",{className:"mobile-card text-center py-4",children:[e.jsx("p",{className:"text-xs text-muted-foreground mb-1.5",children:t("finance.expenses","Ausgaben")}),e.jsx("p",{className:"text-lg font-semibold status-error",children:G.toFixed(0)})]}),e.jsxs("div",{className:"mobile-card text-center py-4",children:[e.jsx("p",{className:"text-xs text-muted-foreground mb-1.5",children:t("finance.balance","Saldo")}),e.jsx("p",{className:`text-lg font-semibold ${C>=0?"status-success":"status-error"}`,children:C.toFixed(0)})]})]}),e.jsxs("div",{className:"flex gap-3 mb-4",children:[e.jsxs("button",{onClick:()=>{W(),oe("einnahme")},className:"flex-1 mobile-card flex items-center justify-center gap-2 py-4 border-l-2 border-l-green-600 active:opacity-80 transition-opacity min-h-[56px]",children:[e.jsx(tt,{className:"w-5 h-5 status-success"}),e.jsx("span",{className:"font-medium text-sm",children:"Einnahme"})]}),e.jsxs("button",{onClick:()=>{W(),oe("ausgabe")},className:"flex-1 mobile-card flex items-center justify-center gap-2 py-4 border-l-2 border-l-red-600 active:opacity-80 transition-opacity min-h-[56px]",children:[e.jsx(nt,{className:"w-5 h-5 status-error"}),e.jsx("span",{className:"font-medium text-sm",children:"Ausgabe"})]})]}),e.jsxs("div",{className:"mb-4 space-y-3",children:[e.jsxs("div",{className:"relative",children:[e.jsx(Ge,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-5 h-5 text-muted-foreground"}),e.jsx(Z,{type:"text",placeholder:"Suchen nach Kategorie, Notizen...",value:x,onChange:a=>w(a.target.value),className:"pl-10 pr-10 mobile-input"}),x&&e.jsx("button",{onClick:()=>w(""),className:"absolute right-3 top-1/2 -translate-y-1/2 p-1 rounded-full hover:bg-muted transition-colors","aria-label":"Suche löschen",children:e.jsx(Ee,{className:"w-4 h-4 text-muted-foreground"})})]}),e.jsxs("button",{onClick:()=>{W(),I(!h)},className:"w-full mobile-card flex items-center justify-between py-3 active:opacity-80 transition-opacity",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(xs,{className:"w-5 h-5 text-muted-foreground"}),e.jsx("span",{className:"font-medium text-sm",children:"Filter"}),(A!=="all"||z!=="all")&&e.jsx("span",{className:"w-2 h-2 rounded-full bg-primary"})]}),e.jsx(xe,{className:`w-5 h-5 text-muted-foreground transition-transform ${h?"rotate-90":""}`})]}),h&&e.jsxs("div",{className:"mobile-card p-4 space-y-4 animate-in slide-in-from-top-2",children:[e.jsxs("div",{children:[e.jsx(F,{className:"text-sm text-muted-foreground mb-2 block",children:"Kategorie"}),e.jsxs(X,{value:A,onValueChange:S,children:[e.jsx(J,{className:"mobile-input",children:e.jsx(ee,{})}),e.jsxs(te,{children:[e.jsx(E,{value:"all",children:"Alle Kategorien"}),R.map(a=>e.jsx(E,{value:a,children:a},a))]})]})]}),e.jsxs("div",{children:[e.jsx(F,{className:"text-sm text-muted-foreground mb-2 block",children:"Zeitraum"}),e.jsxs(X,{value:z,onValueChange:a=>o(a),children:[e.jsx(J,{className:"mobile-input",children:e.jsx(ee,{})}),e.jsxs(te,{children:[e.jsx(E,{value:"all",children:"Alle Zeit"}),e.jsx(E,{value:"week",children:"Letzte 7 Tage"}),e.jsx(E,{value:"month",children:"Letzter Monat"}),e.jsx(E,{value:"year",children:"Letztes Jahr"})]})]})]}),(A!=="all"||z!=="all")&&e.jsx("button",{onClick:()=>{W(),S("all"),o("all")},className:"w-full py-2 px-4 rounded-lg bg-muted text-foreground font-medium active:opacity-80 transition-opacity",children:"Filter zurücksetzen"})]})]}),e.jsx("div",{className:"flex gap-3 mb-4 overflow-x-auto hide-scrollbar",children:[{key:"all",label:t("finance.all","Alle")},{key:"income",label:t("finance.income","Einnahmen")},{key:"expenses",label:t("finance.expenses","Ausgaben")}].map(a=>e.jsx("button",{onClick:()=>{W(),c(a.key)},className:`px-4 py-2 rounded-lg text-sm font-medium whitespace-nowrap transition-colors ${r===a.key?"bg-primary text-primary-foreground":"bg-muted text-muted-foreground"}`,children:a.label},a.key))}),B.length>0&&e.jsxs("div",{className:"mobile-card mb-4 p-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(gs,{className:"w-5 h-5 text-muted-foreground"}),e.jsx("h3",{className:"font-semibold text-base",children:t("finance.monthlyOverview","Monatsübersicht")})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:()=>{W(),vn(l),ie()},className:"p-2 rounded-lg bg-muted hover:bg-muted/80 transition-colors","aria-label":"Als CSV exportieren",children:e.jsx(rt,{className:"w-4 h-4"})}),e.jsx("button",{onClick:()=>{W(),yn(l,{income:_,expenses:G,balance:C}),ie()},className:"p-2 rounded-lg bg-muted hover:bg-muted/80 transition-colors","aria-label":"Als PDF exportieren",children:e.jsx(rt,{className:"w-4 h-4"})})]})]}),e.jsx("div",{className:"h-[250px] w-full",children:e.jsx(vt,{width:"100%",height:"100%",children:e.jsxs(Qs,{data:B,margin:{top:10,right:10,left:-20,bottom:5},children:[e.jsx(Ws,{strokeDasharray:"3 3",stroke:"hsl(var(--border))",opacity:.3}),e.jsx(Gs,{dataKey:"month",fontSize:11,tickLine:!1,axisLine:!1,tick:{fill:"hsl(var(--muted-foreground))"}}),e.jsx(Zs,{fontSize:11,tickLine:!1,axisLine:!1,tick:{fill:"hsl(var(--muted-foreground))"},tickFormatter:a=>`${a}`}),e.jsx(yt,{formatter:a=>[`CHF ${a.toFixed(2)}`,""],contentStyle:{backgroundColor:"hsl(var(--background))",border:"1px solid hsl(var(--border))",borderRadius:"8px",boxShadow:"0 4px 6px rgba(0,0,0,0.1)",fontSize:"12px"},labelStyle:{color:"hsl(var(--foreground))",fontWeight:600}}),e.jsx(Ys,{wrapperStyle:{fontSize:"12px",paddingTop:"10px"},iconType:"circle"}),e.jsx(Nt,{dataKey:"income",name:t("finance.income","Einnahmen"),fill:"#22c55e",radius:[4,4,0,0],isAnimationActive:!0}),e.jsx(Nt,{dataKey:"expenses",name:t("finance.expenses","Ausgaben"),fill:"#ef4444",radius:[4,4,0,0],isAnimationActive:!0})]})})})]}),le.length>0&&r==="expenses"&&e.jsxs("div",{className:"mobile-card mb-4 p-4",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-4",children:[e.jsx(st,{className:"w-5 h-5 text-muted-foreground"}),e.jsx("h3",{className:"font-semibold text-base",children:t("finance.categoryBreakdown","Ausgaben nach Kategorie")})]}),e.jsxs("div",{className:"flex flex-col gap-4",children:[e.jsx("div",{className:"h-[200px] w-full",children:e.jsx(vt,{width:"100%",height:"100%",children:e.jsxs(_s,{children:[e.jsx(Xs,{data:le,cx:"50%",cy:"50%",innerRadius:40,outerRadius:80,paddingAngle:2,dataKey:"value",isAnimationActive:!0,children:le.map((a,b)=>e.jsx(Js,{fill:m[b%m.length]},`cell-${b}`))}),e.jsx(yt,{formatter:a=>[`CHF ${a.toFixed(2)}`,""],contentStyle:{backgroundColor:"hsl(var(--background))",border:"1px solid hsl(var(--border))",borderRadius:"8px",boxShadow:"0 4px 6px rgba(0,0,0,0.1)",fontSize:"12px"}})]})})}),e.jsx("div",{className:"space-y-2",children:le.slice(0,6).map((a,b)=>{const g=G>0?a.value/G*100:0;return e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-3 h-3 rounded-full shrink-0",style:{backgroundColor:m[b%m.length]}}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-sm font-medium truncate",children:a.name}),e.jsxs("span",{className:"text-sm text-muted-foreground ml-2",children:[g.toFixed(1),"%"]})]}),e.jsxs("div",{className:"flex items-center gap-2 mt-1",children:[e.jsx("div",{className:"flex-1 h-2 bg-muted rounded-full overflow-hidden",children:e.jsx("div",{className:"h-full rounded-full",style:{width:`${g}%`,backgroundColor:m[b%m.length]}})}),e.jsxs("span",{className:"text-xs font-medium text-foreground min-w-[60px] text-right",children:["CHF ",a.value.toFixed(2)]})]})]})]},a.name)})})]})]}),d?e.jsx("div",{className:"text-center py-8 text-muted-foreground",children:t("common.loading","Laden...")}):l.length===0?e.jsx("div",{className:"text-center py-8 text-muted-foreground",children:t("finance.noEntries","Keine Einträge")}):e.jsx("div",{className:"space-y-3",children:l.map(a=>{const b=a.type==="einnahme",g=a.status==="paid";return e.jsxs("div",{className:`mobile-card flex items-center justify-between py-3 ${b?"border-l-2 border-l-green-600":"border-l-2 border-l-red-600"}`,children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:`w-10 h-10 rounded-lg flex items-center justify-center ${b?"bg-status-success":"bg-status-error"}`,children:b?e.jsx(tt,{className:"w-5 h-5 status-success"}):e.jsx(nt,{className:"w-5 h-5 status-error"})}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("p",{className:"font-medium",children:a.category}),a.isRecurring&&e.jsx(gt,{className:"w-3 h-3 text-muted-foreground","aria-label":"Wiederkehrend"})]}),e.jsx("p",{className:"text-xs text-muted-foreground",children:N(a.date)}),a.isRecurring&&e.jsxs("p",{className:"text-xs text-muted-foreground mt-0.5",children:["Wiederholt: ",a.recurrenceRule==="daily"?"Täglich":a.recurrenceRule==="weekly"?"Wöchentlich":a.recurrenceRule==="monthly"?"Monatlich":a.recurrenceRule==="yearly"?"Jährlich":""]})]})]}),e.jsxs("div",{className:"text-right",children:[e.jsxs("p",{className:`font-semibold ${b?"status-success":"status-error"}`,children:[b?"+":"-",s(a.amount)]}),!b&&e.jsx("button",{onClick:()=>{W(),U(a.id,g?"open":"paid")},className:`text-xs px-2 py-0.5 rounded mt-1 ${g?"bg-status-success status-success":"bg-status-warning status-warning"}`,"aria-label":`Status für ${a.category} ändern`,"aria-pressed":g,children:g?t("finance.paid","Bezahlt"):t("finance.open","Offen")})]})]},a.id)})}),v&&e.jsx("div",{className:"fixed inset-0 z-50 bg-black/50 flex items-end",children:e.jsxs("div",{className:"bg-background w-full rounded-t-2xl p-6 safe-bottom animate-in slide-in-from-bottom",children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsx("h2",{className:"text-lg font-semibold",children:f==="einnahme"?"Neue Einnahme":"Neue Ausgabe"}),e.jsx("button",{onClick:()=>y(!1),className:"w-10 h-10 rounded-lg bg-muted flex items-center justify-center",children:e.jsx(Ee,{className:"w-5 h-5"})})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx(F,{className:"text-sm text-muted-foreground",children:"Kategorie"}),e.jsxs(X,{value:P.category,onValueChange:a=>O({...P,category:a}),children:[e.jsx(J,{className:"mobile-input mt-1",children:e.jsx(ee,{placeholder:"Kategorie wählen"})}),e.jsx(te,{children:(f==="einnahme"?wt.income:wt.expense).map(a=>e.jsx(E,{value:a,children:a},a))})]})]}),e.jsxs("div",{children:[e.jsx(F,{className:"text-sm text-muted-foreground",children:"Betrag (CHF)"}),e.jsx(Z,{type:"number",value:P.amount,onChange:a=>O({...P,amount:a.target.value}),placeholder:"0.00",className:"mobile-input mt-1",step:"0.01"})]}),e.jsxs("div",{children:[e.jsx(F,{className:"text-sm text-muted-foreground",children:"Datum"}),e.jsx(Z,{type:"text",placeholder:"DD.MM.YYYY",value:He(P.date),onChange:a=>{const b=Ve(a.target.value);b&&O({...P,date:b})},onBlur:a=>{!Ve(a.target.value)&&P.date&&(a.target.value=He(P.date))},className:"mobile-input mt-1"})]}),e.jsxs("div",{children:[e.jsx(F,{className:"text-sm text-muted-foreground",children:"Zahlungsmethode"}),e.jsxs(X,{value:P.paymentMethod,onValueChange:a=>O({...P,paymentMethod:a}),children:[e.jsx(J,{className:"mobile-input mt-1",children:e.jsx(ee,{})}),e.jsxs(te,{children:[e.jsx(E,{value:"Karte",children:"Karte"}),e.jsx(E,{value:"Bar",children:"Bar"}),e.jsx(E,{value:"Überweisung",children:"Überweisung"}),e.jsx(E,{value:"Twint",children:"Twint"})]})]})]}),e.jsxs("div",{children:[e.jsx(F,{className:"text-sm text-muted-foreground",children:"Notizen (optional)"}),e.jsx(Z,{value:P.notes,onChange:a=>O({...P,notes:a.target.value}),placeholder:"Zusätzliche Infos...",className:"mobile-input mt-1"})]}),e.jsxs("div",{className:"flex items-center justify-between p-3 bg-muted/50 rounded-lg",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(gt,{className:"w-5 h-5 text-muted-foreground"}),e.jsxs("div",{children:[e.jsx(F,{className:"text-sm font-medium",children:"Wiederkehrend"}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Automatisch wiederholen"})]})]}),e.jsx(Ct,{checked:P.isRecurring,onCheckedChange:a=>O({...P,isRecurring:a})})]}),P.isRecurring&&e.jsxs("div",{children:[e.jsx(F,{className:"text-sm text-muted-foreground",children:"Wiederholung"}),e.jsxs(X,{value:P.recurrenceRule,onValueChange:a=>O({...P,recurrenceRule:a}),children:[e.jsx(J,{className:"mobile-input mt-1",children:e.jsx(ee,{})}),e.jsxs(te,{children:[e.jsx(E,{value:"daily",children:"Täglich"}),e.jsx(E,{value:"weekly",children:"Wöchentlich"}),e.jsx(E,{value:"monthly",children:"Monatlich"}),e.jsx(E,{value:"yearly",children:"Jährlich"})]})]})]}),e.jsx(T,{onClick:$,className:`w-full mobile-btn mt-4 ${f==="einnahme"?"bg-green-600 hover:bg-green-700 text-white":"bg-red-600 hover:bg-red-700 text-white"}`,children:f==="einnahme"?"Einnahme hinzufügen":"Ausgabe hinzufügen"})]})]})}),!v&&e.jsx("button",{onClick:()=>{W(),oe("ausgabe")},className:"fixed right-4 bottom-20 w-14 h-14 rounded-full bg-primary text-primary-foreground shadow-lg flex items-center justify-center active:opacity-80 transition-opacity safe-bottom",children:e.jsx(Fe,{className:"w-6 h-6"})})]})]})}function Dn(){const{t}=De(),{data:n=[],isLoading:d,refetch:i}=it({}),[r,c]=j(!1),[v,y]=j(!1),[f,k]=j(!1),[x,w]=j({title:"",amount:"",dueDate:Ie(new Date),iban:"",reference:""}),A=Ne(null),S=Ne(null),z=Ne(null),o=Ne(null),h=se(()=>n.filter(m=>m.type==="zahlung"),[n]),I=h.filter(m=>m.status==="offen"),K=h.filter(m=>m.status==="erledigt"),D=I.reduce((m,R)=>m+(R.amount||0),0)/100,L=m=>`CHF ${(m/100).toFixed(2)}`,re=m=>{try{return(m?.toDate?m.toDate():new Date(m)).toLocaleDateString("de-CH",{day:"2-digit",month:"2-digit"})}catch{return"N/A"}},P=async m=>{try{await Je(m,{status:"erledigt"}),p.success("Als bezahlt markiert"),ie(),await i()}catch(R){p.error(Se(R)),ae()}},O=m=>{try{return(m?.toDate?m.toDate():new Date(m))<new Date}catch{return!1}},ne=async()=>{if(!x.title||!x.amount){p.error("Bitte Titel und Betrag eingeben"),ae();return}try{await Et({title:x.title,type:"zahlung",status:"offen",amount:Math.round(parseFloat(x.amount)*100),dueDate:x.dueDate?new Date(x.dueDate):new Date,description:x.iban?`IBAN: ${x.iban}`:""}),p.success("Rechnung hinzugefügt"),ie(),c(!1),w({title:"",amount:"",dueDate:Ie(new Date),iban:"",reference:""}),await i()}catch(m){p.error(Se(m)),ae()}},Y=async()=>{try{const m=await navigator.mediaDevices.getUserMedia({video:{facingMode:"environment"}});o.current=m,A.current&&(A.current.srcObject=m),y(!0),ie()}catch(m){p.error(Se(m)),ae()}},_=()=>{o.current&&(o.current.getTracks().forEach(m=>m.stop()),o.current=null),y(!1)},G=()=>{if(A.current&&S.current){const m=A.current,R=S.current;R.width=m.videoWidth,R.height=m.videoHeight;const l=R.getContext("2d");l&&(l.drawImage(m,0,0),B(R))}},C=m=>{const R=m.target.files?.[0];if(R){const l=new FileReader;l.onload=s=>{const N=new Image;N.onload=()=>{if(S.current){const U=S.current;U.width=N.width,U.height=N.height;const $=U.getContext("2d");$&&($.drawImage(N,0,0),B(U))}},N.src=s.target?.result},l.readAsDataURL(R)}},B=async m=>{k(!0);try{if("BarcodeDetector"in window){const l=await new window.BarcodeDetector({formats:["qr_code"]}).detect(m);if(l.length>0){const s=l[0].rawValue;le(s),p.success("QR-Code erkannt"),_()}else p.error("Kein QR-Code gefunden")}else p.error("QR-Code Erkennung nicht unterstützt")}catch{p.error("Fehler beim Scannen")}finally{k(!1)}},le=m=>{try{const R=m.split(`
`);if(R.length>10){const l=R[3]||"",s=R[18]||"",N=R[28]||"";w(U=>({...U,iban:l,amount:s,reference:N,title:"Gescannte Rechnung"})),c(!0)}}catch{}};return e.jsxs(we,{title:t("nav.bills","Rechnungen"),showSidebar:!0,children:[e.jsxs("div",{className:"mobile-card mb-4 bg-primary text-primary-foreground",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-3",children:[e.jsx(We,{className:"w-6 h-6 opacity-70"}),e.jsx("p",{className:"text-sm opacity-70 font-medium",children:t("bills.openAmount","Offene Rechnungen")})]}),e.jsxs("p",{className:"text-3xl font-semibold mb-2",children:["CHF ",D.toFixed(2)]}),e.jsxs("p",{className:"text-sm opacity-60",children:[I.length," ",t("bills.bills","Rechnungen")]})]}),e.jsxs("div",{className:"flex gap-3 mb-4",children:[e.jsxs("button",{onClick:()=>{W(),c(!0)},className:"flex-1 mobile-card flex items-center justify-center gap-2 py-4 active:opacity-80 transition-opacity min-h-[56px]","aria-label":"Rechnung manuell hinzufügen",children:[e.jsx(Fe,{className:"w-5 h-5"}),e.jsx("span",{className:"font-medium text-sm",children:"Manuell"})]}),e.jsxs("button",{onClick:()=>{W(),Y()},className:"flex-1 mobile-card flex items-center justify-center gap-2 py-4 active:opacity-80 transition-opacity min-h-[56px]","aria-label":"QR-Code scannen",children:[e.jsx(ps,{className:"w-5 h-5"}),e.jsx("span",{className:"font-medium text-sm",children:"Scannen"})]}),e.jsxs("button",{onClick:()=>{W(),z.current?.click()},className:"flex-1 mobile-card flex items-center justify-center gap-2 py-4 active:opacity-80 transition-opacity min-h-[56px]","aria-label":"Bild hochladen",children:[e.jsx(Tt,{className:"w-5 h-5"}),e.jsx("span",{className:"font-medium text-sm",children:"Bild"})]}),e.jsx("input",{ref:z,type:"file",accept:"image/*",className:"hidden",onChange:C})]}),d?e.jsx("div",{className:"space-y-3",children:[1,2,3].map(m=>e.jsx("div",{className:"mobile-card p-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex-1 space-y-2",children:[e.jsx(Q,{className:"h-4 w-3/4"}),e.jsx(Q,{className:"h-3 w-1/2"})]}),e.jsx(Q,{className:"h-8 w-20 ml-4"})]})},m))}):I.length===0?e.jsxs("div",{className:"mobile-card text-center py-8",children:[e.jsx(ge,{className:"w-10 h-10 mx-auto status-success mb-2"}),e.jsx("p",{className:"text-muted-foreground",children:t("bills.allPaid","Alle Rechnungen bezahlt")})]}):e.jsx("div",{className:"space-y-3 mb-4",children:I.map(m=>{const R=O(m.dueDate);return e.jsxs("div",{className:`mobile-card flex items-center justify-between py-3 ${R?"border-l-2 border-l-red-500":""}`,children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:`w-10 h-10 rounded-lg flex items-center justify-center ${R?"bg-status-error":"bg-status-warning"}`,children:R?e.jsx(Pt,{className:"w-5 h-5 status-error"}):e.jsx(Ke,{className:"w-5 h-5 status-warning"})}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium",children:m.title}),e.jsxs("p",{className:`text-xs ${R?"status-error":"text-muted-foreground"}`,children:[R?"Überfällig • ":"",re(m.dueDate)]})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("p",{className:"font-semibold",children:L(m.amount||0)}),e.jsx("button",{onClick:()=>{W(),P(m.id)},className:"w-10 h-10 rounded-lg bg-status-success flex items-center justify-center status-success active:opacity-80 transition-opacity","aria-label":`${m.title} als bezahlt markieren`,children:e.jsx(ge,{className:"w-5 h-5"})})]})]},m.id)})}),K.length>0&&e.jsxs(e.Fragment,{children:[e.jsxs("p",{className:"text-xs font-medium text-muted-foreground mb-2 uppercase tracking-wider",children:[t("bills.paid","Bezahlt")," (",K.length,")"]}),e.jsx("div",{className:"space-y-3 opacity-60",children:K.slice(0,5).map(m=>e.jsxs("div",{className:"mobile-card flex items-center justify-between py-3",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:"w-10 h-10 rounded-lg bg-status-success flex items-center justify-center",children:e.jsx(ge,{className:"w-5 h-5 status-success"})}),e.jsx("p",{className:"font-medium line-through",children:m.title})]}),e.jsx("p",{className:"text-muted-foreground",children:L(m.amount||0)})]},m.id))})]}),e.jsx("canvas",{ref:S,className:"hidden"}),r&&e.jsx("div",{className:"fixed inset-0 z-50 bg-black/50 flex items-end",children:e.jsxs("div",{className:"bg-background w-full rounded-t-2xl p-6 safe-bottom animate-in slide-in-from-bottom",children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsx("h2",{className:"text-lg font-semibold",children:"Neue Rechnung"}),e.jsx("button",{onClick:()=>c(!1),className:"w-10 h-10 rounded-lg bg-muted flex items-center justify-center",children:e.jsx(Ee,{className:"w-5 h-5"})})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx(F,{className:"text-sm text-muted-foreground",children:"Titel"}),e.jsx(Z,{value:x.title,onChange:m=>w({...x,title:m.target.value}),placeholder:"z.B. Stromrechnung",className:"mobile-input mt-1"})]}),e.jsxs("div",{children:[e.jsx(F,{className:"text-sm text-muted-foreground",children:"Betrag (CHF)"}),e.jsx(Z,{type:"number",value:x.amount,onChange:m=>w({...x,amount:m.target.value}),placeholder:"0.00",className:"mobile-input mt-1",step:"0.01"})]}),e.jsxs("div",{children:[e.jsx(F,{className:"text-sm text-muted-foreground",children:"Fälligkeitsdatum"}),e.jsx(Z,{type:"text",placeholder:"DD.MM.YYYY",value:He(x.dueDate),onChange:m=>{const R=Ve(m.target.value);R&&w({...x,dueDate:R})},onBlur:m=>{!Ve(m.target.value)&&x.dueDate&&(m.target.value=He(x.dueDate))},className:"mobile-input mt-1"})]}),e.jsxs("div",{children:[e.jsx(F,{className:"text-sm text-muted-foreground",children:"IBAN (optional)"}),e.jsx(Z,{value:x.iban,onChange:m=>w({...x,iban:m.target.value}),placeholder:"CH...",className:"mobile-input mt-1"})]}),e.jsx(T,{onClick:ne,className:"w-full mobile-btn bg-primary text-primary-foreground mt-4",children:"Rechnung hinzufügen"})]})]})}),v&&e.jsxs("div",{className:"fixed inset-0 z-50 bg-black flex flex-col",children:[e.jsxs("div",{className:"flex items-center justify-between p-4",children:[e.jsx("h2",{className:"text-white font-medium",children:"QR-Code scannen"}),e.jsx("button",{onClick:_,className:"w-10 h-10 rounded-lg bg-white/10 flex items-center justify-center",children:e.jsx(Ee,{className:"w-5 h-5 text-white"})})]}),e.jsxs("div",{className:"flex-1 relative",children:[e.jsx("video",{ref:A,autoPlay:!0,playsInline:!0,className:"w-full h-full object-cover"}),e.jsx("div",{className:"absolute inset-0 flex items-center justify-center",children:e.jsx("div",{className:"w-64 h-64 border-2 border-white/50 rounded-lg relative",children:f&&e.jsx("div",{className:"absolute inset-0 flex items-center justify-center bg-black/50 rounded-lg",children:e.jsx("div",{className:"w-8 h-8 border-2 border-white border-t-transparent rounded-full animate-spin"})})})})]}),e.jsx("div",{className:"p-6 flex justify-center safe-bottom",children:e.jsx("button",{onClick:G,disabled:f,className:"w-16 h-16 rounded-full bg-white flex items-center justify-center active:opacity-80 transition-opacity",children:e.jsx(fs,{className:"w-8 h-8 text-black"})})})]}),!r&&!v&&e.jsx("button",{onClick:()=>c(!0),className:"fixed right-4 bottom-20 w-14 h-14 rounded-full bg-primary text-primary-foreground shadow-lg flex items-center justify-center active:opacity-80 transition-opacity safe-bottom",children:e.jsx(Fe,{className:"w-6 h-6"})})]})}async function kn(){return"Notification"in window?Notification.permission==="granted"?"granted":Notification.permission!=="denied"?await Notification.requestPermission():"denied":(console.warn("This browser does not support notifications"),"denied")}function Sn(){return"Notification"in window&&"serviceWorker"in navigator}function Cn(){return"Notification"in window?Notification.permission:"denied"}async function Ht(){if(!("serviceWorker"in navigator))return console.warn("Service Workers not supported"),null;try{const t=await navigator.serviceWorker.register("/sw.js",{scope:"/"});return console.log("[Notifications] Service Worker registered:",t.scope),t.addEventListener("updatefound",()=>{const n=t.installing;n&&n.addEventListener("statechange",()=>{n.state==="installed"&&navigator.serviceWorker.controller&&console.log("[Notifications] New service worker available")})}),t}catch(t){return console.error("[Notifications] Service Worker registration failed:",t),null}}function ct(){return typeof window<"u"&&"PublicKeyCredential"in window&&typeof PublicKeyCredential.isUserVerifyingPlatformAuthenticatorAvailable=="function"}async function Vt(){if(!ct())return!1;try{return await PublicKeyCredential.isUserVerifyingPlatformAuthenticatorAvailable()}catch(t){return console.error("[Biometric] Error checking availability:",t),!1}}async function En(t,n){if(!ct())return{success:!1,error:"Biometric authentication is not supported on this device"};if(!await Vt())return{success:!1,error:"No biometric authenticator available on this device"};try{const i={challenge:Uint8Array.from(crypto.getRandomValues(new Uint8Array(32))),rp:{name:"Nexo",id:window.location.hostname},user:{id:Uint8Array.from(t,v=>v.charCodeAt(0)),name:n,displayName:n},pubKeyCredParams:[{alg:-7,type:"public-key"}],authenticatorSelection:{authenticatorAttachment:"platform",userVerification:"required"},timeout:6e4,attestation:"direct"},r=await navigator.credentials.create({publicKey:i});return r?{success:!0,credentialId:Buffer.from(r.rawId).toString("base64")}:{success:!1,error:"Failed to create credential"}}catch(i){console.error("[Biometric] Registration error:",i);let r="Biometric registration failed";return i.name==="NotAllowedError"?r="Biometric registration was cancelled or denied":i.name==="InvalidStateError"?r="Biometric credential already exists":i.name==="NotSupportedError"&&(r="Biometric authentication is not supported"),{success:!1,error:r}}}function An(){const{settings:t,updateSettings:n,isLoading:d}=qe(),[i,r]=j(()=>t?.biometricEnabled!==void 0?t.biometricEnabled:localStorage.getItem("biometricEnabled")==="true");return me(()=>{if(!d&&t?.biometricEnabled!==void 0)r(t.biometricEnabled);else if(!d&&!t?.biometricEnabled){const y=localStorage.getItem("biometricEnabled");if(y!==null){const f=y==="true";n({biometricEnabled:f}).then(()=>{localStorage.removeItem("biometricEnabled")}).catch(console.error),r(f)}}},[t?.biometricEnabled,d,n]),{isEnabled:i,enable:async()=>{r(!0),await n({biometricEnabled:!0}),localStorage.setItem("biometricEnabled","true")},disable:async()=>{r(!1),await n({biometricEnabled:!1}),localStorage.setItem("biometricEnabled","false")}}}function Rn(){const{t}=De(),[n,d]=j("default"),[i,r]=j(!1),[c,v]=j(!1);me(()=>{r(Sn()),d(Cn())},[]);const y=async()=>{v(!0);try{W(),await Ht();const x=await kn();d(x),x==="granted"?(p.success("Benachrichtigungen aktiviert"),ie()):x==="denied"?(p.error("Benachrichtigungen wurden blockiert. Bitte in den Browser-Einstellungen aktivieren."),ae()):p.info("Berechtigung erforderlich")}catch{p.error("Fehler beim Aktivieren der Benachrichtigungen"),ae()}finally{v(!1)}};if(!i)return e.jsx("div",{className:"mobile-card w-full flex items-center justify-between py-4 opacity-50",children:e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:"w-10 h-10 rounded-lg bg-muted flex items-center justify-center",children:e.jsx(at,{className:"w-5 h-5 text-foreground"})}),e.jsxs("div",{className:"text-left",children:[e.jsx("p",{className:"font-medium",children:t("settings.notifications","Benachrichtigungen")}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Nicht unterstützt"})]})]})});const f=n==="granted",k=n==="denied";return e.jsxs("div",{className:"mobile-card w-full py-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:"w-10 h-10 rounded-lg bg-muted flex items-center justify-center",children:e.jsx(at,{className:"w-5 h-5 text-foreground"})}),e.jsxs("div",{className:"text-left",children:[e.jsx("p",{className:"font-medium",children:t("settings.notifications","Benachrichtigungen")}),e.jsx("p",{className:"text-xs text-muted-foreground",children:f?"Aktiviert":k?"Blockiert":"Nicht aktiviert"})]})]}),f?e.jsx("div",{className:"w-6 h-6 rounded-full bg-green-500 flex items-center justify-center",children:e.jsx(ge,{className:"w-4 h-4 text-white"})}):e.jsx("div",{className:"w-6 h-6 rounded-full bg-gray-400 flex items-center justify-center",children:e.jsx(Ee,{className:"w-4 h-4 text-white"})})]}),!f&&e.jsx("button",{onClick:y,disabled:c||k,className:"w-full py-2 px-4 rounded-lg bg-primary text-primary-foreground font-medium active:opacity-80 transition-opacity disabled:opacity-50 disabled:cursor-not-allowed min-h-[44px]",children:c?"Aktiviere...":k?"In Browser-Einstellungen aktivieren":"Benachrichtigungen aktivieren"}),k&&e.jsx("p",{className:"text-xs text-muted-foreground mt-2",children:"Bitte öffnen Sie die Browser-Einstellungen und erlauben Sie Benachrichtigungen für diese Website."})]})}function Pn(){const{user:t}=lt(),{isEnabled:n,enable:d,disable:i}=An(),[r,c]=j(!1),[v,y]=j(!1),[f,k]=j(!1),[x,w]=j(!1);me(()=>{(async()=>{const z=ct();if(c(z),z){const o=await Vt();y(o)}})()},[]);const A=async()=>{if(n){await i(),p.success("Biometrische Authentifizierung deaktiviert"),ie();return}if(!v){p.error("Biometrische Authentifizierung ist auf diesem Gerät nicht verfügbar"),ae();return}w(!0);try{if(W(),!t){p.error("Bitte melden Sie sich zuerst an"),ae();return}const S=await En(t.uid,t.displayName||t.email||"User");S.success?(await d(),p.success("Biometrische Authentifizierung aktiviert"),ie()):(p.error(S.error||"Aktivierung fehlgeschlagen"),ae())}catch{p.error("Fehler beim Aktivieren der biometrischen Authentifizierung"),ae()}finally{w(!1)}};return r?e.jsxs("div",{className:"mobile-card w-full py-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:"w-10 h-10 rounded-lg bg-muted flex items-center justify-center",children:e.jsx(ks,{className:"w-5 h-5 text-foreground"})}),e.jsxs("div",{className:"text-left",children:[e.jsx("p",{className:"font-medium",children:"Biometrische Authentifizierung"}),e.jsx("p",{className:"text-xs text-muted-foreground",children:n?"Aktiviert":v?"Verfügbar":"Nicht verfügbar"})]})]}),n?e.jsx("div",{className:"w-6 h-6 rounded-full bg-green-500 flex items-center justify-center",children:e.jsx(ge,{className:"w-4 h-4 text-white"})}):e.jsx("div",{className:"w-6 h-6 rounded-full bg-gray-400 flex items-center justify-center",children:e.jsx(Ee,{className:"w-4 h-4 text-white"})})]}),v&&e.jsx("button",{onClick:A,disabled:x||f,className:"w-full py-2 px-4 rounded-lg bg-primary text-primary-foreground font-medium active:opacity-80 transition-opacity disabled:opacity-50 disabled:cursor-not-allowed min-h-[44px]",children:x?"Registriere...":f?"Lädt...":n?"Biometrische Authentifizierung deaktivieren":"Biometrische Authentifizierung aktivieren"}),!v&&r&&e.jsx("p",{className:"text-xs text-muted-foreground",children:"Kein biometrischer Sensor auf diesem Gerät gefunden."})]}):null}function Fn(){const{settings:t,updateSettings:n,isLoading:d}=qe(),[i,r]=j(!1),[c,v]=j(""),[y,f]=j(!1);me(()=>{t?.weatherLocation&&v(t.weatherLocation)},[t]);const k=async()=>{if(!c.trim()){p.error("Bitte geben Sie einen Ort ein"),ae();return}f(!0);try{W(),await n({weatherLocation:c.trim()}),r(!1),p.success("Standort gespeichert"),ie()}catch{p.error("Fehler beim Speichern des Standorts"),ae()}finally{f(!1)}};return e.jsxs(e.Fragment,{children:[e.jsxs("button",{onClick:()=>r(!0),className:"mobile-card w-full flex items-center justify-between active:opacity-80 transition-opacity py-4",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:"w-10 h-10 rounded-lg bg-muted flex items-center justify-center",children:e.jsx(Ss,{className:"w-5 h-5 text-foreground"})}),e.jsxs("div",{className:"text-left",children:[e.jsx("p",{className:"font-medium",children:"Wetter-Standort"}),e.jsx("p",{className:"text-xs text-muted-foreground truncate max-w-[200px]",children:t?.weatherLocation||"Zurich, CH"})]})]}),e.jsx(xe,{className:"w-5 h-5 text-muted-foreground"})]}),i&&e.jsx("div",{className:"fixed inset-0 z-50 bg-black/50 flex items-end",onClick:()=>r(!1),children:e.jsxs("div",{className:"bg-background w-full rounded-t-2xl p-6 safe-bottom animate-in slide-in-from-bottom",onClick:x=>x.stopPropagation(),children:[e.jsx("h2",{className:"text-lg font-semibold mb-4",children:"Wetter-Standort"}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium mb-2 block",children:'Ort (z.B. "Zurich, CH" oder "Berlin, DE")'}),e.jsx("input",{type:"text",value:c,onChange:x=>v(x.target.value),placeholder:"Zurich, CH",className:"w-full px-4 py-3 rounded-lg bg-muted border border-border focus:outline-none focus:ring-2 focus:ring-primary",disabled:y||d}),e.jsx("p",{className:"text-xs text-muted-foreground mt-2",children:'Format: Stadt, Ländercode (z.B. "Zurich, CH", "Berlin, DE", "New York, US")'})]}),e.jsxs("div",{className:"flex gap-3",children:[e.jsx("button",{onClick:k,disabled:y||d||!c.trim(),className:"flex-1 py-3 rounded-lg bg-primary text-primary-foreground font-medium active:opacity-80 transition-opacity disabled:opacity-50 disabled:cursor-not-allowed min-h-[44px]",children:y?"Speichere...":"Speichern"}),e.jsx("button",{onClick:()=>r(!1),className:"px-6 py-3 rounded-lg bg-muted text-foreground font-medium active:opacity-80 transition-opacity min-h-[44px]",children:"Abbrechen"})]})]})]})})]})}function Bn(){const{t,i18n:n}=De(),[,d]=ot(),{user:i,logout:r}=lt(),{theme:c,toggleTheme:v}=hn(),{isEnabled:y,toggle:f}=_t(),[k,x]=j(!1),[w,A]=j(!1),{settings:S,updateSettings:z}=qe(),o=async L=>{n.changeLanguage(L),await z({language:L}),x(!1),p.success(L==="de"?"Sprache geändert":"Language changed")};me(()=>{if(S?.language)n.changeLanguage(S.language);else{const L=localStorage.getItem("language");L&&(z({language:L}).then(()=>{localStorage.removeItem("language")}).catch(console.error),n.changeLanguage(L))}},[S?.language,z,n]);const h=()=>{v&&(v(),p.success(c==="dark"?"Helles Design aktiviert":"Dunkles Design aktiviert")),A(!1)},I=async()=>{try{r&&await r(),p.success("Abgemeldet"),d("/login")}catch{p.error("Fehler beim Abmelden")}},K=()=>{d("/login")},D=async()=>{await z({preferDesktop:!0}),window.location.href="https://nexo-jtsky100.web.app"};return e.jsxs(we,{title:t("nav.settings","Einstellungen"),showSidebar:!0,children:[e.jsxs("div",{className:"mobile-card mb-4 flex items-center gap-4",children:[e.jsx("div",{className:"w-14 h-14 rounded-lg bg-muted flex items-center justify-center overflow-hidden",children:i?.photoURL?e.jsx("img",{src:i.photoURL,alt:"",className:"w-14 h-14 object-cover"}):e.jsx(zt,{className:"w-7 h-7 text-muted-foreground"})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("p",{className:"font-semibold truncate",children:i?.displayName||"Benutzer"}),e.jsx("p",{className:"text-sm text-muted-foreground truncate",children:i?.email||"Nicht angemeldet"})]})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("button",{onClick:()=>x(!0),className:"mobile-card w-full flex items-center justify-between active:opacity-80 transition-opacity py-4",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:"w-10 h-10 rounded-lg bg-muted flex items-center justify-center",children:e.jsx(js,{className:"w-5 h-5 text-foreground"})}),e.jsxs("div",{className:"text-left",children:[e.jsx("p",{className:"font-medium",children:t("settings.language","Sprache")}),e.jsx("p",{className:"text-xs text-muted-foreground",children:n.language==="de"?"Deutsch":"English"})]})]}),e.jsx(xe,{className:"w-5 h-5 text-muted-foreground"})]}),e.jsxs("button",{onClick:()=>A(!0),className:"mobile-card w-full flex items-center justify-between active:opacity-80 transition-opacity py-4",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:"w-10 h-10 rounded-lg bg-muted flex items-center justify-center",children:c==="dark"?e.jsx(pt,{className:"w-5 h-5 text-foreground"}):e.jsx(ft,{className:"w-5 h-5 text-foreground"})}),e.jsxs("div",{className:"text-left",children:[e.jsx("p",{className:"font-medium",children:t("settings.theme","Design")}),e.jsx("p",{className:"text-xs text-muted-foreground",children:c==="dark"?t("settings.dark","Dunkel"):t("settings.light","Hell")})]})]}),e.jsx(xe,{className:"w-5 h-5 text-muted-foreground"})]}),e.jsxs("button",{onClick:D,className:"mobile-card w-full flex items-center justify-between active:opacity-80 transition-opacity py-4",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:"w-10 h-10 rounded-lg bg-muted flex items-center justify-center",children:e.jsx(bs,{className:"w-5 h-5 text-foreground"})}),e.jsxs("div",{className:"text-left",children:[e.jsx("p",{className:"font-medium",children:"Desktop Version"}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Zur vollständigen Ansicht"})]})]}),e.jsx(xe,{className:"w-5 h-5 text-muted-foreground"})]}),e.jsx(Rn,{}),e.jsx(Pn,{}),e.jsx(Fn,{}),e.jsxs("div",{className:"mobile-card w-full py-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:"w-10 h-10 rounded-lg bg-muted flex items-center justify-center",children:e.jsx(vs,{className:"w-5 h-5 text-foreground"})}),e.jsxs("div",{className:"text-left",children:[e.jsx("p",{className:"font-medium",children:"Glass-Effekt"}),e.jsx("p",{className:"text-xs text-muted-foreground",children:y?"Aktiviert":"Deaktiviert"})]})]}),y?e.jsx("div",{className:"w-6 h-6 rounded-full bg-green-500 flex items-center justify-center",children:e.jsx(ge,{className:"w-4 h-4 text-white"})}):e.jsx("div",{className:"w-6 h-6 rounded-full bg-gray-400 flex items-center justify-center",children:e.jsx(Ee,{className:"w-4 h-4 text-white"})})]}),e.jsx("button",{onClick:()=>{f(),W(),p.success(y?"Glass-Effekt deaktiviert":"Glass-Effekt aktiviert")},className:"w-full py-2 px-4 rounded-lg bg-primary text-primary-foreground font-medium active:opacity-80 transition-opacity min-h-[44px]",children:y?"Glass-Effekt deaktivieren":"Glass-Effekt aktivieren"})]}),e.jsxs("button",{onClick:()=>p.info("Kommt in einer zukünftigen Version"),className:"mobile-card w-full flex items-center justify-between active:opacity-80 transition-opacity py-4",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:"w-10 h-10 rounded-lg bg-muted flex items-center justify-center",children:e.jsx(ys,{className:"w-5 h-5 text-foreground"})}),e.jsx("div",{className:"text-left",children:e.jsx("p",{className:"font-medium",children:t("settings.privacy","Datenschutz")})})]}),e.jsx(xe,{className:"w-5 h-5 text-muted-foreground"})]}),e.jsxs("button",{onClick:()=>p.info("Kommt in einer zukünftigen Version"),className:"mobile-card w-full flex items-center justify-between active:opacity-80 transition-opacity py-4",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:"w-10 h-10 rounded-lg bg-muted flex items-center justify-center",children:e.jsx(Ns,{className:"w-5 h-5 text-foreground"})}),e.jsx("div",{className:"text-left",children:e.jsx("p",{className:"font-medium",children:t("settings.help","Hilfe")})})]}),e.jsx(xe,{className:"w-5 h-5 text-muted-foreground"})]})]}),e.jsxs("button",{onClick:i?I:K,className:"mobile-card w-full flex items-center gap-3 mt-6 active:opacity-80 transition-opacity",children:[e.jsx("div",{className:`w-10 h-10 rounded-lg flex items-center justify-center ${i?"bg-status-error":"bg-primary"}`,children:i?e.jsx(ws,{className:"w-5 h-5 status-error"}):e.jsx(Ds,{className:"w-5 h-5 text-primary-foreground"})}),e.jsx("p",{className:`font-medium ${i?"status-error":"text-primary"}`,children:i?t("auth.logout","Abmelden"):t("auth.login","Anmelden")})]}),e.jsx("p",{className:"text-center text-xs text-muted-foreground mt-6",children:"Nexo Mobile v1.0.0"}),k&&e.jsx("div",{className:"fixed inset-0 z-50 bg-black/50 flex items-end",onClick:()=>x(!1),children:e.jsxs("div",{className:"bg-background w-full rounded-t-2xl p-6 safe-bottom animate-in slide-in-from-bottom",onClick:L=>L.stopPropagation(),children:[e.jsx("h2",{className:"text-lg font-semibold mb-4",children:t("settings.language","Sprache")}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("button",{onClick:()=>o("de"),className:`w-full mobile-card flex items-center justify-between ${n.language==="de"?"border-primary":""}`,children:[e.jsx("span",{className:"font-medium",children:"Deutsch"}),n.language==="de"&&e.jsx(ge,{className:"w-5 h-5"})]}),e.jsxs("button",{onClick:()=>o("en"),className:`w-full mobile-card flex items-center justify-between ${n.language==="en"?"border-primary":""}`,children:[e.jsx("span",{className:"font-medium",children:"English"}),n.language==="en"&&e.jsx(ge,{className:"w-5 h-5"})]})]}),e.jsx("button",{onClick:()=>x(!1),className:"w-full mt-4 py-3 text-muted-foreground font-medium",children:t("common.cancel","Abbrechen")})]})}),w&&e.jsx("div",{className:"fixed inset-0 z-50 bg-black/50 flex items-end",onClick:()=>A(!1),children:e.jsxs("div",{className:"bg-background w-full rounded-t-2xl p-6 safe-bottom animate-in slide-in-from-bottom",onClick:L=>L.stopPropagation(),children:[e.jsx("h2",{className:"text-lg font-semibold mb-4",children:t("settings.theme","Design")}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("button",{onClick:()=>{c==="dark"?h():A(!1)},className:`w-full mobile-card flex items-center justify-between ${c==="light"?"border-primary":""}`,children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(ft,{className:"w-5 h-5"}),e.jsx("span",{className:"font-medium",children:t("settings.light","Hell")})]}),c==="light"&&e.jsx(ge,{className:"w-5 h-5"})]}),e.jsxs("button",{onClick:()=>{c==="light"?h():A(!1)},className:`w-full mobile-card flex items-center justify-between ${c==="dark"?"border-primary":""}`,children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(pt,{className:"w-5 h-5"}),e.jsx("span",{className:"font-medium",children:t("settings.dark","Dunkel")})]}),c==="dark"&&e.jsx(ge,{className:"w-5 h-5"})]})]}),e.jsx("button",{onClick:()=>A(!1),className:"w-full mt-4 py-3 text-muted-foreground font-medium",children:t("common.cancel","Abbrechen")})]})})]})}function In(t){return!t||t.trim()===""?{valid:!1,error:"E-Mail-Adresse ist erforderlich"}:/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(t)?{valid:!0}:{valid:!1,error:"Ungültige E-Mail-Adresse"}}function Tn(t,n=6){return!t||t.length===0?{valid:!1,error:"Passwort ist erforderlich"}:t.length<n?{valid:!1,error:`Passwort muss mindestens ${n} Zeichen lang sein`}:{valid:!0}}function zn(){const[,t]=ot(),{loginWithGoogle:n,loginWithEmail:d}=lt(),[i,r]=j(""),[c,v]=j(""),[y,f]=j(!1),k=async()=>{if(!y){f(!0);try{await n(),t("/")}catch(w){p.error(w.message||"Login fehlgeschlagen")}finally{f(!1)}}},x=async w=>{w.preventDefault();const A=In(i);if(!A.valid){p.error(A.error||"Ungültige E-Mail-Adresse");return}const S=Tn(c);if(!S.valid){p.error(S.error||"Ungültiges Passwort");return}if(!y){f(!0);try{await d(i,c),t("/")}catch(z){p.error(z.message||"Login fehlgeschlagen")}finally{f(!1)}}};return e.jsxs("div",{className:"min-h-screen bg-background flex flex-col items-center justify-center p-6",children:[e.jsx("div",{className:"w-20 h-20 rounded-2xl bg-primary flex items-center justify-center mb-6",children:e.jsx("span",{className:"text-3xl font-bold text-primary-foreground",children:"N"})}),e.jsx("h1",{className:"text-2xl font-bold mb-2",children:"Nexo"}),e.jsx("p",{className:"text-muted-foreground mb-8 text-center",children:"Melden Sie sich an, um fortzufahren"}),e.jsxs("button",{type:"button",onClick:k,disabled:y,className:"w-full h-12 px-6 rounded-lg font-medium text-base border border-border bg-background flex items-center justify-center gap-3 active:bg-muted disabled:opacity-50 mb-4",children:[e.jsxs("svg",{className:"w-5 h-5",viewBox:"0 0 24 24",children:[e.jsx("path",{fill:"#4285F4",d:"M22.56 12.25c0-.78-.07-1.53-.2-2.25H12v4.26h5.92c-.26 1.37-1.04 2.53-2.21 3.31v2.77h3.57c2.08-1.92 3.28-4.74 3.28-8.09z"}),e.jsx("path",{fill:"#34A853",d:"M12 23c2.97 0 5.46-.98 7.28-2.66l-3.57-2.77c-.98.66-2.23 1.06-3.71 1.06-2.86 0-5.29-1.93-6.16-4.53H2.18v2.84C3.99 20.53 7.7 23 12 23z"}),e.jsx("path",{fill:"#FBBC05",d:"M5.84 14.09c-.22-.66-.35-1.36-.35-2.09s.13-1.43.35-2.09V7.07H2.18C1.43 8.55 1 10.22 1 12s.43 3.45 1.18 4.93l2.85-2.22.81-.62z"}),e.jsx("path",{fill:"#EA4335",d:"M12 5.38c1.62 0 3.06.56 4.21 1.64l3.15-3.15C17.45 2.09 14.97 1 12 1 7.7 1 3.99 3.47 2.18 7.07l3.66 2.84c.87-2.6 3.3-4.53 6.16-4.53z"})]}),y?"Laden...":"Mit Google anmelden"]}),e.jsxs("div",{className:"flex items-center gap-4 w-full mb-4",children:[e.jsx("div",{className:"flex-1 h-px bg-border"}),e.jsx("span",{className:"text-xs text-muted-foreground",children:"oder"}),e.jsx("div",{className:"flex-1 h-px bg-border"})]}),e.jsxs("form",{onSubmit:x,className:"w-full space-y-3",children:[e.jsx("input",{type:"email",placeholder:"E-Mail",value:i,onChange:w=>r(w.target.value),className:"w-full h-12 px-4 rounded-lg text-base bg-background border border-border outline-none focus:border-primary"}),e.jsx("input",{type:"password",placeholder:"Passwort",value:c,onChange:w=>v(w.target.value),className:"w-full h-12 px-4 rounded-lg text-base bg-background border border-border outline-none focus:border-primary"}),e.jsx("button",{type:"submit",disabled:y,className:"w-full h-12 px-6 rounded-lg font-medium text-base bg-primary text-primary-foreground active:opacity-80 disabled:opacity-50",children:y?"Laden...":"Anmelden"})]}),e.jsx("p",{className:"text-xs text-muted-foreground mt-8 text-center",children:e.jsx("a",{href:"https://nexo-jtsky100.web.app",className:"text-primary underline",children:"Desktop-Version öffnen"})})]})}function Ln(){const{t}=De(),[n,d]=j(!1),[i,r]=j(null),[c,v]=j(""),[y,f]=j("all"),[k,x]=j("all"),[w,A]=j(null),{data:S=[],isLoading:z,refetch:o}=it(),[h,I]=j({title:"",type:"termin",dueDate:_e(new Date),isAllDay:!1,amount:"",currency:"CHF",notes:"",recurrenceRule:""}),[K,D]=j(Me(new Date)),[L,re]=j(!1),P=l=>Xt(l),O=l=>{switch(l){case"termin":return e.jsx(As,{className:"w-4 h-4"});case"zahlung":return e.jsx(Es,{className:"w-4 h-4"});case"aufgabe":return e.jsx(Cs,{className:"w-4 h-4"});default:return e.jsx(Ke,{className:"w-4 h-4"})}},ne=l=>{switch(l){case"termin":return"Termin";case"zahlung":return"Zahlung";case"aufgabe":return"Aufgabe";default:return l}},Y=(l,s)=>{const N=new Date,U=s instanceof Date?s:new Date(s);return l==="erledigt"?e.jsx(ke,{className:"bg-green-500 text-white",children:"Erledigt"}):U<N?e.jsx(ke,{className:"bg-red-500 text-white",children:"Überfällig"}):e.jsx(ke,{className:"bg-blue-500 text-white",children:"Offen"})},_=se(()=>{let l=[...S];if(y!=="all"&&(l=l.filter(s=>s.type===y)),k!=="all"&&(l=l.filter(s=>s.status===k)),c.trim()){const s=c.toLowerCase();l=l.filter(N=>N.title.toLowerCase().includes(s)||N.notes&&N.notes.toLowerCase().includes(s)||N.amount&&(N.amount/100).toString().includes(s))}return l.sort((s,N)=>{const U=s.dueDate instanceof Date?s.dueDate:new Date(s.dueDate),$=N.dueDate instanceof Date?N.dueDate:new Date(N.dueDate),oe=new Date;if(s.status==="erledigt"&&N.status!=="erledigt")return 1;if(N.status==="erledigt"&&s.status!=="erledigt")return-1;const a=s.status!=="erledigt"&&U<oe,b=N.status!=="erledigt"&&$<oe;return a&&!b?-1:b&&!a?1:U.getTime()-$.getTime()})},[S,y,k,c]),G=l=>{if(l){r(l);const s=l.dueDate instanceof Date?l.dueDate:new Date(l.dueDate);I({title:l.title,type:l.type,dueDate:_e(s),isAllDay:l.isAllDay,amount:l.amount?(l.amount/100).toString():"",currency:l.currency||"CHF",notes:l.notes||"",recurrenceRule:l.recurrenceRule||""})}else r(null),I({title:"",type:"termin",dueDate:new Date().toISOString().slice(0,16),isAllDay:!1,amount:"",currency:"CHF",notes:"",recurrenceRule:""});d(!0)},C=()=>{d(!1),r(null);const l=_e(new Date);I({title:"",type:"termin",dueDate:l,isAllDay:!1,amount:"",currency:"CHF",notes:"",recurrenceRule:""}),D(Me(l))},B=async()=>{if(!h.title||!h.dueDate){p.error("Bitte füllen Sie alle Pflichtfelder aus.");return}try{re(!0);const l=Jt(h.dueDate),s={title:h.title,type:h.type,dueDate:l.toISOString(),isAllDay:h.isAllDay,amount:h.amount?Math.round(parseFloat(h.amount)*100):null,currency:h.currency,notes:h.notes||null,recurrenceRule:h.recurrenceRule||null};i?(await Je(i.id,s),p.success("Erinnerung aktualisiert")):(await Et(s),p.success("Erinnerung erstellt")),await o(),C(),ie()}catch(l){p.error(Se(l)),ae()}finally{re(!1)}},le=async l=>{try{await es(l),p.success("Erinnerung gelöscht"),ie(),await o(),A(null)}catch(s){p.error(Se(s)),ae()}},m=async l=>{try{const s=l.status==="erledigt"?"offen":"erledigt";await Je(l.id,{status:s}),p.success(s==="erledigt"?"Als erledigt markiert":"Wieder geöffnet"),ie(),await o()}catch(s){p.error(Se(s)),ae()}},R=se(()=>{const l=S.length,s=S.filter($=>$.status==="offen").length,N=S.filter($=>$.status==="erledigt").length,U=S.filter($=>{const oe=$.dueDate instanceof Date?$.dueDate:new Date($.dueDate);return $.status==="offen"&&oe<new Date}).length;return{total:l,open:s,done:N,overdue:U}},[S]);return e.jsxs(we,{title:"Erinnerungen",showSidebar:!0,children:[e.jsxs("div",{className:"grid grid-cols-2 gap-3 mb-4",children:[e.jsxs("div",{className:"mobile-card",children:[e.jsx("p",{className:"text-xs text-muted-foreground mb-1",children:"Gesamt"}),e.jsx("p",{className:"text-xl font-semibold",children:R.total})]}),e.jsxs("div",{className:"mobile-card",children:[e.jsx("p",{className:"text-xs text-muted-foreground mb-1",children:"Offen"}),e.jsx("p",{className:"text-xl font-semibold",children:R.open})]}),e.jsxs("div",{className:"mobile-card",children:[e.jsx("p",{className:"text-xs text-muted-foreground mb-1",children:"Erledigt"}),e.jsx("p",{className:"text-xl font-semibold",children:R.done})]}),e.jsxs("div",{className:"mobile-card",children:[e.jsx("p",{className:"text-xs text-muted-foreground mb-1",children:"Überfällig"}),e.jsx("p",{className:"text-xl font-semibold text-red-500",children:R.overdue})]})]}),e.jsx("div",{className:"mobile-card mb-4",children:e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{children:[e.jsx(F,{className:"text-xs text-muted-foreground mb-2 block",children:"Suche"}),e.jsxs("div",{className:"relative",children:[e.jsx(Ge,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-4 h-4 text-muted-foreground"}),e.jsx(Z,{placeholder:"Suchen...",value:c,onChange:l=>v(l.target.value),className:"pl-10 h-10 min-h-[44px]"})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[e.jsxs("div",{children:[e.jsx(F,{className:"text-xs text-muted-foreground mb-2 block",children:"Typ"}),e.jsxs(X,{value:y,onValueChange:f,children:[e.jsx(J,{className:"h-10 min-h-[44px]",children:e.jsx(ee,{})}),e.jsxs(te,{children:[e.jsx(E,{value:"all",children:"Alle"}),e.jsx(E,{value:"termin",children:"Termine"}),e.jsx(E,{value:"zahlung",children:"Zahlungen"}),e.jsx(E,{value:"aufgabe",children:"Aufgaben"})]})]})]}),e.jsxs("div",{children:[e.jsx(F,{className:"text-xs text-muted-foreground mb-2 block",children:"Status"}),e.jsxs(X,{value:k,onValueChange:x,children:[e.jsx(J,{className:"h-10 min-h-[44px]",children:e.jsx(ee,{})}),e.jsxs(te,{children:[e.jsx(E,{value:"all",children:"Alle"}),e.jsx(E,{value:"offen",children:"Offen"}),e.jsx(E,{value:"erledigt",children:"Erledigt"})]})]})]})]})]})}),e.jsxs("div",{className:"flex gap-3 mb-4",children:[e.jsxs(T,{onClick:()=>{W(),G()},className:"flex-1 h-12 min-h-[44px]",children:[e.jsx(Fe,{className:"w-5 h-5 mr-2"}),"Erinnerung hinzufügen"]}),_.length>0&&e.jsx("button",{onClick:()=>{W(),Nn(_),ie()},className:"px-4 rounded-lg bg-muted hover:bg-muted/80 transition-colors flex items-center justify-center min-h-[48px]","aria-label":"Als CSV exportieren",children:e.jsx(rt,{className:"w-5 h-5"})})]}),z?e.jsx("div",{className:"space-y-3",children:[1,2,3].map(l=>e.jsx("div",{className:"mobile-card p-4",children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx(Q,{className:"w-4 h-4 rounded mt-1"}),e.jsxs("div",{className:"flex-1 space-y-2",children:[e.jsx(Q,{className:"h-4 w-3/4"}),e.jsx(Q,{className:"h-3 w-1/2"}),e.jsx(Q,{className:"h-3 w-2/3"}),e.jsxs("div",{className:"flex gap-2 mt-3",children:[e.jsx(Q,{className:"h-8 flex-1"}),e.jsx(Q,{className:"h-8 w-8"}),e.jsx(Q,{className:"h-8 w-8"})]})]})]})},l))}):_.length===0?e.jsx("div",{className:"mobile-card text-center py-8",children:e.jsx("p",{className:"text-muted-foreground",children:"Keine Erinnerungen gefunden"})}):e.jsx("div",{className:"space-y-3",children:_.map(l=>{const s=l.dueDate instanceof Date?l.dueDate:new Date(l.dueDate);return e.jsx(Re,{className:"mobile-card",children:e.jsx(Pe,{className:"p-4",children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("div",{className:"mt-1",children:O(l.type)}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-start justify-between gap-2 mb-2",children:[e.jsx("h3",{className:"font-semibold text-sm flex-1",children:l.title}),Y(l.status,s)]}),e.jsxs("div",{className:"space-y-1 text-xs text-muted-foreground",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Ke,{className:"w-3 h-3"}),e.jsx("span",{children:P(s)}),!l.isAllDay&&l.dueDate&&e.jsx("span",{children:new Date(l.dueDate).toLocaleTimeString("de-CH",{hour:"2-digit",minute:"2-digit"})})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{children:ne(l.type)}),l.amount&&e.jsxs("span",{children:["• CHF ",(l.amount/100).toFixed(2)]})]}),l.notes&&e.jsx("p",{className:"line-clamp-2",children:l.notes})]}),e.jsxs("div",{className:"flex items-center gap-2 mt-3",children:[e.jsx(T,{variant:"outline",size:"sm",onClick:()=>{W(),m(l)},className:"h-8 min-h-[44px] flex-1",children:l.status==="erledigt"?e.jsxs(e.Fragment,{children:[e.jsx(jt,{className:"w-4 h-4 mr-1"}),"Wieder öffnen"]}):e.jsxs(e.Fragment,{children:[e.jsx(jt,{className:"w-4 h-4 mr-1"}),"Als erledigt markieren"]})}),e.jsx(T,{variant:"outline",size:"sm",onClick:()=>{W(),G(l)},className:"h-8 min-h-[44px]",children:e.jsx(Lt,{className:"w-4 h-4"})}),e.jsx(T,{variant:"outline",size:"sm",onClick:()=>{W(),A(l.id)},className:"h-8 min-h-[44px] text-red-500",children:e.jsx(Ze,{className:"w-4 h-4"})})]})]})]})})},l.id)})}),e.jsx(pe,{open:n,onOpenChange:d,children:e.jsxs(fe,{className:"!fixed !top-[50%] !left-[50%] !right-auto !bottom-auto !translate-x-[-50%] !translate-y-[-50%] !w-[85vw] !max-w-sm !max-h-fit !rounded-3xl !m-0 !overflow-visible !shadow-2xl",children:[e.jsxs(je,{className:"px-5 pt-5 pb-3",children:[e.jsx(be,{className:"text-lg font-semibold",children:i?"Erinnerung bearbeiten":"Erinnerung hinzufügen"}),e.jsx(ye,{className:"sr-only",children:i?"Bearbeiten Sie die Details der Erinnerung":"Erstellen Sie eine neue Erinnerung mit Titel, Typ, Datum und optionalen Notizen"})]}),e.jsxs("div",{className:"space-y-3 px-5 pb-2",children:[e.jsxs("div",{children:[e.jsx(F,{children:"Titel *"}),e.jsx(Z,{value:h.title,onChange:l=>I({...h,title:l.target.value}),placeholder:"Titel",className:"h-10 min-h-[44px] mt-1"})]}),e.jsxs("div",{children:[e.jsx(F,{children:"Typ *"}),e.jsxs(X,{value:h.type,onValueChange:l=>I({...h,type:l}),children:[e.jsx(J,{className:"h-10 min-h-[44px] mt-1",children:e.jsx(ee,{})}),e.jsxs(te,{children:[e.jsx(E,{value:"termin",children:"Termin"}),e.jsx(E,{value:"zahlung",children:"Zahlung"}),e.jsx(E,{value:"aufgabe",children:"Aufgabe"})]})]})]}),e.jsxs("div",{children:[e.jsx(F,{children:"Datum & Uhrzeit *"}),e.jsx(Z,{type:"text",placeholder:"DD.MM.YYYY HH:mm",value:K,onChange:l=>{const s=l.target.value;D(s);const N=ut(s);N&&I({...h,dueDate:N})},onBlur:l=>{const s=ut(l.target.value);s?(I({...h,dueDate:s}),D(Me(s))):l.target.value&&D(Me(h.dueDate))},className:"h-10 min-h-[44px] mt-1"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Ct,{checked:h.isAllDay,onCheckedChange:l=>I({...h,isAllDay:l})}),e.jsx(F,{children:"Ganztägig"})]}),h.type==="zahlung"&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{children:[e.jsx(F,{children:"Betrag"}),e.jsx(Z,{type:"number",step:"0.01",value:h.amount,onChange:l=>I({...h,amount:l.target.value}),placeholder:"0.00",className:"h-10 min-h-[44px] mt-1"})]}),e.jsxs("div",{children:[e.jsx(F,{children:"Währung"}),e.jsxs(X,{value:h.currency,onValueChange:l=>I({...h,currency:l}),children:[e.jsx(J,{className:"h-10 min-h-[44px] mt-1",children:e.jsx(ee,{})}),e.jsxs(te,{children:[e.jsx(E,{value:"CHF",children:"CHF"}),e.jsx(E,{value:"EUR",children:"EUR"}),e.jsx(E,{value:"USD",children:"USD"})]})]})]})]}),e.jsxs("div",{children:[e.jsx(F,{children:"Notizen"}),e.jsx(et,{value:h.notes,onChange:l=>I({...h,notes:l.target.value}),placeholder:"Notizen...",className:"mt-1 min-h-[100px]"})]})]}),e.jsxs(ve,{className:"px-5 pb-3 pt-2 gap-2.5",children:[e.jsx(T,{variant:"outline",onClick:C,className:"h-11 min-h-[44px] flex-1 rounded-xl text-sm font-medium",children:"Abbrechen"}),e.jsx(T,{onClick:B,disabled:L,className:"h-11 min-h-[44px] flex-1 rounded-xl text-sm font-medium",children:L?"Speichert...":i?"Aktualisieren":"Erstellen"})]})]})}),w&&e.jsx(pe,{open:!!w,onOpenChange:()=>A(null),children:e.jsxs(fe,{className:`max-w-[320px] w-[90vw] \r
                       !fixed !top-[50%] !left-[50%] !right-auto !bottom-auto !translate-x-[-50%] !translate-y-[-50%]\r
                       rounded-lg\r
                       border\r
                       !h-auto !max-h-[auto]\r
                       flex flex-col\r
                       p-5 gap-4`,showCloseButton:!1,children:[e.jsxs(je,{className:"text-center",children:[e.jsx(be,{className:"text-lg font-semibold",children:"Erinnerung löschen?"}),e.jsx(ye,{className:"sr-only",children:"Bestätigen Sie das Löschen dieser Erinnerung. Diese Aktion kann nicht rückgängig gemacht werden."})]}),e.jsx("p",{className:"text-sm text-muted-foreground text-center leading-relaxed",children:"Möchten Sie diese Erinnerung wirklich löschen? Diese Aktion kann nicht rückgängig gemacht werden."}),e.jsxs(ve,{className:"flex-row gap-3 pt-2",children:[e.jsx(T,{variant:"outline",onClick:()=>A(null),className:"h-10 min-h-[44px] flex-1 text-sm font-medium",children:"Abbrechen"}),e.jsx(T,{variant:"destructive",onClick:()=>le(w),className:"h-10 min-h-[44px] flex-1 text-sm font-medium",children:"Löschen"})]})]})})]})}function Mn({className:t,...n}){return e.jsx(tn,{"data-slot":"tabs",className:Te("flex flex-col gap-2",t),...n})}function On({className:t,...n}){return e.jsx(sn,{"data-slot":"tabs-list",className:Te("bg-muted text-muted-foreground inline-flex h-9 w-fit items-center justify-center rounded-lg p-[3px]",t),...n})}function Dt({className:t,...n}){return e.jsx(nn,{"data-slot":"tabs-trigger",className:Te("data-[state=active]:bg-background dark:data-[state=active]:text-foreground focus-visible:border-ring focus-visible:ring-ring/50 focus-visible:outline-ring dark:data-[state=active]:border-input dark:data-[state=active]:bg-input/30 text-foreground dark:text-muted-foreground inline-flex h-[calc(100%-1px)] flex-1 items-center justify-center gap-1.5 rounded-md border border-transparent px-2 py-1 text-sm font-medium whitespace-nowrap transition-[color,box-shadow] focus-visible:ring-[3px] focus-visible:outline-1 disabled:pointer-events-none disabled:opacity-50 data-[state=active]:shadow-sm [&_svg]:pointer-events-none [&_svg]:shrink-0 [&_svg:not([class*='size-'])]:size-4",t),...n})}function kt({className:t,...n}){return e.jsx(an,{"data-slot":"tabs-content",className:Te("flex-1 outline-none",t),...n})}function Un(){const{t}=De(),[n,d]=j("household"),[i,r]=j(!1),[c,v]=j(!1),[y,f]=j(!1),[k,x]=j(null),[w,A]=j(null),[S,z]=j(""),[o,h]=j({name:"",email:"",phone:"",currency:"CHF",type:"household",relationship:"both",notes:""}),{data:I=[],isLoading:K,refetch:D}=At(),L=se(()=>I.filter(s=>!s.type||s.type==="household"||s.type==="child"),[I]),re=se(()=>I.filter(s=>s.type==="external"),[I]),P=s=>s.map(N=>{const U=N.invoices||[],$=U.filter(g=>(g.direction==="incoming"||!g.direction)&&(g.status==="open"||g.status==="postponed")).reduce((g,H)=>g+(H.amount||0),0),oe=U.filter(g=>(g.direction==="incoming"||!g.direction)&&g.status==="paid").reduce((g,H)=>g+(H.amount||0),0),a=U.filter(g=>g.direction==="outgoing"&&(g.status==="open"||g.status==="postponed")).reduce((g,H)=>g+(H.amount||0),0),b=U.filter(g=>g.direction==="outgoing"&&g.status==="paid").reduce((g,H)=>g+(H.amount||0),0);return{...N,incomingOpen:$,incomingPaid:oe,outgoingOpen:a,outgoingPaid:b,totalOpen:$+a,totalPaid:oe+b,invoiceCount:U.length,hasOpenInvoices:$>0||a>0}}),O=se(()=>P(L),[L]),ne=se(()=>P(re),[re]),Y=s=>s.filter(N=>N.name.toLowerCase().includes(S.toLowerCase())||N.email?.toLowerCase().includes(S.toLowerCase())||N.phone?.toLowerCase().includes(S.toLowerCase())),_=se(()=>Y(O),[O,S]),G=se(()=>Y(ne),[ne,S]),C=async()=>{const s=validateRequired(o.name,"Name");if(!s.valid){p.error(s.error||"Bitte geben Sie einen Namen ein");return}if(o.email&&o.email.trim()!==""){const N=validateEmail(o.email);if(!N.valid){p.error(N.error||"Ungültige E-Mail-Adresse");return}}if(o.phone&&o.phone.trim()!==""){const N=validatePhone(o.phone);if(!N.valid){p.error(N.error||"Ungültige Telefonnummer");return}}try{const N={name:o.name,currency:o.currency,type:o.type,notes:o.notes||null};o.type==="child"?(N.email=null,N.phone=null,N.relationship=null):o.type==="external"?(N.email=o.email||null,N.phone=o.phone||null,N.relationship=o.relationship):(N.email=o.email||null,N.phone=o.phone||null,N.relationship=null),await ts(N),p.success("Person hinzugefügt"),r(!1),h({name:"",email:"",phone:"",currency:"CHF",type:"household",relationship:"both",notes:""}),await D()}catch(N){p.error("Fehler: "+(N.message||"Unbekannter Fehler"))}},B=async()=>{if(!k||!o.name){p.error("Bitte geben Sie einen Namen ein");return}try{const s={name:o.name,currency:o.currency,type:o.type,notes:o.notes||null};o.type==="child"?(s.email=null,s.phone=null,s.relationship=null):o.type==="external"?(s.email=o.email||null,s.phone=o.phone||null,s.relationship=o.relationship):(s.email=o.email||null,s.phone=o.phone||null,s.relationship=null),await ss(k.id,s),p.success("Person aktualisiert"),v(!1),x(null),await D()}catch(s){p.error("Fehler: "+(s.message||"Unbekannter Fehler"))}},le=async()=>{if(w)try{await ns(w),p.success("Person gelöscht"),A(null)}catch(s){p.error("Fehler: "+(s.message||"Unbekannter Fehler"))}},m=s=>{x(s),h({name:s.name||"",email:s.email||"",phone:s.phone||"",currency:s.currency||"CHF",type:s.type||"household",relationship:s.relationship||"both",notes:s.notes||""}),v(!0)},R=s=>`CHF ${(s/100).toFixed(2)}`,l=s=>{const N=s.type==="child";return e.jsx(Re,{className:"mobile-card",children:e.jsx(Pe,{className:"p-4",children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("div",{className:`w-10 h-10 rounded-full flex items-center justify-center flex-shrink-0 ${N?"bg-purple-100 text-purple-600":"bg-primary/10 text-primary"}`,children:N?e.jsx(Rs,{className:"w-5 h-5"}):e.jsx(bt,{className:"w-5 h-5"})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-start justify-between gap-2 mb-2",children:[e.jsx("h3",{className:"font-semibold text-sm",children:s.name}),N&&e.jsx(ke,{variant:"outline",className:"text-xs",children:"Kind"})]}),!N&&e.jsxs("div",{className:"space-y-1 text-xs text-muted-foreground",children:[s.email&&e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(Ps,{className:"w-3 h-3"}),e.jsx("span",{className:"truncate",children:s.email})]}),s.phone&&e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(Fs,{className:"w-3 h-3"}),e.jsx("span",{children:s.phone})]})]}),s.hasOpenInvoices&&e.jsxs("div",{className:"mt-2 space-y-1",children:[s.incomingOpen>0&&e.jsxs("p",{className:"text-xs text-green-600",children:["Forderungen: ",R(s.incomingOpen)]}),s.outgoingOpen>0&&e.jsxs("p",{className:"text-xs text-red-600",children:["Verbindlichkeiten: ",R(s.outgoingOpen)]})]}),s.invoiceCount>0&&e.jsxs("p",{className:"text-xs text-muted-foreground mt-1",children:[s.invoiceCount," Rechnung(en)"]}),e.jsxs("div",{className:"flex items-center gap-2 mt-3",children:[s.invoiceCount>0&&e.jsxs(T,{variant:"outline",size:"sm",onClick:()=>{x(s),f(!0)},className:"h-8 min-h-[44px] flex-1",children:[e.jsx(Mt,{className:"w-4 h-4 mr-1"}),"Rechnungen"]}),e.jsx(T,{variant:"outline",size:"sm",onClick:()=>m(s),className:"h-8 min-h-[44px]",children:e.jsx(Lt,{className:"w-4 h-4"})}),e.jsx(T,{variant:"outline",size:"sm",onClick:()=>A(s.id),className:"h-8 min-h-[44px] text-red-500",children:e.jsx(Ze,{className:"w-4 h-4"})})]})]})]})})},s.id)};return e.jsxs(we,{title:"Personen & Schulden",showSidebar:!0,children:[e.jsx("div",{className:"mobile-card mb-4",children:e.jsxs("div",{className:"relative",children:[e.jsx(Ge,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-4 h-4 text-muted-foreground"}),e.jsx(Z,{placeholder:"Suchen...",value:S,onChange:s=>z(s.target.value),className:"pl-10 h-10 min-h-[44px]"})]})}),e.jsxs(T,{onClick:()=>{h({name:"",email:"",phone:"",currency:"CHF",type:"household",relationship:"both",notes:""}),r(!0)},className:"w-full mb-4 h-12 min-h-[44px]",children:[e.jsx(Fe,{className:"w-5 h-5 mr-2"}),"Person hinzufügen"]}),e.jsxs(Mn,{value:n,onValueChange:s=>d(s),className:"mb-4",children:[e.jsxs(On,{className:"grid w-full grid-cols-2 h-12 min-h-[44px]",children:[e.jsxs(Dt,{value:"household",className:"h-10 min-h-[44px]",children:[e.jsx(Bt,{className:"w-4 h-4 mr-2"}),"Haushalt"]}),e.jsxs(Dt,{value:"external",className:"h-10 min-h-[44px]",children:[e.jsx(bt,{className:"w-4 h-4 mr-2"}),"Externe"]})]}),e.jsx(kt,{value:"household",className:"mt-4",children:K?e.jsx("div",{className:"text-center py-8 text-muted-foreground",children:"Lädt..."}):_.length===0?e.jsx("div",{className:"mobile-card text-center py-8",children:e.jsx("p",{className:"text-muted-foreground",children:"Keine Personen gefunden"})}):e.jsx("div",{className:"space-y-3",children:_.map(l)})}),e.jsx(kt,{value:"external",className:"mt-4",children:K?e.jsx("div",{className:"text-center py-8 text-muted-foreground",children:"Lädt..."}):G.length===0?e.jsx("div",{className:"mobile-card text-center py-8",children:e.jsx("p",{className:"text-muted-foreground",children:"Keine Personen gefunden"})}):e.jsx("div",{className:"space-y-3",children:G.map(l)})})]}),e.jsx(pe,{open:i,onOpenChange:r,children:e.jsxs(fe,{className:"!fixed !top-[50%] !left-[50%] !right-auto !bottom-auto !translate-x-[-50%] !translate-y-[-50%] !w-[85vw] !max-w-sm !max-h-fit !rounded-3xl !m-0 !overflow-visible !shadow-2xl",children:[e.jsxs(je,{className:"px-5 pt-5 pb-3",children:[e.jsx(be,{className:"text-lg font-semibold",children:"Person hinzufügen"}),e.jsx(ye,{className:"sr-only",children:"Erstellen Sie eine neue Person mit Name, E-Mail, Telefonnummer und optionalen Notizen"})]}),e.jsxs("div",{className:"space-y-3 px-5 pb-2",children:[e.jsxs("div",{children:[e.jsx(F,{children:"Name *"}),e.jsx(Z,{value:o.name,onChange:s=>h({...o,name:s.target.value}),placeholder:"Name",className:"h-10 min-h-[44px] mt-1"})]}),e.jsxs("div",{children:[e.jsx(F,{children:"Typ *"}),e.jsxs(X,{value:o.type,onValueChange:s=>h({...o,type:s}),children:[e.jsx(J,{className:"h-10 min-h-[44px] mt-1",children:e.jsx(ee,{})}),e.jsxs(te,{children:[e.jsx(E,{value:"household",children:"Haushalt"}),e.jsx(E,{value:"external",children:"Externe Person"}),e.jsx(E,{value:"child",children:"Kind"})]})]})]}),o.type!=="child"&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{children:[e.jsx(F,{children:"E-Mail"}),e.jsx(Z,{type:"email",value:o.email,onChange:s=>h({...o,email:s.target.value}),placeholder:"email@example.com",className:"h-10 min-h-[44px] mt-1"})]}),e.jsxs("div",{children:[e.jsx(F,{children:"Telefon"}),e.jsx(Z,{type:"tel",value:o.phone,onChange:s=>h({...o,phone:s.target.value}),placeholder:"+41 XX XXX XX XX",className:"h-10 min-h-[44px] mt-1"})]})]}),o.type==="external"&&e.jsxs("div",{children:[e.jsx(F,{children:"Beziehung"}),e.jsxs(X,{value:o.relationship,onValueChange:s=>h({...o,relationship:s}),children:[e.jsx(J,{className:"h-10 min-h-[44px] mt-1",children:e.jsx(ee,{})}),e.jsxs(te,{children:[e.jsx(E,{value:"both",children:"Beides"}),e.jsx(E,{value:"creditor",children:"Gläubiger"}),e.jsx(E,{value:"debtor",children:"Schuldner"})]})]})]}),e.jsxs("div",{children:[e.jsx(F,{children:"Währung"}),e.jsxs(X,{value:o.currency,onValueChange:s=>h({...o,currency:s}),children:[e.jsx(J,{className:"h-10 min-h-[44px] mt-1",children:e.jsx(ee,{})}),e.jsxs(te,{children:[e.jsx(E,{value:"CHF",children:"CHF"}),e.jsx(E,{value:"EUR",children:"EUR"}),e.jsx(E,{value:"USD",children:"USD"})]})]})]}),e.jsxs("div",{children:[e.jsx(F,{children:"Notizen"}),e.jsx(et,{value:o.notes,onChange:s=>h({...o,notes:s.target.value}),placeholder:"Notizen...",className:"mt-1 min-h-[100px]"})]})]}),e.jsxs(ve,{className:"px-5 pb-3 pt-2 gap-2.5",children:[e.jsx(T,{variant:"outline",onClick:()=>r(!1),className:"h-11 min-h-[44px] flex-1 rounded-xl text-sm font-medium",children:"Abbrechen"}),e.jsx(T,{onClick:C,className:"h-10 min-h-[44px]",children:"Hinzufügen"})]})]})}),e.jsx(pe,{open:c,onOpenChange:v,children:e.jsxs(fe,{className:"!fixed !top-[50%] !left-[50%] !right-auto !bottom-auto !translate-x-[-50%] !translate-y-[-50%] !w-[85vw] !max-w-sm !max-h-fit !rounded-3xl !m-0 !overflow-visible !shadow-2xl",children:[e.jsxs(je,{className:"px-5 pt-5 pb-3",children:[e.jsx(be,{className:"text-lg font-semibold",children:"Person bearbeiten"}),e.jsx(ye,{className:"sr-only",children:"Bearbeiten Sie die Informationen der ausgewählten Person"})]}),e.jsxs("div",{className:"space-y-3 px-5 pb-2",children:[e.jsxs("div",{children:[e.jsx(F,{children:"Name *"}),e.jsx(Z,{value:o.name,onChange:s=>h({...o,name:s.target.value}),placeholder:"Name",className:"h-10 min-h-[44px] mt-1"})]}),e.jsxs("div",{children:[e.jsx(F,{children:"Typ *"}),e.jsxs(X,{value:o.type,onValueChange:s=>h({...o,type:s}),children:[e.jsx(J,{className:"h-10 min-h-[44px] mt-1",children:e.jsx(ee,{})}),e.jsxs(te,{children:[e.jsx(E,{value:"household",children:"Haushalt"}),e.jsx(E,{value:"external",children:"Externe Person"}),e.jsx(E,{value:"child",children:"Kind"})]})]})]}),o.type!=="child"&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{children:[e.jsx(F,{children:"E-Mail"}),e.jsx(Z,{type:"email",value:o.email,onChange:s=>h({...o,email:s.target.value}),placeholder:"email@example.com",className:"h-10 min-h-[44px] mt-1"})]}),e.jsxs("div",{children:[e.jsx(F,{children:"Telefon"}),e.jsx(Z,{type:"tel",value:o.phone,onChange:s=>h({...o,phone:s.target.value}),placeholder:"+41 XX XXX XX XX",className:"h-10 min-h-[44px] mt-1"})]})]}),o.type==="external"&&e.jsxs("div",{children:[e.jsx(F,{children:"Beziehung"}),e.jsxs(X,{value:o.relationship,onValueChange:s=>h({...o,relationship:s}),children:[e.jsx(J,{className:"h-10 min-h-[44px] mt-1",children:e.jsx(ee,{})}),e.jsxs(te,{children:[e.jsx(E,{value:"both",children:"Beides"}),e.jsx(E,{value:"creditor",children:"Gläubiger"}),e.jsx(E,{value:"debtor",children:"Schuldner"})]})]})]}),e.jsxs("div",{children:[e.jsx(F,{children:"Währung"}),e.jsxs(X,{value:o.currency,onValueChange:s=>h({...o,currency:s}),children:[e.jsx(J,{className:"h-10 min-h-[44px] mt-1",children:e.jsx(ee,{})}),e.jsxs(te,{children:[e.jsx(E,{value:"CHF",children:"CHF"}),e.jsx(E,{value:"EUR",children:"EUR"}),e.jsx(E,{value:"USD",children:"USD"})]})]})]}),e.jsxs("div",{children:[e.jsx(F,{children:"Notizen"}),e.jsx(et,{value:o.notes,onChange:s=>h({...o,notes:s.target.value}),placeholder:"Notizen...",className:"mt-1 min-h-[100px]"})]})]}),e.jsxs(ve,{className:"px-5 pb-3 pt-2 gap-2.5",children:[e.jsx(T,{variant:"outline",onClick:()=>v(!1),className:"h-11 min-h-[44px] flex-1 rounded-xl text-sm font-medium",children:"Abbrechen"}),e.jsx(T,{onClick:B,className:"h-11 min-h-[44px] flex-1 rounded-xl text-sm font-medium",children:"Aktualisieren"})]})]})}),w&&e.jsx(pe,{open:!!w,onOpenChange:()=>A(null),children:e.jsxs(fe,{className:"max-w-sm",children:[e.jsxs(je,{children:[e.jsx(be,{children:"Person löschen?"}),e.jsx(ye,{className:"sr-only",children:"Bestätigen Sie das Löschen dieser Person. Diese Aktion kann nicht rückgängig gemacht werden."})]}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Möchten Sie diese Person wirklich löschen? Diese Aktion kann nicht rückgängig gemacht werden."}),e.jsxs(ve,{className:"px-5 pb-3 pt-2 gap-2.5",children:[e.jsx(T,{variant:"outline",onClick:()=>A(null),className:"h-11 min-h-[44px] flex-1 rounded-xl text-sm font-medium",children:"Abbrechen"}),e.jsx(T,{variant:"destructive",onClick:le,className:"h-11 min-h-[44px] flex-1 rounded-xl text-sm font-medium",children:"Löschen"})]})]})}),k&&y&&e.jsx(pe,{open:y,onOpenChange:f,children:e.jsxs(fe,{className:"!fixed !top-[50%] !left-[50%] !right-auto !bottom-auto !translate-x-[-50%] !translate-y-[-50%] !w-[85vw] !max-w-sm !max-h-fit !rounded-3xl !m-0 !overflow-visible !shadow-2xl",children:[e.jsxs(je,{className:"px-5 pt-5 pb-3",children:[e.jsxs(be,{className:"text-lg font-semibold",children:["Rechnungen - ",k.name]}),e.jsx(ye,{className:"sr-only",children:"Verwalten Sie Rechnungen für diese Person"})]}),e.jsx("div",{className:"px-5 pb-2",children:e.jsx("p",{className:"text-sm text-muted-foreground",children:"Die Rechnungsverwaltung wird in einer zukünftigen Version verfügbar sein."})}),e.jsx(ve,{className:"px-5 pb-3 pt-2",children:e.jsx(T,{variant:"outline",onClick:()=>f(!1),className:"h-11 min-h-[44px] w-full rounded-xl text-sm font-medium",children:"Schließen"})})]})})]})}function Hn({className:t,value:n,...d}){return e.jsx(rn,{"data-slot":"progress",className:Te("bg-primary/20 relative h-2 w-full overflow-hidden rounded-full",t),...d,children:e.jsx(ln,{"data-slot":"progress-indicator",className:"bg-primary h-full w-full flex-1 transition-all",style:{transform:`translateX(-${100-(n||0)}%)`}})})}function Vn(){const{t}=De(),{data:n=[],isLoading:d,error:i}=At(),r=Ne(null);me(()=>{i&&console.error("[Documents] Error loading people:",i)},[i]);const[c,v]=j([]),[y,f]=j(!0),[k,x]=j("all"),[w,A]=j("all"),[S,z]=j(""),[o,h]=j(!1),[I,K]=j(0),[D,L]=j(null),[re,P]=j(!1),[O,ne]=j(null),[Y,_]=j(null),[G,C]=j(""),[B,le]=j("Sonstiges"),[m,R]=j(!1),[l,s]=j(null),[N,U]=j(!1),$=[{value:"all",label:"Alle Ordner"},{value:"Rechnungen",label:"Rechnungen"},{value:"Termine",label:"Termine"},{value:"Verträge",label:"Verträge"},{value:"Sonstiges",label:"Sonstiges"}],oe=[{value:"Rechnungen",label:"Rechnungen"},{value:"Termine",label:"Termine"},{value:"Verträge",label:"Verträge"},{value:"Sonstiges",label:"Sonstiges"}],a=$s(async()=>{try{f(!0),console.log("[Documents] Starting fetchDocuments, folder:",w);const u=Ue(Oe,"getAllDocuments");console.log("[Documents] Calling getAllDocuments function...");const M=await u({folder:w==="all"?null:w});if(console.log("[Documents] Function call successful, result:",M),!M||!M.data){console.warn("[Documents] No data in result, setting empty array"),v([]);return}const q=M.data;console.log("[Documents] Data received:",{hasDocuments:!!q.documents,count:q.documents?.length||0,total:q.total});const he=Array.isArray(q.documents)?q.documents:[];console.log("[Documents] Processing",he.length,"documents");const ue=he.map((V,ze)=>{try{return!V||typeof V!="object"?(console.warn(`[Documents] Invalid document at index ${ze}:`,V),null):{...V,id:V.id||`doc-${ze}`,personId:V.personId||"",personName:V.personName||"Unbekannt",fileName:V.fileName||"Unbenannt",fileType:V.fileType||"",fileUrl:V.fileUrl||"",folder:V.folder||"Sonstiges",status:V.status||"uploaded",createdAt:V.createdAt?typeof V.createdAt=="string"?V.createdAt:new Date(V.createdAt).toISOString():null,updatedAt:V.updatedAt?typeof V.updatedAt=="string"?V.updatedAt:new Date(V.updatedAt).toISOString():null}}catch(Le){return console.error(`[Documents] Error mapping document at index ${ze}:`,Le,V),null}}).filter(V=>V!==null&&V.id!=="");console.log("[Documents] Successfully mapped",ue.length,"documents"),v(ue)}catch(u){console.error("[Documents] Error in fetchDocuments:",u),console.error("[Documents] Error details:",{message:u?.message,code:u?.code,details:u?.details,stack:u?.stack});const M=u?.message||u?.code||"Unbekannter Fehler";p.error("Fehler beim Laden der Dokumente: "+M),v([])}finally{f(!1)}},[w]);me(()=>{let u=!0;return(async()=>{try{await a()}catch(q){u&&console.error("Failed to load documents:",q)}})(),()=>{u=!1}},[a]);const b=useMemo(()=>{try{if(!Array.isArray(c))return console.warn("[Documents] documents is not an array in filteredDocuments useMemo"),[];let u=c.filter(M=>M&&M.id);if(k!=="all"&&(u=u.filter(M=>M.personId===k)),w!=="all"&&(u=u.filter(M=>M.folder===w)),S.trim()){const M=S.toLowerCase();u=u.filter(q=>{try{return(q.fileName||"").toLowerCase().includes(M)||(q.personName||"").toLowerCase().includes(M)||(q.folder||"").toLowerCase().includes(M)}catch(he){return console.error("[Documents] Error filtering by search query:",he,q),!1}})}return u.sort((M,q)=>{try{const he=M.updatedAt||M.createdAt||"";return(q.updatedAt||q.createdAt||"").localeCompare(he)}catch(he){return console.error("[Documents] Error sorting documents:",he),0}})}catch(u){return console.error("[Documents] Error in filteredDocuments useMemo:",u),[]}},[c,k,w,S]),g=async u=>{if(!u)return;const M=10*1024*1024;if(u.size>M){p.error("Datei ist zu groß. Maximal 10MB erlaubt.");return}try{h(!0),K(0),L(u);const q=new FileReader;q.onload=async()=>{try{const ue=q.result.split(",")[1];_(ue);const Le=(await Ue(Oe,"analyzeDocument")({fileData:ue,fileName:u.name,fileType:u.type})).data;ne(Le),P(!0),K(100)}catch(ue){p.error("Fehler bei der Analyse: "+(ue.message||"Unbekannter Fehler")),h(!1)}},q.onerror=()=>{p.error("Fehler beim Lesen der Datei"),h(!1)},q.readAsDataURL(u);const he=setInterval(()=>{K(ue=>ue>=90?(clearInterval(he),90):ue+10)},200)}catch(q){p.error("Fehler: "+(q.message||"Unbekannter Fehler")),h(!1)}},H=async()=>{if(!Y||!G||!D){p.error("Bitte füllen Sie alle Felder aus");return}try{R(!0),await Ue(Oe,"uploadDocument")({fileData:Y,fileName:D.name,fileType:D.type,personId:G,folder:B}),p.success("Dokument gespeichert"),P(!1),L(null),_(null),ne(null),C(""),le("Sonstiges"),h(!1),K(0),await a()}catch(u){p.error("Fehler beim Speichern: "+(u.message||"Unbekannter Fehler"))}finally{R(!1)}},de=async u=>{try{await Ue(Oe,"deleteDocument")({documentId:u}),p.success("Dokument gelöscht"),await a()}catch(M){p.error("Fehler: "+(M.message||"Unbekannter Fehler"))}},Ae=u=>{s(u.fileUrl),U(!0)},Ye=u=>{if(!u)return"N/A";try{return on(new Date(u),"dd.MM.yyyy",{locale:cn})}catch{return"N/A"}},Kt=u=>u.startsWith("image/")?e.jsx(Ts,{className:"w-5 h-5"}):u.includes("pdf")?e.jsx(We,{className:"w-5 h-5"}):e.jsx(zs,{className:"w-5 h-5"});me(()=>{Array.isArray(c)||(console.error("[Documents] documents is not an array, resetting:",c),v([]))},[c]);const dt=useMemo(()=>{try{return Array.isArray(b)?b.filter(u=>!(!u||!u.id||typeof u.id!="string")):(console.warn("[Documents] filteredDocuments is not an array, returning empty array"),[])}catch(u){return console.error("[Documents] Error in safeFilteredDocuments:",u),[]}},[b]);return e.jsxs(we,{title:"Dokumente",showSidebar:!0,children:[e.jsx("div",{className:"mobile-card mb-4",children:e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{children:[e.jsx(F,{className:"text-xs text-muted-foreground mb-2 block",children:"Suche"}),e.jsxs("div",{className:"relative",children:[e.jsx(Ge,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-4 h-4 text-muted-foreground"}),e.jsx(Z,{placeholder:"Suchen...",value:S,onChange:u=>z(u.target.value),className:"pl-10 h-10 min-h-[44px]"})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[e.jsxs("div",{children:[e.jsx(F,{className:"text-xs text-muted-foreground mb-2 block",children:"Person"}),e.jsxs(X,{value:k,onValueChange:x,children:[e.jsx(J,{className:"h-10 min-h-[44px]",children:e.jsx(ee,{})}),e.jsxs(te,{children:[e.jsx(E,{value:"all",children:"Alle"}),n.map(u=>e.jsx(E,{value:u.id,children:u.name},u.id))]})]})]}),e.jsxs("div",{children:[e.jsx(F,{className:"text-xs text-muted-foreground mb-2 block",children:"Ordner"}),e.jsxs(X,{value:w,onValueChange:A,children:[e.jsx(J,{className:"h-10 min-h-[44px]",children:e.jsx(ee,{})}),e.jsx(te,{children:$.map(u=>e.jsx(E,{value:u.value,children:u.label},u.value))})]})]})]})]})}),e.jsx(T,{onClick:()=>r.current?.click(),className:"w-full mb-4 h-12 min-h-[44px]",disabled:o,children:o?e.jsxs(e.Fragment,{children:[e.jsx(Bs,{className:"w-5 h-5 mr-2 animate-spin"}),"Lädt..."]}):e.jsxs(e.Fragment,{children:[e.jsx(Tt,{className:"w-5 h-5 mr-2"}),"Dokument hochladen"]})}),o&&e.jsx("div",{className:"mobile-card mb-4",children:e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center justify-between text-sm",children:[e.jsx("span",{children:"Upload Fortschritt"}),e.jsxs("span",{children:[I,"%"]})]}),e.jsx(Hn,{value:I})]})}),e.jsx("input",{ref:r,type:"file",className:"hidden",accept:"image/*,.pdf,.doc,.docx",onChange:u=>{const M=u.target.files?.[0];M&&g(M),u.target.value=""}}),y||d?e.jsx("div",{className:"space-y-3",children:Array.from({length:5}).map((u,M)=>e.jsx(Re,{className:"mobile-card",children:e.jsx(Pe,{className:"p-4",children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx(Skeleton,{className:"w-5 h-5 rounded"}),e.jsxs("div",{className:"flex-1 space-y-2",children:[e.jsx(Skeleton,{className:"h-4 w-3/4"}),e.jsx(Skeleton,{className:"h-3 w-1/2"})]})]})})},M))}):dt.length===0?e.jsx("div",{className:"mobile-card text-center py-8",children:e.jsx("p",{className:"text-muted-foreground",children:"Keine Dokumente gefunden"})}):e.jsx("div",{className:"space-y-3",children:dt.map(u=>!u||!u.id?(console.warn("[Documents] Skipping invalid document in render:",u),null):e.jsx(Re,{className:"mobile-card",children:e.jsx(Pe,{className:"p-4",children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("div",{className:"mt-1",children:Kt(u.fileType)}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("h3",{className:"font-semibold text-sm mb-1 truncate",children:u.fileName}),e.jsxs("div",{className:"space-y-1 text-xs text-muted-foreground",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(zt,{className:"w-3 h-3"}),e.jsx("span",{children:u.personName})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Is,{className:"w-3 h-3"}),e.jsx("span",{children:u.folder})]}),u.updatedAt&&e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Ke,{className:"w-3 h-3"}),e.jsx("span",{children:Ye(u.updatedAt)})]})]}),e.jsxs("div",{className:"flex items-center gap-2 mt-3",children:[e.jsxs(T,{variant:"outline",size:"sm",onClick:()=>Ae(u),className:"h-8 min-h-[44px] flex-1","aria-label":`Dokument ${u.fileName} ansehen`,children:[e.jsx(Mt,{className:"w-4 h-4 mr-1","aria-hidden":"true"}),"Ansehen"]}),e.jsx(T,{variant:"outline",size:"sm",onClick:()=>de(u.id),className:"h-8 min-h-[44px] text-red-500","aria-label":`Dokument ${u.fileName} löschen`,children:e.jsx(Ze,{className:"w-4 h-4","aria-hidden":"true"})})]})]})]})})},u.id))}),e.jsx(pe,{open:re,onOpenChange:P,children:e.jsxs(fe,{className:"!fixed !top-[50%] !left-[50%] !right-auto !bottom-auto !translate-x-[-50%] !translate-y-[-50%] !w-[85vw] !max-w-sm !max-h-fit !rounded-3xl !m-0 !overflow-visible !shadow-2xl",children:[e.jsxs(je,{className:"px-5 pt-5 pb-3",children:[e.jsx(be,{className:"text-lg font-semibold",children:"Dokument zuordnen"}),e.jsx(ye,{children:"Wählen Sie eine Person und einen Ordner für dieses Dokument"})]}),e.jsxs("div",{className:"px-5 pb-2",children:[O&&e.jsx("div",{className:"space-y-3 mb-4",children:e.jsxs("div",{className:"p-3 bg-muted rounded-lg",children:[e.jsx("p",{className:"text-xs font-semibold mb-2",children:"Analyse-Ergebnis"}),O.extractedData.amount&&e.jsxs("p",{className:"text-sm",children:["Betrag: CHF ",(O.extractedData.amount/100).toFixed(2)]}),O.extractedData.dueDate&&e.jsxs("p",{className:"text-sm",children:["Fälligkeitsdatum: ",Ye(O.extractedData.dueDate)]}),O.extractedData.description&&e.jsxs("p",{className:"text-sm",children:["Beschreibung: ",O.extractedData.description]})]})}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{children:[e.jsx(F,{children:"Person *"}),e.jsxs(X,{value:G,onValueChange:C,children:[e.jsx(J,{className:"h-10 min-h-[44px] mt-1",children:e.jsx(ee,{placeholder:"Person auswählen"})}),e.jsx(te,{children:n.map(u=>e.jsx(E,{value:u.id,children:u.name},u.id))})]})]}),e.jsxs("div",{children:[e.jsx(F,{children:"Ordner *"}),e.jsxs(X,{value:B,onValueChange:le,children:[e.jsx(J,{className:"h-10 min-h-[44px] mt-1",children:e.jsx(ee,{})}),e.jsx(te,{children:oe.map(u=>e.jsx(E,{value:u.value,children:u.label},u.value))})]})]})]})]}),e.jsxs(ve,{className:"px-5 pb-3 pt-2 gap-2.5",children:[e.jsx(T,{variant:"outline",onClick:()=>{P(!1),h(!1),K(0)},className:"h-10 min-h-[44px]",children:"Abbrechen"}),e.jsx(T,{onClick:H,disabled:m||!G,className:"h-10 min-h-[44px]",children:m?"Speichert...":"Speichern"})]})]})}),e.jsx(pe,{open:N,onOpenChange:U,children:e.jsxs(fe,{className:"!fixed !top-[50%] !left-[50%] !right-auto !bottom-auto !translate-x-[-50%] !translate-y-[-50%] !w-[85vw] !max-w-sm !max-h-fit !rounded-3xl !m-0 !overflow-visible !shadow-2xl",children:[e.jsx(je,{className:"px-5 pt-5 pb-3",children:e.jsx(be,{className:"text-lg font-semibold",children:"Dokument Vorschau"})}),l&&e.jsx("div",{className:"w-full",children:l.includes("image")?e.jsx("img",{src:l,alt:"Preview",className:"w-full h-auto rounded-lg"}):e.jsx("iframe",{src:l,className:"w-full h-[60vh] rounded-lg",title:"Document Preview"})}),e.jsx(ve,{className:"px-5 pb-3 pt-2",children:e.jsx(T,{variant:"outline",onClick:()=>U(!1),className:"h-11 min-h-[44px] w-full rounded-xl text-sm font-medium",children:"Schließen"})})]})})]})}const Kn={ZH:"Zürich",BE:"Bern",LU:"Luzern",UR:"Uri",SZ:"Schwyz",OW:"Obwalden",NW:"Nidwalden",GL:"Glarus",ZG:"Zug",FR:"Freiburg",SO:"Solothurn",BS:"Basel-Stadt",BL:"Basel-Landschaft",SH:"Schaffhausen",AR:"Appenzell Ausserrhoden",AI:"Appenzell Innerrhoden",SG:"St. Gallen",GR:"Graubünden",AG:"Aargau",TG:"Thurgau",TI:"Tessin",VD:"Waadt",VS:"Wallis",NE:"Neuenburg",GE:"Genf",JU:"Jura"};function $n(){const{t}=De(),[n,d]=j(0),{data:i,isLoading:r,error:c}=as(n),[v,y]=j(!1),[f,k]=j(null),[x,w]=j(null),A=D=>{switch(D){case"unvollständig":return e.jsx(ke,{variant:"outline",className:"bg-yellow-50 text-yellow-700 border-yellow-200",children:"Unvollständig"});case"vollständig":return e.jsx(ke,{variant:"outline",className:"bg-blue-50 text-blue-700 border-blue-200",children:"Vollständig"});case"eingereicht":return e.jsx(ke,{variant:"outline",className:"bg-green-50 text-green-700 border-green-200",children:"Eingereicht"});default:return e.jsx(ke,{variant:"outline",children:D})}},S=D=>D==null?"-":new Intl.NumberFormat("de-CH",{style:"currency",currency:"CHF"}).format(D),z=D=>{if(!D)return"-";try{return new Date(D).toLocaleDateString("de-CH",{day:"2-digit",month:"2-digit",year:"numeric"})}catch{return"-"}},o=async()=>{if(x)try{await rs(x),p.success("Steuerprofil gelöscht"),w(null),d(D=>D+1)}catch(D){p.error("Fehler: "+(D.message||"Unbekannter Fehler"))}},h=D=>{k(D),y(!0)},I=()=>{k(null),y(!0)},K=()=>{y(!1),k(null),d(D=>D+1)};return c?e.jsx(we,{title:"Steuern",showSidebar:!0,children:e.jsx("div",{className:"mobile-card text-center py-8",children:e.jsx("p",{className:"text-red-500",children:"Fehler beim Laden der Steuerprofile"})})}):e.jsxs(we,{title:"Steuern",showSidebar:!0,children:[e.jsxs(T,{onClick:I,className:"w-full mb-4 h-12 min-h-[44px]",children:[e.jsx(Fe,{className:"w-5 h-5 mr-2"}),"Steuerprofil hinzufügen"]}),r?e.jsx("div",{className:"text-center py-8 text-muted-foreground",children:"Lädt..."}):!i||i.length===0?e.jsxs("div",{className:"mobile-card text-center py-8",children:[e.jsx("p",{className:"text-muted-foreground",children:"Keine Steuerprofile gefunden"}),e.jsx("p",{className:"text-sm text-muted-foreground mt-2",children:"Erstellen Sie ein neues Steuerprofil, um Ihre Steuern zu verwalten"})]}):e.jsx("div",{className:"space-y-3",children:i.map(D=>e.jsx(Re,{className:"mobile-card",children:e.jsx(Pe,{className:"p-4",children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("div",{className:"w-10 h-10 rounded-full bg-primary/10 text-primary flex items-center justify-center flex-shrink-0",children:e.jsx(We,{className:"w-5 h-5"})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("div",{className:"flex items-start justify-between gap-2 mb-2",children:e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("h3",{className:"font-semibold text-sm truncate",children:[D.year," - ",D.canton?Kn[D.canton]||D.canton:"Schweiz"]}),D.status&&A(D.status)]})}),e.jsxs("div",{className:"space-y-1 text-xs text-muted-foreground",children:[D.taxableIncome!==null&&D.taxableIncome!==void 0&&e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(It,{className:"w-3 h-3"}),e.jsxs("span",{children:["Einkommen: ",S(D.taxableIncome)]})]}),D.taxAmount!==null&&D.taxAmount!==void 0&&e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Ls,{className:"w-3 h-3"}),e.jsxs("span",{children:["Steuerbetrag: ",S(D.taxAmount)]})]}),D.submissionDate&&e.jsx("div",{className:"flex items-center gap-2",children:e.jsxs("span",{children:["Eingereicht: ",z(D.submissionDate)]})})]}),e.jsxs("div",{className:"flex items-center gap-2 mt-3",children:[e.jsxs(T,{variant:"outline",size:"sm",onClick:()=>h(D),className:"h-8 min-h-[44px] flex-1",children:[e.jsx(Ms,{className:"w-4 h-4 mr-1"}),"Bearbeiten"]}),e.jsx(T,{variant:"outline",size:"sm",onClick:()=>w(D.id),className:"h-8 min-h-[44px] text-red-500",children:e.jsx(Ze,{className:"w-4 h-4"})})]})]})]})})},D.id))}),v&&e.jsx(pe,{open:v,onOpenChange:K,children:e.jsxs(fe,{className:"!fixed !top-[50%] !left-[50%] !right-auto !bottom-auto !translate-x-[-50%] !translate-y-[-50%] !w-[85vw] !max-w-sm !max-h-fit !rounded-3xl !m-0 !overflow-visible !shadow-2xl",children:[e.jsxs(je,{className:"px-5 pt-5 pb-3",children:[e.jsx(be,{children:f?"Steuerprofil bearbeiten":"Neues Steuerprofil"}),e.jsx(ye,{className:"sr-only",children:f?"Bearbeiten Sie die Details des Steuerprofils":"Erstellen Sie ein neues Steuerprofil für ein Steuerjahr"})]}),e.jsx("div",{className:"px-5 pb-2",children:e.jsx("p",{className:"text-sm text-muted-foreground",children:"Die Steuerprofil-Verwaltung wird in einer zukünftigen Version verfügbar sein. Bitte verwenden Sie die Web-Version für die Verwaltung von Steuerprofilen."})}),e.jsx(ve,{className:"px-5 pb-3 pt-2",children:e.jsx(T,{variant:"outline",onClick:K,className:"h-11 min-h-[44px] w-full rounded-xl text-sm font-medium",children:"Schließen"})})]})}),x&&e.jsx(pe,{open:!!x,onOpenChange:()=>w(null),children:e.jsxs(fe,{className:"!fixed !top-[50%] !left-[50%] !right-auto !bottom-auto !translate-x-[-50%] !translate-y-[-50%] !w-[85vw] !max-w-sm !max-h-fit !rounded-3xl !m-0 !overflow-visible !shadow-2xl",children:[e.jsxs(je,{className:"px-5 pt-5 pb-3",children:[e.jsx(be,{className:"text-lg font-semibold",children:"Steuerprofil löschen?"}),e.jsx(ye,{className:"sr-only",children:"Bestätigen Sie das Löschen dieses Steuerprofils. Diese Aktion kann nicht rückgängig gemacht werden."})]}),e.jsx("div",{className:"px-5 pb-2",children:e.jsx("p",{className:"text-sm text-muted-foreground",children:"Möchten Sie dieses Steuerprofil wirklich löschen? Diese Aktion kann nicht rückgängig gemacht werden."})}),e.jsxs(ve,{className:"px-5 pb-3 pt-2 gap-2.5",children:[e.jsx(T,{variant:"outline",onClick:()=>w(null),className:"h-11 min-h-[44px] flex-1 rounded-xl text-sm font-medium",children:"Abbrechen"}),e.jsx(T,{variant:"destructive",onClick:o,className:"h-11 min-h-[44px] flex-1 rounded-xl text-sm font-medium",children:"Löschen"})]})]})})]})}function qn(){return e.jsx(gn,{children:e.jsx(mn,{defaultTheme:"light",switchable:!0,children:e.jsxs(is,{children:[e.jsxs(ms,{children:[e.jsx(ce,{path:"/login",component:zn}),e.jsx(ce,{path:"/",component:mt}),e.jsx(ce,{path:"/dashboard",component:fn}),e.jsx(ce,{path:"/calendar",component:qs}),e.jsx(ce,{path:"/reminders",component:Ln}),e.jsx(ce,{path:"/finance",component:wn}),e.jsx(ce,{path:"/people",component:Un}),e.jsx(ce,{path:"/bills",component:Dn}),e.jsx(ce,{path:"/documents",component:Vn}),e.jsx(ce,{path:"/shopping",component:en}),e.jsx(ce,{path:"/taxes",component:$n}),e.jsx(ce,{path:"/settings",component:Bn}),e.jsx(ce,{children:e.jsx(mt,{})})]}),e.jsx(un,{position:"top-center",richColors:!0})]})})})}typeof window<"u"&&setTimeout(async()=>{try{await Xe(()=>import("./eventBus-CWDWdm45.js"),[]),await Xe(()=>import("./backgroundTaskManager-DuxFkiIE.js"),__vite__mapDeps([0,1])),await Xe(()=>import("./workflowOrchestrator-BZtQc-WZ.js"),__vite__mapDeps([2,1,0]))}catch{}},100);"serviceWorker"in navigator&&window.addEventListener("load",()=>{Ht().catch(t=>{console.error("[Main] Service Worker registration failed:",t)})});const Qn="UNAUTHORIZED",Wn=()=>"/login",$e=new Os({defaultOptions:{queries:{retry:(t,n)=>{if(n instanceof Qe){const d=n.data?.httpStatus;if(d>=400&&d<500)return!1}return t<2}}}}),Gn=t=>{if(!(t instanceof Qe)||typeof window>"u"||!(t.message===Qn||t.data?.code==="UNAUTHORIZED"))return;const d=Wn();window.location.href=d};$e.getQueryCache().subscribe(t=>{if(t?.type==="updated"&&t?.query?.state?.error){const n=t.query.state.error;if(n instanceof Qe){const d=n.data?.requestId||n.meta?.requestId||null;console.error("[Query Error]",{message:n.message,code:n.data?.code,requestId:d,path:n.data?.path})}if(t.action?.type==="error"){const d=t.query.queryKey;Array.isArray(d)&&d[0]==="auth"&&d[1]==="me"&&Gn(n)}}});$e.getMutationCache().subscribe(t=>{if(t?.type==="updated"&&t?.mutation?.state?.error){const n=t.mutation.state.error;if(n instanceof Qe){const d=n.data?.requestId||n.meta?.requestId||null;console.error("[Mutation Error]",{message:n.message,code:n.data?.code,requestId:d,path:n.data?.path})}}});const Zn=Rt.createClient({links:[ds({url:"/api/trpc",async fetch(t,n){let d=null;try{const r=ls.currentUser;r&&(d=await r.getIdToken())}catch{}const i=new Headers(n?.headers);d&&i.set("Authorization",`Bearer ${d}`);try{const r=await globalThis.fetch(t,{...n??{},headers:i,credentials:"include"}),c=r.headers.get("x-goog-request-id")||r.headers.get("x-cloud-trace-context")?.split("/")[0]||null;if(c&&!r.ok){const v=typeof t=="string"?t:t instanceof Request?t.url:String(t);console.error("[tRPC] Request failed with Request ID:",{requestId:c,status:r.status,statusText:r.statusText,url:v})}return r}catch(r){const c=typeof t=="string"?t:t instanceof Request?t.url:String(t);throw console.error("[tRPC] Network error:",{error:r instanceof Error?r.message:String(r),url:c}),r}}})]}),Ce=document.getElementById("root");if(!Ce)throw new Error("Root element not found");Ce.innerHTML='<div style="padding: 20px; text-align: center;"><p>Lädt...</p></div>';window.addEventListener("error",t=>{console.error("[Global Error]",t.error),Ce&&!Ce.querySelector("h1")&&(Ce.innerHTML=`
      <div style="padding: 20px; text-align: center; font-family: system-ui;">
        <h1>Fehler beim Laden</h1>
        <p>${t.error?.message||"Unbekannter Fehler"}</p>
        <button onclick="window.location.reload()" style="margin-top: 20px; padding: 10px 20px; background: #3b82f6; color: white; border: none; border-radius: 6px; cursor: pointer;">Seite neu laden</button>
      </div>
    `)});window.addEventListener("unhandledrejection",t=>{console.error("[Unhandled Rejection]",t.reason)});try{cs(Ce).render(e.jsx(Rt.Provider,{client:Zn,queryClient:$e,children:e.jsx(us,{client:$e,children:e.jsx(qn,{})})})),console.log("[Main] App rendered successfully")}catch(t){console.error("[Main] Failed to render app:",t);const n=t instanceof Error?t.message:String(t);Ce.innerHTML=`
    <div style="padding: 20px; text-align: center; font-family: system-ui;">
      <h1>Fehler beim Laden</h1>
      <p>Die Anwendung konnte nicht geladen werden.</p>
      <p style="color: #666; font-size: 14px; margin-top: 10px; font-family: monospace;">${n}</p>
      <button onclick="window.location.reload()" style="margin-top: 20px; padding: 10px 20px; background: #3b82f6; color: white; border: none; border-radius: 6px; cursor: pointer;">Seite neu laden</button>
    </div>
  `}
