import{j as e,C as Ge,u as Me,c as $,P as Ve,f as I,a as Je,b as Ke,d as Xe,e as Ze,g as _e,h as De,i as V,n as J,k as z,l as Ce,B as D,m as Ee,o as ke,D as Q,p as ee,q as te,r as ae,s as xe,t as ne,L as H,v as se,w as Qe,x as et}from"./page-aichat-D9kAxZiV.js";import{useState as N,useRef as Ie,useEffect as W,useMemo as re,useCallback as Se}from"react";import{u as le}from"./vendor-router-D6hxBhhV.js";import{L as tt,h as be,B as ze,g as fe,k as Re,M as Ae,i as at,j as nt,V as st,Y as rt,U as lt,Z as ot,F as it,_ as dt,$ as ct,N as mt,l as ut,a0 as ht,c as xt,X as pe,d as pt,e as gt,G as ge,C as Te,S as ft,b as bt,a as vt,W as yt,f as jt,a1 as Nt,n as wt}from"./vendor-misc-Dgoprpj-.js";import{createPortal as Dt}from"react-dom";import{S as Ct}from"./vendor-ui-lt1so0uj.js";import{k as Et}from"./vendor-firebase-Dpcgiyci.js";import{t as E}from"./vendor-toast-CdQ6zwVl.js";const kt=[{id:"dashboard",label:"Dashboard",path:"/dashboard",icon:tt},{id:"calendar",label:"Kalender",path:"/calendar",icon:be},{id:"reminders",label:"Erinnerungen",path:"/reminders",icon:ze},{id:"finance",label:"Finanzen",path:"/finance",icon:fe},{id:"shopping",label:"Einkaufsliste",path:"/shopping",icon:Re},{id:"chat",label:"Assistent",path:"/aichat",icon:Ae},{id:"bills",label:"Rechnungen",path:"/bills",icon:at},{id:"documents",label:"Dokumente",path:"/documents",icon:nt}];function St({currentPath:a,customActions:k}){const[h,S]=le(),[x,y]=N(!1),R=k||kt,w=a||h;return e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"fixed top-14 left-0 right-0 z-30 px-4 py-3 flex flex-row gap-3 justify-center safe-top overflow-x-auto scrollbar-hide",style:{paddingTop:"max(0.75rem, env(safe-area-inset-top))"},children:[e.jsx("button",{onClick:()=>y(!0),className:"w-12 h-12 flex-shrink-0 rounded-full bg-background hover:bg-muted border border-border transition-colors flex items-center justify-center active:scale-95 shadow-sm","aria-label":"Menü öffnen","aria-expanded":x,"aria-controls":"sidebar-menu",title:"Menü öffnen",children:e.jsx(st,{className:"w-5 h-5 text-foreground"})}),R.map(d=>{const T=d.icon,m=w===d.path;return e.jsx("button",{onClick:()=>{S(d.path)},className:`w-12 h-12 flex-shrink-0 rounded-full border transition-colors flex items-center justify-center active:scale-95 shadow-sm ${m?"bg-primary text-primary-foreground border-primary":"bg-background hover:bg-muted border-border"}`,"aria-label":d.label,title:d.label,children:e.jsx(T,{className:"w-5 h-5"})},d.id)})]}),e.jsx(Ge,{open:x,onClose:()=>y(!1)})]})}function Tt(){const{t:a}=Me(),[k,h]=le(),[S,x]=N(!1),[y,R]=N({x:0,y:0}),[w,d]=N(""),T=Ie(null);W(()=>{const p=C=>{const v=C.target;if(v.tagName==="BUTTON"||v.tagName==="INPUT"||v.tagName==="TEXTAREA"||v.tagName==="SELECT"||v.closest("button")||v.closest("input")||v.closest("textarea")||v.closest("select")||v.closest("[data-radix-context-menu-trigger]")||v.closest("[data-radix-context-menu-content]")||v.closest('[role="menu"]')||v.closest("[data-global-context-menu]"))return;C.preventDefault(),C.stopPropagation();const L=window.getSelection()?.toString().trim()||"";d(L);const b=224,G=400,X=C.clientX+b>window.innerWidth?window.innerWidth-b-10:C.clientX,ce=C.clientY+G>window.innerHeight?window.innerHeight-G-10:C.clientY;R({x:Math.max(10,X),y:Math.max(10,ce)}),x(!0)},K=C=>{T.current&&!T.current.contains(C.target)&&x(!1)},A=C=>{C.key==="Escape"&&x(!1)};return document.addEventListener("contextmenu",p),document.addEventListener("click",K,!0),document.addEventListener("keydown",A),()=>{document.removeEventListener("contextmenu",p),document.removeEventListener("click",K,!0),document.removeEventListener("keydown",A)}},[]);const m=()=>{w?navigator.clipboard.writeText(w):navigator.clipboard.writeText(window.location.href),x(!1)},oe=()=>{window.location.reload()},ie=()=>{if(w){const p=`https://www.google.com/search?q=${encodeURIComponent(w)}`;window.open(p,"_blank")}x(!1)},B=[{id:"dashboard",label:a("nav.dashboard"),icon:e.jsx(rt,{className:"w-4 h-4"}),path:"/dashboard"},{id:"calendar",label:a("nav.calendar"),icon:e.jsx(be,{className:"w-4 h-4"}),path:"/calendar"},{id:"people",label:a("nav.people"),icon:e.jsx(lt,{className:"w-4 h-4"}),path:"/people"},{id:"bills",label:a("nav.bills"),icon:e.jsx(ot,{className:"w-4 h-4"}),path:"/bills"},{id:"documents",label:a("nav.documents"),icon:e.jsx(it,{className:"w-4 h-4"}),path:"/documents"},{id:"shopping",label:a("nav.shopping"),icon:e.jsx(Re,{className:"w-4 h-4"}),path:"/shopping"},{id:"aiChat",label:a("nav.assistant"),icon:e.jsx(Ae,{className:"w-4 h-4"}),path:"/ai-chat"}],q=[{id:"copy",label:a(w?"common.copy":"common.copyUrl"),icon:e.jsx(dt,{className:"w-4 h-4"}),onClick:m},{id:"refresh",label:a("common.refresh"),icon:e.jsx(ct,{className:"w-4 h-4"}),onClick:oe}];w&&q.splice(1,0,{id:"search",label:a("common.search"),icon:e.jsx(mt,{className:"w-4 h-4"}),onClick:ie});const F=[{id:"settings",label:a("nav.settings"),icon:e.jsx(ut,{className:"w-4 h-4"}),path:"/settings"},{id:"help",label:a("common.help"),icon:e.jsx(ht,{className:"w-4 h-4"}),path:"/help"}];if(!S)return null;const de=e.jsx("div",{ref:T,"data-global-context-menu":!0,className:"fixed z-[10000] min-w-[14rem] rounded-md border bg-popover text-popover-foreground shadow-md",style:{left:`${y.x}px`,top:`${y.y}px`,transform:"translate(0, 0)"},onClick:p=>p.stopPropagation(),children:e.jsxs("div",{className:"p-1",children:[B.map(p=>e.jsxs("button",{onClick:()=>{h(p.path),x(!1)},className:$("relative flex w-full cursor-pointer select-none items-center rounded-sm px-2 py-1.5 text-sm outline-none transition-colors hover:bg-accent hover:text-accent-foreground focus:bg-accent focus:text-accent-foreground",k===p.path&&"bg-accent"),children:[e.jsx("span",{className:"mr-2",children:p.icon}),p.label]},p.id)),q.length>0&&e.jsx("div",{className:"my-1 h-px bg-border"}),q.map(p=>e.jsxs("button",{onClick:()=>{p.onClick(),x(!1)},className:"relative flex w-full cursor-pointer select-none items-center rounded-sm px-2 py-1.5 text-sm outline-none transition-colors hover:bg-accent hover:text-accent-foreground focus:bg-accent focus:text-accent-foreground",children:[e.jsx("span",{className:"mr-2",children:p.icon}),p.label]},p.id)),e.jsx("div",{className:"my-1 h-px bg-border"}),F.map(p=>e.jsxs("button",{onClick:()=>{h(p.path),x(!1)},className:"relative flex w-full cursor-pointer select-none items-center rounded-sm px-2 py-1.5 text-sm outline-none transition-colors hover:bg-accent hover:text-accent-foreground focus:bg-accent focus:text-accent-foreground",children:[e.jsx("span",{className:"mr-2",children:p.icon}),p.label]},p.id))]})});return Dt(de,document.body)}function Ft({children:a,title:k="Nexo",showSidebar:h=!1,showQuickActions:S=!1,quickActions:x=[],currentChatId:y,onSelectChat:R,onNewChat:w,hideQuickActions:d=!1}){const[T]=le();return e.jsxs("div",{className:"min-h-screen bg-background flex flex-col",children:[e.jsx(Ve,{title:k,showSidebar:h,showQuickActions:S,quickActions:x,currentChatId:y,onSelectChat:R,onNewChat:w}),!d&&e.jsx(St,{currentPath:T}),e.jsx("main",{className:"flex-1 overflow-y-auto",style:{paddingTop:d?"3.5rem":"7rem",touchAction:"pan-y"},children:e.jsx("div",{className:"mobile-container py-4",children:a})}),e.jsx(Tt,{})]})}function Mt({className:a,...k}){return e.jsx("div",{"data-slot":"skeleton",className:$("bg-accent animate-pulse rounded-md",a),...k})}const It=xt("inline-flex items-center justify-center rounded-md border px-2 py-0.5 text-xs font-medium w-fit whitespace-nowrap shrink-0 [&>svg]:size-3 gap-1 [&>svg]:pointer-events-none focus-visible:border-ring focus-visible:ring-ring/50 focus-visible:ring-[3px] aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive transition-[color,box-shadow] overflow-hidden",{variants:{variant:{default:"border-transparent bg-primary text-primary-foreground [a&]:hover:bg-primary/90",secondary:"border-transparent bg-secondary text-secondary-foreground [a&]:hover:bg-secondary/90",destructive:"border-transparent bg-destructive text-white [a&]:hover:bg-destructive/90 focus-visible:ring-destructive/20 dark:focus-visible:ring-destructive/40 dark:bg-destructive/60",outline:"text-foreground [a&]:hover:bg-accent [a&]:hover:text-accent-foreground"}},defaultVariants:{variant:"default"}});function Fe({className:a,variant:k,asChild:h=!1,...S}){const x=h?Ct:"span";return e.jsx(x,{"data-slot":"badge",className:$(It({variant:k}),a),...S})}function Pt(){const{t:a}=Me(),[,k]=le(),[h,S]=N(new Date),[x,y]=N([]),[R,w]=N(!0),[d,T]=N(null),[m,oe]=N(null),[ie,B]=N(!1),[q,F]=N(!1),[de,p]=N(!1),[K,A]=N(!1),[C,v]=N(I(new Date)),[ve,L]=N(I(new Date)),{data:b=[]}=Je(),{data:G=[]}=Ke(),{data:X=[]}=Xe(),{settings:ce}=Ze(),Z=ce?.weatherLocation||"Zurich, CH",me=re(()=>d?new Date(d.getFullYear(),d.getMonth(),d.getDate()):null,[d?.getFullYear(),d?.getMonth(),d?.getDate()]),{data:j,isLoading:ue,error:Y}=_e(me,Z),U=Ie(""),P=Se(async()=>{try{if(w(!0),!De){console.error("[Calendar] Firebase functions not available"),y([]);return}if(!V.currentUser){console.warn("[Calendar] User not authenticated"),y([]);return}const t=Et(De,"getCalendarEvents"),n=new Date(h.getFullYear(),h.getMonth()-12,1),c=new Date(h.getFullYear(),h.getMonth()+12,0);try{console.log("[Calendar] Calling getCalendarEvents with:",{startDate:n.toISOString(),endDate:c.toISOString()});const i=await t({startDate:n.toISOString(),endDate:c.toISOString()});console.log("[Calendar] Raw eventsResult:",i),console.log("[Calendar] eventsResult.data:",i.data);const u=i.data.events||[];console.log("[Calendar] loadedEvents count:",u.length),console.log("[Calendar] loadedEvents sample:",u.slice(0,3));const s=u.map(r=>{try{if(!r.date)return console.warn("[Calendar] Event has no date:",r),null;const g=J(r.date);if(!g){if(typeof r.date=="string"&&r.date.match(/^\d{4}-\d{2}-\d{2}/))return console.warn("[Calendar] Normalization failed, using original date string:",r.date),{...r,date:r.date.split("T")[0]};if(typeof r.date=="string"&&r.date.includes("T")){const f=r.date.split("T")[0];if(f.match(/^\d{4}-\d{2}-\d{2}/))return console.warn("[Calendar] Using fallback ISO date extraction:",f),{...r,date:f}}return console.warn("[Calendar] Event with invalid date skipped:",r),null}return{...r,date:g}}catch(g){if(console.error("[Calendar] Error normalizing event date:",g,r),typeof r.date=="string")try{const f=r.date.split("T")[0];if(f.match(/^\d{4}-\d{2}-\d{2}/))return console.warn("[Calendar] Using fallback date extraction:",f),{...r,date:f}}catch(f){console.error("[Calendar] Fallback also failed:",f)}return null}}).filter(r=>r!==null);if(console.log("[Calendar] normalizedEvents count:",s.length),console.log("[Calendar] normalizedEvents sample (first 5):",s.slice(0,5).map(r=>({id:r.id,title:r.title,date:r.date,type:r.type}))),s.length<u.length){console.warn(`[Calendar] WARNING: Lost ${u.length-s.length} events during normalization!`);const r=u.filter(g=>!s.find(M=>M.id===g.id));console.warn("[Calendar] Lost events:",r.map(g=>({title:g.title,date:g.date})))}const o=O(b,s);console.log("[Calendar] Final events count:",{normalizedEvents:s.length,totalEvents:o.length,sampleEvents:o.slice(0,5).map(r=>({id:r.id,title:r.title,date:r.date}))}),y(o)}catch(i){console.error("[Calendar] API Error:",{message:i?.message,code:i?.code,details:i?.details}),U.current===""&&(i?.code==="unauthenticated"||i?.message?.includes("UNAUTHORIZED")?E.error(a("calendar.errors.pleaseLogin","Bitte anmelden")):(i?.code==="unavailable"||i?.message?.includes("network"))&&E.error(a("calendar.errors.networkError","Netzwerkfehler - Bitte erneut versuchen"))),console.log("[Calendar] API Error occurred, but still converting reminders to events");const u=O(b,[]);y(u)}}catch(t){console.error("[Calendar] Unexpected error:",t);const n=O(b,[]);y(n)}finally{w(!1)}},[h,b]),O=Se((t,n=[])=>{console.log("[Calendar] convertRemindersToEvents - START:",{remindersCount:t.length,existingEventsCount:n.length});const c=t.filter(l=>{if(!l.dueDate)return console.log("[Calendar] Reminder skipped - no dueDate:",l.title),!1;let u;if(l.dueDate instanceof Date)u=l.dueDate;else if(typeof l.dueDate=="string")u=new Date(l.dueDate);else return console.log("[Calendar] Reminder skipped - invalid dueDate type:",l.title,typeof l.dueDate),!1;if(isNaN(u.getTime()))return console.log("[Calendar] Reminder skipped - invalid date:",l.title,l.dueDate),!1;const s=z(u),o=n.some(r=>(J(r.date)||(typeof r.date=="string"?r.date.split("T")[0]:""))===s&&r.title===l.title);return o&&console.log("[Calendar] Reminder already in events, skipping:",l.title),!o}).map(l=>{let u;if(l.dueDate instanceof Date)u=l.dueDate;else if(typeof l.dueDate=="string")u=new Date(l.dueDate);else throw new Error(`Invalid dueDate for reminder ${l.id}`);let s="appointment";l.type==="termin"?s="appointment":l.type==="zahlung"?s="due":l.type==="aufgabe"&&(s="reminder");const o=z(u),r=l.isAllDay?void 0:Ce(u);return{id:`reminder-${l.id}`,type:s,title:l.title,date:o,time:r,description:l.notes||void 0,status:l.status}});console.log("[Calendar] convertRemindersToEvents - RESULT:",{count:c.length,events:c.map(l=>({id:l.id,title:l.title,date:l.date}))});const i=[...n];for(const l of c)i.some(u=>u.id===l.id)||i.push(l);return i},[]);W(()=>{const t=JSON.stringify({reminders:b.map(n=>n.id).sort(),financeEntries:G.map(n=>n.id).sort(),people:X.map(n=>n.id).sort()});if(U.current!==t&&U.current!==""){U.current=t;const n=setTimeout(()=>{V.currentUser&&P().catch(c=>{console.error("[Calendar] Error refetching events:",c)})},1e3);return()=>clearTimeout(n)}else U.current===""&&(U.current=t)},[b,G,X,P]),W(()=>{console.log("[Calendar] useEffect - Reminders changed:",{remindersCount:b.length,reminders:b.map(n=>({id:n.id,title:n.title,dueDate:n.dueDate}))});const t=O(b,[]);console.log("[Calendar] Converted reminders to events immediately:",{count:t.length,events:t.map(n=>({id:n.id,title:n.title,date:n.date}))}),y(n=>{const c=[...n];for(const i of t)c.some(l=>l.id===i.id)||c.push(i);return console.log("[Calendar] Updated events state:",{prevCount:n.length,newCount:c.length,added:t.length}),c})},[b,O]),W(()=>{console.log("[Calendar] Weather state:",{selectedDate:d?.toISOString(),weatherDate:me?.toISOString(),location:Z,weatherData:j,isLoading:ue,error:Y?.message})},[d,me,Z,j,ue,Y]),W(()=>{console.log("[Calendar] Reminders changed, converting to events:",{remindersCount:b.length,reminders:b.map(n=>({id:n.id,title:n.title,dueDate:n.dueDate}))});const t=O(b,[]);console.log("[Calendar] Converted reminders to events immediately:",{count:t.length,events:t.map(n=>({id:n.id,title:n.title,date:n.date}))}),y(n=>{const c=[...n];for(const i of t)c.some(l=>l.id===i.id)||c.push(i);return c})},[b,O]),W(()=>{console.log("[Calendar] useEffect for fetchEvents - auth check:",{isAuthenticated:!!V.currentUser,userId:V.currentUser?.uid}),V.currentUser?(console.log("[Calendar] User authenticated, calling fetchEvents"),P().catch(t=>{console.error("[Calendar] Error in fetchEvents:",t)})):(console.log("[Calendar] User not authenticated, clearing events"),y([]),w(!1))},[P]);const Oe=[a("calendar.months.january","Januar"),a("calendar.months.february","Februar"),a("calendar.months.march","März"),a("calendar.months.april","April"),a("calendar.months.may","Mai"),a("calendar.months.june","Juni"),a("calendar.months.july","Juli"),a("calendar.months.august","August"),a("calendar.months.september","September"),a("calendar.months.october","Oktober"),a("calendar.months.november","November"),a("calendar.months.december","Dezember")],Be=[a("calendar.days.monday","Mo"),a("calendar.days.tuesday","Di"),a("calendar.days.wednesday","Mi"),a("calendar.days.thursday","Do"),a("calendar.days.friday","Fr"),a("calendar.days.saturday","Sa"),a("calendar.days.sunday","So")],Le=t=>new Date(t.getFullYear(),t.getMonth()+1,0).getDate(),Ye=t=>{const n=new Date(t.getFullYear(),t.getMonth(),1).getDay();return n===0?6:n-1},Ue=re(()=>{const t=Le(h),n=Ye(h),c=[];console.log("[Calendar] calendarDays useMemo - START:",{currentDate:h.toISOString(),eventsCount:x.length,events:x.map(o=>({id:o.id,title:o.title,date:o.date}))});const i=o=>{const r=z(o),g=x.filter(f=>{if(!f.date)return console.log("[Calendar] Event skipped - no date:",f.title),!1;let M=J(f.date);if(!M&&typeof f.date=="string"){const we=f.date.split("T")[0];we.match(/^\d{4}-\d{2}-\d{2}/)&&(M=we,console.log("[Calendar] Using fallback date extraction for event:",f.title,M))}if(!M)return console.log("[Calendar] Event skipped - invalid date:",f.title,f.date),!1;const Ne=M===r;return Ne&&console.log("[Calendar] Event matched for date:",{eventTitle:f.title,eventDate:f.date,eventDateStr:M,targetDateStr:r,date:o.toISOString()}),Ne});return g.length>0&&console.log("[Calendar] Found events for date:",{date:r,count:g.length,events:g.map(f=>f.title)}),g},u=new Date(h.getFullYear(),h.getMonth()-1,0).getDate();for(let o=n-1;o>=0;o--){const r=new Date(h.getFullYear(),h.getMonth()-1,u-o),g=i(r);c.push({date:r,isCurrentMonth:!1,events:g})}for(let o=1;o<=t;o++){const r=new Date(h.getFullYear(),h.getMonth(),o),g=i(r);c.push({date:r,isCurrentMonth:!0,events:g})}const s=42-c.length;for(let o=1;o<=s;o++){const r=new Date(h.getFullYear(),h.getMonth()+1,o),g=i(r);c.push({date:r,isCurrentMonth:!1,events:g})}return c},[h,x]),Pe=()=>{S(new Date(h.getFullYear(),h.getMonth()-1,1))},He=()=>{S(new Date(h.getFullYear(),h.getMonth()+1,1))},We=()=>{S(new Date)},$e=t=>{const n=new Date;return t.toDateString()===n.toDateString()},qe=t=>{const n=new Date(t.getFullYear(),t.getMonth(),t.getDate());T(n),F(!0)},he=t=>{oe(t),B(!0)},ye=re(()=>{if(!d)return console.log("[Calendar] dayEvents - no selectedDate"),[];const t=new Date(d.getFullYear(),d.getMonth(),d.getDate()),n=z(t);console.log("[Calendar] dayEvents filter - START:",{selectedDate:d.toISOString(),normalizedSelectedDate:t.toISOString(),dateStr:n,totalEvents:x.length,totalReminders:b.length,events:x.map(s=>({title:s.title,date:s.date,type:s.type}))});const c=x.filter(s=>{if(!s.date)return console.log("[Calendar] Event skipped - no date:",s.title),!1;let o=J(s.date);if(!o&&typeof s.date=="string"){const g=s.date.split("T")[0];g.match(/^\d{4}-\d{2}-\d{2}/)&&(o=g,console.log("[Calendar] Using fallback date extraction for filter:",o))}if(!o)return console.log("[Calendar] Event skipped - invalid date:",s.title,s.date),!1;const r=o===n;return r&&console.log("[Calendar] Event matched:",{eventTitle:s.title,eventDate:s.date,eventDateStr:o,selectedDateStr:n}),r}),i=b.filter(s=>{if(!s.dueDate)return!1;let o;if(s.dueDate instanceof Date)o=s.dueDate;else if(typeof s.dueDate=="string")o=new Date(s.dueDate);else return!1;return isNaN(o.getTime())?!1:z(o)===n});console.log("[Calendar] Reminders for date:",{dateStr:n,remindersForDate:i.length,reminders:i.map(s=>({id:s.id,title:s.title,dueDate:s.dueDate}))});const l=i.map(s=>{let o="appointment";s.type==="termin"?o="appointment":s.type==="zahlung"?o="due":s.type==="aufgabe"&&(o="reminder");let r;if(s.dueDate instanceof Date)r=s.dueDate;else if(typeof s.dueDate=="string")r=new Date(s.dueDate);else throw new Error(`Invalid dueDate for reminder ${s.id}`);return{id:`reminder-${s.id}`,type:o,title:s.title,date:z(r),time:s.isAllDay?void 0:Ce(r),description:s.notes||void 0,status:s.status}}),u=[...c];for(const s of l)u.some(o=>o.id===s.id)||u.push(s);return console.log("[Calendar] dayEvents filter - RESULT:",{selectedDate:t.toISOString(),dateStr:n,filteredFromEvents:c.length,fromReminders:l.length,totalDayEvents:u.length,allDayEvents:u.map(s=>({id:s.id,title:s.title,date:s.date,type:s.type}))}),u},[d,x,b]),je=re(()=>{const n=z(new Date);return x.filter(c=>{const i=J(c.date);return i!==""&&i===n})},[x]),_=t=>{switch(t){case"due":return"bg-pink-500";case"reminder":case"appointment":case"termin":return"bg-orange-500";case"work":return"bg-slate-400";case"vacation":case"frei":return"bg-emerald-400";case"school-holiday":return"bg-sky-400";case"school":return"bg-purple-400";case"hort":return"bg-fuchsia-500";default:return"bg-gray-500"}};return e.jsxs(Ft,{title:a("calendar.title","Kalender"),showSidebar:!0,children:[e.jsx(D,{variant:"ghost",size:"icon",onClick:()=>k("/"),className:"fixed top-2 right-2 z-50 h-9 w-9 rounded-full bg-background/95 backdrop-blur-sm border border-border shadow-lg",children:e.jsx(pe,{className:"h-4 w-4"})}),e.jsxs("div",{className:"mobile-card mb-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx(D,{variant:"outline",size:"sm",onClick:Pe,className:"h-10 min-h-[44px] px-3",children:e.jsx(pt,{className:"w-5 h-5"})}),e.jsx("div",{className:"flex-1 text-center",children:e.jsxs("h2",{className:"text-lg font-semibold",children:[Oe[h.getMonth()]," ",h.getFullYear()]})}),e.jsx(D,{variant:"outline",size:"sm",onClick:He,className:"h-10 min-h-[44px] px-3",children:e.jsx(gt,{className:"w-5 h-5"})})]}),e.jsx(D,{variant:"outline",size:"sm",onClick:We,className:"w-full h-10 min-h-[44px]",children:a("calendar.today","Heute")})]}),e.jsxs("div",{className:"mobile-card",children:[e.jsx("div",{className:"grid grid-cols-7 gap-1 mb-2",children:Be.map((t,n)=>e.jsx("div",{className:"text-center text-xs font-medium text-muted-foreground py-2",children:t},n))}),R?e.jsx("div",{className:"grid grid-cols-7 gap-1",children:Array.from({length:42}).map((t,n)=>e.jsx(Mt,{className:"aspect-square min-h-[44px] rounded-lg"},n))}):e.jsx("div",{className:"grid grid-cols-7 gap-1",children:Ue.map((t,n)=>{const c=$e(t.date);return e.jsxs("button",{onClick:()=>qe(t.date),className:`
                    aspect-square min-h-[44px] p-1 rounded-lg text-sm transition-colors
                    ${t.isCurrentMonth?"text-foreground":"text-muted-foreground/40"}
                    ${c?"bg-primary text-primary-foreground font-bold":"hover:bg-muted"}
                  `,children:[e.jsx("div",{className:"text-xs font-medium mb-1",children:t.date.getDate()}),e.jsxs("div",{className:"flex flex-col gap-0.5",children:[t.events.slice(0,2).map((i,l)=>e.jsx("div",{onClick:u=>{u.stopPropagation(),he(i)},className:`h-1 rounded ${_(i.type)}`,title:i.title},l)),t.events.length>2&&e.jsxs("div",{className:"text-[10px] text-muted-foreground",children:["+",t.events.length-2]})]})]},n)})})]}),je.length>0&&e.jsxs("div",{className:"mobile-card mt-4",children:[e.jsx("h3",{className:"text-sm font-semibold mb-3",children:a("calendar.todayEvents","Heute - Termine & Events")}),e.jsx("div",{className:"space-y-2",children:je.map(t=>e.jsx(Ee,{className:"cursor-pointer hover:bg-muted/50 transition-colors",onClick:()=>{T(new Date(t.date.includes("T")?t.date.split("T")[0]:t.date)),he(t)},children:e.jsx(ke,{className:"p-3",children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("div",{className:$("w-3 h-3 rounded-full mt-1 flex-shrink-0",_(t.type))}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("p",{className:"font-medium text-sm truncate",children:t.title}),t.time&&e.jsxs("p",{className:"text-xs text-muted-foreground mt-1",children:[e.jsx(ge,{className:"w-3 h-3 inline mr-1"}),t.time]}),t.personName&&e.jsx("p",{className:"text-xs text-muted-foreground mt-1",children:t.personName})]})]})})},t.id))})]}),e.jsx(Q,{open:q,onOpenChange:F,children:e.jsxs(ee,{className:"!fixed !top-[50%] !left-[50%] !right-auto !bottom-auto !translate-x-[-50%] !translate-y-[-50%] !w-[85vw] !max-w-sm !max-h-[85vh] !rounded-3xl !m-0 !overflow-y-auto !shadow-2xl",children:[e.jsx(te,{className:"px-5 pt-5 pb-3 sticky top-0 bg-background z-10 border-b border-border",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx(ae,{className:"text-lg font-semibold",children:d?.toLocaleDateString("de-CH",{weekday:"long",day:"numeric",month:"long",year:"numeric"})}),e.jsx(xe,{className:"sr-only",children:a("calendar.dayDialogDescription","Details für den ausgewählten Tag mit Wetter, Terminen und Schnellaktionen")}),e.jsx(D,{variant:"ghost",size:"icon",onClick:()=>F(!1),className:"h-8 w-8 rounded-full",children:e.jsx(pe,{className:"h-4 w-4"})})]})}),e.jsxs("div",{className:"space-y-4 px-5 pb-2",children:[e.jsxs("div",{className:"bg-muted/30 rounded-xl p-4 space-y-3",children:[e.jsx("div",{className:"flex items-center justify-between",children:e.jsxs("h3",{className:"text-sm font-semibold flex items-center gap-2",children:[e.jsx(Te,{className:"w-4 h-4"}),a("calendar.weather","Wetter")]})}),ue?e.jsxs("div",{className:"flex flex-col items-center justify-center py-4",children:[e.jsx("div",{className:"text-xs text-muted-foreground",children:a("calendar.loadingWeather","Lädt Wetterdaten...")}),Y&&e.jsxs("div",{className:"text-xs text-red-500 mt-2",children:[a("calendar.errors.weatherError","Fehler"),": ",Y.message]})]}):Y?e.jsxs("div",{className:"text-xs text-muted-foreground text-center py-2",children:[e.jsx("p",{className:"text-red-500 mb-1",children:a("calendar.errors.loadingError","Fehler beim Laden")}),e.jsx("p",{className:"opacity-70",children:Y.message}),!Z]}):j?e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[j.icon==="sun"&&e.jsx(ft,{className:"w-6 h-6 text-yellow-500"}),j.icon==="cloud-sun"&&e.jsx(bt,{className:"w-6 h-6 text-gray-500"}),j.icon==="cloud"&&e.jsx(Te,{className:"w-6 h-6 text-gray-500"}),j.icon==="rain"&&e.jsx(vt,{className:"w-6 h-6 text-blue-500"}),e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-baseline gap-1",children:[e.jsxs("span",{className:"text-2xl font-bold",children:[j.temperature,"°"]}),e.jsx("span",{className:"text-sm text-muted-foreground",children:"C"})]}),e.jsx("div",{className:"text-xs text-muted-foreground",children:j.condition})]})]}),(j.humidity!==void 0||j.windSpeed!==void 0)&&e.jsxs("div",{className:"flex gap-4 text-xs text-muted-foreground pt-2 border-t border-border/50",children:[j.windSpeed!==void 0&&e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(yt,{className:"w-3 h-3"}),e.jsxs("span",{children:[j.windSpeed," km/h"]})]}),j.humidity!==void 0&&e.jsx("div",{children:e.jsxs("span",{children:[a("calendar.humidity","Luftfeuchtigkeit"),": ",j.humidity,"%"]})})]})]}):e.jsx("div",{className:"text-xs text-muted-foreground text-center py-2",children:a("calendar.noWeatherDataAvailable","Keine Wetterdaten verfügbar")})]}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-sm font-semibold mb-2",children:a("calendar.appointmentsAndEvents","Termine & Events")}),ye.length===0?e.jsxs("div",{className:"text-sm text-muted-foreground text-center py-3 bg-muted/30 rounded-lg",children:[e.jsx("p",{children:a("calendar.noEventsToday","Keine Events an diesem Tag")}),e.jsxs("p",{className:"text-xs mt-2 opacity-70",children:["Debug: ",x.length," Events geladen, ",d?`Datum: ${z(d)}`:"Kein Datum ausgewählt",x.length>0&&e.jsxs("span",{className:"block mt-1",children:["Event-Daten: ",JSON.stringify(x.slice(0,2).map(t=>({title:t.title,date:t.date})))]})]})]}):e.jsx("div",{className:"space-y-2",children:ye.map(t=>e.jsx(Ee,{className:"cursor-pointer hover:bg-muted/50 transition-colors",onClick:()=>{F(!1),he(t)},children:e.jsx(ke,{className:"p-3",children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("div",{className:$("w-3 h-3 rounded-full mt-1 flex-shrink-0",_(t.type))}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("p",{className:"font-medium text-sm truncate",children:t.title}),t.time&&e.jsxs("p",{className:"text-xs text-muted-foreground mt-1",children:[e.jsx(ge,{className:"w-3 h-3 inline mr-1"}),t.time]}),t.personName&&e.jsx("p",{className:"text-xs text-muted-foreground mt-1",children:t.personName})]})]})})},t.id))})]}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-sm font-semibold mb-2",children:a("calendar.quickActions","Schnellaktionen")}),e.jsxs("div",{className:"grid grid-cols-2 gap-2",children:[e.jsxs(D,{variant:"outline",onClick:()=>{p(!0)},className:"h-auto py-3 flex flex-col items-center gap-2 rounded-xl",children:[e.jsx(jt,{className:"w-5 h-5"}),e.jsx("span",{className:"text-xs",children:a("calendar.createAppointment","Termin erstellen")})]}),e.jsxs(D,{variant:"outline",onClick:()=>{A(!0)},className:"h-auto py-3 flex flex-col items-center gap-2 rounded-xl",children:[e.jsx(fe,{className:"w-5 h-5"}),e.jsx("span",{className:"text-xs",children:a("calendar.financeEntry","Finanz-Eintrag")})]})]})]})]}),e.jsx(ne,{className:"px-5 pb-3 pt-2 sticky bottom-0 bg-background border-t border-border",children:e.jsx(D,{variant:"default",onClick:()=>F(!1),className:"h-11 min-h-[44px] w-full rounded-xl text-sm font-medium",children:a("common.close","Schliessen")})})]})}),e.jsx(Q,{open:ie,onOpenChange:B,children:e.jsxs(ee,{className:"!fixed !top-[50%] !left-[50%] !right-auto !bottom-auto !translate-x-[-50%] !translate-y-[-50%] !w-[85vw] !max-w-sm !max-h-[85vh] !rounded-3xl !m-0 !overflow-y-auto !shadow-2xl",children:[e.jsxs(te,{className:"px-5 pt-5 pb-3 sticky top-0 bg-background z-10 border-b border-border relative",children:[e.jsx(D,{variant:"ghost",size:"icon",onClick:()=>B(!1),className:"absolute right-2 top-2 h-8 w-8 rounded-full z-20",children:e.jsx(pe,{className:"h-4 w-4"})}),e.jsx("div",{className:"flex items-start gap-3 pr-8",children:e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx("div",{className:$("w-4 h-4 rounded-full flex-shrink-0",_(m?.type||""))}),e.jsxs(Fe,{variant:"outline",className:"text-xs",children:[m?.type==="due"&&"Fällig",m?.type==="reminder"&&"Erinnerung",m?.type==="appointment"&&"Termin",m?.type==="work"&&"Arbeit",m?.type==="school"&&"Schule",m?.type==="hort"&&"Hort",!m?.type&&"Event"]})]}),e.jsx(ae,{className:"text-lg font-semibold leading-tight",children:m?.title}),e.jsx(xe,{className:"sr-only",children:"Detaillierte Informationen zum ausgewählten Event"})]})})]}),m&&e.jsxs("div",{className:"space-y-4 px-5 pb-2",children:[e.jsxs("div",{className:"bg-muted/30 rounded-xl p-4 space-y-3",children:[m.date&&e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx(be,{className:"w-5 h-5 text-muted-foreground mt-0.5 flex-shrink-0"}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx(H,{className:"text-xs text-muted-foreground block mb-1",children:"Datum"}),e.jsx("p",{className:"text-sm font-medium",children:new Date(m.date).toLocaleDateString("de-CH",{weekday:"long",day:"numeric",month:"long",year:"numeric"})})]})]}),m.time&&e.jsxs("div",{className:"flex items-start gap-3 pt-2 border-t border-border/50",children:[e.jsx(ge,{className:"w-5 h-5 text-muted-foreground mt-0.5 flex-shrink-0"}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx(H,{className:"text-xs text-muted-foreground block mb-1",children:"Uhrzeit"}),e.jsx("p",{className:"text-sm font-medium",children:m.time})]})]})]}),m.description&&e.jsxs("div",{className:"bg-muted/30 rounded-xl p-4",children:[e.jsx(H,{className:"text-xs text-muted-foreground block mb-2",children:"Beschreibung"}),e.jsx("p",{className:"text-sm leading-relaxed whitespace-pre-wrap",children:m.description})]}),(m.amount||m.personName||m.status)&&e.jsxs("div",{className:"space-y-2",children:[m.amount&&e.jsxs("div",{className:"flex items-center gap-3 bg-muted/30 rounded-xl p-4",children:[e.jsx(fe,{className:"w-5 h-5 text-muted-foreground flex-shrink-0"}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx(H,{className:"text-xs text-muted-foreground block mb-1",children:a("calendar.amount","Betrag")}),e.jsxs("p",{className:"text-sm font-semibold",children:["CHF ",(m.amount/100).toFixed(2)]})]})]}),m.personName&&e.jsxs("div",{className:"flex items-center gap-3 bg-muted/30 rounded-xl p-4",children:[e.jsx(ze,{className:"w-5 h-5 text-muted-foreground flex-shrink-0"}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx(H,{className:"text-xs text-muted-foreground block mb-1",children:a("calendar.person","Person")}),e.jsx("p",{className:"text-sm font-medium",children:m.personName})]})]}),m.status&&e.jsxs("div",{className:"flex items-center gap-3 bg-muted/30 rounded-xl p-4",children:[e.jsx(Nt,{className:"w-5 h-5 text-muted-foreground flex-shrink-0"}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx(H,{className:"text-xs text-muted-foreground block mb-1",children:a("calendar.status","Status")}),e.jsx(Fe,{variant:m.status==="paid"?"default":"secondary",className:"text-xs",children:m.status==="paid"?a("calendar.paid","Bezahlt"):m.status==="pending"?a("calendar.pending","Ausstehend"):m.status})]})]}),m.isOverdue&&e.jsxs("div",{className:"flex items-center gap-3 bg-red-50 dark:bg-red-950/20 rounded-xl p-4 border border-red-200 dark:border-red-800",children:[e.jsx(wt,{className:"w-5 h-5 text-red-600 dark:text-red-400 flex-shrink-0"}),e.jsx("div",{className:"flex-1 min-w-0",children:e.jsx("p",{className:"text-sm font-medium text-red-600 dark:text-red-400",children:a("calendar.overdue","Überfällig")})})]})]})]}),e.jsx(ne,{className:"px-5 pb-3 pt-2 sticky bottom-0 bg-background border-t border-border",children:e.jsx(D,{variant:"default",onClick:()=>B(!1),className:"h-11 min-h-[44px] w-full rounded-xl text-sm font-medium",children:a("common.close","Schliessen")})})]})}),e.jsx(Q,{open:de,onOpenChange:t=>{p(t),t&&v(I(d||new Date))},children:e.jsxs(ee,{className:"!fixed !top-[50%] !left-[50%] !right-auto !bottom-auto !translate-x-[-50%] !translate-y-[-50%] !w-[85vw] !max-w-sm !max-h-fit !rounded-3xl !m-0 !overflow-visible !shadow-2xl",children:[e.jsx(te,{className:"px-5 pt-4 pb-2",children:e.jsx(ae,{className:"text-lg font-semibold",children:a("calendar.createAppointment","Termin erstellen")})}),e.jsxs("div",{className:"px-5 pb-2 space-y-3",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium mb-1 block",children:a("reminders.titleField","Titel")}),e.jsx("input",{type:"text",id:"reminder-title",placeholder:a("reminders.titlePlaceholder","z.B. Arzttermin"),className:"w-full px-3 py-2 border border-border rounded-lg text-sm",autoFocus:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium mb-1 block",children:a("reminders.dueDate","Datum")}),e.jsx("input",{type:"text",id:"reminder-date",placeholder:"DD.MM.YYYY",value:C,onChange:t=>{const n=t.target.value;v(n)},onBlur:t=>{const n=se(t.target.value);n?v(I(n)):t.target.value&&d&&v(I(d))},className:"w-full px-3 py-2 border border-border rounded-lg text-sm"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium mb-1 block",children:a("calendar.timeOptional","Uhrzeit (optional)")}),e.jsx("input",{type:"time",id:"reminder-time",className:"w-full px-3 py-2 border border-border rounded-lg text-sm"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium mb-1 block",children:a("calendar.notesOptional","Notizen (optional)")}),e.jsx("textarea",{id:"reminder-notes",placeholder:a("calendar.moreDetails","Weitere Details..."),rows:2,className:"w-full px-3 py-2 border border-border rounded-lg text-sm resize-none"})]})]}),e.jsxs(ne,{className:"px-5 pb-3 pt-2 gap-2",children:[e.jsx(D,{variant:"outline",onClick:()=>p(!1),className:"h-11 min-h-[44px] flex-1 rounded-xl text-sm font-medium",children:a("common.cancel","Abbrechen")}),e.jsx(D,{variant:"default",onClick:async()=>{try{const t=document.getElementById("reminder-title"),n=document.getElementById("reminder-date"),c=document.getElementById("reminder-time"),i=document.getElementById("reminder-notes");if(!t.value.trim()){E.error(a("calendar.errors.titleRequired","Bitte gib einen Titel ein"));return}const l=se(n.value);if(!l){E.error(a("calendar.errors.invalidDate","Bitte gib ein gültiges Datum ein (DD.MM.YYYY)"));return}const u=new Date;if(u.setHours(0,0,0,0),new Date(l.getFullYear(),l.getMonth(),l.getDate())<u){E.error(a("calendar.errors.cannotCreateInPast","Termine können nicht in der Vergangenheit erstellt werden"));return}const o=new Date(l);if(c.value){const[r,g]=c.value.split(":");o.setHours(parseInt(r),parseInt(g))}else o.setHours(12,0);await Qe({title:t.value.trim(),type:"termin",dueDate:o,isAllDay:!c.value,notes:i.value.trim()||null}),E.success(a("calendar.appointmentCreated","Termin erstellt")),p(!1),F(!1),await P(),d&&T(new Date(d))}catch(t){E.error(t.message||a("calendar.errors.createAppointmentError","Fehler beim Erstellen des Termins"))}},className:"h-11 min-h-[44px] flex-1 rounded-xl text-sm font-medium",children:a("common.create","Erstellen")})]})]})}),e.jsx(Q,{open:K,onOpenChange:t=>{A(t),t&&L(I(d||new Date))},children:e.jsxs(ee,{className:"!fixed !top-[50%] !left-[50%] !right-auto !bottom-auto !translate-x-[-50%] !translate-y-[-50%] !w-[85vw] !max-w-sm !max-h-fit !rounded-3xl !m-0 !overflow-visible !shadow-2xl",children:[e.jsxs(te,{className:"px-5 pt-4 pb-2",children:[e.jsx(ae,{className:"text-lg font-semibold",children:a("calendar.createFinanceEntry","Finanz-Eintrag erstellen")}),e.jsx(xe,{className:"sr-only",children:a("calendar.createFinanceEntryDescription","Erstellen Sie einen neuen Finanz-Eintrag mit Beschreibung, Betrag, Typ und Datum")})]}),e.jsxs("div",{className:"px-5 pb-2 space-y-3",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium mb-1 block",children:a("finance.description","Beschreibung")}),e.jsx("input",{type:"text",id:"finance-description",placeholder:a("calendar.descriptionPlaceholder","z.B. Einkauf, Gehalt"),className:"w-full px-3 py-2 border border-border rounded-lg text-sm",autoFocus:!0})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"text-sm font-medium mb-1 block",children:[a("finance.amount","Betrag")," (CHF)"]}),e.jsx("input",{type:"number",id:"finance-amount",placeholder:"0.00",step:"0.01",className:"w-full px-3 py-2 border border-border rounded-lg text-sm"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium mb-1 block",children:a("finance.type","Typ")}),e.jsxs("select",{id:"finance-type",className:"w-full px-3 py-2 border border-border rounded-lg text-sm",children:[e.jsx("option",{value:"einnahme",children:a("finance.income","Einnahme")}),e.jsx("option",{value:"ausgabe",children:a("finance.expense","Ausgabe")})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium mb-1 block",children:a("reminders.dueDate","Datum")}),e.jsx("input",{type:"text",id:"finance-date",placeholder:"DD.MM.YYYY",value:ve,onChange:t=>{const n=t.target.value;L(n)},onBlur:t=>{const n=se(t.target.value);n?L(I(n)):t.target.value&&d&&L(I(d))},className:"w-full px-3 py-2 border border-border rounded-lg text-sm"})]})]}),e.jsxs(ne,{className:"px-5 pb-3 pt-2 gap-2",children:[e.jsx(D,{variant:"outline",onClick:()=>A(!1),className:"h-11 min-h-[44px] flex-1 rounded-xl text-sm font-medium",children:a("common.cancel","Abbrechen")}),e.jsx(D,{variant:"default",onClick:async()=>{try{const t=document.getElementById("finance-description"),n=document.getElementById("finance-amount"),c=document.getElementById("finance-type"),i=document.getElementById("finance-date");if(!t.value.trim()){E.error(a("calendar.errors.descriptionRequired","Bitte gib eine Beschreibung ein"));return}const l=se(i.value);if(!l){E.error(a("calendar.errors.invalidDate","Bitte gib ein gültiges Datum ein (DD.MM.YYYY)"));return}if(!n.value||parseFloat(n.value)<=0){E.error(a("calendar.errors.invalidAmount","Bitte gib einen gültigen Betrag ein"));return}await et({notes:t.value.trim(),amount:Math.round(parseFloat(n.value)*100),type:c.value,date:new Date(l),category:a("finance.categories.expense.other","Sonstiges"),currency:"CHF",isRecurring:!1}),E.success(a("calendar.financeEntryCreated","Finanz-Eintrag erstellt")),A(!1),F(!1),await P()}catch(t){E.error(t.message||a("calendar.errors.createFinanceEntryError","Fehler beim Erstellen des Finanz-Eintrags"))}},className:"h-11 min-h-[44px] flex-1 rounded-xl text-sm font-medium",children:a("common.create","Erstellen")})]})]})})]})}export{Fe as B,Ft as M,Mt as S,Pt as a};
