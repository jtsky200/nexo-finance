import{x as ks,y as Cs,j as e,I as V,S as ke,z as Ce,A as Se,E as Pe,F as f,B as w,D as Ss,o as Ps,p as Is,q as As,r as Fs,G as Ts,L as Ls,s as Es,H as Ie,J as A,K as v,M as g,g as ce,N as zs,O as Ds,Q as Ms,R as Et,w as Rs}from"./page-aichat-D58eS9Bi.js";import{useEffect as Ae,useState as l,useRef as L,useMemo as zt}from"react";import{M as Bs}from"./page-calendar-DDwRw0-e.js";import{t as n}from"./vendor-toast-CdQ6zwVl.js";import{m as oe}from"./vendor-firebase-B1cnVIMW.js";import{k as tt,p as de,T as st,X as B,V as Fe,Y as $s,N as Te,t as at,Z as qs,j as Le,O as Hs,_ as Ks,F as Os,q as rt,o as nt,h as Gs,z as Us,$ as Dt,a0 as _s,a1 as Vs,a2 as Qs}from"./vendor-misc-CBTJ0G7x.js";const Mt=["Lebensmittel","Getränke","Haushalt","Hygiene","Tierbedarf","Sonstiges"];function ua(){const{t:$}=ks();Ae(()=>{const t=document.createElement("style");return t.textContent=`
      @keyframes scan-line {
        0% { transform: translateY(0); opacity: 0.3; }
        50% { transform: translateY(100%); opacity: 1; }
        100% { transform: translateY(0); opacity: 0.3; }
      }
    `,document.head.appendChild(t),()=>{document.head.contains(t)&&document.head.removeChild(t)}},[]);const{data:me=[],isLoading:Rt,refetch:q}=Cs(),[lt,Ee]=l(!1),[it,ue]=l(!1),[p,Q]=l({name:"",quantity:"1",category:"Lebensmittel",store:""}),[x,E]=l([]),[ct,ot]=l(!1),[W,O]=l("camera"),[G,he]=l("receipt"),[b,H]=l(!1),[c,ze]=l(null),[y,U]=l([]),[k,z]=l([]),[Bt,D]=l(0),[C,xe]=l(null),[Y,Z]=l(1),[De,$t]=l(!0),[Me,qt]=l(!0),[Re,Ht]=l(!0),u=L(null),_=L(null),dt=L(null),[d,J]=l(null),[mt,Be]=l(!1),[X,$e]=l(null),[ut,ht]=l(!1),M=L(null),qe=L(null),[xt,ft]=l(null),fe=L(null),[gt,He]=l(!1),[Ke,Oe]=l(null),[Ge,bt]=l(!1),R=L(null),Ue=L(null),[pt,jt]=l(null),_e=zt(()=>me.filter(t=>t.status==="not_bought"),[me]),ge=zt(()=>me.filter(t=>t.status==="bought"),[me]),Kt=async()=>{if(!p.name.trim()){n.error("Bitte Artikelname eingeben");return}try{await Ie({item:p.name.trim(),quantity:parseInt(p.quantity)||1,category:p.category,estimatedPrice:0,currency:"CHF",store:p.store||null}),n.success("Artikel hinzugefügt"),A(),Ee(!1),Q({name:"",quantity:"1",category:"Lebensmittel",store:""}),await q()}catch(t){n.error("Fehler: "+v(t)),g()}},Ot=()=>{const t={store:"",items:[]};E([...x,t])},Gt=t=>{E(x.filter((s,a)=>a!==t))},Ut=(t,s)=>{const a=[...x];a[t].store=s,E(a)},_t=t=>{const s=[...x];s[t].items.push({id:Date.now().toString()+Math.random().toString(36).substr(2,9),name:"",quantity:"1",category:"Lebensmittel",price:"",articleNumber:"",productInfo:null,saveToDatabase:!1}),E(s)},Vt=(t,s)=>{const a=[...x];a[t].items=a[t].items.filter(r=>r.id!==s),E(a)},S=(t,s,a,r)=>{const o=[...x],i=o[t].items.findIndex(m=>m.id===s);i!==-1&&(o[t].items[i][a]=r,E(o))},Qt=(t,s)=>{$e({groupIndex:t,itemId:s}),Be(!0),setTimeout(()=>Wt(),100)},Wt=async()=>{try{if(!navigator.mediaDevices||!navigator.mediaDevices.getUserMedia){n.error("Kamera wird nicht unterstützt");return}const t=await navigator.mediaDevices.getUserMedia({video:{facingMode:"environment"}});ft(t),M.current&&(M.current.srcObject=t,await M.current.play()),ht(!0),Yt(),A()}catch(t){n.error("Kamera-Fehler: "+v(t)),g()}},Yt=()=>{if(!("BarcodeDetector"in window)){n.error("Barcode-Erkennung nicht unterstützt");return}const t=new window.BarcodeDetector({formats:["ean_13","ean_8","code_128","code_39","upc_a","upc_e"]});fe.current=setInterval(async()=>{if(!M.current||!qe.current||!ut)return;const s=M.current,a=qe.current,r=a.getContext("2d");if(!(!r||s.readyState!==4)){a.width=s.videoWidth,a.height=s.videoHeight,r.drawImage(s,0,0);try{const o=await t.detect(a);if(o.length>0){const i=o[0].rawValue;Nt(),X&&(S(X.groupIndex,X.itemId,"articleNumber",i),n.success(`Barcode gescannt: ${i}`),A(),await ss(X.groupIndex,X.itemId,i)),Be(!1),$e(null)}}catch{}}},500)},Nt=()=>{fe.current&&(clearInterval(fe.current),fe.current=null),xt&&(xt.getTracks().forEach(t=>t.stop()),ft(null)),M.current&&(M.current.srcObject=null),ht(!1)},Zt=()=>{Nt(),Be(!1),$e(null)},Jt=(t,s)=>{Oe({groupIndex:t,itemId:s}),He(!0),setTimeout(()=>Xt(),100)},Xt=async()=>{try{if(!navigator.mediaDevices||!navigator.mediaDevices.getUserMedia){n.error("Kamera wird nicht unterstützt");return}const t=await navigator.mediaDevices.getUserMedia({video:{facingMode:"environment"}});jt(t),R.current&&(R.current.srcObject=t,await R.current.play()),A()}catch(t){n.error("Kamera-Fehler: "+v(t)),g()}},es=async()=>{if(!(!R.current||!Ue.current||!Ke)){bt(!0);try{const t=R.current,s=Ue.current;s.width=t.videoWidth,s.height=t.videoHeight;const a=s.getContext("2d");if(a){a.drawImage(t,0,0);const r=s.toDataURL("image/jpeg");await as(Ke.groupIndex,Ke.itemId,r),wt(),He(!1),Oe(null)}}catch(t){n.error("Fehler beim Erfassen: "+v(t)),g()}finally{bt(!1)}}},wt=()=>{pt&&(pt.getTracks().forEach(t=>t.stop()),jt(null)),R.current&&(R.current.srcObject=null)},ts=()=>{wt(),He(!1),Oe(null)},ss=async(t,s,a)=>{try{if(!x[t]?.items.find(P=>P.id===s))return;const o=x[t]?.store||"",m=await oe(ce,"searchProductInfo")({articleNumber:a,store:o});m.data&&m.data.productInfo&&(S(t,s,"productInfo",m.data.productInfo),n.success("Produktinformationen gefunden"))}catch(r){console.log("Product info fetch failed:",r)}},as=async(t,s,a)=>{try{const r=x[t]?.items.find(P=>P.id===s);if(!r)return;const o=x[t]?.store||"",m=await oe(ce,"analyzeProductImage")({imageData:a,store:o,articleNumber:r.articleNumber});m.data&&m.data.productInfo?(S(t,s,"productInfo",m.data.productInfo),m.data.articleNumber&&!r.articleNumber&&S(t,s,"articleNumber",m.data.articleNumber),n.success("Produktinformationen erkannt"),A()):n.info("Keine Produktinformationen erkannt")}catch(r){n.error("Fehler bei Analyse: "+v(r)),g()}},rs=async(t,s)=>{Qt(t,s)},ns=async(t,s)=>{Jt(t,s)},ls=async()=>{try{let t=0;for(const s of x){if(!s.store){n.error("Bitte Laden für alle Gruppen angeben");return}for(const a of s.items){if(!a.name.trim()){n.error("Bitte Artikelname für alle Artikel eingeben");return}await Ie({item:a.name.trim(),quantity:parseInt(a.quantity)||1,category:a.category,estimatedPrice:parseFloat(a.price||"0")*100,currency:"CHF",store:s.store,articleNumber:a.articleNumber||null,productInfo:a.productInfo||null,saveToDatabase:a.saveToDatabase||!1}),t++}}n.success(`${t} Artikel hinzugefügt`),A(),ue(!1),E([]),await q()}catch(t){n.error("Fehler: "+v(t)),g()}},vt=async(t,s)=>{try{(s==="bought"?"not_bought":"bought")==="bought"?await zs(t):await Ds(t,{status:"not_bought"}),Ms(),await q()}catch(a){n.error(v(a)),g()}},is=async t=>{try{await Et(t),A(),await q()}catch(s){n.error(v(s)),g()}},cs=async()=>{try{for(const t of ge)await Et(t.id);n.success("Eingekaufte Artikel gelöscht"),A(),await q()}catch(t){n.error(v(t)),g()}},[Ws,ee]=l("idle"),[Ys,yt]=l(0),F=L(null),[Zs,os]=l({topLeft:{x:10,y:15},topRight:{x:90,y:15},bottomLeft:{x:10,y:75},bottomRight:{x:90,y:75}}),[Js,Xs]=l(null),[ea,ta]=l(!1),te=async()=>{try{if(!navigator.mediaDevices||!navigator.mediaDevices.getUserMedia){n.error("Kamera wird nicht unterstützt"),O("upload");return}d&&(d.getTracks().forEach(a=>{a.stop()}),J(null),await new Promise(a=>setTimeout(a,100))),u.current&&(u.current.srcObject=null);let t=null,s={video:{facingMode:"environment",width:{ideal:3840},height:{ideal:2160},aspectRatio:{ideal:16/9}},audio:!1};try{t=await navigator.mediaDevices.getUserMedia(s)}catch{s={video:{facingMode:"environment",width:{ideal:1920},height:{ideal:1080}},audio:!1};try{t=await navigator.mediaDevices.getUserMedia(s)}catch{t=await navigator.mediaDevices.getUserMedia({video:{facingMode:"environment"},audio:!1})}}if(!t||t.getVideoTracks().length===0)throw new Error("Kein Kamera-Stream erhalten");if(J(t),ee("scanning"),await new Promise(a=>setTimeout(a,50)),u.current){const a=u.current;a.srcObject=t,await new Promise((r,o)=>{const i=setTimeout(()=>{o(new Error("Video-Timeout"))},5e3),m=()=>{clearTimeout(i),a.removeEventListener("loadedmetadata",m),a.removeEventListener("error",P),r()},P=Ze=>{clearTimeout(i),a.removeEventListener("loadedmetadata",m),a.removeEventListener("error",P),o(new Error("Video-Fehler"))};if(a.readyState>=2){clearTimeout(i),r();return}a.addEventListener("loadedmetadata",m,{once:!0}),a.addEventListener("error",P,{once:!0})});try{await a.play(),n.success("Kamera aktiv"),kt()}catch{n.success("Kamera aktiv"),kt()}}}catch(t){d&&(d.getTracks().forEach(r=>r.stop()),J(null)),u.current&&(u.current.srcObject=null);const s=t;let a="Kamera-Fehler";s.name==="NotAllowedError"||s.name==="PermissionDeniedError"?a="Kamera-Berechtigung verweigert. Bitte in den Browser-Einstellungen erlauben.":s.name==="NotFoundError"||s.name==="DevicesNotFoundError"?a="Keine Kamera gefunden":s.name==="NotReadableError"||s.name==="TrackStartError"?a="Kamera wird bereits verwendet":s.name==="OverconstrainedError"||s.name==="ConstraintNotSatisfiedError"?a="Kamera-Unterstützung nicht verfügbar":s.message==="Video-Timeout"?a="Kamera-Initialisierung zu langsam":a=`Kamera-Fehler: ${s.message||s.name}`,n.error(a),O("upload"),ee("idle")}},Ve=()=>{F.current&&(cancelAnimationFrame(F.current),F.current=null),d&&(d.getTracks().forEach(t=>t.stop()),J(null)),ee("idle"),yt(0)},kt=()=>{os({topLeft:{x:15,y:10},topRight:{x:85,y:10},bottomLeft:{x:15,y:85},bottomRight:{x:85,y:85}}),ee("scanning"),yt(0)},ds=()=>{if(!u.current||!_.current)return;F.current&&(cancelAnimationFrame(F.current),F.current=null),ee("capturing");const t=u.current,s=_.current;s.width=t.videoWidth,s.height=t.videoHeight;const a=s.getContext("2d");a&&(a.imageSmoothingEnabled=!1,a.drawImage(t,0,0),n.success("Foto aufgenommen!"),s.toBlob(async r=>{if(r){Ve();const o=new File([r],"photo.jpg",{type:"image/jpeg"});await Ct(o)}},"image/jpeg",1))};Ae(()=>()=>{!d&&u.current&&u.current.srcObject&&(u.current.srcObject.getTracks().forEach(s=>s.stop()),u.current.srcObject=null)},[d]),Ae(()=>()=>{F.current&&(cancelAnimationFrame(F.current),F.current=null),d&&(d.getTracks().forEach(t=>t.stop()),J(null)),u.current&&(u.current.srcObject=null)},[]);const ms=async t=>{const s=t.target.files?.[0];s&&await Ct(s)},Ct=async t=>{H(!0),U([]),ze(null);try{const s=new FileReader;s.onload=async()=>{try{const a=s.result.split(",")[1];n.info("Analysiere mit OCR...");const i=(await oe(ce,"analyzeReceipt")({fileData:a,fileType:t.type||"image/jpeg",fileName:t.name||"photo.jpg"})).data;i.success&&i.items&&i.items.length>0?(ze({store:i.store||{name:"Unbekannt"},purchase:i.purchase||{},items:i.items,totals:i.totals||{total:0},confidence:i.confidence||50}),U(i.items.map(m=>({...m,selected:!0}))),n.success(`${i.items.length} Artikel erkannt!`)):i.error?.includes("Vision API")||i.error?.includes("PERMISSION_DENIED")?n.error("OCR nicht verfügbar. Google Cloud Vision API muss aktiviert werden.",{duration:5e3}):i.error?.includes("billing")?n.error("Google Cloud Billing erforderlich",{duration:5e3}):i.rawText?n.error("Text erkannt aber keine Artikel gefunden. Versuche bessere Bildqualität.",{duration:4e3}):n.error(i.error||"Keine Artikel erkannt. Bitte bessere Bildqualität verwenden.",{duration:4e3})}catch(a){n.error(v(a)),g()}H(!1)},s.onerror=()=>{n.error("Datei konnte nicht gelesen werden"),g(),H(!1)},s.readAsDataURL(t)}catch(s){n.error(v(s)),g(),H(!1)}},[Qe,se]=l(null),[j,St]=l(!1),[be,pe]=l(null),[us,hs]=l(0),[We,ae]=l(new Set),[sa,xs]=l([]),Ye=async()=>{if(!u.current||!_.current||b)return;const t=Date.now();if(t-us<1500)return;hs(t),H(!0),se(null);const s=u.current,a=_.current,r=s.videoWidth||1920,o=s.videoHeight||1080,i=Math.max(r,1920),m=Math.max(o,1080);a.width=i,a.height=m;const P=a.getContext("2d",{willReadFrequently:!0,alpha:!1});P&&(P.drawImage(s,0,0,r,o,0,0,i,m),a.toBlob(async Ze=>{if(Ze)try{const je=new FileReader;je.onload=async()=>{const ys=je.result.split(",")[1];try{const ne=(await oe(ce,"analyzeReceipt")({fileData:ys,fileType:"image/jpeg",fileName:"live-scan-full.jpg"})).data;if(ne.success&&ne.items&&ne.items.length>0){const Je=(ne.rawText||"").split(/[\n\r]+/),Ne=ne.items.map((h,T)=>{const we=(h.name||"Unbekannt").toLowerCase().trim(),le=(h.unitPrice||h.totalPrice||0).toFixed(2),K=h.articleNumber||"";let ie=-1;for(let I=0;I<Je.length;I++)if(Je[I].includes(h.name||"")||K&&Je[I].includes(K)){ie=I;break}const N=`${we}_${le}_${K}_${ie>=0?ie:T}_${T}`;return{item:{name:h.name||"Unbekannt",articleNumber:h.articleNumber,quantity:h.quantity||1,unitPrice:h.unitPrice||h.totalPrice||0,totalPrice:h.totalPrice||h.unitPrice*(h.quantity||1),selected:!0},positionId:N}}).filter(({positionId:h})=>!We.has(h));if(Ne.length>0){const h=new Set(We);Ne.forEach(({positionId:T})=>{h.add(T)}),ae(h),z(T=>{const we=new Set(T.map(N=>{const I=N.name.toLowerCase().trim(),ve=N.unitPrice.toFixed(2),Xe=N.articleNumber||"";return`${I}_${ve}_${Xe}`})),le=[...T];let K=0;Ne.forEach(({item:N,positionId:I})=>{const ve=N.name.toLowerCase().trim(),Xe=N.unitPrice.toFixed(2),et=N.articleNumber||"",Lt=`${ve}_${Xe}_${et}`;we.has(Lt)||et&&T.some(ye=>ye.articleNumber===et)||T.some(ye=>ye.name.toLowerCase().trim()===ve&&Math.abs(ye.unitPrice-N.unitPrice)<.01)||(le.push(N),K++,we.add(Lt))});const ie=le.reduce((N,I)=>N+I.totalPrice,0);return D(ie),K>0?(n.success(`${K} neue Artikel erkannt!`,{duration:1500}),navigator.vibrate&&navigator.vibrate(200)):Ne.length>0&&(j||n.info("Alle Artikel bereits in Liste",{duration:1e3})),le})}else j||n.info("Alle Artikel bereits erkannt",{duration:1e3})}else j||se("Keine Artikel erkannt")}catch(Ft){if(!j){const Tt=v(Ft);se(Tt)}g()}H(!1)},je.readAsDataURL(Ze)}catch{g(),H(!1)}},"image/jpeg",.95))};Ae(()=>{if(j&&d&&G==="single"){const t=setTimeout(()=>{!b&&d&&Ye()},500),s=setInterval(()=>{!b&&d&&Ye()},2e3);return pe(s),()=>{clearInterval(s),clearTimeout(t),pe(null)}}else be&&(clearInterval(be),pe(null))},[j,d,G,b]);const fs=async()=>{await Ye()},gs=()=>{if(!C)return;const t={...C,quantity:Y,totalPrice:C.unitPrice*Y};z(s=>[...s,t]),D(s=>s+t.totalPrice),xe(null),Z(1),n.success(`${t.name} (${Y}x) hinzugefügt`),A()},bs=()=>{xe(null),Z(1)},Pt=t=>{z(s=>{const a=s[t];return D(r=>r-a.totalPrice),s.filter((r,o)=>o!==t)})},It=(t,s)=>{if(s<1){Pt(t);return}z(a=>{const r=[...a],o=r[t],i=o.totalPrice;return r[t]={...o,quantity:s,totalPrice:o.unitPrice*s},D(m=>m-i+r[t].totalPrice),r})},ps=async()=>{if(k.length===0){n.error("Keine Artikel gescannt");return}try{for(const t of k)await Ie({item:t.name,quantity:t.quantity||1,category:At(t.name),estimatedPrice:(t.totalPrice||t.unitPrice||0)*100,currency:"CHF",store:c?.store?.name||null});n.success(`${k.length} Artikel hinzugefügt!`),z([]),D(0),re(),await q()}catch(t){n.error("Fehler: "+t.message)}},js=async()=>{const t=y.filter(s=>s.selected);if(t.length===0){n.error("Bitte mindestens einen Artikel auswählen");return}try{for(const s of t)await Ie({item:s.name,quantity:s.quantity||1,category:At(s.name),estimatedPrice:(s.totalPrice||s.unitPrice||0)*100,currency:"CHF",store:c?.store?.name||null});n.success(`${t.length} Artikel hinzugefügt!`),re(),await q()}catch(s){n.error("Fehler: "+s.message)}},Ns=async()=>{if(c)try{await oe(ce,"saveReceipt")({receiptData:c}),n.success("Quittung gespeichert!")}catch(t){n.error("Fehler: "+t.message)}},ws=async()=>{if(c)try{await Rs({type:"ausgabe",amount:c.totals.total*100,category:"Lebensmittel",notes:`Einkauf bei ${c.store.name}`,date:c.purchase.date||new Date().toISOString().split("T")[0],paymentMethod:c.purchase.paymentMethod||"Karte",currency:"CHF",isRecurring:!1}),n.success("Zu Finanzen hinzugefügt!"),A(),re()}catch(t){n.error(v(t)),g()}},At=t=>{const s=t.toLowerCase(),a={Getränke:["bier","wein","saft","wasser","cola","fanta","sprite","energy","shot","drink"],"Obst & Gemüse":["apfel","orange","banane","tomate","salat","gurke","karotte","bio oran","gemüse"],Milchprodukte:["milch","joghurt","käse","butter","sahne","quark","naturejog"],Fleisch:["fleisch","steak","wurst","schinken","poulet","rind","schwein","ragout"],Backwaren:["brot","brötchen","toast","croissant","kuchen","keks","butterkeks"],Süsswaren:["schoko","bonbon","gummi","chips","zucker","gelatine"]};for(const[r,o]of Object.entries(a))if(o.some(i=>s.includes(i)))return r;return"Lebensmittel"},vs=()=>{ot(!0),U([]),O("camera"),setTimeout(()=>te(),100)},re=()=>{Ve(),ot(!1),U([]),ze(null),z([]),D(0),he("receipt"),xe(null),Z(1),se(null),St(!1),ae(new Set),xs([]),be&&(clearInterval(be),pe(null))};return e.jsxs(Bs,{title:$("nav.shopping","Einkaufsliste"),showSidebar:!0,children:[e.jsxs("div",{className:"mobile-card mb-4 bg-primary text-primary-foreground",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-3",children:[e.jsx(tt,{className:"w-6 h-6 opacity-70"}),e.jsx("p",{className:"text-sm opacity-70 font-medium",children:$("shopping.list","Einkaufsliste")})]}),e.jsx("p",{className:"text-3xl font-semibold mb-2",children:_e.length}),e.jsx("p",{className:"text-sm opacity-60",children:$("shopping.itemsOpen","Artikel offen")})]}),Rt?e.jsx("div",{className:"text-center py-8 text-muted-foreground",children:$("common.loading","Laden...")}):_e.length===0?e.jsxs("div",{className:"mobile-card text-center py-8",children:[e.jsx(de,{className:"w-10 h-10 mx-auto status-success mb-2"}),e.jsx("p",{className:"text-muted-foreground",children:$("shopping.empty","Liste ist leer")})]}):e.jsx("div",{className:"space-y-3 mb-4",children:_e.map(t=>e.jsxs("div",{className:"mobile-card flex items-center gap-4 py-3",children:[e.jsx("button",{onClick:()=>vt(t.id,t.status),className:"w-6 h-6 rounded border-2 border-border flex items-center justify-center shrink-0"}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("p",{className:"font-medium truncate",children:t.item}),e.jsxs("p",{className:"text-xs text-muted-foreground",children:[t.quantity>1&&`${t.quantity}x • `,t.category,t.store&&` • ${t.store}`]})]}),e.jsx("button",{onClick:()=>is(t.id),className:"w-10 h-10 rounded-lg flex items-center justify-center text-muted-foreground active:opacity-80",children:e.jsx(st,{className:"w-4 h-4"})})]},t.id))}),ge.length>0&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsxs("p",{className:"text-xs font-medium text-muted-foreground uppercase tracking-wider",children:[$("shopping.bought","Eingekauft")," (",ge.length,")"]}),e.jsx("button",{onClick:cs,className:"text-xs status-error active:opacity-80",children:$("shopping.clearBought","Löschen")})]}),e.jsx("div",{className:"space-y-3 opacity-60",children:ge.map(t=>e.jsxs("div",{className:"mobile-card flex items-center gap-4 py-3",children:[e.jsx("button",{onClick:()=>vt(t.id,t.status),className:"w-6 h-6 rounded bg-status-success flex items-center justify-center shrink-0",children:e.jsx(de,{className:"w-4 h-4 status-success"})}),e.jsx("p",{className:"font-medium line-through flex-1 truncate",children:t.item})]},t.id))})]}),lt&&e.jsx("div",{className:"fixed inset-0 z-50 bg-black/50 flex items-end",children:e.jsxs("div",{className:"bg-background w-full rounded-t-2xl p-6 safe-bottom animate-in slide-in-from-bottom",children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsx("h2",{className:"text-lg font-semibold",children:"Artikel hinzufügen"}),e.jsx("button",{onClick:()=>Ee(!1),className:"w-10 h-10 rounded-lg bg-muted flex items-center justify-center",children:e.jsx(B,{className:"w-5 h-5"})})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsx("div",{children:e.jsx(V,{value:p.name,onChange:t=>Q({...p,name:t.target.value}),placeholder:"Artikelname",className:"mobile-input",autoFocus:!0})}),e.jsxs("div",{className:"flex gap-3",children:[e.jsx("div",{className:"w-20",children:e.jsx(V,{type:"number",value:p.quantity,onChange:t=>Q({...p,quantity:t.target.value}),placeholder:"1",className:"mobile-input text-center",min:"1"})}),e.jsx("div",{className:"flex-1",children:e.jsxs(ke,{value:p.category,onValueChange:t=>Q({...p,category:t}),children:[e.jsx(Ce,{className:"mobile-input",children:e.jsx(Se,{})}),e.jsx(Pe,{children:Mt.map(t=>e.jsx(f,{value:t,children:t},t))})]})})]}),e.jsx("div",{children:e.jsxs(ke,{value:p.store||"none",onValueChange:t=>Q({...p,store:t==="none"?"":t}),children:[e.jsx(Ce,{className:"mobile-input",children:e.jsx(Se,{placeholder:"Laden (optional)"})}),e.jsxs(Pe,{children:[e.jsx(f,{value:"none",children:"Kein Laden"}),e.jsx(f,{value:"Migros",children:"Migros"}),e.jsx(f,{value:"Coop",children:"Coop"}),e.jsx(f,{value:"Aldi",children:"Aldi"}),e.jsx(f,{value:"Lidl",children:"Lidl"}),e.jsx(f,{value:"Denner",children:"Denner"})]})]})}),e.jsx(w,{onClick:Kt,className:"w-full mobile-btn bg-primary text-primary-foreground mt-4",children:"Hinzufügen"})]})]})}),e.jsx(Ss,{open:it,onOpenChange:ue,children:e.jsxs(Ps,{className:"!fixed !top-[50%] !left-[50%] !right-auto !bottom-auto !translate-x-[-50%] !translate-y-[-50%] !w-[90vw] !max-w-2xl !max-h-[90vh] !rounded-3xl !m-0 !overflow-hidden !shadow-2xl !flex !flex-col",children:[e.jsxs(Is,{className:"px-5 pt-5 pb-3 flex-shrink-0",children:[e.jsx(As,{className:"text-lg font-semibold",children:"Mehrere Artikel hinzufügen"}),e.jsx(Fs,{className:"sr-only",children:"Fügen Sie mehrere Artikel gruppiert nach Laden hinzu"})]}),e.jsxs("div",{className:"px-5 pb-2 overflow-y-auto flex-1 min-h-0 space-y-4",children:[x.length===0&&e.jsxs("div",{className:"text-center py-8 text-muted-foreground",children:[e.jsx(Fe,{className:"w-12 h-12 mx-auto mb-3 opacity-50"}),e.jsx("p",{children:"Keine Laden-Gruppen vorhanden"}),e.jsx("p",{className:"text-sm mt-1",children:'Klicken Sie auf "Laden hinzufügen" um zu beginnen'})]}),x.map((t,s)=>e.jsxs("div",{className:"border rounded-xl p-4 space-y-3 bg-muted/30",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Fe,{className:"w-4 h-4 text-muted-foreground"}),e.jsxs(ke,{value:t.store||"none",onValueChange:a=>Ut(s,a==="none"?"":a),children:[e.jsx(Ce,{className:"flex-1 h-9",children:e.jsx(Se,{placeholder:"Laden wählen"})}),e.jsxs(Pe,{children:[e.jsx(f,{value:"none",children:"Laden wählen"}),e.jsx(f,{value:"Migros",children:"Migros"}),e.jsx(f,{value:"Coop",children:"Coop"}),e.jsx(f,{value:"Aldi",children:"Aldi"}),e.jsx(f,{value:"Lidl",children:"Lidl"}),e.jsx(f,{value:"Denner",children:"Denner"}),e.jsx(f,{value:"Volg",children:"Volg"}),e.jsx(f,{value:"Spar",children:"Spar"})]})]}),e.jsx(w,{variant:"ghost",size:"sm",onClick:()=>Gt(s),className:"h-9 w-9 p-0",children:e.jsx(B,{className:"w-4 h-4"})})]}),e.jsxs("div",{className:"space-y-2",children:[t.items.map(a=>e.jsx("div",{className:"bg-background rounded-lg p-3 space-y-2 border",children:e.jsxs("div",{className:"flex items-start gap-2",children:[e.jsxs("div",{className:"flex-1 space-y-2",children:[e.jsxs("div",{className:"flex gap-2",children:[e.jsx(V,{placeholder:"Artikelname *",value:a.name,onChange:r=>S(s,a.id,"name",r.target.value),className:"flex-1 h-9"}),e.jsx(V,{type:"number",placeholder:"Menge",value:a.quantity,onChange:r=>S(s,a.id,"quantity",r.target.value),className:"w-20 h-9",min:"1"})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(ke,{value:a.category,onValueChange:r=>S(s,a.id,"category",r),children:[e.jsx(Ce,{className:"flex-1 h-9",children:e.jsx(Se,{})}),e.jsx(Pe,{children:Mt.map(r=>e.jsx(f,{value:r,children:r},r))})]}),e.jsx(V,{type:"number",step:"0.01",placeholder:"Preis (CHF)",value:a.price,onChange:r=>S(s,a.id,"price",r.target.value),className:"w-24 h-9"})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(V,{placeholder:"Artikelnummer (EAN/Barcode)",value:a.articleNumber,onChange:r=>S(s,a.id,"articleNumber",r.target.value),className:"flex-1 h-9"}),e.jsx(w,{variant:"outline",size:"sm",onClick:()=>rs(s,a.id),className:"h-9",title:"Barcode scannen",children:e.jsx($s,{className:"w-4 h-4"})}),e.jsx(w,{variant:"outline",size:"sm",onClick:()=>ns(s,a.id),className:"h-9",title:"Produktinfo scannen",children:e.jsx(Te,{className:"w-4 h-4"})})]}),a.productInfo&&e.jsxs("div",{className:"bg-muted/50 rounded p-2 text-xs space-y-1",children:[a.productInfo.brand&&e.jsxs("p",{children:[e.jsx("strong",{children:"Marke:"})," ",a.productInfo.brand]}),a.productInfo.description&&e.jsxs("p",{children:[e.jsx("strong",{children:"Beschreibung:"})," ",a.productInfo.description]}),a.productInfo.price&&e.jsxs("p",{children:[e.jsx("strong",{children:"Preis:"})," CHF ",a.productInfo.price]}),a.productInfo.imageUrl&&e.jsx("img",{src:a.productInfo.imageUrl,alt:"Produkt",className:"w-full h-24 object-contain mt-2 rounded"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Ts,{checked:a.saveToDatabase||!1,onCheckedChange:r=>S(s,a.id,"saveToDatabase",r)}),e.jsx(Ls,{className:"text-xs",children:"Für zukünftige Käufe speichern"})]})]}),e.jsx(w,{variant:"ghost",size:"sm",onClick:()=>Vt(s,a.id),className:"h-9 w-9 p-0",children:e.jsx(st,{className:"w-4 h-4"})})]})},a.id)),e.jsxs(w,{variant:"outline",size:"sm",onClick:()=>_t(s),className:"w-full h-9",children:[e.jsx(at,{className:"w-4 h-4 mr-2"}),"Artikel hinzufügen"]})]})]},s)),e.jsxs(w,{variant:"outline",onClick:Ot,className:"w-full",children:[e.jsx(Fe,{className:"w-4 h-4 mr-2"}),"Laden hinzufügen"]})]}),e.jsxs(Es,{className:"px-5 pb-3 pt-2 gap-2.5 flex-shrink-0",children:[e.jsx(w,{variant:"outline",onClick:()=>{ue(!1),E([])},className:"h-11 min-h-[44px] flex-1 rounded-xl text-sm font-medium",children:"Abbrechen"}),e.jsxs(w,{onClick:ls,disabled:x.length===0||x.every(t=>t.items.length===0),className:"h-11 min-h-[44px] flex-1 rounded-xl text-sm font-medium",children:[x.reduce((t,s)=>t+s.items.length,0)," Artikel hinzufügen"]})]})]})}),ct&&e.jsxs("div",{className:"fixed inset-0 z-50 bg-black flex flex-col",children:[e.jsxs("div",{className:"flex items-center justify-between p-4 bg-black/50",children:[e.jsx("h2",{className:"text-white font-semibold",children:"Liste scannen"}),e.jsx("button",{onClick:re,className:"w-10 h-10 rounded-lg bg-white/20 flex items-center justify-center",children:e.jsx(B,{className:"w-5 h-5 text-white"})})]}),e.jsxs("div",{className:"flex gap-2 px-4 py-2",children:[e.jsxs("button",{onClick:()=>{he("receipt"),O("camera"),te()},className:`flex-1 py-2 px-3 rounded-lg flex items-center justify-center gap-1.5 text-sm ${G==="receipt"&&W==="camera"?"bg-white text-black":"bg-white/20 text-white"}`,children:[e.jsx(qs,{className:"w-4 h-4"}),"Quittung"]}),e.jsxs("button",{onClick:async()=>{he("single"),O("camera"),z([]),D(0),ae(new Set),xe(null),se(null),await te()},className:`flex-1 py-2 px-3 rounded-lg flex items-center justify-center gap-1.5 text-sm ${G==="single"?"bg-white text-black":"bg-white/20 text-white"}`,children:[e.jsx(Le,{className:"w-4 h-4"}),"Einzeln"]}),e.jsxs("button",{onClick:()=>{he("receipt"),O("upload"),Ve()},className:`flex-1 py-2 px-3 rounded-lg flex items-center justify-center gap-1.5 text-sm ${W==="upload"?"bg-white text-black":"bg-white/20 text-white"}`,children:[e.jsx(Hs,{className:"w-4 h-4"}),"Upload"]})]}),W==="camera"&&G==="receipt"&&y.length===0&&e.jsxs("div",{className:"flex-1 relative",children:[e.jsx("video",{ref:u,autoPlay:!0,playsInline:!0,muted:!0,preload:"auto",className:"absolute inset-0 w-full h-full object-cover"}),e.jsx("canvas",{ref:_,className:"hidden"}),d&&e.jsxs("div",{className:"absolute inset-0 pointer-events-none",children:[e.jsx("div",{className:"absolute inset-8 border-2 border-white/60 rounded-lg"}),e.jsx("div",{className:"absolute top-8 left-8 w-6 h-6 border-t-4 border-l-4 border-white rounded-tl"}),e.jsx("div",{className:"absolute top-8 right-8 w-6 h-6 border-t-4 border-r-4 border-white rounded-tr"}),e.jsx("div",{className:"absolute bottom-8 left-8 w-6 h-6 border-b-4 border-l-4 border-white rounded-bl"}),e.jsx("div",{className:"absolute bottom-8 right-8 w-6 h-6 border-b-4 border-r-4 border-white rounded-br"})]}),e.jsx("div",{className:"absolute top-4 left-4 right-4 z-20",children:e.jsx("div",{className:"bg-black/60 rounded-lg p-3 text-center",children:e.jsx("p",{className:"text-white text-sm font-medium",children:b?"Analysiere...":"Quittung fotografieren"})})}),e.jsx("div",{className:"absolute bottom-8 left-0 right-0 z-20",children:d?e.jsxs("div",{className:"flex justify-center items-center gap-4",children:[e.jsx("button",{onClick:re,className:"w-12 h-12 rounded-full bg-white/20 flex items-center justify-center active:opacity-80",children:e.jsx(B,{className:"w-6 h-6 text-white"})}),e.jsx("button",{onClick:ds,disabled:b,className:"w-20 h-20 rounded-full bg-white shadow-lg flex items-center justify-center active:opacity-80 border-4 border-white/50",children:b?e.jsx("div",{className:"w-8 h-8 border-3 border-gray-300 border-t-gray-600 rounded-full animate-spin"}):e.jsx("div",{className:"w-14 h-14 rounded-full bg-white"})}),e.jsx("div",{className:"w-12 h-12"})]}):e.jsx("div",{className:"flex justify-center",children:e.jsxs("button",{onClick:te,className:"px-6 py-3 rounded-full bg-white shadow-lg flex items-center justify-center gap-2 active:opacity-80",children:[e.jsx(Te,{className:"w-5 h-5 text-gray-800"}),e.jsx("span",{className:"font-medium text-gray-800",children:"Kamera starten"})]})})})]}),W==="camera"&&G==="single"&&e.jsxs("div",{className:"flex-1 flex flex-col bg-background w-full h-full overflow-hidden",children:[e.jsx("div",{className:"w-full px-4 py-3 bg-background/95 backdrop-blur-sm border-b border-border/50 flex-shrink-0",children:e.jsxs("div",{className:"flex items-center justify-between gap-3",children:[e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[e.jsx("div",{className:`w-2 h-2 rounded-full ${d?"bg-green-500 animate-pulse":"bg-gray-400"}`}),e.jsx("p",{className:"text-xs font-medium text-muted-foreground",children:d?"Kamera aktiv":"Kamera inaktiv"})]}),e.jsx("p",{className:"text-sm font-bold truncate",children:b?"Analysiere...":j?`${We.size} Positionen erkannt`:k.length>0?`${k.length} Artikel gescannt`:"Bereit zum Scannen"})]}),e.jsxs("button",{onClick:()=>St(!j),disabled:!d,className:`px-3 py-2 rounded-lg flex items-center gap-1.5 flex-shrink-0 transition-all ${j&&d?"bg-green-500 text-white shadow-lg":"bg-muted text-muted-foreground"} ${d?"":"opacity-50"}`,children:[e.jsx("div",{className:`w-2 h-2 rounded-full ${j&&d?"bg-white":"bg-foreground/50"}`}),e.jsx("span",{className:"text-xs font-semibold",children:"Auto"})]})]})}),e.jsxs("div",{className:"flex-1 flex flex-col w-full overflow-hidden min-h-0 relative",children:[e.jsxs("div",{className:"relative bg-black w-full flex-1 flex-shrink-0 min-h-0",children:[e.jsx("video",{ref:u,autoPlay:!0,playsInline:!0,muted:!0,preload:"auto",className:"absolute inset-0 w-full h-full object-cover",style:{minWidth:"100%",minHeight:"100%"}}),e.jsx("canvas",{ref:_,className:"hidden"}),d&&j&&e.jsxs("div",{className:"absolute inset-0 pointer-events-none",children:[b&&e.jsx("div",{className:"absolute left-0 right-0 h-1 bg-green-500/50",style:{top:"50%",animation:"scan-line 1.5s ease-in-out infinite",boxShadow:"0 0 20px rgba(16, 185, 129, 0.6)",transform:"translateY(-50%)"}}),e.jsx("div",{className:"absolute top-4 left-1/2 transform -translate-x-1/2 z-10",children:e.jsxs("div",{className:"bg-green-500/90 backdrop-blur-sm text-white px-4 py-2 rounded-full text-xs font-semibold flex items-center gap-2 shadow-lg",children:[e.jsx("div",{className:"w-2 h-2 bg-white rounded-full animate-pulse"}),b?"Analysiere...":`Live-Scan (${k.length} Artikel)`]})})]}),d&&!j&&e.jsx("div",{className:"absolute top-4 left-1/2 transform -translate-x-1/2 z-10",children:e.jsx("div",{className:"bg-black/60 backdrop-blur-sm text-white px-4 py-2 rounded-full text-xs font-medium",children:"Quittung vollständig sichtbar machen"})}),d&&!C&&e.jsx("div",{className:"absolute bottom-0 left-0 right-0 z-20 p-4 bg-gradient-to-t from-black/80 via-black/40 to-transparent",children:e.jsx("button",{onClick:fs,disabled:b,className:`w-full py-4 rounded-xl shadow-2xl flex items-center justify-center gap-3 transition-all transform ${b?"bg-gray-600/90":"bg-green-500 hover:bg-green-600 active:scale-95"}`,children:b?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"w-6 h-6 border-2 border-white/30 border-t-white rounded-full animate-spin"}),e.jsx("span",{className:"font-bold text-white text-lg",children:"Analysiere..."})]}):e.jsxs(e.Fragment,{children:[e.jsx(Le,{className:"w-6 h-6 text-white"}),e.jsx("span",{className:"font-bold text-white text-lg",children:"ALLE SCANNEN"})]})})}),!d&&e.jsxs("div",{className:"absolute inset-0 flex flex-col items-center justify-center bg-gradient-to-b from-black/90 to-black/70",children:[e.jsxs("div",{className:"text-center mb-8",children:[e.jsx("div",{className:"w-20 h-20 mx-auto mb-4 rounded-full bg-white/10 backdrop-blur-sm flex items-center justify-center",children:e.jsx(Te,{className:"w-10 h-10 text-white"})}),e.jsx("p",{className:"text-white text-lg font-semibold mb-2",children:"Kamera starten"}),e.jsx("p",{className:"text-white/70 text-sm",children:"Für das Scannen von Quittungen"})]}),e.jsxs("button",{onClick:te,className:"px-8 py-4 rounded-xl bg-white shadow-2xl flex items-center justify-center gap-3 hover:bg-gray-50 active:scale-95 transition-all",children:[e.jsx(Te,{className:"w-6 h-6 text-gray-800"}),e.jsx("span",{className:"font-bold text-gray-800 text-base",children:"Kamera aktivieren"})]})]})]}),e.jsxs("div",{className:"flex-1 overflow-y-auto bg-background w-full p-4 min-h-0",children:[Qe&&!C&&e.jsxs("div",{className:"mb-4 p-4 bg-red-500/10 border border-red-500/30 rounded-xl backdrop-blur-sm",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx("div",{className:"w-2 h-2 rounded-full bg-red-500"}),e.jsx("p",{className:"text-red-600 font-semibold text-sm",children:"Fehler"})]}),e.jsx("p",{className:"text-red-600 font-medium text-center text-sm",children:Qe}),e.jsx("p",{className:"text-red-500/70 text-xs text-center mt-1",children:"Quittung näher halten und erneut scannen"})]}),C&&e.jsxs("div",{className:"mb-4 p-5 bg-green-500/10 border border-green-500/40 rounded-xl backdrop-blur-sm",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-3",children:[e.jsx("div",{className:"w-2 h-2 rounded-full bg-green-500 animate-pulse"}),e.jsx("p",{className:"text-green-600 font-bold text-sm",children:"ERKANNT"})]}),e.jsxs("div",{className:"bg-background/80 backdrop-blur-sm rounded-lg p-4 mb-4 border border-border/50",children:[e.jsx("p",{className:"font-bold text-base mb-1",children:C.name}),e.jsxs("p",{className:"text-xs text-muted-foreground",children:["CHF ",C.unitPrice.toFixed(2)," pro Stück"]})]}),e.jsxs("div",{className:"flex items-center justify-center gap-4 mb-4",children:[e.jsx("button",{onClick:()=>Z(t=>Math.max(1,t-1)),className:"w-11 h-11 rounded-full bg-muted flex items-center justify-center text-xl font-bold active:scale-95 transition-transform",children:"−"}),e.jsx("div",{className:"w-16 h-11 rounded-lg bg-background border border-border flex items-center justify-center",children:e.jsx("span",{className:"text-2xl font-bold",children:Y})}),e.jsx("button",{onClick:()=>Z(t=>t+1),className:"w-11 h-11 rounded-full bg-muted flex items-center justify-center text-xl font-bold active:scale-95 transition-transform",children:"+"})]}),e.jsxs("div",{className:"text-center mb-4 p-3 bg-background/50 rounded-lg border border-border/50",children:[e.jsx("p",{className:"text-xs text-muted-foreground mb-1",children:"Total"}),e.jsxs("p",{className:"text-xl font-bold",children:["CHF ",(C.unitPrice*Y).toFixed(2)]})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs("button",{onClick:bs,className:"flex-1 py-3 rounded-lg bg-muted flex items-center justify-center gap-2 text-sm font-semibold active:scale-95 transition-transform",children:[e.jsx(B,{className:"w-4 h-4"}),"Abbrechen"]}),e.jsxs("button",{onClick:gs,className:"flex-1 py-3 rounded-lg bg-green-500 text-white flex items-center justify-center gap-2 text-sm font-semibold shadow-lg active:scale-95 transition-transform",children:[e.jsx(de,{className:"w-4 h-4"}),"Hinzufügen"]})]})]}),!C&&k.length===0&&!Qe&&e.jsxs("div",{className:"text-center py-8",children:[e.jsx("div",{className:"w-16 h-16 mx-auto mb-4 rounded-full bg-muted/50 flex items-center justify-center",children:e.jsx(Le,{className:"w-8 h-8 text-muted-foreground/40"})}),e.jsx("p",{className:"text-base font-bold text-foreground mb-2",children:"Artikel scannen"}),e.jsx("p",{className:"text-xs text-muted-foreground/70 px-4",children:j?e.jsx(e.Fragment,{children:"Auto-Scan aktiv: Quittung in den Rahmen halten"}):e.jsx(e.Fragment,{children:'Quittung in den Rahmen halten und "ALLE SCANNEN" drücken'})})]}),k.length>0&&e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center justify-between mb-3 p-3 bg-green-500/10 rounded-xl border border-green-500/30 backdrop-blur-sm",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-8 h-8 rounded-full bg-green-500/20 flex items-center justify-center",children:e.jsx(tt,{className:"w-4 h-4 text-green-600"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-muted-foreground",children:"Gesamt"}),e.jsxs("p",{className:"font-bold text-sm",children:[k.reduce((t,s)=>t+s.quantity,0)," Artikel"]})]})]}),e.jsxs("div",{className:"text-right",children:[e.jsx("p",{className:"text-xs text-muted-foreground",children:"Total"}),e.jsxs("p",{className:"text-xl font-bold text-green-600",children:["CHF ",Bt.toFixed(2)]})]})]}),e.jsx("div",{className:"space-y-2.5 mb-3",children:k.map((t,s)=>e.jsxs("div",{className:"p-3 bg-muted/80 backdrop-blur-sm rounded-xl border border-border/50",children:[e.jsxs("div",{className:"flex items-start justify-between mb-2.5",children:[e.jsxs("div",{className:"flex items-center gap-2.5 flex-1 min-w-0",children:[e.jsx("div",{className:"w-9 h-9 rounded-full bg-green-500 text-white text-xs font-bold flex items-center justify-center flex-shrink-0 shadow-sm",children:t.quantity}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("p",{className:"font-bold text-sm mb-0.5 truncate",children:t.name}),e.jsxs("p",{className:"text-xs text-muted-foreground",children:["CHF ",t.unitPrice.toFixed(2)," pro Stück"]})]})]}),e.jsx("button",{onClick:()=>Pt(s),className:"w-8 h-8 rounded-full bg-red-500/10 flex items-center justify-center flex-shrink-0 active:scale-95 transition-transform",children:e.jsx(B,{className:"w-4 h-4 text-red-500"})})]}),e.jsxs("div",{className:"flex items-center justify-between pt-2 border-t border-border/50",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{onClick:()=>It(s,t.quantity-1),className:"w-9 h-9 rounded-full bg-background border border-border flex items-center justify-center text-lg font-bold active:scale-95 transition-transform",children:"−"}),e.jsx("div",{className:"w-10 h-9 rounded-lg bg-background border border-border flex items-center justify-center",children:e.jsx("span",{className:"text-lg font-bold",children:t.quantity})}),e.jsx("button",{onClick:()=>It(s,t.quantity+1),className:"w-9 h-9 rounded-full bg-background border border-border flex items-center justify-center text-lg font-bold active:scale-95 transition-transform",children:"+"})]}),e.jsxs("div",{className:"text-right",children:[e.jsx("p",{className:"text-xs text-muted-foreground",children:"Total"}),e.jsxs("p",{className:"font-bold text-base",children:["CHF ",t.totalPrice.toFixed(2)]})]})]})]},s))}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs("button",{onClick:()=>{ae(new Set),n.success("Positionen zurückgesetzt")},className:"px-3 py-2.5 rounded-lg bg-muted flex items-center justify-center gap-1.5 text-xs font-semibold active:scale-95 transition-transform",children:[e.jsx(Ks,{className:"w-3.5 h-3.5"}),"Reset"]}),e.jsxs("button",{onClick:()=>{z([]),D(0),ae(new Set)},className:"flex-1 py-2.5 rounded-lg bg-muted flex items-center justify-center gap-1.5 text-xs font-semibold active:scale-95 transition-transform",children:[e.jsx(st,{className:"w-3.5 h-3.5"}),"Alle löschen"]}),e.jsxs("button",{onClick:ps,className:"flex-1 py-2.5 rounded-lg bg-primary text-primary-foreground flex items-center justify-center gap-1.5 text-xs font-semibold shadow-lg active:scale-95 transition-transform",children:[e.jsx(de,{className:"w-3.5 h-3.5"}),"Fertig"]})]})]})]})]})]}),W==="upload"&&y.length===0&&e.jsxs("div",{className:"flex-1 flex items-center justify-center p-4",children:[e.jsxs("button",{onClick:()=>dt.current?.click(),className:"w-full max-w-sm p-8 border-2 border-dashed border-white/30 rounded-xl text-center",children:[e.jsx(Os,{className:"w-12 h-12 mx-auto text-white/50 mb-4"}),e.jsx("p",{className:"text-white font-medium",children:"Foto auswählen"}),e.jsx("p",{className:"text-white/50 text-sm mt-2",children:"JPG, PNG oder PDF"})]}),e.jsx("input",{ref:dt,type:"file",accept:"image/*,application/pdf",capture:"environment",className:"hidden",onChange:ms})]}),b&&e.jsx("div",{className:"flex-1 flex items-center justify-center",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"w-12 h-12 border-2 border-white/30 border-t-white rounded-full animate-spin mx-auto mb-4"}),e.jsx("p",{className:"text-white",children:"Analysiere Liste..."})]})}),c&&y.length>0&&e.jsx("div",{className:"flex-1 bg-background overflow-y-auto",children:e.jsxs("div",{className:"p-4 space-y-4",children:[e.jsxs("div",{className:"bg-muted rounded-xl overflow-hidden",children:[e.jsxs("button",{onClick:()=>$t(!De),className:"w-full p-3 flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Fe,{className:"w-4 h-4 text-primary"}),e.jsx("span",{className:"font-medium",children:"Geschäft"})]}),De?e.jsx(rt,{className:"w-4 h-4"}):e.jsx(nt,{className:"w-4 h-4"})]}),De&&e.jsxs("div",{className:"px-3 pb-3 space-y-1",children:[e.jsx("p",{className:"font-semibold text-lg",children:c.store.name}),c.store.address&&e.jsx("p",{className:"text-sm text-muted-foreground",children:c.store.address}),c.store.city&&e.jsxs("p",{className:"text-sm text-muted-foreground",children:[c.store.postalCode," ",c.store.city]}),e.jsxs("div",{className:"flex gap-4 mt-2 text-xs text-muted-foreground",children:[c.purchase.date&&e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx(Gs,{className:"w-3 h-3"}),new Date(c.purchase.date).toLocaleDateString("de-CH")]}),c.purchase.time&&e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx(Us,{className:"w-3 h-3"}),c.purchase.time]})]})]})]}),e.jsxs("div",{className:"bg-muted rounded-xl overflow-hidden",children:[e.jsxs("button",{onClick:()=>qt(!Me),className:"w-full p-3 flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(tt,{className:"w-4 h-4 text-primary"}),e.jsxs("span",{className:"font-medium",children:["Artikel (",y.length,")"]}),e.jsxs("span",{className:"text-xs bg-primary text-primary-foreground px-2 py-0.5 rounded-full",children:[y.filter(t=>t.selected).length," ausgewählt"]})]}),Me?e.jsx(rt,{className:"w-4 h-4"}):e.jsx(nt,{className:"w-4 h-4"})]}),Me&&e.jsxs("div",{className:"px-3 pb-3",children:[e.jsx("div",{className:"flex justify-end mb-2",children:e.jsx("button",{onClick:()=>U(t=>t.map(s=>({...s,selected:!y.every(a=>a.selected)}))),className:"text-xs text-primary",children:y.every(t=>t.selected)?"Alle abwählen":"Alle auswählen"})}),e.jsx("div",{className:"space-y-2 max-h-64 overflow-y-auto",children:y.map((t,s)=>e.jsx("div",{className:`p-2.5 rounded-lg border ${t.selected?"bg-background border-primary":"bg-background/50 border-border"}`,onClick:()=>U(a=>a.map((r,o)=>o===s?{...r,selected:!r.selected}:r)),children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:`w-5 h-5 rounded border-2 ${t.selected?"bg-primary border-primary":"border-border"} flex items-center justify-center shrink-0`,children:t.selected&&e.jsx(de,{className:"w-3 h-3 text-white"})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("p",{className:"font-medium text-sm truncate",children:t.name}),e.jsxs("p",{className:"text-xs text-muted-foreground",children:[t.articleNumber&&e.jsxs("span",{className:"mr-2",children:["#",t.articleNumber]}),t.quantity,"x à CHF ",t.unitPrice.toFixed(2)]})]}),e.jsxs("p",{className:"font-semibold text-sm shrink-0",children:["CHF ",t.totalPrice.toFixed(2)]})]})},s))})]})]}),e.jsxs("div",{className:"bg-muted rounded-xl overflow-hidden",children:[e.jsxs("button",{onClick:()=>Ht(!Re),className:"w-full p-3 flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Dt,{className:"w-4 h-4 text-primary"}),e.jsx("span",{className:"font-medium",children:"Zahlung"})]}),Re?e.jsx(rt,{className:"w-4 h-4"}):e.jsx(nt,{className:"w-4 h-4"})]}),Re&&e.jsxs("div",{className:"px-3 pb-3 space-y-2",children:[c.totals.subtotal&&e.jsxs("div",{className:"flex justify-between text-sm",children:[e.jsx("span",{className:"text-muted-foreground",children:"Zwischensumme"}),e.jsxs("span",{children:["CHF ",c.totals.subtotal.toFixed(2)]})]}),c.totals.rounding&&e.jsxs("div",{className:"flex justify-between text-sm",children:[e.jsx("span",{className:"text-muted-foreground",children:"Rundung"}),e.jsxs("span",{children:["CHF ",c.totals.rounding.toFixed(2)]})]}),e.jsxs("div",{className:"flex justify-between font-semibold text-lg pt-2 border-t",children:[e.jsx("span",{children:"Total"}),e.jsxs("span",{children:["CHF ",c.totals.total.toFixed(2)]})]}),c.purchase.paymentMethod&&e.jsxs("div",{className:"flex items-center gap-2 text-xs text-muted-foreground",children:[e.jsx(Dt,{className:"w-3 h-3"}),c.purchase.paymentMethod]})]})]}),e.jsxs("div",{className:"flex items-center justify-center gap-2 text-xs text-muted-foreground",children:[e.jsx("div",{className:`w-2 h-2 rounded-full ${c.confidence>=70?"bg-green-500":c.confidence>=40?"bg-yellow-500":"bg-red-500"}`}),"Erkennungsqualität: ",c.confidence,"%"]}),e.jsxs("div",{className:"space-y-2 pt-2",children:[e.jsxs(w,{onClick:js,className:"w-full",children:[e.jsx(at,{className:"w-4 h-4 mr-2"}),y.filter(t=>t.selected).length," Artikel zur Liste"]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(w,{variant:"outline",onClick:Ns,className:"flex-1",children:[e.jsx(_s,{className:"w-4 h-4 mr-1"}),"Speichern"]}),e.jsxs(w,{variant:"outline",onClick:ws,className:"flex-1",children:[e.jsx(Vs,{className:"w-4 h-4 mr-1"}),"Zu Finanzen"]})]})]})]})})]}),mt&&e.jsxs("div",{className:"fixed inset-0 z-[100] bg-black flex flex-col",children:[e.jsxs("div",{className:"flex items-center justify-between p-4 bg-black/50",children:[e.jsx("h2",{className:"text-white font-semibold",children:"Barcode scannen"}),e.jsx("button",{onClick:Zt,className:"w-10 h-10 rounded-lg bg-white/20 flex items-center justify-center",children:e.jsx(B,{className:"w-5 h-5 text-white"})})]}),e.jsxs("div",{className:"flex-1 relative flex items-center justify-center",children:[e.jsx("video",{ref:M,autoPlay:!0,playsInline:!0,className:"w-full h-full object-cover"}),e.jsx("canvas",{ref:qe,className:"hidden"}),e.jsx("div",{className:"absolute inset-0 flex items-center justify-center",children:e.jsx("div",{className:"w-64 h-32 border-2 border-white rounded-lg"})}),ut&&e.jsx("div",{className:"absolute bottom-20 left-0 right-0 text-center",children:e.jsx("p",{className:"text-white bg-black/50 px-4 py-2 rounded-lg inline-block",children:"Barcode in den Rahmen positionieren"})})]})]}),gt&&e.jsxs("div",{className:"fixed inset-0 z-[100] bg-black flex flex-col",children:[e.jsxs("div",{className:"flex items-center justify-between p-4 bg-black/50",children:[e.jsx("h2",{className:"text-white font-semibold",children:"Produkt fotografieren"}),e.jsx("button",{onClick:ts,className:"w-10 h-10 rounded-lg bg-white/20 flex items-center justify-center",children:e.jsx(B,{className:"w-5 h-5 text-white"})})]}),e.jsxs("div",{className:"flex-1 relative flex items-center justify-center",children:[e.jsx("video",{ref:R,autoPlay:!0,playsInline:!0,className:"w-full h-full object-cover"}),e.jsx("canvas",{ref:Ue,className:"hidden"}),Ge&&e.jsx("div",{className:"absolute inset-0 flex items-center justify-center bg-black/50",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"w-12 h-12 border-2 border-white/30 border-t-white rounded-full animate-spin mx-auto mb-4"}),e.jsx("p",{className:"text-white",children:"Analysiere Produkt..."})]})})]}),e.jsx("div",{className:"p-4 bg-black/50",children:e.jsx(w,{onClick:es,disabled:Ge,className:"w-full bg-primary text-primary-foreground",children:Ge?"Analysiere...":"Foto aufnehmen"})})]}),!lt&&!ct&&!it&&!mt&&!gt&&e.jsxs("div",{className:"fixed right-4 bottom-20 flex flex-col gap-3 safe-bottom",children:[e.jsx("button",{onClick:vs,className:"w-12 h-12 rounded-full bg-secondary text-secondary-foreground shadow-lg flex items-center justify-center active:opacity-80 transition-opacity",children:e.jsx(Le,{className:"w-5 h-5"})}),e.jsx("button",{onClick:()=>ue(!0),className:"w-12 h-12 rounded-full bg-secondary text-secondary-foreground shadow-lg flex items-center justify-center active:opacity-80 transition-opacity",title:"Mehrere Artikel hinzufügen",children:e.jsx(Qs,{className:"w-5 h-5"})}),e.jsx("button",{onClick:()=>Ee(!0),className:"w-14 h-14 rounded-full bg-primary text-primary-foreground shadow-lg flex items-center justify-center active:opacity-80 transition-opacity",children:e.jsx(at,{className:"w-6 h-6"})})]})]})}export{ua as M};
