import*as Ne from"react";import bt,{createContext as vt,useContext as yt,useMemo as ce,useRef as U,useCallback as Z,useState as p,useEffect as K}from"react";import"./vendor-i18n-CxwOOByA.js";import{s as Zt,c as Jt,X as Te,W as wt,C as He,a as Qe,b as jt,S as Nt,d as Yt,e as Xt,f as Qt,g as Ce,U as Ct,H as kt,M as en,L as nt,h as st,B as Ge,i as We,j as Re,k as ze,l as Le,F as St,m as $e,n as Dt,o as Et,p as tn,q as lt,P as nn,I as sn,G as an,r as At,A as rn,t as on,u as ln,v as cn,T as dn,w as un,E as mn,x as hn,y as fn,z as gn,D as xn,J as pn,R as bn,K as ct,N as vn}from"./vendor-misc-BrD495OK.js";import{u as _e,L as yn}from"./vendor-router-B7zKU0Km.js";import{S as wn,R as jn,C as Nn,a as Cn,T as kn,D as Sn,P as Dn,O as En,b as An,c as In,d as Fn,I as Rn,V as Tn,e as zn,f as Mn,g as Pn,h as Bn,i as Ln,j as _n,k as On,l as Un,m as Kn,n as Hn,o as Wn,p as $n,q as Gn,r as qn,s as Vn}from"./vendor-ui-C8Iut7Xy.js";import{t as Zn,c as Jn}from"./vendor-utils-BNe0Xlio.js";import{i as Yn,g as Xn,a as Qn,b as es,c as ts,d as ns,o as ss,s as as,G as rs,e as is,f as os,h as ls,j as z}from"./vendor-firebase-1FGBEtGo.js";import{t as b}from"./vendor-toast-CdQ6zwVl.js";import{c as cs}from"./vendor-api-Is7l17Jf.js";const ds="modulepreload",us=function(n){return"/"+n},dt={},va=function(t,s,i){let o=Promise.resolve();if(s&&s.length>0){let x=function(h){return Promise.all(h.map(f=>Promise.resolve(f).then(m=>({status:"fulfilled",value:m}),m=>({status:"rejected",reason:m}))))};document.getElementsByTagName("link");const c=document.querySelector("meta[property=csp-nonce]"),d=c?.nonce||c?.getAttribute("nonce");o=x(s.map(h=>{if(h=us(h),h in dt)return;dt[h]=!0;const f=h.endsWith(".css"),m=f?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${h}"]${m}`))return;const v=document.createElement("link");if(v.rel=f?"stylesheet":ds,f||(v.as="script"),v.crossOrigin="",v.href=h,d&&v.setAttribute("nonce",d),document.head.appendChild(v),f)return new Promise((j,y)=>{v.addEventListener("load",j),v.addEventListener("error",()=>y(new Error(`Unable to preload CSS for ${h}`)))})}))}function l(c){const d=new Event("vite:preloadError",{cancelable:!0});if(d.payload=c,window.dispatchEvent(d),!d.defaultPrevented)throw c}return o.then(c=>{for(const d of c||[])d.status==="rejected"&&l(d.reason);return t().catch(l)})};var ya=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function wa(n){return n&&n.__esModule&&Object.prototype.hasOwnProperty.call(n,"default")?n.default:n}var Ve={exports:{}},Pe={};/**
 * @license React
 * react-jsx-runtime.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var ut;function ms(){if(ut)return Pe;ut=1;var n=bt,t=Symbol.for("react.element"),s=Symbol.for("react.fragment"),i=Object.prototype.hasOwnProperty,o=n.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,l={key:!0,ref:!0,__self:!0,__source:!0};function c(d,x,h){var f,m={},v=null,j=null;h!==void 0&&(v=""+h),x.key!==void 0&&(v=""+x.key),x.ref!==void 0&&(j=x.ref);for(f in x)i.call(x,f)&&!l.hasOwnProperty(f)&&(m[f]=x[f]);if(d&&d.defaultProps)for(f in x=d.defaultProps,x)m[f]===void 0&&(m[f]=x[f]);return{$$typeof:t,type:d,key:v,ref:j,props:m,_owner:o.current}}return Pe.Fragment=s,Pe.jsx=c,Pe.jsxs=c,Pe}var mt;function hs(){return mt||(mt=1,Ve.exports=ms()),Ve.exports}var e=hs();const fs=(n,t,s,i)=>{const o=[s,{code:t,...i||{}}];if(n?.services?.logger?.forward)return n.services.logger.forward(o,"warn","react-i18next::",!0);ke(o[0])&&(o[0]=`react-i18next:: ${o[0]}`),n?.services?.logger?.warn?n.services.logger.warn(...o):console?.warn&&console.warn(...o)},ht={},It=(n,t,s,i)=>{ke(s)&&ht[s]||(ke(s)&&(ht[s]=new Date),fs(n,t,s,i))},Ft=(n,t)=>()=>{if(n.isInitialized)t();else{const s=()=>{setTimeout(()=>{n.off("initialized",s)},0),t()};n.on("initialized",s)}},et=(n,t,s)=>{n.loadNamespaces(t,Ft(n,s))},ft=(n,t,s,i)=>{if(ke(s)&&(s=[s]),n.options.preload&&n.options.preload.indexOf(t)>-1)return et(n,s,i);s.forEach(o=>{n.options.ns.indexOf(o)<0&&n.options.ns.push(o)}),n.loadLanguages(t,Ft(n,i))},gs=(n,t,s={})=>!t.languages||!t.languages.length?(It(t,"NO_LANGUAGES","i18n.languages were undefined or empty",{languages:t.languages}),!0):t.hasLoadedNamespace(n,{lng:s.lng,precheck:(i,o)=>{if(s.bindI18n&&s.bindI18n.indexOf("languageChanging")>-1&&i.services.backendConnector.backend&&i.isLanguageChangingTo&&!o(i.isLanguageChangingTo,n))return!1}}),ke=n=>typeof n=="string",xs=n=>typeof n=="object"&&n!==null,ps=/&(?:amp|#38|lt|#60|gt|#62|apos|#39|quot|#34|nbsp|#160|copy|#169|reg|#174|hellip|#8230|#x2F|#47);/g,bs={"&amp;":"&","&#38;":"&","&lt;":"<","&#60;":"<","&gt;":">","&#62;":">","&apos;":"'","&#39;":"'","&quot;":'"',"&#34;":'"',"&nbsp;":" ","&#160;":" ","&copy;":"©","&#169;":"©","&reg;":"®","&#174;":"®","&hellip;":"…","&#8230;":"…","&#x2F;":"/","&#47;":"/"},vs=n=>bs[n],ys=n=>n.replace(ps,vs);let tt={bindI18n:"languageChanged",bindI18nStore:"",transEmptyNodeValue:"",transSupportBasicHtmlNodes:!0,transWrapTextNodes:"",transKeepBasicHtmlNodesFor:["br","strong","i","p"],useSuspense:!0,unescape:ys,transDefaultProps:void 0};const ws=(n={})=>{tt={...tt,...n}},js=()=>tt;let Rt;const Ns=n=>{Rt=n},Cs=()=>Rt,ja={type:"3rdParty",init(n){ws(n.options.react),Ns(n)}},ks=vt();class Ss{constructor(){this.usedNamespaces={}}addUsedNamespaces(t){t.forEach(s=>{this.usedNamespaces[s]||(this.usedNamespaces[s]=!0)})}getUsedNamespaces(){return Object.keys(this.usedNamespaces)}}const Ds=(n,t)=>ke(t)?t:xs(t)&&ke(t.defaultValue)?t.defaultValue:Array.isArray(n)?n[n.length-1]:n,Es={t:Ds,ready:!1},As=()=>()=>{},Tt=(n,t={})=>{const{i18n:s}=t,{i18n:i,defaultNS:o}=yt(ks)||{},l=s||i||Cs();l&&!l.reportNamespaces&&(l.reportNamespaces=new Ss),l||It(l,"NO_I18NEXT_INSTANCE","useTranslation: You will need to pass in an i18next instance by using initReactI18next");const c=ce(()=>({...js(),...l?.options?.react,...t}),[l,t]),{useSuspense:d,keyPrefix:x}=c,h=o||l?.options?.defaultNS,f=ke(h)?[h]:h||["translation"],m=ce(()=>f,f);l?.reportNamespaces?.addUsedNamespaces?.(m);const v=U(0),j=Z(T=>{if(!l)return As;const{bindI18n:w,bindI18nStore:E}=c,L=()=>{v.current+=1,T()};return w&&l.on(w,L),E&&l.store.on(E,L),()=>{w&&w.split(" ").forEach(ee=>l.off(ee,L)),E&&E.split(" ").forEach(ee=>l.store.off(ee,L))}},[l,c]),y=U(),u=Z(()=>{if(!l)return Es;const T=!!(l.isInitialized||l.initializedStoreOnce)&&m.every(ae=>gs(ae,l,c)),w=t.lng||l.language,E=v.current,L=y.current;if(L&&L.ready===T&&L.lng===w&&L.keyPrefix===x&&L.revision===E)return L;const R={t:l.getFixedT(w,c.nsMode==="fallback"?m:m[0],x),ready:T,lng:w,keyPrefix:x,revision:E};return y.current=R,R},[l,m,x,c,t.lng]),[k,A]=p(0),{t:X,ready:W}=Zt.useSyncExternalStore(j,u,u);K(()=>{if(l&&!W&&!d){const T=()=>A(w=>w+1);t.lng?ft(l,t.lng,m,T):et(l,m,T)}},[l,t.lng,m,W,d,k]);const I=l||{},B=U(null),O=U(),se=T=>{const w=Object.getOwnPropertyDescriptors(T);w.__original&&delete w.__original;const E=Object.create(Object.getPrototypeOf(T),w);if(!Object.prototype.hasOwnProperty.call(E,"__original"))try{Object.defineProperty(E,"__original",{value:T,writable:!1,enumerable:!1,configurable:!1})}catch{}return E},Q=ce(()=>{const T=I,w=T?.language;let E=T;T&&(B.current&&B.current.__original===T?O.current!==w?(E=se(T),B.current=E,O.current=w):E=B.current:(E=se(T),B.current=E,O.current=w));const L=[X,E,W];return L.t=X,L.i18n=E,L.ready=W,L},[X,I,W,I.resolvedLanguage,I.language,I.languages]);if(l&&d&&!W)throw new Promise(T=>{const w=()=>T();t.lng?ft(l,t.lng,m,w):et(l,m,w)});return Q},Is=cs(),Fs={apiKey:"AIzaSyCZ8V17HUVMlBKXK0ftrMURS-XP2zIsOps",authDomain:"nexo-jtsky100.firebaseapp.com",projectId:"nexo-jtsky100",storageBucket:"nexo-jtsky100.firebasestorage.app",messagingSenderId:"859320186482",appId:"1:859320186482:web:0c9dcca5d8ce613aaf34eb",measurementId:"G-G8PX4GB2YF"},qe=Yn(Fs),De=Xn(qe);Qn(qe);const M=es(qe,"us-central1");typeof window<"u"&&ts(qe);const zt=vt(void 0);function Na({children:n}){const[t,s]=p(null),[i,o]=p(!0),[l,c]=p(null);K(()=>(ns(De).then(u=>{u?.user&&s(u.user)}).catch(u=>{}),ss(De,u=>{s(u),o(!1)})),[]);const d=async(y,u)=>{try{c(null);const k=await os(De,y,u)}catch(k){let A="Anmeldung fehlgeschlagen";switch(k.code){case"auth/invalid-email":A="Ungültige E-Mail-Adresse";break;case"auth/user-disabled":A="Dieses Konto wurde deaktiviert";break;case"auth/user-not-found":A="Kein Konto mit dieser E-Mail gefunden";break;case"auth/wrong-password":A="Falsches Passwort";break;case"auth/invalid-credential":A="Ungültige Anmeldedaten";break;default:A=k.message||"Ein Fehler ist aufgetreten"}throw c(A),new Error(A)}},x=async(y,u)=>{try{c(null);const k=await ls(De,y,u)}catch(k){let A="Registrierung fehlgeschlagen";switch(k.code){case"auth/email-already-in-use":A="Diese E-Mail wird bereits verwendet";break;case"auth/invalid-email":A="Ungültige E-Mail-Adresse";break;case"auth/weak-password":A="Passwort ist zu schwach";break;default:A=k.message||"Ein Fehler ist aufgetreten"}throw c(A),new Error(A)}},h=async()=>{try{c(null);const y=new rs;y.addScope("email"),y.addScope("profile"),y.setCustomParameters({prompt:"select_account"}),await is(De,y)}catch(y){let u="Ein Fehler ist aufgetreten";switch(y.code){case"auth/unauthorized-domain":u="Diese Domain ist nicht autorisiert. Bitte kontaktieren Sie den Administrator.";break;case"auth/operation-not-allowed":u="Google Sign-In ist nicht aktiviert.";break;case"auth/network-request-failed":u="Netzwerkfehler. Bitte überprüfen Sie Ihre Internetverbindung.";break;default:u=y.message||"Ein unbekannter Fehler ist aufgetreten"}throw c(u),new Error(u)}},f=async()=>{try{await as(De)}catch{throw new Error("Abmeldung fehlgeschlagen")}},m=d,v=h,j=f;return e.jsx(zt.Provider,{value:{user:t,loading:i,error:l,signIn:d,signUp:x,signInWithGoogle:h,signOut:f,loginWithEmail:m,loginWithGoogle:v,logout:j},children:n})}function Rs(){const n=yt(zt);if(n===void 0)throw new Error("useAuth must be used within an AuthProvider");return n}function D(...n){return Zn(Jn(n))}const Ts=Jt("inline-flex items-center justify-center gap-2 whitespace-nowrap rounded-md text-sm font-medium transition-all disabled:pointer-events-none disabled:opacity-50 [&_svg]:pointer-events-none [&_svg:not([class*='size-'])]:size-4 shrink-0 [&_svg]:shrink-0 outline-none focus-visible:border-ring focus-visible:ring-ring/50 focus-visible:ring-[3px] aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive",{variants:{variant:{default:"bg-primary text-primary-foreground hover:bg-primary/90",destructive:"bg-destructive text-white hover:bg-destructive/90 focus-visible:ring-destructive/20 dark:focus-visible:ring-destructive/40 dark:bg-destructive/60",outline:"border bg-transparent shadow-xs hover:bg-accent dark:bg-transparent dark:border-input dark:hover:bg-input/50",secondary:"bg-secondary text-secondary-foreground hover:bg-secondary/80",ghost:"hover:bg-accent dark:hover:bg-accent/50",link:"text-primary underline-offset-4 hover:underline"},size:{default:"h-9 px-4 py-2 has-[>svg]:px-3",sm:"h-8 rounded-md gap-1.5 px-3 has-[>svg]:px-2.5",lg:"h-10 rounded-md px-6 has-[>svg]:px-4",icon:"size-9","icon-sm":"size-8","icon-lg":"size-10"}},defaultVariants:{variant:"default",size:"default"}});function _({className:n,variant:t,size:s,asChild:i=!1,...o}){const l=i?wn:"button";return e.jsx(l,{"data-slot":"button",className:D(Ts({variant:t,size:s,className:n})),...o})}function zs({className:n,...t}){return e.jsx("div",{"data-slot":"card",className:D("bg-card text-card-foreground flex flex-col gap-6 rounded-xl border py-6 shadow-sm",n),...t})}function Ca({className:n,...t}){return e.jsx("div",{"data-slot":"card-header",className:D("@container/card-header grid auto-rows-min grid-rows-[auto_auto] items-start gap-2 px-6 has-data-[slot=card-action]:grid-cols-[1fr_auto] [.border-b]:pb-6",n),...t})}function ka({className:n,...t}){return e.jsx("div",{"data-slot":"card-title",className:D("leading-none font-semibold",n),...t})}function Sa({className:n,...t}){return e.jsx("div",{"data-slot":"card-description",className:D("text-muted-foreground text-sm",n),...t})}function Ms({className:n,...t}){return e.jsx("div",{"data-slot":"card-content",className:D("px-6",n),...t})}const Ps={maxRetries:3,initialDelay:1e3,maxDelay:1e4,backoffMultiplier:2,retryableErrors:["network","timeout","ECONNRESET","ETIMEDOUT","ENOTFOUND","EAI_AGAIN","500","502","503","504"]};function Bs(n,t){if(!n)return!1;const s=n.message?.toLowerCase()||"",i=n.code?.toLowerCase()||"",o=n.status?.toString()||"";return t.some(l=>{const c=l.toLowerCase();return s.includes(c)||i.includes(c)||o.includes(c)})}function Ls(n,t){const s=t.initialDelay*Math.pow(t.backoffMultiplier,n);return Math.min(s,t.maxDelay)}async function _s(n,t={}){const s={...Ps,...t};let i;for(let o=0;o<=s.maxRetries;o++)try{return await n()}catch(l){if(i=l,o>=s.maxRetries||!Bs(l,s.retryableErrors))break;const c=Ls(o,s);await new Promise(d=>setTimeout(d,c))}throw i}async function be(n,t,s={}){return _s(async()=>(await n(t)).data,s)}const at={maxRetries:3,initialDelay:1e3},Oe={maxRetries:2,initialDelay:500};function Da(n){const[t,s]=p([]),[i,o]=p(!0),[l,c]=p(null),[d,x]=p(0);return K(()=>{(async()=>{try{o(!0);const y=(await z(M,"getReminders")(n||{})).data.reminders.map(u=>({...u,dueDate:u.dueDate?.toDate?u.dueDate.toDate():new Date(u.dueDate),createdAt:u.createdAt?.toDate?u.createdAt.toDate():new Date(u.createdAt),updatedAt:u.updatedAt?.toDate?u.updatedAt.toDate():new Date(u.updatedAt)}));s(y),c(null)}catch(m){c(m)}finally{o(!1)}})()},[n?.startDate,n?.endDate,n?.status,d]),{data:t,isLoading:i,error:l,refetch:()=>x(f=>f+1)}}async function Mt(n){const t=z(M,"createReminder");return be(t,n,at)}async function Ea(n,t){const s=z(M,"updateReminder");await be(s,{id:n,...t},Oe)}async function Aa(n){const t=z(M,"deleteReminder");await be(t,{id:n},Oe)}function Ia(n){const[t,s]=p([]),[i,o]=p(!0),[l,c]=p(null),d=Z(async()=>{try{o(!0);const v=(await z(M,"getFinanceEntries")(n||{})).data.entries.map(j=>({...j,date:j.date?.toDate?j.date.toDate():new Date(j.date),createdAt:j.createdAt?.toDate?j.createdAt.toDate():new Date(j.createdAt),updatedAt:j.updatedAt?.toDate?j.updatedAt.toDate():new Date(j.updatedAt)}));s(v),c(null)}catch(h){c(h)}finally{o(!1)}},[n?.startDate,n?.endDate,n?.type]);K(()=>{d()},[d]);const x=Z(async()=>{await d()},[d]);return{data:t,isLoading:i,error:l,refetch:x}}async function Pt(n){const t=z(M,"createFinanceEntry");return be(t,n,at)}async function Fa(n,t){const s=z(M,"updateFinanceEntry");await be(s,{id:n,...t},Oe)}function Ra(){const[n,t]=p([]),[s,i]=p(!0),[o,l]=p(null);return K(()=>{(async()=>{try{i(!0);const f=(await z(M,"getTaxProfiles")({})).data.profiles.map(m=>({...m,createdAt:m.createdAt?.toDate?m.createdAt.toDate():new Date(m.createdAt),updatedAt:m.updatedAt?.toDate?m.updatedAt.toDate():new Date(m.updatedAt)}));t(f),l(null)}catch(d){l(d)}finally{i(!1)}})()},[]),{data:n,isLoading:s,error:o}}async function Ta(n){await z(M,"deleteTaxProfile")({id:n})}function za(){const[n,t]=p([]),[s,i]=p(!0),[o,l]=p(null);return K(()=>{(async()=>{try{i(!0);const f=(await z(M,"getPeople")({})).data.people.map(m=>({...m,createdAt:m.createdAt?.toDate?m.createdAt.toDate():new Date(m.createdAt),updatedAt:m.updatedAt?.toDate?m.updatedAt.toDate():new Date(m.updatedAt)}));t(f),l(null)}catch(d){l(d)}finally{i(!1)}})()},[]),{data:n,isLoading:s,error:o}}async function Ma(n){const t=z(M,"createPerson");return be(t,n,at)}async function Pa(n,t){const s=z(M,"updatePerson");await be(s,{personId:n,...t},Oe)}async function Ba(n){const t=z(M,"deletePerson");await be(t,{personId:n},Oe)}function La(n){const[t,s]=p([]),[i,o]=p(!0),[l,c]=p(null),[d,x]=p(0);return K(()=>{(async()=>{try{o(!0);const y=(await z(M,"getShoppingList")({status:n})).data.items.map(u=>({...u,boughtAt:u.boughtAt?.toDate?u.boughtAt.toDate():u.boughtAt?new Date(u.boughtAt):null,createdAt:u.createdAt?.toDate?u.createdAt.toDate():new Date(u.createdAt),updatedAt:u.updatedAt?.toDate?u.updatedAt.toDate():new Date(u.updatedAt)}));s(y),c(null)}catch(m){c(m)}finally{o(!1)}})()},[n,d]),{data:t,isLoading:i,error:l,refetch:()=>x(f=>f+1)}}async function Os(n){return(await z(M,"createShoppingItem")(n)).data}async function _a(n){await z(M,"deleteShoppingItem")({itemId:n})}async function Oa(n,t,s){return(await z(M,"markShoppingItemAsBought")({itemId:n,actualPrice:t,createExpense:s})).data}function Us(){const[n,t]=p([]),[s,i]=p(!0),[o,l]=p(null),[c,d]=p(0);return K(()=>{(async()=>{try{i(!0);const j=(await z(M,"getChatConversations")({})).data.conversations.map(y=>{let u=new Date;y.createdAt&&(typeof y.createdAt=="string"?u=y.createdAt:u=new Date(y.createdAt).toISOString());let k=new Date;return y.updatedAt&&(typeof y.updatedAt=="string"?k=y.updatedAt:k=new Date(y.updatedAt).toISOString()),{...y,createdAt:u,updatedAt:k}});j.sort((y,u)=>{const k=typeof y.updatedAt=="string"?new Date(y.updatedAt).getTime():y.updatedAt.getTime();return(typeof u.updatedAt=="string"?new Date(u.updatedAt).getTime():u.updatedAt.getTime())-k}),t(j),l(null)}catch(f){l(f)}finally{i(!1)}})()},[c]),{data:n,isLoading:s,error:o,refetch:()=>d(h=>h+1)}}function Bt(n,t){const[s,i]=p(null),[o,l]=p(!1),[c,d]=p(null);return K(()=>{if(!n){i(null);return}(async()=>{try{if(l(!0),d(null),!t)throw new Error("Location ist erforderlich. Bitte in den Einstellungen einen Standort eingeben.");const m=(await z(M,"getWeather")({date:n.toISOString(),location:t})).data,v=!1;if(m)i(m);else{const j=new Date;j.setHours(0,0,0,0);const y=new Date(n);y.setHours(0,0,0,0),y<j?d(new Error("Historische Wetterdaten sind nur aus dem Cache verfügbar.")):d(new Error("Keine Wetterdaten verfügbar. Bitte überprüfen Sie den Standort in den Einstellungen."))}}catch(h){console.error("[useWeather] Error:",h);const f=h?.message||h?.code||"Unbekannter Fehler beim Laden der Wetterdaten";d(new Error(f)),i(null)}finally{l(!1)}})()},[n,t]),{data:s,isLoading:o,error:c}}function Lt(){const[n,t]=p(null),[s,i]=p(!0),[o,l]=p(null);K(()=>{(async()=>{try{i(!0),l(null);const f=(await z(M,"getUserSettings")({})).data;t(f)}catch(x){l(x)}finally{i(!1)}})()},[]);const c=Z(async d=>{try{return await z(M,"updateUserSettings")(d),t(h=>h?{...h,...d}:d),{success:!0}}catch(x){throw l(x),x}},[]);return{settings:n,isLoading:s,error:o,updateSettings:c}}async function Ks(n){return(await z(M,"createChatConversation")(n)).data}async function Hs(n,t){await z(M,"updateChatConversation")({id:n,...t})}function rt(){return Us()}async function Ze(n){try{if(n.id&&!n.id.startsWith("chat_"))await Hs(n.id,{title:n.title,messages:n.messages});else{const t=await Ks({title:n.title,messages:n.messages});n.id=t.id}}catch(t){throw t}}function Je(n,t){return t.find(s=>s.id===n)||null}function Ws(n){return n.length<=50?n:n.substring(0,50)+"..."}function gt(){const n=`chat_${Date.now()}_${Math.random().toString(36).substring(2,9)}`,t=new Date().toISOString();return{id:n,userId:"",title:"Neue Konversation",messages:[],createdAt:t,updatedAt:t}}const xt="glassEffectEnabled";function _t(){const[n,t]=p(()=>{const i=localStorage.getItem(xt);return i!==null?i==="true":!0});return K(()=>{localStorage.setItem(xt,String(n))},[n]),{isEnabled:n,toggle:()=>{t(i=>!i)},setIsEnabled:t}}const Ot=Ne.createContext({isComposing:()=>!1,setComposing:()=>{},justEndedComposing:()=>!1,markCompositionEnd:()=>{}}),it=()=>Ne.useContext(Ot);function he({...n}){const t=Ne.useRef(!1),s=Ne.useRef(!1),i=Ne.useRef(null),o=Ne.useMemo(()=>({isComposing:()=>t.current,setComposing:l=>{t.current=l},justEndedComposing:()=>s.current,markCompositionEnd:()=>{s.current=!0,i.current&&clearTimeout(i.current),i.current=setTimeout(()=>{s.current=!1},150)}}),[]);return e.jsx(Ot.Provider,{value:o,children:e.jsx(jn,{"data-slot":"dialog",...n})})}function $s({...n}){return e.jsx(Dn,{"data-slot":"dialog-portal",...n})}function Ut({className:n,...t}){return e.jsx(En,{"data-slot":"dialog-overlay",className:D("data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 fixed inset-0 z-50 bg-black/50",n),...t})}Ut.displayName="DialogOverlay";function fe({className:n,children:t,showCloseButton:s=!0,onEscapeKeyDown:i,...o}){const{isComposing:l}=it(),c=Ne.useCallback(d=>{if(d.isComposing||l()){d.preventDefault();return}i?.(d)},[l,i]);return e.jsxs($s,{"data-slot":"dialog-portal",children:[e.jsx(Ut,{}),e.jsxs(Nn,{"data-slot":"dialog-content",className:D("bg-background data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 fixed top-0 left-0 right-0 bottom-0 z-50 flex flex-col w-full h-full border-0 shadow-lg duration-200 sm:top-[50%] sm:left-[50%] sm:right-auto sm:bottom-auto sm:translate-x-[-50%] sm:translate-y-[-50%] sm:max-w-lg sm:h-auto sm:max-h-[90vh] sm:rounded-lg sm:border sm:m-4 sm:flex sm:flex-col",n),onEscapeKeyDown:c,...o,children:[t,s&&e.jsxs(Cn,{"data-slot":"dialog-close",className:"ring-offset-background focus:ring-ring data-[state=open]:bg-accent data-[state=open]:text-muted-foreground absolute top-4 right-4 rounded-xs opacity-70 transition-opacity hover:opacity-100 focus:ring-2 focus:ring-offset-2 focus:outline-hidden disabled:pointer-events-none [&_svg]:pointer-events-none [&_svg]:shrink-0 [&_svg:not([class*='size-'])]:size-4",children:[e.jsx(Te,{}),e.jsx("span",{className:"sr-only",children:"Close"})]})]})]})}function ge({className:n,...t}){return e.jsx("div",{"data-slot":"dialog-header",className:D("flex flex-col gap-2 text-center sm:text-left",n),...t})}function xe({className:n,...t}){return e.jsx("div",{"data-slot":"dialog-footer",className:D("flex flex-col-reverse gap-2 sm:flex-row sm:justify-end",n),...t})}function pe({className:n,...t}){return e.jsx(kn,{"data-slot":"dialog-title",className:D("text-lg leading-none font-semibold",n),...t})}function Ua({className:n,...t}){return e.jsx(Sn,{"data-slot":"dialog-description",className:D("text-muted-foreground text-sm",n),...t})}function Gs({selectedDate:n}){const{settings:t,isLoading:s}=Lt(),i=t?.weatherLocation||"Zurich, CH",{data:o,isLoading:l,error:c}=Bt(n,i);bt.useEffect(()=>{},[n,i,s,o,l,c]);const d=h=>{switch(h){case"sun":return e.jsx(Nt,{className:"w-5 h-5"});case"cloud-sun":return e.jsx(jt,{className:"w-5 h-5"});case"cloud":return e.jsx(He,{className:"w-5 h-5"});case"rain":return e.jsx(Qe,{className:"w-5 h-5"});case"snow":return e.jsx(Qe,{className:"w-5 h-5"});default:return e.jsx(He,{className:"w-5 h-5"})}};if(!n)return null;const x=n.toLocaleDateString("de-CH",{weekday:"long",day:"numeric",month:"long"});return e.jsxs("div",{className:"p-3 border-b border-border",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("h4",{className:"text-xs font-semibold text-muted-foreground",children:"Wetter"}),e.jsx("span",{className:"text-[10px] text-muted-foreground",children:x})]}),l?e.jsx("div",{className:"flex items-center justify-center py-4",children:e.jsx("div",{className:"text-xs text-muted-foreground",children:"Lädt..."})}):o?e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[d(o.icon),e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-baseline gap-1",children:[e.jsxs("span",{className:"text-lg font-bold",children:[o.temperature,"°"]}),e.jsx("span",{className:"text-xs text-muted-foreground",children:"C"})]}),e.jsx("div",{className:"text-[10px] text-muted-foreground",children:o.condition})]})]}),o.humidity!==void 0&&o.windSpeed!==void 0&&e.jsxs("div",{className:"flex gap-3 text-[9px] text-muted-foreground pt-1 border-t border-border/50",children:[e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(wt,{className:"w-3 h-3"}),e.jsxs("span",{children:[o.windSpeed," km/h"]})]}),e.jsx("div",{children:e.jsxs("span",{children:["Luftfeuchtigkeit: ",o.humidity,"%"]})})]})]}):c?e.jsxs("div",{className:"space-y-1",children:[e.jsx("div",{className:"text-xs text-muted-foreground text-center py-2",children:c.message||"Fehler beim Laden der Wetterdaten"}),e.jsxs("div",{className:"text-[10px] text-muted-foreground/70 text-center",children:["Standort: ",i]})]}):s?e.jsx("div",{className:"flex items-center justify-center py-4",children:e.jsx("div",{className:"text-xs text-muted-foreground",children:"Lädt Einstellungen..."})}):e.jsxs("div",{className:"space-y-1",children:[e.jsx("div",{className:"text-xs text-muted-foreground text-center py-2",children:"Keine Wetterdaten verfügbar"}),e.jsxs("div",{className:"text-[10px] text-muted-foreground/70 text-center",children:["Standort: ",i]})]})]})}function qs(){const[,n]=_e(),[t,s]=p(new Date),[i,o]=p([]),[l,c]=p(!1),[d,x]=p(null),[h,f]=p(null),[m,v]=p(!1),[j,y]=p(!1),[u,k]=p(!1),[A,X]=p(!1),{settings:W}=Lt(),I=W?.weatherLocation||"Zurich, CH",B=d?new Date(d.getFullYear(),d.getMonth(),d.getDate()):null,{data:O,isLoading:se}=Bt(B,I);K(()=>{d||x(new Date)},[]);const Q=["Januar","Februar","März","April","Mai","Juni","Juli","August","September","Oktober","November","Dezember"],T=["Mo","Di","Mi","Do","Fr","Sa","So"],w=Z(async()=>{try{c(!0);const a=z(M,"getCalendarEvents"),g=z(M,"getVacations"),N=z(M,"getSchoolSchedules"),P=z(M,"getSchoolHolidays"),S=new Date(t.getFullYear(),t.getMonth()-1,1),F=new Date(t.getFullYear(),t.getMonth()+2,0),[$,G,H,ne]=await Promise.all([a({startDate:S.toISOString(),endDate:F.toISOString()}).catch(()=>({data:{events:[]}})),g({startDate:S.toISOString(),endDate:F.toISOString()}).catch(()=>({data:{vacations:[]}})),N({startDate:S.toISOString(),endDate:F.toISOString()}).catch(()=>({data:{schedules:[]}})),P({startDate:S.toISOString(),endDate:F.toISOString()}).catch(()=>({data:{holidays:[]}}))]),V=$.data,we=G.data,oe=H.data,de=ne.data,je=[...V.events||[],...(we.vacations||[]).map(q=>({id:`vacation-${q.id}`,type:"work",title:q.title||"Ferien",date:q.startDate,description:q.description})),...(oe.schedules||[]).map(q=>({id:`school-${q.id}`,type:"school",title:q.childName?`${q.childName} - Schule`:"Schule",date:q.date,schoolType:q.type})),...(de.holidays||[]).map(q=>({id:`holiday-${q.id}`,type:"school-holiday",title:q.title||"Schulferien",date:q.date}))];o(je)}catch{}finally{c(!1)}},[t]);K(()=>{w()},[w]);const E=a=>{const g=new Date(a),N=g.getDay(),P=g.getDate()-(N===0?6:N-1);return new Date(g.setDate(P))},L=ce(()=>{const a=E(t),g=[];for(let N=0;N<7;N++){const P=new Date(a);P.setDate(a.getDate()+N);const S=P.toISOString().split("T")[0];g.push({date:P,events:i.filter(F=>F.date===S)})}return g},[t,i]),ee=()=>{const a=new Date(t);a.setDate(a.getDate()-7),s(a)},R=()=>{const a=new Date(t);a.setDate(a.getDate()+7),s(a)},ae=()=>{s(new Date)},ve=a=>{const g=new Date;return a.toDateString()===g.toDateString()},Se=a=>{x(a),v(!0)},te=a=>{x(a)},ie=a=>{f(a),y(!0)},ye=ce(()=>{if(!d)return[];const a=d.toISOString().split("T")[0];return i.filter(g=>g.date===a)},[d,i]),ue=a=>{switch(a){case"due":return"bg-pink-500";case"reminder":case"appointment":case"termin":return"bg-orange-500";case"work":return"bg-slate-400";case"vacation":case"frei":return"bg-emerald-400";case"school-holiday":return"bg-sky-400";case"school":return"bg-purple-400";case"hort":return"bg-fuchsia-500";default:return"bg-gray-500"}};return e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"p-2 border-b border-border",children:[e.jsxs("div",{className:"flex items-center justify-between mb-1.5",children:[e.jsx(_,{variant:"ghost",size:"sm",onClick:ee,className:"h-5 w-5 p-0 min-w-0",children:e.jsx(Yt,{className:"w-3 h-3"})}),e.jsx("div",{className:"flex-1 text-center px-1",children:e.jsxs("h3",{className:"text-[11px] font-semibold leading-tight",children:[Q[t.getMonth()]," ",t.getFullYear()]})}),e.jsx(_,{variant:"ghost",size:"sm",onClick:R,className:"h-5 w-5 p-0 min-w-0",children:e.jsx(Xt,{className:"w-3 h-3"})})]}),e.jsx("div",{className:"grid grid-cols-7 gap-0",children:T.map((a,g)=>{const N=L[g],P=N?ve(N.date):!1;return e.jsxs("div",{className:"flex flex-col items-center",children:[e.jsx("div",{className:"text-center text-[10px] font-medium text-muted-foreground mb-1 w-full",children:a}),N&&e.jsxs("button",{onClick:()=>{te(N.date),Se(N.date)},className:D("w-full aspect-square min-h-[28px] max-h-[30px] rounded-sm transition-colors flex flex-col items-center justify-center relative","text-foreground",d&&N.date.toDateString()===d.toDateString()?"bg-primary/20 ring-1 ring-primary":P?"bg-primary text-primary-foreground font-semibold":"hover:bg-muted/50"),children:[e.jsx("span",{className:"text-[12px] leading-none font-medium",children:N.date.getDate()}),N.events.length>0&&e.jsx("div",{className:"absolute bottom-0.5 left-0 right-0 flex gap-0.5 justify-center",children:N.events.slice(0,2).map((S,F)=>e.jsx("div",{onClick:$=>{$.stopPropagation(),ie(S)},className:D("h-0.5 w-0.5 rounded-full",ue(S.type)),title:S.title},F))})]})]},g)})}),e.jsx(_,{variant:"ghost",size:"sm",onClick:ae,className:"w-full h-6 mt-1.5 text-[10px]",children:"Heute"})]}),e.jsx(Gs,{selectedDate:d}),e.jsx(he,{open:m,onOpenChange:v,children:e.jsxs(fe,{className:"!fixed !top-[50%] !left-[50%] !right-auto !bottom-auto !translate-x-[-50%] !translate-y-[-50%] !w-[85vw] !max-w-sm !max-h-[85vh] !rounded-3xl !m-0 !overflow-y-auto !shadow-2xl",children:[e.jsx(ge,{className:"px-5 pt-5 pb-3 sticky top-0 bg-background z-10 border-b border-border",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx(pe,{className:"text-lg font-semibold",children:d?.toLocaleDateString("de-CH",{weekday:"long",day:"numeric",month:"long",year:"numeric"})}),e.jsx(_,{variant:"ghost",size:"sm",onClick:()=>v(!1),className:"h-8 w-8 p-0",children:e.jsx(Te,{className:"h-4 w-4"})})]})}),e.jsxs("div",{className:"space-y-4 px-5 pb-2",children:[e.jsxs("div",{className:"bg-muted/30 rounded-xl p-4 space-y-3",children:[e.jsx("div",{className:"flex items-center justify-between",children:e.jsxs("h3",{className:"text-sm font-semibold flex items-center gap-2",children:[e.jsx(He,{className:"w-4 h-4"}),"Wetter"]})}),se?e.jsx("div",{className:"flex items-center justify-center py-4",children:e.jsx("div",{className:"text-xs text-muted-foreground",children:"Lädt Wetterdaten..."})}):O?e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[O.icon==="sun"&&e.jsx(Nt,{className:"w-6 h-6 text-yellow-500"}),O.icon==="cloud-sun"&&e.jsx(jt,{className:"w-6 h-6 text-gray-500"}),O.icon==="cloud"&&e.jsx(He,{className:"w-6 h-6 text-gray-500"}),O.icon==="rain"&&e.jsx(Qe,{className:"w-6 h-6 text-blue-500"}),e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-baseline gap-1",children:[e.jsxs("span",{className:"text-2xl font-bold",children:[O.temperature,"°"]}),e.jsx("span",{className:"text-sm text-muted-foreground",children:"C"})]}),e.jsx("div",{className:"text-xs text-muted-foreground",children:O.condition})]})]}),(O.humidity!==void 0||O.windSpeed!==void 0)&&e.jsxs("div",{className:"flex gap-4 text-xs text-muted-foreground pt-2 border-t border-border/50",children:[O.windSpeed!==void 0&&e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(wt,{className:"w-3 h-3"}),e.jsxs("span",{children:[O.windSpeed," km/h"]})]}),O.humidity!==void 0&&e.jsx("div",{children:e.jsxs("span",{children:["Luftfeuchtigkeit: ",O.humidity,"%"]})})]})]}):e.jsx("div",{className:"text-xs text-muted-foreground text-center py-2",children:"Keine Wetterdaten verfügbar"})]}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-sm font-semibold mb-2",children:"Termine & Events"}),ye.length===0?e.jsx("p",{className:"text-sm text-muted-foreground text-center py-4 bg-muted/30 rounded-lg",children:"Keine Events an diesem Tag"}):e.jsx("div",{className:"space-y-2",children:ye.map(a=>e.jsx(zs,{className:"cursor-pointer hover:bg-muted/50 transition-colors",onClick:()=>{v(!1),ie(a)},children:e.jsx(Ms,{className:"p-3",children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("div",{className:D("w-3 h-3 rounded-full mt-1 flex-shrink-0",ue(a.type))}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("p",{className:"font-medium text-sm truncate",children:a.title}),a.time&&e.jsx("p",{className:"text-xs text-muted-foreground mt-1",children:a.time}),a.personName&&e.jsx("p",{className:"text-xs text-muted-foreground mt-1",children:a.personName})]})]})})},a.id))})]}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-sm font-semibold mb-2",children:"Schnellaktionen"}),e.jsxs("div",{className:"grid grid-cols-2 gap-2",children:[e.jsxs(_,{variant:"outline",onClick:()=>{k(!0)},className:"h-auto py-3 flex flex-col items-center gap-2 rounded-xl",children:[e.jsx(Qt,{className:"w-5 h-5"}),e.jsx("span",{className:"text-xs",children:"Termin erstellen"})]}),e.jsxs(_,{variant:"outline",onClick:()=>{X(!0)},className:"h-auto py-3 flex flex-col items-center gap-2 rounded-xl",children:[e.jsx(Ce,{className:"w-5 h-5"}),e.jsx("span",{className:"text-xs",children:"Finanz-Eintrag"})]})]})]})]}),e.jsxs(xe,{className:"px-5 pb-3 pt-2 sticky bottom-0 bg-background border-t border-border",children:[e.jsx(_,{variant:"outline",onClick:()=>{try{v(!1),setTimeout(()=>{try{n("/calendar")}catch(a){console.error("Navigation error:",a),b.error("Fehler beim Navigieren zum Kalender")}},100)}catch(a){console.error("Dialog close error:",a),b.error("Fehler beim Schließen des Dialogs")}},className:"h-11 min-h-[44px] flex-1 rounded-xl text-sm font-medium",children:"Zum Kalender"}),e.jsx(_,{variant:"default",onClick:()=>v(!1),className:"h-11 min-h-[44px] flex-1 rounded-xl text-sm font-medium",children:"Schließen"})]})]})}),e.jsx(he,{open:u,onOpenChange:k,children:e.jsxs(fe,{className:"!fixed !top-[50%] !left-[50%] !right-auto !bottom-auto !translate-x-[-50%] !translate-y-[-50%] !w-[85vw] !max-w-sm !max-h-fit !rounded-3xl !m-0 !overflow-visible !shadow-2xl",children:[e.jsx(ge,{className:"px-5 pt-5 pb-3",children:e.jsx(pe,{className:"text-lg font-semibold",children:"Termin erstellen"})}),e.jsxs("div",{className:"px-5 pb-2 space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium mb-1 block",children:"Titel"}),e.jsx("input",{type:"text",id:"reminder-title",placeholder:"z.B. Arzttermin",className:"w-full px-3 py-2 border border-border rounded-lg text-sm",autoFocus:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium mb-1 block",children:"Datum"}),e.jsx("input",{type:"date",id:"reminder-date",defaultValue:d?.toISOString().split("T")[0],className:"w-full px-3 py-2 border border-border rounded-lg text-sm"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium mb-1 block",children:"Uhrzeit (optional)"}),e.jsx("input",{type:"time",id:"reminder-time",className:"w-full px-3 py-2 border border-border rounded-lg text-sm"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium mb-1 block",children:"Notizen (optional)"}),e.jsx("textarea",{id:"reminder-notes",placeholder:"Weitere Details...",rows:3,className:"w-full px-3 py-2 border border-border rounded-lg text-sm resize-none"})]})]}),e.jsxs(xe,{className:"px-5 pb-3 pt-2",children:[e.jsx(_,{variant:"outline",onClick:()=>k(!1),className:"h-11 min-h-[44px] flex-1 rounded-xl text-sm font-medium",children:"Abbrechen"}),e.jsx(_,{variant:"default",onClick:async()=>{try{const a=document.getElementById("reminder-title"),g=document.getElementById("reminder-date"),N=document.getElementById("reminder-time"),P=document.getElementById("reminder-notes");if(!a.value.trim()){b.error("Bitte gib einen Titel ein");return}const S=new Date(g.value);if(N.value){const[F,$]=N.value.split(":");S.setHours(parseInt(F),parseInt($))}else S.setHours(12,0);await Mt({title:a.value.trim(),type:"termin",dueDate:S,isAllDay:!N.value,notes:P.value.trim()||null}),b.success("Termin erstellt"),k(!1),v(!1),w()}catch(a){b.error(a.message||"Fehler beim Erstellen des Termins")}},className:"h-11 min-h-[44px] flex-1 rounded-xl text-sm font-medium",children:"Erstellen"})]})]})}),e.jsx(he,{open:A,onOpenChange:X,children:e.jsxs(fe,{className:"!fixed !top-[50%] !left-[50%] !right-auto !bottom-auto !translate-x-[-50%] !translate-y-[-50%] !w-[85vw] !max-w-sm !max-h-fit !rounded-3xl !m-0 !overflow-visible !shadow-2xl",children:[e.jsx(ge,{className:"px-5 pt-5 pb-3",children:e.jsx(pe,{className:"text-lg font-semibold",children:"Finanz-Eintrag erstellen"})}),e.jsxs("div",{className:"px-5 pb-2 space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium mb-1 block",children:"Beschreibung"}),e.jsx("input",{type:"text",id:"finance-description",placeholder:"z.B. Einkauf, Gehalt",className:"w-full px-3 py-2 border border-border rounded-lg text-sm",autoFocus:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium mb-1 block",children:"Betrag (CHF)"}),e.jsx("input",{type:"number",id:"finance-amount",placeholder:"0.00",step:"0.01",className:"w-full px-3 py-2 border border-border rounded-lg text-sm"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium mb-1 block",children:"Typ"}),e.jsxs("select",{id:"finance-type",className:"w-full px-3 py-2 border border-border rounded-lg text-sm",children:[e.jsx("option",{value:"einnahme",children:"Einnahme"}),e.jsx("option",{value:"ausgabe",children:"Ausgabe"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium mb-1 block",children:"Datum"}),e.jsx("input",{type:"date",id:"finance-date",defaultValue:d?.toISOString().split("T")[0],className:"w-full px-3 py-2 border border-border rounded-lg text-sm"})]})]}),e.jsxs(xe,{className:"px-5 pb-3 pt-2",children:[e.jsx(_,{variant:"outline",onClick:()=>X(!1),className:"h-11 min-h-[44px] flex-1 rounded-xl text-sm font-medium",children:"Abbrechen"}),e.jsx(_,{variant:"default",onClick:async()=>{try{const a=document.getElementById("finance-description"),g=document.getElementById("finance-amount"),N=document.getElementById("finance-type"),P=document.getElementById("finance-date");if(!a.value.trim()){b.error("Bitte gib eine Beschreibung ein");return}if(!g.value||parseFloat(g.value)<=0){b.error("Bitte gib einen gültigen Betrag ein");return}await Pt({description:a.value.trim(),amount:Math.round(parseFloat(g.value)*100),type:N.value,date:new Date(P.value),category:"Sonstiges",currency:"CHF",isRecurring:!1}),b.success("Finanz-Eintrag erstellt"),X(!1),v(!1)}catch(a){b.error(a.message||"Fehler beim Erstellen des Finanz-Eintrags")}},className:"h-11 min-h-[44px] flex-1 rounded-xl text-sm font-medium",children:"Erstellen"})]})]})}),e.jsx(he,{open:j,onOpenChange:y,children:e.jsxs(fe,{className:"!fixed !top-[50%] !left-[50%] !right-auto !bottom-auto !translate-x-[-50%] !translate-y-[-50%] !w-[85vw] !max-w-sm !max-h-fit !rounded-3xl !m-0 !overflow-visible !shadow-2xl",children:[e.jsx(ge,{className:"px-5 pt-5 pb-3",children:e.jsx(pe,{className:"text-lg font-semibold",children:h?.title})}),e.jsxs("div",{className:"space-y-3 px-5 pb-2",children:[h?.date&&e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-muted-foreground mb-1",children:"Datum"}),e.jsx("p",{className:"text-sm",children:new Date(h.date).toLocaleDateString("de-CH",{weekday:"long",day:"numeric",month:"long",year:"numeric"})})]}),h?.time&&e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-muted-foreground mb-1",children:"Uhrzeit"}),e.jsx("p",{className:"text-sm",children:h.time})]}),h?.description&&e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-muted-foreground mb-1",children:"Beschreibung"}),e.jsx("p",{className:"text-sm",children:h.description})]}),h?.personName&&e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-muted-foreground mb-1",children:"Person"}),e.jsx("p",{className:"text-sm",children:h.personName})]}),h?.amount&&e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-muted-foreground mb-1",children:"Betrag"}),e.jsxs("p",{className:"text-sm",children:["CHF ",h.amount.toFixed(2)]})]})]}),e.jsxs(xe,{className:"px-5 pb-3 pt-2",children:[e.jsx(_,{variant:"outline",onClick:()=>{y(!1),n("/calendar")},className:"h-11 min-h-[44px] w-full rounded-xl text-sm font-medium",children:"Zum Kalender"}),e.jsx(_,{variant:"outline",onClick:()=>y(!1),className:"h-11 min-h-[44px] w-full rounded-xl text-sm font-medium",children:"Schließen"})]})]})})]})}const Vs=[{path:"/",icon:en,label:"Assistent"},{path:"/dashboard",icon:nt,label:"Dashboard"},{path:"/calendar",icon:st,label:"Kalender"},{path:"/reminders",icon:Ge,label:"Erinnerungen"},{path:"/finance",icon:Ce,label:"Finanzen"},{path:"/people",icon:We,label:"Personen"},{path:"/bills",icon:Re,label:"Rechnungen"},{path:"/documents",icon:ze,label:"Dokumente"},{path:"/shopping",icon:Le,label:"Einkaufen"},{path:"/taxes",icon:St,label:"Steuern"},{path:"/settings",icon:$e,label:"Einstellungen"}];function Zs({open:n,onClose:t,currentChatId:s,onSelectChat:i,onNewChat:o}){const[l]=_e(),{user:c}=Rs(),{isEnabled:d}=_t(),[x,h]=p(!1),{data:f,refetch:m}=rt(),v=U(null);K(()=>{n&&m()},[n,m]),K(()=>{const u=k=>{v.current&&!v.current.contains(k.target)&&h(!1)};return document.addEventListener("mousedown",u),()=>document.removeEventListener("mousedown",u)},[]);const j=u=>{const k=typeof u=="string"?new Date(u):typeof u=="number"?new Date(u):u,X=new Date().getTime()-k.getTime(),W=Math.floor(X/(1e3*60*60*24));return W===0?"Heute":W===1?"Gestern":W<7?`${W} Tage`:k.toLocaleDateString("de-DE",{day:"2-digit",month:"2-digit"})},y=()=>{if(c?.displayName){const u=c.displayName.split(" ");return u.length>=2?(u[0][0]+u[1][0]).toUpperCase():c.displayName.substring(0,2).toUpperCase()}return c?.email?c.email.substring(0,2).toUpperCase():"U"};return e.jsxs(e.Fragment,{children:[n&&e.jsx("div",{className:D("fixed inset-0 z-40 transition-opacity",d?"bg-black/5":"bg-black/50"),onClick:t}),e.jsx("aside",{className:D("fixed top-0 left-0 h-full w-full max-w-sm z-50 transform transition-transform duration-300 ease-in-out shadow-xl",n?"translate-x-0":"-translate-x-full",d?"bg-background/95 backdrop-blur-md":"bg-background"),"aria-label":"Hauptnavigation","aria-hidden":!n,children:e.jsxs("div",{className:"flex flex-col h-full",children:[e.jsxs("div",{className:"p-4 border-b border-border",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-3",children:[e.jsx("button",{onClick:t,className:"p-2 hover:bg-muted rounded-lg transition-colors","aria-label":"Menü schließen",children:e.jsx(Te,{className:"w-5 h-5"})}),e.jsx("h2",{className:"text-lg font-semibold flex-1",children:"Menü"})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs("button",{onClick:()=>{o&&o(),t()},className:"flex-1 flex items-center justify-center gap-2 px-3 py-2 rounded-lg bg-primary text-primary-foreground hover:bg-primary/90 transition-colors text-sm font-medium","aria-label":"Neue Konversation",children:[e.jsx(Ct,{className:"w-4 h-4"}),e.jsx("span",{children:"Neue Konversation"})]}),e.jsxs("div",{className:"relative",ref:v,children:[e.jsxs("button",{onClick:()=>{h(!x),x||m()},className:"flex items-center justify-center gap-2 px-3 py-2 rounded-lg bg-muted hover:bg-muted/80 transition-colors text-sm font-medium","aria-label":"Chat-Verlauf",children:[e.jsx(kt,{className:"w-4 h-4"}),e.jsx("span",{children:"Verlauf"})]}),x&&e.jsxs("div",{className:"absolute top-full right-0 mt-2 w-72 bg-background border border-border rounded-lg shadow-lg z-50 overflow-hidden max-h-[60vh] flex flex-col",children:[e.jsxs("div",{className:"p-3 border-b border-border flex items-center justify-between",children:[e.jsx("h3",{className:"text-sm font-semibold",children:"Chat-Verlauf"}),e.jsx("button",{onClick:()=>h(!1),className:"p-1 hover:bg-muted rounded transition-colors",children:e.jsx(Te,{className:"w-4 h-4"})})]}),e.jsx("div",{className:"overflow-y-auto",children:f.length===0?e.jsx("p",{className:"text-sm text-muted-foreground py-4 px-3 text-center",children:"Noch keine Konversationen"}):e.jsx("div",{className:"p-2",children:f.map(u=>{const k=s===u.id;return e.jsx("button",{onClick:()=>{i&&i(u.id),h(!1),t()},className:D("w-full flex items-center justify-between gap-2 px-3 py-2.5 rounded-lg transition-colors text-left",k?"bg-primary/10 text-primary":"hover:bg-muted"),children:e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("p",{className:D("text-sm truncate",k&&"font-medium"),children:u.title}),e.jsx("p",{className:"text-xs text-muted-foreground mt-0.5",children:j(u.updatedAt)})]})},u.id)})})})]})]})]})]}),e.jsxs("div",{className:"flex-1 overflow-y-auto",children:[e.jsxs("div",{className:"p-4 border-b border-border",children:[e.jsx("h3",{className:"text-xs font-semibold text-muted-foreground uppercase tracking-wider mb-3",children:"Navigation"}),e.jsx("nav",{className:"space-y-1",children:Vs.map(u=>{const k=u.icon,A=l===u.path;return e.jsx(yn,{href:u.path,children:e.jsxs("button",{onClick:t,className:D("w-full flex items-center gap-3 px-3 py-2.5 rounded-lg transition-colors text-left min-h-[44px]",A?"bg-primary/10 text-primary font-medium":"text-foreground hover:bg-muted"),"aria-label":`Zu ${u.label} navigieren`,"aria-current":A?"page":void 0,"aria-pressed":A,type:"button",role:"menuitem",children:[e.jsx(k,{className:"w-5 h-5 flex-shrink-0","aria-hidden":"true"}),e.jsx("span",{className:"text-sm",children:u.label})]})},u.path)})})]}),e.jsx(qs,{})]}),e.jsx("div",{className:"p-4 border-t border-border",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-10 h-10 rounded-full bg-primary text-primary-foreground flex items-center justify-center flex-shrink-0 text-sm font-medium",children:c?.photoURL?e.jsx("img",{src:c.photoURL,alt:c?.displayName||"Benutzerprofilbild",className:"w-10 h-10 rounded-full object-cover"}):e.jsx("span",{"aria-label":"Benutzerinitialen",children:y()})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("p",{className:"text-sm font-medium truncate",children:c?.displayName||"Benutzer"}),e.jsx("p",{className:"text-xs text-muted-foreground truncate",children:c?.email||"Nicht angemeldet"})]})]})})]})})]})}function Js({title:n,showSidebar:t=!1,showQuickActions:s=!1,quickActions:i=[],currentChatId:o,onSelectChat:l,onNewChat:c,sidebarOpen:d,onSidebarToggle:x}){_e();const[h,f]=p(!1),{isEnabled:m}=_t(),[v,j]=p(!1),{data:y,refetch:u}=rt(),k=U(null),A=d!==void 0?d:h,X=x||f;K(()=>{v&&u()},[v,u]),K(()=>{const I=B=>{k.current&&!k.current.contains(B.target)&&j(!1)};return document.addEventListener("mousedown",I),()=>document.removeEventListener("mousedown",I)},[]);const W=I=>{const B=typeof I=="string"?new Date(I):typeof I=="number"?new Date(I):I,se=new Date().getTime()-B.getTime(),Q=Math.floor(se/(1e3*60*60*24));return Q===0?"Heute":Q===1?"Gestern":Q<7?`${Q} Tage`:B.toLocaleDateString("de-DE",{day:"2-digit",month:"2-digit"})};return e.jsxs(e.Fragment,{children:[t&&e.jsx(Zs,{open:A,onClose:()=>X(!1),currentChatId:o,onSelectChat:l,onNewChat:c}),e.jsx("header",{className:D("fixed top-0 left-0 right-0 z-40 border-b safe-top",m?"bg-background/95 backdrop-blur-md border-border/30":"bg-background border-border"),children:e.jsxs("div",{className:"px-4 h-14 flex items-center gap-3",children:[e.jsx("div",{className:"flex-1 flex items-center justify-center",children:e.jsx("h1",{className:"text-lg font-semibold text-center",children:n})}),c&&e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{onClick:()=>{c&&c()},className:"p-2 hover:bg-muted rounded-lg transition-colors","aria-label":"Neue Konversation",children:e.jsx(Ct,{className:"w-5 h-5"})}),e.jsxs("div",{className:"relative",ref:k,children:[e.jsx("button",{onClick:()=>{j(!v),v||u()},className:"p-2 hover:bg-muted rounded-lg transition-colors","aria-label":"Chat-Verlauf",children:e.jsx(kt,{className:"w-5 h-5"})}),v&&e.jsxs("div",{className:"absolute top-full right-0 mt-2 w-72 bg-background border border-border rounded-lg shadow-lg z-50 overflow-hidden max-h-[60vh] flex flex-col",children:[e.jsxs("div",{className:"p-3 border-b border-border flex items-center justify-between",children:[e.jsx("h3",{className:"text-sm font-semibold",children:"Chat-Verlauf"}),e.jsx("button",{onClick:()=>j(!1),className:"p-1 hover:bg-muted rounded transition-colors",children:e.jsx(Te,{className:"w-4 h-4"})})]}),e.jsx("div",{className:"overflow-y-auto",children:y.length===0?e.jsx("p",{className:"text-sm text-muted-foreground py-4 px-3 text-center",children:"Noch keine Konversationen"}):e.jsx("div",{className:"p-2",children:y.map(I=>{const B=o===I.id;return e.jsx("button",{onClick:()=>{l&&l(I.id),j(!1)},className:D("w-full flex items-center justify-between gap-2 px-3 py-2.5 rounded-lg transition-colors text-left",B?"bg-primary/10 text-primary":"hover:bg-muted"),children:e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("p",{className:D("text-sm truncate",B&&"font-medium"),children:I.title}),e.jsx("p",{className:"text-xs text-muted-foreground mt-0.5",children:W(I.updatedAt)})]})},I.id)})})})]})]})]})]})})]})}function Ue(n){const t=U(n);t.current=n;const s=U(null);return s.current||(s.current=function(...i){return t.current.apply(this,i)}),s.current}function Kt(n={}){const{onKeyDown:t,onCompositionStart:s,onCompositionEnd:i}=n,o=U(!1),l=U(null),c=U(null),d=Ue(m=>{l.current&&(clearTimeout(l.current),l.current=null),c.current&&(clearTimeout(c.current),c.current=null),o.current=!0,s?.(m)}),x=Ue(m=>{l.current=setTimeout(()=>{c.current=setTimeout(()=>{o.current=!1})}),i?.(m)}),h=Ue(m=>{if(o.current&&(m.key==="Escape"||m.key==="Enter"&&!m.shiftKey)){m.stopPropagation();return}t?.(m)}),f=Ue(()=>o.current);return{onCompositionStart:d,onCompositionEnd:x,onKeyDown:h,isComposing:f}}function me({className:n,type:t,onKeyDown:s,onCompositionStart:i,onCompositionEnd:o,...l}){const c=it(),{onCompositionStart:d,onCompositionEnd:x,onKeyDown:h}=Kt({onKeyDown:f=>{const m=f.nativeEvent.isComposing||c.justEndedComposing();f.key==="Enter"&&m||s?.(f)},onCompositionStart:f=>{c.setComposing(!0),i?.(f)},onCompositionEnd:f=>{c.markCompositionEnd(),setTimeout(()=>{c.setComposing(!1)},100),o?.(f)}});return e.jsx("input",{type:t,"data-slot":"input",className:D("file:text-foreground placeholder:text-muted-foreground selection:bg-primary selection:text-primary-foreground dark:bg-input/30 border-input h-9 w-full min-w-0 rounded-md border bg-transparent px-3 py-1 text-base shadow-xs transition-[color,box-shadow] outline-none file:inline-flex file:h-7 file:border-0 file:bg-transparent file:text-sm file:font-medium disabled:pointer-events-none disabled:cursor-not-allowed disabled:opacity-50 md:text-sm","focus-visible:border-ring focus-visible:ring-ring/50 focus-visible:ring-[3px]","aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive",n),onCompositionStart:d,onCompositionEnd:x,onKeyDown:h,...l})}function Y({className:n,...t}){return e.jsx(An,{"data-slot":"label",className:D("flex items-center gap-2 text-sm leading-none font-medium select-none group-data-[disabled=true]:pointer-events-none group-data-[disabled=true]:opacity-50 peer-disabled:cursor-not-allowed peer-disabled:opacity-50",n),...t})}function Ee({...n}){return e.jsx(In,{"data-slot":"select",...n})}function Ae({...n}){return e.jsx(Tn,{"data-slot":"select-value",...n})}function Ie({className:n,size:t="default",children:s,...i}){return e.jsxs(Fn,{"data-slot":"select-trigger","data-size":t,className:D("border-input data-[placeholder]:text-muted-foreground [&_svg:not([class*='text-'])]:text-muted-foreground focus-visible:border-ring focus-visible:ring-ring/50 aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive dark:bg-input/30 dark:hover:bg-input/50 flex w-fit items-center justify-between gap-2 rounded-md border bg-transparent px-3 py-2 text-sm whitespace-nowrap shadow-xs transition-[color,box-shadow] outline-none focus-visible:ring-[3px] disabled:cursor-not-allowed disabled:opacity-50 data-[size=default]:h-9 data-[size=sm]:h-8 *:data-[slot=select-value]:line-clamp-1 *:data-[slot=select-value]:flex *:data-[slot=select-value]:items-center *:data-[slot=select-value]:gap-2 [&_svg]:pointer-events-none [&_svg]:shrink-0 [&_svg:not([class*='size-'])]:size-4",n),...i,children:[s,e.jsx(Rn,{asChild:!0,children:e.jsx(Dt,{className:"size-4 opacity-50"})})]})}function Fe({className:n,children:t,position:s="popper",align:i="center",...o}){return e.jsx(zn,{children:e.jsxs(Mn,{"data-slot":"select-content",className:D("bg-popover text-popover-foreground data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 relative z-50 max-h-(--radix-select-content-available-height) min-w-[8rem] origin-(--radix-select-content-transform-origin) overflow-x-hidden overflow-y-auto rounded-md border shadow-md",s==="popper"&&"data-[side=bottom]:translate-y-1 data-[side=left]:-translate-x-1 data-[side=right]:translate-x-1 data-[side=top]:-translate-y-1",n),position:s,align:i,...o,children:[e.jsx(Ys,{}),e.jsx(Pn,{className:D("p-1",s==="popper"&&"h-[var(--radix-select-trigger-height)] w-full min-w-[var(--radix-select-trigger-width)] scroll-my-1"),children:t}),e.jsx(Xs,{})]})})}function re({className:n,children:t,...s}){return e.jsxs(Bn,{"data-slot":"select-item",className:D("focus:bg-accent focus:text-accent-foreground [&_svg:not([class*='text-'])]:text-muted-foreground relative flex w-full cursor-default items-center gap-2 rounded-sm py-1.5 pr-8 pl-2 text-sm outline-hidden select-none data-[disabled]:pointer-events-none data-[disabled]:opacity-50 [&_svg]:pointer-events-none [&_svg]:shrink-0 [&_svg:not([class*='size-'])]:size-4 *:[span]:last:flex *:[span]:last:items-center *:[span]:last:gap-2",n),...s,children:[e.jsx("span",{className:"absolute right-2 flex size-3.5 items-center justify-center",children:e.jsx(Ln,{children:e.jsx(Et,{className:"size-4"})})}),e.jsx(_n,{children:t})]})}function Ys({className:n,...t}){return e.jsx(On,{"data-slot":"select-scroll-up-button",className:D("flex cursor-default items-center justify-center py-1",n),...t,children:e.jsx(tn,{className:"size-4"})})}function Xs({className:n,...t}){return e.jsx(Un,{"data-slot":"select-scroll-down-button",className:D("flex cursor-default items-center justify-center py-1",n),...t,children:e.jsx(Dt,{className:"size-4"})})}function Qs({className:n,...t}){return e.jsx(Kn,{"data-slot":"switch",className:D("peer data-[state=checked]:bg-primary data-[state=unchecked]:bg-input focus-visible:border-ring focus-visible:ring-ring/50 dark:data-[state=unchecked]:bg-input/80 inline-flex h-[1.15rem] w-8 shrink-0 items-center rounded-full border border-transparent shadow-xs transition-all outline-none focus-visible:ring-[3px] disabled:cursor-not-allowed disabled:opacity-50",n),...t,children:e.jsx(Hn,{"data-slot":"switch-thumb",className:D("bg-background dark:data-[state=unchecked]:bg-foreground dark:data-[state=checked]:bg-primary-foreground pointer-events-none block size-4 rounded-full ring-0 transition-transform data-[state=checked]:translate-x-[calc(100%-2px)] data-[state=unchecked]:translate-x-0")})})}const ea={light:10,medium:20,heavy:30,success:[50,50,50],error:[100,50,100],warning:[50,100,50],selection:5};function ot(n="medium"){if(!navigator.vibrate)return;const t=ea[n];try{navigator.vibrate(t)}catch{}}function Ye(){ot("success")}function ta(){ot("error")}function Ka(){ot("selection")}function na(n){const t=n,s=t?.data?.requestId||t?.requestId||null;if(t?.code==="unavailable"||t?.message?.includes("network")||t?.message?.includes("fetch"))return{title:"Verbindungsfehler",message:"Keine Internetverbindung. Bitte überprüfen Sie Ihre Netzwerkverbindung und versuchen Sie es erneut.",action:"Erneut versuchen",retryable:!0};if(t?.code==="deadline-exceeded"||t?.message?.includes("timeout"))return{title:"Zeitüberschreitung",message:"Die Anfrage hat zu lange gedauert. Bitte versuchen Sie es erneut.",action:"Erneut versuchen",retryable:!0};if(t?.code==="permission-denied"||t?.message?.includes("permission"))return{title:"Berechtigung verweigert",message:"Sie haben keine Berechtigung für diese Aktion. Bitte kontaktieren Sie den Administrator.",retryable:!1};if(t?.code==="unauthenticated"||t?.message?.includes("auth")||t?.message?.includes("login"))return{title:"Anmeldung erforderlich",message:"Bitte melden Sie sich an, um fortzufahren.",action:"Anmelden",retryable:!1};if(t?.code==="not-found"||t?.message?.includes("not found"))return{title:"Nicht gefunden",message:"Die angeforderte Ressource wurde nicht gefunden.",retryable:!1};if(t?.code==="invalid-argument"||t?.message?.includes("validation")||t?.message?.includes("invalid"))return{title:"Ungültige Eingabe",message:t?.message||"Bitte überprüfen Sie Ihre Eingabe und versuchen Sie es erneut.",retryable:!1};if(t?.code==="resource-exhausted"||t?.message?.includes("quota"))return{title:"Kontingent überschritten",message:"Das Tageslimit wurde erreicht. Bitte versuchen Sie es später erneut.",retryable:!1};if(t?.message?.includes("billing")||t?.message?.includes("Billing"))return{title:"Abrechnungsfehler",message:"Google Cloud Billing ist erforderlich. Bitte kontaktieren Sie den Administrator.",retryable:!1};if(t?.code?.startsWith("functions/"))return{title:"Server-Fehler",message:`Ein Fehler ist aufgetreten: ${t.code.replace("functions/","")}. Bitte versuchen Sie es später erneut.`,action:"Erneut versuchen",retryable:!0};let i=t?.message||t?.toString()||"Ein unbekannter Fehler ist aufgetreten.";return s&&(i+=`

Request ID: ${s.substring(0,8)}...`),{title:"Fehler",message:i.length>200?`${i.substring(0,200)}...`:i,action:"Erneut versuchen",retryable:!0,requestId:s||void 0}}function sa(n){return na(n).message}function aa({className:n,children:t,...s}){return e.jsxs(Wn,{"data-slot":"scroll-area",className:D("relative",n),...s,children:[e.jsx($n,{"data-slot":"scroll-area-viewport",className:"focus-visible:ring-ring/50 size-full rounded-[inherit] transition-[color,box-shadow] outline-none focus-visible:ring-[3px] focus-visible:outline-1",children:t}),e.jsx(ra,{}),e.jsx(Gn,{})]})}function ra({className:n,orientation:t="vertical",...s}){return e.jsx(qn,{"data-slot":"scroll-area-scrollbar",orientation:t,className:D("hidden opacity-0 w-0 h-0 invisible pointer-events-none",n),...s,children:e.jsx(Vn,{"data-slot":"scroll-area-thumb",className:"hidden opacity-0 w-0 h-0"})})}const ia={"layout-dashboard":nt,calendar:st,bell:Ge,wallet:Ce,users:We,"file-text":St,folder:ze,"scan-line":ze,"shopping-cart":Le,receipt:Re,"clipboard-list":Re,settings:$e,check:Et,plus:At,search:xn,edit:gn,trash:fn,clock:hn,euro:mn,"trending-up":un,"trending-down":dn,info:cn,"alert-circle":ln},oa={dashboard:{path:"/",icon:nt},calendar:{path:"/calendar",icon:st},reminders:{path:"/reminders",icon:Ge},finances:{path:"/finance",icon:Ce},finance:{path:"/finance",icon:Ce},finanzen:{path:"/finance",icon:Ce},people:{path:"/people",icon:We},personen:{path:"/people",icon:We},invoices:{path:"/bills",icon:Re},bills:{path:"/bills",icon:Re},rechnungen:{path:"/bills",icon:Re},documents:{path:"/documents",icon:ze},dokumente:{path:"/documents",icon:ze},shopping:{path:"/shopping",icon:Le},einkaufsliste:{path:"/shopping",icon:Le},settings:{path:"/settings",icon:$e},einstellungen:{path:"/settings",icon:$e}};function la({content:n,onNavigate:t}){const s=ce(()=>{const i=[],o=n.length>1e4?n.substring(0,1e4)+"...":n;let l=0,c=0;const d=/\[(nav|icon):([a-zA-Z0-9_-]+)(?:[|｜]([^\]]+))?\]/g;let x;const h=[];for(;(x=d.exec(o))!==null;)h.push({index:x.index,type:x[1],key:x[2],label:x[3],endIndex:x.index+x[0].length});for(const f of h){if(f.index>l){const m=o.slice(l,f.index);i.push(e.jsx("span",{dangerouslySetInnerHTML:{__html:Xe(m)}},`text-${c++}`))}if(f.type==="nav"&&f.label){const m=f.key,v=f.label,j=oa[m];if(j&&t){const y=j.icon;i.push(e.jsxs("button",{onClick:u=>{u.preventDefault(),u.stopPropagation();try{t(j.path)}catch{}},className:"inline-flex items-center gap-1.5 px-2 py-1 mx-0.5 rounded-lg bg-primary/10 hover:bg-primary/20 text-primary font-medium text-sm transition-all duration-200 cursor-pointer border border-primary/20 hover:border-primary/40 hover:shadow-sm",title:`Zu ${v} navigieren`,children:[e.jsx(y,{className:"size-4"}),e.jsx("span",{className:"underline decoration-dotted underline-offset-2",children:Ke(v)})]},`nav-${c++}`))}else i.push(e.jsx("span",{className:"font-medium text-primary",children:Ke(v)},`nav-text-${c++}`))}else if(f.type==="icon"){const m=f.key,v=ia[m];v?i.push(e.jsx(v,{className:"inline-block size-4 mx-0.5 align-text-bottom text-primary"},`icon-${c++}`)):i.push(e.jsxs("span",{children:["[",Ke(m),"]"]},`unknown-${c++}`))}l=f.endIndex}if(l<o.length){const f=o.slice(l);i.push(e.jsx("span",{dangerouslySetInnerHTML:{__html:Xe(f)}},`text-${c++}`))}return i.length>0?i:[e.jsx("span",{dangerouslySetInnerHTML:{__html:Xe(o)}},"full")]},[n,t]);return e.jsx("div",{className:"prose prose-sm max-w-none",children:s})}function Ke(n){const t=document.createElement("div");return t.textContent=n,t.innerHTML}function Xe(n){let t=Ke(n);return t=t.replace(/\*\*(.+?)\*\*/g,"<strong>$1</strong>").replace(/__(.+?)__/g,"<strong>$1</strong>"),t=t.replace(new RegExp("(?<!\\*)\\*(?!\\*)(.+?)(?<!\\*)\\*(?!\\*)","g"),"<em>$1</em>"),t=t.replace(/`(.+?)`/g,'<code class="bg-muted px-1.5 py-0.5 rounded text-sm font-mono">$1</code>'),t=t.replace(/\n/g,"<br />"),t}function ca({messages:n,onSendMessage:t,isLoading:s=!1,placeholder:i="Nachricht eingeben...",className:o,height:l="100%",emptyStateMessage:c="Beginne eine Unterhaltung mit dem Assistenten",suggestedPrompts:d}){const{t:x,i18n:h}=Tt(),[,f]=_e(),[m,v]=p(""),j=U(null),y=U(null),u=U(null),k=U(null),A=U(null),X=U(null),[W,I]=p(!1),[B,O]=p(null),[se,Q]=p(!1),T=U(null),w=Z(a=>{localStorage.setItem("nexo_chat_messages",JSON.stringify(n)),localStorage.setItem("nexo_chat_open_popup","true"),localStorage.setItem("nexo_chat_from_route",a),f(a)},[n,f]),E=ce(()=>n.filter(a=>a.role!=="system"),[n]),L=ce(()=>d?d.map(a=>typeof a=="string"?{text:a,icon:"tag"}:a):[],[d]),ee=Z(()=>{const a=j.current?.querySelector("[data-radix-scroll-area-viewport]");a&&requestAnimationFrame(()=>{a.scrollTo({top:a.scrollHeight,behavior:"smooth"})})},[]);K(()=>{E.length>0&&ee()},[E.length,ee]),K(()=>{const a=g=>{T.current&&!T.current.contains(g.target)&&Q(!1)};if(se)return document.addEventListener("mousedown",a),()=>document.removeEventListener("mousedown",a)},[se]);const R=Z(a=>{a.preventDefault();const g=m.trim();if(!(!g||s)){if(g.length>1e4){b.error("Nachricht ist zu lang. Bitte kürze sie auf maximal 10.000 Zeichen.");return}if(s){b.info("Bitte warte auf die Antwort...");return}try{t(g),v(""),ee(),k.current?.focus()}catch{b.error("Fehler beim Senden der Nachricht. Bitte versuche es erneut.")}}},[m,s,t,ee]),ae=Z(a=>{a.key==="Enter"&&!a.shiftKey&&(a.preventDefault(),R(a))},[R]),ve=Z(a=>{s||(t(a),ee())},[s,t,ee]),Se=Z(async a=>{if(a.size>10485760){b.error(`Datei ist zu groß. Maximal ${(10485760/1024/1024).toFixed(0)}MB erlaubt.`);return}if(!a.name||a.name.length>255){b.error("Ungültiger Dateiname.");return}const N=b.loading("Datei wird hochgeladen...");try{const P=await Promise.race([new Promise((G,H)=>{const ne=new FileReader;ne.onload=()=>{const V=ne.result;if(!V||!V.includes(",")){H(new Error("Ungültiges Dateiformat"));return}G(V.split(",")[1])},ne.onerror=()=>H(new Error("Fehler beim Lesen der Datei")),ne.readAsDataURL(a)}),new Promise((G,H)=>setTimeout(()=>H(new Error("Upload-Timeout")),3e4))]),S=z(M,"uploadAIChatFile"),F=await Promise.race([S({fileName:a.name,fileData:P,fileType:a.type}),new Promise((G,H)=>setTimeout(()=>H(new Error("Upload-Timeout")),6e4))]);if(!F?.data)throw new Error("Keine Antwort vom Server erhalten");const $=F.data;if(!$.fileUrl||!$.fileName)throw new Error("Ungültige Server-Antwort");b.dismiss(N),t(`[Datei: ${$.fileName}](${$.fileUrl})`),b.success("Datei erfolgreich hochgeladen")}catch(P){b.dismiss(N);const S=P.message||"Unbekannter Fehler";b.error(`Fehler beim Hochladen: ${S}`)}},[t]),te=Z(async a=>{if(!a.type.startsWith("image/")){b.error("Bitte wähle ein Bild aus (JPG, PNG, GIF, etc.)");return}const g=5*1024*1024;if(a.size>g){b.error(`Bild ist zu groß. Maximal ${(g/1024/1024).toFixed(0)}MB erlaubt.`);return}if(!a.name||a.name.length>255){b.error("Ungültiger Dateiname.");return}const N=b.loading("Bild wird hochgeladen...");try{const P=await Promise.race([new Promise((G,H)=>{const ne=new FileReader;ne.onload=()=>{const V=ne.result;if(!V||!V.includes(",")){H(new Error("Ungültiges Bildformat"));return}G(V.split(",")[1])},ne.onerror=()=>H(new Error("Fehler beim Lesen des Bildes")),ne.readAsDataURL(a)}),new Promise((G,H)=>setTimeout(()=>H(new Error("Upload-Timeout")),3e4))]),S=z(M,"uploadAIChatImage"),F=await Promise.race([S({fileName:a.name,fileData:P,fileType:a.type}),new Promise((G,H)=>setTimeout(()=>H(new Error("Upload-Timeout")),6e4))]);if(!F?.data)throw new Error("Keine Antwort vom Server erhalten");const $=F.data;if(!$.imageUrl||!$.fileName)throw new Error("Ungültige Server-Antwort");b.dismiss(N),t(`![${$.fileName}](${$.imageUrl})`),b.success("Bild erfolgreich hochgeladen")}catch(P){b.dismiss(N);const S=P.message||"Unbekannter Fehler";b.error(`Fehler beim Hochladen: ${S}`)}},[t]),ie=Z(async()=>{if(W&&B){try{B.stop(),I(!1),b.info("Aufnahme wird verarbeitet...")}catch{I(!1),b.error("Fehler beim Stoppen der Aufnahme")}return}try{if(!navigator.mediaDevices||!navigator.mediaDevices.getUserMedia){b.error("Mikrofon-Zugriff wird von diesem Browser nicht unterstützt.");return}const a=await Promise.race([navigator.mediaDevices.getUserMedia({audio:!0}),new Promise((S,F)=>setTimeout(()=>F(new Error("Mikrofon-Zugriff-Timeout")),1e4))]),g=new MediaRecorder(a),N=[];let P=null;g.ondataavailable=S=>{S.data.size>0&&N.push(S.data)},g.onstop=async()=>{P&&clearTimeout(P);const S=new Blob(N,{type:"audio/webm"}),F=10*1024*1024;if(S.size>F){b.error("Audio-Aufnahme ist zu groß. Bitte kürze die Aufnahme."),a.getTracks().forEach(G=>G.stop());return}const $=b.loading("Audio wird transkribiert...");try{const G=await Promise.race([new Promise((we,oe)=>{const de=new FileReader;de.onload=()=>{const je=de.result;if(!je||!je.includes(",")){oe(new Error("Ungültiges Audioformat"));return}we(je.split(",")[1])},de.onerror=()=>oe(new Error("Fehler beim Lesen der Audio-Datei")),de.readAsDataURL(S)}),new Promise((we,oe)=>setTimeout(()=>oe(new Error("Audio-Verarbeitung-Timeout")),3e4))]),H=z(M,"transcribeAIChatAudio"),ne=await Promise.race([H({audioData:G,mimeType:"audio/webm"}),new Promise((we,oe)=>setTimeout(()=>oe(new Error("Transkription-Timeout")),6e4))]);if(!ne?.data)throw new Error("Keine Antwort vom Server erhalten");const V=ne.data;if(V.transcription&&V.transcription.trim())v(V.transcription.trim()),k.current?.focus(),b.dismiss($),b.success("Spracheingabe erfolgreich");else throw new Error("Keine Transkription erhalten")}catch(G){b.dismiss($);const H=G.message||"Unbekannter Fehler";b.error(`Fehler bei der Transkription: ${H}`)}finally{a.getTracks().forEach(G=>G.stop())}},g.onerror=S=>{b.error("Fehler bei der Aufnahme"),I(!1),a.getTracks().forEach(F=>F.stop())},P=setTimeout(()=>{g.state==="recording"&&(g.stop(),b.warning("Maximale Aufnahmezeit erreicht (5 Minuten)"))},300*1e3),g.start(),O(g),I(!0),b.info("Aufnahme gestartet... (Klicke erneut zum Stoppen)")}catch(a){I(!1);const g=a.message||"Unbekannter Fehler";g.includes("permission")||g.includes("denied")?b.error("Mikrofon-Zugriff wurde verweigert. Bitte erlaube den Zugriff in den Browser-Einstellungen."):g.includes("not found")||g.includes("not available")?b.error("Kein Mikrofon gefunden. Bitte verbinde ein Mikrofon."):b.error(`Mikrofon-Fehler: ${g}`)}},[W,B]),ye=Z(()=>{const g=h.language==="de"?"en":"de";h.changeLanguage(g),localStorage.setItem("language",g),b.success(g==="de"?"Sprache auf Deutsch geändert":"Language changed to English")},[h]),ue=()=>e.jsxs("form",{ref:u,onSubmit:R,className:"w-full",children:[e.jsx("input",{ref:A,type:"file",className:"hidden",onChange:a=>{const g=a.target.files?.[0];g&&Se(g),a.target.value=""},accept:"*/*"}),e.jsx("input",{ref:X,type:"file",className:"hidden",onChange:a=>{const g=a.target.files?.[0];g&&(te(g),Q(!1)),a.target.value=""},accept:"image/*"}),e.jsx("div",{className:"w-full max-w-full mx-auto",children:e.jsxs("div",{className:"flex items-center gap-2 px-2",style:{alignItems:"center"},children:[e.jsx("div",{className:"relative",ref:T,children:se&&e.jsxs("div",{className:"absolute bottom-full left-2 mb-2 bg-background border border-border rounded-lg shadow-lg z-50 min-w-[200px] overflow-hidden",children:[e.jsxs("button",{type:"button",onClick:()=>{A.current?.click()},className:"w-full flex items-center gap-3 px-4 py-3 hover:bg-muted transition-colors text-left",children:[e.jsx(nn,{className:"w-5 h-5 text-muted-foreground"}),e.jsx("span",{className:"text-sm",children:"Datei anhängen"})]}),e.jsxs("button",{type:"button",onClick:()=>{X.current?.click()},className:"w-full flex items-center gap-3 px-4 py-3 hover:bg-muted transition-colors text-left",children:[e.jsx(sn,{className:"w-5 h-5 text-muted-foreground"}),e.jsx("span",{className:"text-sm",children:"Bild hinzufügen"})]}),e.jsxs("button",{type:"button",onClick:()=>{ye(),Q(!1)},className:"w-full flex items-center gap-3 px-4 py-3 hover:bg-muted transition-colors text-left",children:[e.jsx(an,{className:"w-5 h-5 text-muted-foreground"}),e.jsx("span",{className:"text-sm",children:"Sprache wechseln"})]})]})}),e.jsxs("div",{className:"flex-1 relative",children:[e.jsx("button",{type:"button",onClick:()=>Q(!se),className:"absolute left-2 top-1/2 -translate-y-1/2 w-8 h-8 rounded-full bg-transparent hover:bg-muted/50 transition-colors flex items-center justify-center active:scale-95 z-10","aria-label":"Mehr Optionen",disabled:s,children:e.jsx(At,{className:"w-4 h-4 text-muted-foreground"})}),e.jsx("textarea",{ref:k,value:m,onChange:a=>v(a.target.value),onKeyDown:ae,placeholder:i,rows:1,className:"w-full pl-10 pr-4 py-3 rounded-2xl bg-muted border-0 text-base text-foreground placeholder:text-muted-foreground focus:outline-none focus:ring-2 focus:ring-primary/20 transition-all resize-none overflow-y-auto min-h-[44px] max-h-[120px] leading-relaxed",style:{height:"auto",minHeight:"44px"},disabled:s,onInput:a=>{const g=a.target;g.style.height="auto",g.style.height=`${Math.min(g.scrollHeight,120)}px`}})]}),m.trim()?e.jsx("button",{type:"submit",disabled:s,className:"w-10 h-10 rounded-full bg-primary text-primary-foreground hover:bg-primary/90 transition-colors flex items-center justify-center active:scale-95 shadow-md self-center","aria-label":s?"Wird gesendet...":"Nachricht senden",children:s?e.jsx(lt,{className:"w-5 h-5 animate-spin"}):e.jsx(rn,{className:"w-5 h-5"})}):e.jsx("button",{type:"button",onClick:ie,className:D("transition-colors flex items-center justify-center active:scale-95 self-center p-2",W?"text-red-500 hover:text-red-600":"text-foreground hover:text-foreground/80"),"aria-label":"Spracheingabe",disabled:s,children:e.jsx(on,{className:D("w-7 h-7",W?"text-red-500":"text-foreground")})})]})})]});return e.jsx("div",{ref:y,className:D("flex flex-col bg-background text-foreground",o),style:{height:l},children:E.length===0?e.jsxs("div",{className:"flex flex-col h-full animate-in fade-in duration-300 pb-20",children:[e.jsx("div",{className:"flex-1 flex items-center justify-center px-4",children:e.jsx("div",{className:"w-full max-w-2xl"})}),L.length>0&&e.jsx("div",{className:"fixed bottom-24 left-0 right-0 px-4 pb-2 z-20 pointer-events-none",children:e.jsx("div",{className:"w-full max-w-2xl mx-auto",children:e.jsx("div",{className:"overflow-x-auto scrollbar-hide -mx-4 px-4 pointer-events-auto",children:e.jsx("div",{className:"flex gap-3",style:{width:"max-content"},children:L.map((a,g)=>{const N=a.subtitle&&a.subtitle.trim().length>0;return e.jsxs("button",{onClick:()=>ve(a.text),disabled:s,className:"flex-shrink-0 w-[calc(40vw-1rem)] min-w-[140px] max-w-[160px] rounded-xl bg-muted hover:bg-muted/80 active:bg-muted/70 px-2.5 py-2 text-left transition-all duration-200 disabled:cursor-not-allowed disabled:opacity-50 shadow-sm",type:"button",children:[e.jsx("p",{className:"font-medium text-xs text-foreground mb-0.5 line-clamp-2 leading-tight",children:a.text}),N&&e.jsx("p",{className:"text-[10px] text-muted-foreground line-clamp-2 leading-tight",children:a.subtitle})]},g)})})})})}),e.jsx("div",{className:"fixed bottom-0 left-0 right-0 w-full bg-background px-4 py-3 safe-bottom",style:{paddingBottom:"max(0.75rem, env(safe-area-inset-bottom))"},children:e.jsx("div",{className:"w-full max-w-2xl mx-auto",children:ue()})})]}):e.jsxs(e.Fragment,{children:[e.jsx("div",{ref:j,className:"flex-1 overflow-hidden pb-32",children:e.jsx(aa,{className:"h-full [&>div>div]:!overflow-y-auto [&>div>div]:[-ms-overflow-style:none] [&>div>div]:[scrollbar-width:none] [&>div>div::-webkit-scrollbar]:hidden",children:e.jsxs("div",{className:"flex flex-col p-4 space-y-4 pb-6",children:[E.map((a,g)=>e.jsx("div",{className:D("flex gap-3 animate-in fade-in slide-in-from-bottom-2 duration-300",a.role==="user"?"justify-end":"justify-start"),children:e.jsx("div",{className:D("max-w-[85%] select-text",a.role==="user"?"bg-primary text-primary-foreground rounded-2xl px-4 py-3 text-base":"text-foreground text-base"),onClick:N=>{N.target.closest("button, a")||N.stopPropagation()},onMouseDown:N=>{N.target.closest("button, a")||N.stopPropagation()},children:a.role==="assistant"?e.jsx(la,{content:a.content,onNavigate:w}):e.jsx("p",{className:"whitespace-pre-wrap leading-relaxed",children:a.content})})},g)),s&&e.jsx("div",{className:"flex items-start gap-4 justify-start animate-in fade-in duration-200",children:e.jsx("div",{className:"rounded-lg bg-muted px-4 py-3",children:e.jsx(lt,{className:"size-4 animate-spin text-muted-foreground"})})})]})})}),L.length>0&&e.jsx("div",{className:"fixed bottom-24 left-0 right-0 px-4 pb-2 z-20 pointer-events-none",children:e.jsx("div",{className:"w-full max-w-2xl mx-auto",children:e.jsx("div",{className:"overflow-x-auto scrollbar-hide -mx-4 px-4 pointer-events-auto",children:e.jsx("div",{className:"flex gap-3",style:{width:"max-content"},children:L.map((a,g)=>{const N=a.subtitle&&a.subtitle.trim().length>0;return e.jsxs("button",{onClick:()=>ve(a.text),disabled:s,className:"flex-shrink-0 w-[calc(40vw-1rem)] min-w-[140px] max-w-[160px] rounded-xl bg-muted hover:bg-muted/80 active:bg-muted/70 px-2.5 py-2 text-left transition-all duration-200 disabled:cursor-not-allowed disabled:opacity-50 shadow-sm",type:"button",children:[e.jsx("p",{className:"font-medium text-xs text-foreground mb-0.5 line-clamp-2 leading-tight",children:a.text}),N&&e.jsx("p",{className:"text-[10px] text-muted-foreground line-clamp-2 leading-tight",children:a.subtitle})]},g)})})})})}),e.jsx("div",{className:"fixed bottom-0 left-0 right-0 w-full bg-background/95 backdrop-blur-sm px-4 py-3 safe-bottom flex-shrink-0 z-30",style:{paddingBottom:"max(0.75rem, env(safe-area-inset-bottom))"},children:e.jsx("div",{className:"w-full max-w-2xl mx-auto",children:ue()})})]})})}function pt({className:n,onKeyDown:t,onCompositionStart:s,onCompositionEnd:i,...o}){const l=it(),{onCompositionStart:c,onCompositionEnd:d,onKeyDown:x}=Kt({onKeyDown:h=>{const f=h.nativeEvent.isComposing||l.justEndedComposing();h.key==="Enter"&&!h.shiftKey&&f||t?.(h)},onCompositionStart:h=>{l.setComposing(!0),s?.(h)},onCompositionEnd:h=>{l.markCompositionEnd(),setTimeout(()=>{l.setComposing(!1)},100),i?.(h)}});return e.jsx("textarea",{"data-slot":"textarea",className:D("border-input placeholder:text-muted-foreground focus-visible:border-ring focus-visible:ring-ring/50 aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive dark:bg-input/30 flex field-sizing-content min-h-16 w-full rounded-md border bg-transparent px-3 py-2 text-base shadow-xs transition-[color,box-shadow] outline-none focus-visible:ring-[3px] disabled:cursor-not-allowed disabled:opacity-50 md:text-sm",n),onCompositionStart:c,onCompositionEnd:d,onKeyDown:x,...o})}const Be={role:"system",content:"Du bist ein hilfreicher Assistent für die Nexo-Anwendung. Du hilfst Benutzern bei Fragen zu Finanzen, Rechnungen, Terminen und anderen Funktionen der App."};function Ha(){const{t:n}=Tt();_e();const{data:t,isLoading:s,refetch:i}=rt(),[o,l]=p(null),[c,d]=p(!1),[x,h]=p(!1),[f,m]=p(!1),[v,j]=p(!1),[y,u]=p(!1),[k,A]=p(!1),[X,W]=p(!1),[I,B]=p(null),O=U(null),se=U(null),Q=U(null),T=U(null),[w,E]=p({title:"",type:"termin",dueDate:"",isAllDay:!1,amount:"",currency:"CHF",notes:""}),[L,ee]=p(!1),[R,ae]=p({type:"ausgabe",amount:"",category:"",description:"",date:new Date().toISOString().split("T")[0],paymentMethod:"Karte"}),[ve,Se]=p(!1),[te,ie]=p({name:"",quantity:"1",category:"Lebensmittel",store:""}),[ye,ue]=p(!1),a=["Lebensmittel","Getränke","Haushalt","Hygiene","Tierbedarf","Sonstiges"],g=async()=>{if(!te.name){b.error("Bitte Artikelname eingeben");return}ue(!0);try{await Os({item:te.name,quantity:parseInt(te.quantity)||1,category:te.category,estimatedPrice:0,currency:"EUR",unit:null}),b.success("Artikel zur Einkaufsliste hinzugefügt"),u(!1),ie({name:"",quantity:"1",category:"Lebensmittel",store:""})}catch(r){b.error("Fehler beim Hinzufügen des Artikels"),console.error(r)}finally{ue(!1)}},N={income:["Gehalt","Freelance","Investitionen","Geschenk","Sonstiges"],expense:["Lebensmittel","Transport","Wohnen","Unterhaltung","Gesundheit","Kleidung","Bildung","Rechnung","Sonstiges"]},P=async()=>{if(!R.amount||!R.category){b.error("Bitte Betrag und Kategorie eingeben");return}Se(!0);try{await Pt({type:R.type,category:R.category,amount:Math.round(parseFloat(R.amount)*100),currency:"CHF",date:new Date(R.date),paymentMethod:R.paymentMethod,notes:R.description||"",status:R.type==="ausgabe"?"open":void 0}),b.success(R.type==="einnahme"?"Einnahme hinzugefügt":"Ausgabe hinzugefügt"),j(!1),ae({type:"ausgabe",amount:"",category:"",description:"",date:new Date().toISOString().split("T")[0],paymentMethod:"Karte"})}catch(r){b.error("Fehler beim Erstellen des Eintrags"),console.error(r)}finally{Se(!1)}};K(()=>{if(!s&&t.length>0&&!o)l(t[0].id);else if(!s&&t.length===0&&!o){const r=gt();Ze(r).then(()=>{i(),l(r.id)})}},[s,t,o,i]);const[S,F]=p([Be]),$=U(null),G=U(!1);K(()=>{if(o&&o!==$.current)if($.current=o,t.length>0){const r=Je(o,t);r&&r.messages.length>0?F(r.messages):F([Be])}else F([Be])},[o,t]),K(()=>{if(!G.current&&o&&S.length>1){const r=setTimeout(async()=>{G.current=!0;try{const C=Je(o,t);if(C){const J=S.find(le=>le.role==="user");J&&C.title==="Neue Konversation"&&(C.title=Ws(J.content)),C.messages=S,C.updatedAt=new Date().toISOString(),await Ze(C)}}catch{}finally{G.current=!1}},1e3);return()=>clearTimeout(r)}},[S,o,t]);const H=Z(async()=>{const r=gt();try{await Ze(r),l(r.id),F([Be]),await i(),b.success("Neue Konversation gestartet")}catch(C){b.error("Fehler beim Erstellen der neuen Konversation: "+(C instanceof Error?C.message:String(C)))}},[i]),ne=Z(r=>{l(r);const C=Je(r,t);C&&C.messages.length>0?F(C.messages):F([Be])},[t]),V=Is.ai.chat.useMutation({onSuccess:r=>{const C={role:"assistant",content:r.content};F(J=>[...J,C])},onError:r=>{let C="Ein unbekannter Fehler ist aufgetreten.";r.message.includes("<!doctype")||r.message.includes("Unexpected token")||r.message.includes("Failed to fetch")?C="Der Server ist nicht erreichbar oder gibt eine ungültige Antwort zurück. Bitte stelle sicher, dass der Server läuft und du eine Internetverbindung hast.":r.message.includes("Unable to transform")||r.message.includes("NetworkError")?C="Fehler bei der Datenübertragung. Bitte überprüfe deine Internetverbindung und versuche es erneut.":r.data?.code==="UNAUTHORIZED"||r.message.includes("unauthenticated")?C="Du bist nicht angemeldet. Bitte melde dich an.":r.data?.code==="INTERNAL_SERVER_ERROR"||r.message.includes("500")?C="Ein Serverfehler ist aufgetreten. Bitte versuche es später erneut.":r.message.includes("timeout")||r.message.includes("Timeout")?C="Die Anfrage hat zu lange gedauert. Bitte versuche es erneut.":r.message.includes("rate limit")||r.message.includes("429")?C="Zu viele Anfragen. Bitte warte einen Moment und versuche es erneut.":C=r.message||"Ein Fehler ist aufgetreten.";const J={role:"assistant",content:`**Fehler aufgetreten**

${C}

Bitte versuche es erneut oder starte eine neue Konversation.`};F(le=>[...le,J]),b.error("Fehler beim Senden der Nachricht")}}),we=Z(r=>{if(r.length>1e4){b.error("Nachricht ist zu lang. Bitte kürze sie auf maximal 10.000 Zeichen.");return}if(S.filter(J=>J.role==="user").length>=50){b.warning("Zu viele Nachrichten in dieser Konversation. Bitte starte eine neue Konversation.");return}try{const J={role:"user",content:r},le=[...S,J];F(le),V.mutate({messages:le})}catch{b.error("Fehler beim Senden der Nachricht. Bitte versuche es erneut.")}},[S,V]),oe=ce(()=>[{text:"Wie funktioniert die Rechnungsverwaltung?",subtitle:"Lerne die Rechnungsverwaltung kennen",icon:"receipt"},{text:"Wie erstelle ich eine Erinnerung?",subtitle:"Erstelle Termine und Erinnerungen",icon:"bell"},{text:"Wie verwalte ich meine Finanzen?",subtitle:"Verwalte Einnahmen und Ausgaben",icon:"wallet"},{text:"Was kann ich mit der Einkaufsliste machen?",subtitle:"Verwalte deine Einkaufsliste",icon:"shoppingCart"},{text:"Wie funktioniert das Raten-System?",subtitle:"Lerne Ratenzahlungen zu verwalten",icon:"calendar"},{text:"Wie scanne ich eine Rechnung?",subtitle:"Erfasse Rechnungen automatisch",icon:"scan"}],[]),de=S.some(r=>r.role==="user"),je=()=>o&&t.length>0&&t.find(C=>C.id===o)?.title||"Assistent",q=ce(()=>[{id:"reminder",label:"Erinnerung erstellen",path:"#",icon:Ge,onClick:()=>h(!0)},{id:"scan",label:"Rechnung scannen",path:"#",icon:ze,onClick:()=>{m(!0),B(null)}},{id:"finance",label:"Finanzübersicht",path:"#",icon:Ce,onClick:()=>j(!0)},{id:"shopping",label:"Einkaufsliste",path:"#",icon:Le,onClick:()=>u(!0)}],[]),Ht=async()=>{if(!w.title||!w.dueDate){b.error("Bitte füllen Sie Titel und Datum aus");return}ee(!0);try{const r=w.amount?Math.round(parseFloat(w.amount)*100):void 0;await Mt({title:w.title,type:w.type,dueDate:new Date(w.dueDate),isAllDay:w.isAllDay,amount:r,currency:w.currency,notes:w.notes||""}),b.success("Erinnerung erstellt"),h(!1),E({title:"",type:"termin",dueDate:"",isAllDay:!1,amount:"",currency:"CHF",notes:""})}catch(r){b.error("Fehler beim Erstellen der Erinnerung"),console.error(r)}finally{ee(!1)}},Wt=async()=>{try{const r=await navigator.mediaDevices.getUserMedia({video:{facingMode:"environment"}});T.current=r,O.current&&(O.current.srcObject=r),A(!0),Ye()}catch(r){b.error(sa(r)),ta()}},Me=()=>{T.current&&(T.current.getTracks().forEach(r=>r.stop()),T.current=null),A(!1)},$t=()=>{if(O.current&&se.current){const r=O.current,C=se.current;C.width=r.videoWidth,C.height=r.videoHeight;const J=C.getContext("2d");if(J){J.drawImage(r,0,0);const le=C.toDataURL("image/jpeg");B(le),Me(),Ye()}}},Gt=r=>{const C=r.target.files?.[0];if(C){const J=new FileReader;J.onload=le=>{const Vt=le.target?.result;B(Vt),Ye()},J.readAsDataURL(C)}},qt=async()=>{if(I){const r={role:"user",content:`![Gescanntes Bild](${I})`};F(C=>[...C,r]),B(null),m(!1),b.success("Scan zum Chat hinzugefügt");try{V.mutate({messages:[...S,r]})}catch(C){console.error("Error sending scan to chat:",C)}}};return K(()=>()=>{f||Me()},[f]),e.jsxs("div",{className:"min-h-screen bg-background flex flex-col safe-area-inset",children:[e.jsx(Js,{title:je(),showSidebar:!0,showQuickActions:!0,quickActions:q,currentChatId:o||void 0,onSelectChat:ne,onNewChat:H,sidebarOpen:c,onSidebarToggle:d}),q.length>0&&e.jsxs("div",{className:"fixed top-14 left-0 right-0 z-30 px-4 py-3 flex flex-row gap-3 justify-center safe-top",style:{paddingTop:"max(0.75rem, env(safe-area-inset-top))"},children:[e.jsx("button",{onClick:()=>d(!0),className:"w-12 h-12 rounded-full bg-background hover:bg-muted border border-border transition-colors flex items-center justify-center active:scale-95 shadow-sm","aria-label":"Menü öffnen","aria-expanded":c,"aria-controls":"sidebar-menu",title:"Menü öffnen",children:e.jsx(pn,{className:"w-5 h-5 text-foreground"})}),q.map(r=>{const C=r.icon;return e.jsx("button",{onClick:r.onClick,className:"w-12 h-12 rounded-full bg-background hover:bg-muted border border-border transition-colors flex items-center justify-center active:scale-95 shadow-sm","aria-label":r.label,title:r.label,children:C&&e.jsx(C,{className:"w-5 h-5 text-foreground"})},r.id)}),de&&e.jsx("button",{onClick:H,className:"w-12 h-12 rounded-full bg-background hover:bg-muted border border-border transition-colors flex items-center justify-center active:scale-95 shadow-sm","aria-label":"Neue Konversation",title:"Neue Konversation",children:e.jsx(bn,{className:"w-5 h-5 text-foreground"})})]}),e.jsx("div",{className:"flex-1 overflow-hidden flex flex-col bg-background",style:{paddingTop:q.length>0?"7rem":"3.5rem"},children:e.jsx("div",{className:"flex-1 flex flex-col w-full overflow-hidden min-h-0",children:e.jsx(ca,{messages:S,onSendMessage:we,isLoading:V.isPending,placeholder:n("common.typeMessage","Nachricht eingeben..."),height:"100%",emptyStateMessage:"Wähle eine Frage oder stelle deine eigene",suggestedPrompts:de?[]:oe})})}),e.jsx(he,{open:x,onOpenChange:h,children:e.jsxs(fe,{className:"!fixed !top-[50%] !left-[50%] !right-auto !bottom-auto !translate-x-[-50%] !translate-y-[-50%] !w-[85vw] !max-w-sm !max-h-fit !rounded-3xl !m-0 !overflow-visible !shadow-2xl",children:[e.jsx(ge,{className:"px-5 pt-5 pb-3",children:e.jsx(pe,{className:"text-lg font-semibold",children:"Erinnerung erstellen"})}),e.jsxs("div",{className:"space-y-3 px-5 pb-2",children:[e.jsxs("div",{children:[e.jsx(Y,{className:"text-sm font-medium",children:"Titel *"}),e.jsx(me,{value:w.title,onChange:r=>E({...w,title:r.target.value}),placeholder:"Titel",className:"h-11 min-h-[44px] mt-1.5 rounded-xl"})]}),e.jsxs("div",{children:[e.jsx(Y,{className:"text-sm font-medium",children:"Typ *"}),e.jsxs(Ee,{value:w.type,onValueChange:r=>E({...w,type:r}),children:[e.jsx(Ie,{className:"h-11 min-h-[44px] mt-1.5 rounded-xl",children:e.jsx(Ae,{})}),e.jsxs(Fe,{children:[e.jsx(re,{value:"termin",children:"Termin"}),e.jsx(re,{value:"zahlung",children:"Zahlung"}),e.jsx(re,{value:"aufgabe",children:"Aufgabe"})]})]})]}),e.jsxs("div",{children:[e.jsx(Y,{className:"text-sm font-medium",children:"Datum & Uhrzeit *"}),e.jsx(me,{type:"datetime-local",value:w.dueDate,onChange:r=>E({...w,dueDate:r.target.value}),className:"h-11 min-h-[44px] mt-1.5 rounded-xl"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Qs,{checked:w.isAllDay,onCheckedChange:r=>E({...w,isAllDay:r})}),e.jsx(Y,{className:"text-sm font-medium",children:"Ganztägig"})]}),w.type==="zahlung"&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{children:[e.jsx(Y,{children:"Betrag"}),e.jsx(me,{type:"number",step:"0.01",value:w.amount,onChange:r=>E({...w,amount:r.target.value}),placeholder:"0.00",className:"h-10 min-h-[44px] mt-1"})]}),e.jsxs("div",{children:[e.jsx(Y,{className:"text-sm font-medium",children:"Währung"}),e.jsxs(Ee,{value:w.currency,onValueChange:r=>E({...w,currency:r}),children:[e.jsx(Ie,{className:"h-10 min-h-[44px] mt-1",children:e.jsx(Ae,{})}),e.jsxs(Fe,{children:[e.jsx(re,{value:"CHF",children:"CHF"}),e.jsx(re,{value:"EUR",children:"EUR"}),e.jsx(re,{value:"USD",children:"USD"})]})]})]})]}),e.jsxs("div",{children:[e.jsx(Y,{className:"text-sm font-medium",children:"Notizen"}),e.jsx(pt,{value:w.notes,onChange:r=>E({...w,notes:r.target.value}),placeholder:"Notizen...",className:"mt-1.5 min-h-[90px] rounded-xl"})]})]}),e.jsxs(xe,{className:"px-5 pb-3 pt-2 gap-2.5",children:[e.jsx(_,{variant:"outline",onClick:()=>h(!1),className:"h-11 min-h-[44px] flex-1 rounded-xl text-sm font-medium",children:"Abbrechen"}),e.jsx(_,{onClick:Ht,disabled:L,className:"h-11 min-h-[44px] flex-1 rounded-xl text-sm font-medium",children:L?"Speichert...":"Erstellen"})]})]})}),e.jsx(he,{open:f,onOpenChange:r=>{m(r),r||(Me(),B(null))},children:e.jsxs(fe,{className:"!fixed !top-[50%] !left-[50%] !right-auto !bottom-auto !translate-x-[-50%] !translate-y-[-50%] !w-[85vw] !max-w-sm !max-h-fit !rounded-3xl !m-0 !overflow-visible !shadow-2xl",children:[e.jsx(ge,{className:"px-5 pt-5 pb-3",children:e.jsx(pe,{className:"text-lg font-semibold",children:"Rechnung scannen"})}),e.jsxs("div",{className:"space-y-3 px-5 pb-2",children:[!k&&!I&&e.jsxs("div",{className:"space-y-2.5",children:[e.jsxs(_,{onClick:Wt,className:"w-full h-11 flex items-center justify-center gap-2 rounded-xl text-sm font-medium",children:[e.jsx(ct,{className:"w-4 h-4"}),"Kamera öffnen"]}),e.jsxs("div",{className:"relative",children:[e.jsx("input",{ref:Q,type:"file",accept:"image/*",onChange:Gt,className:"hidden"}),e.jsxs(_,{variant:"outline",onClick:()=>Q.current?.click(),className:"w-full h-11 flex items-center justify-center gap-2 rounded-xl text-sm font-medium",children:[e.jsx(vn,{className:"w-4 h-4"}),"Bild hochladen"]})]})]}),k&&e.jsxs("div",{className:"space-y-2.5",children:[e.jsxs("div",{className:"relative bg-black rounded-xl overflow-hidden aspect-video",children:[e.jsx("video",{ref:O,autoPlay:!0,playsInline:!0,className:"w-full h-full object-cover"}),e.jsx("canvas",{ref:se,className:"hidden"})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(_,{variant:"outline",onClick:Me,className:"flex-1 h-11 rounded-xl text-sm font-medium",children:[e.jsx(Te,{className:"w-4 h-4 mr-2"}),"Abbrechen"]}),e.jsxs(_,{onClick:$t,className:"flex-1 h-11 rounded-xl text-sm font-medium",children:[e.jsx(ct,{className:"w-4 h-4 mr-2"}),"Aufnehmen"]})]})]}),I&&e.jsxs("div",{className:"space-y-2.5",children:[e.jsx("div",{className:"relative bg-black rounded-xl overflow-hidden",children:e.jsx("img",{src:I,alt:"Gescanntes Bild",className:"w-full h-auto"})}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(_,{variant:"outline",onClick:()=>{B(null),A(!1)},className:"flex-1 h-11 rounded-xl text-sm font-medium",children:"Neu scannen"}),e.jsx(_,{onClick:qt,className:"flex-1 h-11 rounded-xl text-sm font-medium",children:"Zum Chat hinzufügen"})]})]})]}),e.jsx(xe,{className:"px-5 pb-3 pt-2",children:e.jsx(_,{variant:"outline",onClick:()=>{m(!1),Me(),B(null)},className:"h-11 min-h-[44px] w-full rounded-xl text-sm font-medium",children:"Schließen"})})]})}),e.jsx(he,{open:v,onOpenChange:r=>{j(r),r||ae({type:"ausgabe",amount:"",category:"",description:"",date:new Date().toISOString().split("T")[0],paymentMethod:"Karte"})},children:e.jsxs(fe,{className:"!fixed !top-[50%] !left-[50%] !right-auto !bottom-auto !translate-x-[-50%] !translate-y-[-50%] !w-[85vw] !max-w-sm !max-h-fit !rounded-3xl !m-0 !overflow-visible !shadow-2xl",children:[e.jsx(ge,{className:"px-5 pt-5 pb-3",children:e.jsx(pe,{className:"text-lg font-semibold",children:"Einnahme / Ausgabe"})}),e.jsxs("div",{className:"space-y-3 px-5 pb-2",children:[e.jsxs("div",{children:[e.jsx(Y,{className:"text-sm font-medium",children:"Typ *"}),e.jsxs(Ee,{value:R.type,onValueChange:r=>{ae({...R,type:r,category:""})},children:[e.jsx(Ie,{className:"h-11 min-h-[44px] mt-1.5 rounded-xl",children:e.jsx(Ae,{})}),e.jsxs(Fe,{children:[e.jsx(re,{value:"einnahme",children:"Einnahme"}),e.jsx(re,{value:"ausgabe",children:"Ausgabe"})]})]})]}),e.jsxs("div",{children:[e.jsx(Y,{children:"Betrag *"}),e.jsx(me,{type:"number",step:"0.01",value:R.amount,onChange:r=>ae({...R,amount:r.target.value}),placeholder:"0.00",className:"h-11 min-h-[44px] mt-1.5 rounded-xl"})]}),e.jsxs("div",{children:[e.jsx(Y,{className:"text-sm font-medium",children:"Kategorie *"}),e.jsxs(Ee,{value:R.category,onValueChange:r=>ae({...R,category:r}),children:[e.jsx(Ie,{className:"h-11 min-h-[44px] mt-1.5 rounded-xl",children:e.jsx(Ae,{placeholder:"Kategorie wählen"})}),e.jsx(Fe,{children:(R.type==="einnahme"?N.income:N.expense).map(r=>e.jsx(re,{value:r,children:r},r))})]})]}),e.jsxs("div",{children:[e.jsx(Y,{className:"text-sm font-medium",children:"Datum *"}),e.jsx(me,{type:"date",value:R.date,onChange:r=>ae({...R,date:r.target.value}),className:"h-11 min-h-[44px] mt-1.5 rounded-xl"})]}),e.jsxs("div",{children:[e.jsx(Y,{children:"Zahlungsmethode"}),e.jsxs(Ee,{value:R.paymentMethod,onValueChange:r=>ae({...R,paymentMethod:r}),children:[e.jsx(Ie,{className:"h-11 min-h-[44px] mt-1.5 rounded-xl",children:e.jsx(Ae,{})}),e.jsxs(Fe,{children:[e.jsx(re,{value:"Karte",children:"Karte"}),e.jsx(re,{value:"Bar",children:"Bar"}),e.jsx(re,{value:"Überweisung",children:"Überweisung"}),e.jsx(re,{value:"Andere",children:"Andere"})]})]})]}),e.jsxs("div",{children:[e.jsx(Y,{children:"Beschreibung"}),e.jsx(pt,{value:R.description,onChange:r=>ae({...R,description:r.target.value}),placeholder:"Beschreibung...",className:"mt-1 min-h-[80px]"})]})]}),e.jsxs(xe,{className:"px-5 pb-3 pt-2 gap-2.5",children:[e.jsx(_,{variant:"outline",onClick:()=>j(!1),className:"h-11 min-h-[44px] flex-1 rounded-xl text-sm font-medium",children:"Abbrechen"}),e.jsx(_,{onClick:P,disabled:ve,className:"h-11 min-h-[44px] flex-1 rounded-xl text-sm font-medium",children:ve?"Speichert...":"Erstellen"})]})]})}),e.jsx(he,{open:y,onOpenChange:r=>{u(r),r||ie({name:"",quantity:"1",category:"Lebensmittel",store:""})},children:e.jsxs(fe,{className:"!fixed !top-[50%] !left-[50%] !right-auto !bottom-auto !translate-x-[-50%] !translate-y-[-50%] !w-[85vw] !max-w-sm !max-h-fit !rounded-3xl !m-0 !overflow-visible !shadow-2xl",children:[e.jsx(ge,{className:"px-5 pt-5 pb-3",children:e.jsx(pe,{className:"text-lg font-semibold",children:"Artikel zur Einkaufsliste hinzufügen"})}),e.jsxs("div",{className:"space-y-3 px-5 pb-2",children:[e.jsxs("div",{children:[e.jsx(Y,{className:"text-sm font-medium",children:"Artikelname *"}),e.jsx(me,{value:te.name,onChange:r=>ie({...te,name:r.target.value}),placeholder:"z.B. Milch",className:"h-11 min-h-[44px] mt-1.5 rounded-xl"})]}),e.jsxs("div",{children:[e.jsx(Y,{className:"text-sm font-medium",children:"Menge"}),e.jsx(me,{type:"number",min:"1",value:te.quantity,onChange:r=>ie({...te,quantity:r.target.value}),placeholder:"1",className:"h-11 min-h-[44px] mt-1.5 rounded-xl"})]}),e.jsxs("div",{children:[e.jsx(Y,{className:"text-sm font-medium",children:"Kategorie"}),e.jsxs(Ee,{value:te.category,onValueChange:r=>ie({...te,category:r}),children:[e.jsx(Ie,{className:"h-11 min-h-[44px] mt-1.5 rounded-xl",children:e.jsx(Ae,{})}),e.jsx(Fe,{children:a.map(r=>e.jsx(re,{value:r,children:r},r))})]})]}),e.jsxs("div",{children:[e.jsx(Y,{className:"text-sm font-medium",children:"Geschäft (optional)"}),e.jsx(me,{value:te.store,onChange:r=>ie({...te,store:r.target.value}),placeholder:"z.B. Migros",className:"h-11 min-h-[44px] mt-1.5 rounded-xl"})]})]}),e.jsxs(xe,{className:"px-5 pb-3 pt-2 gap-2.5",children:[e.jsx(_,{variant:"outline",onClick:()=>u(!1),className:"h-11 min-h-[44px] flex-1 rounded-xl text-sm font-medium",children:"Abbrechen"}),e.jsx(_,{onClick:g,disabled:ye,className:"h-11 min-h-[44px] flex-1 rounded-xl text-sm font-medium",children:ye?"Speichert...":"Hinzufügen"})]})]})})]})}export{Ua as $,sa as A,_ as B,Zs as C,he as D,_a as E,ya as F,wa as G,ja as H,me as I,Ca as J,ka as K,Y as L,Sa as M,Ia as N,Qs as O,Js as P,Fa as Q,Ea as R,Ee as S,Rs as T,_t as U,pt as V,Aa as W,za as X,Ma as Y,Pa as Z,Ba as _,Da as a,Ra as a0,Ta as a1,Na as a2,Ha as a3,va as a4,Is as a5,Lt as b,D as c,Bt as d,De as e,M as f,zs as g,Ms as h,fe as i,e as j,ge as k,pe as l,xe as m,Mt as n,Pt as o,La as p,Ie as q,Ae as r,Fe as s,re as t,Tt as u,Os as v,Ye as w,ta as x,Oa as y,Ka as z};
