import*as me from"react";import zt,{createContext as mt,useContext as ht,useMemo as ce,useRef as M,useCallback as $,useState as b,useEffect as G}from"react";import"./vendor-i18n-CxwOOByA.js";import{s as Pt,c as _t,X as Xe,M as Mt,L as Je,C as ft,B as Ye,W as ke,U as gt,a as Ee,S as Ue,b as Se,F as pt,d as Le,e as xt,f as bt,g as Bt,h as nt,P as Ut,I as Lt,G as Ot,i as vt,A as Kt,j as $t,k as Ht,l as Gt,T as Wt,m as qt,E as Vt,n as Zt,o as Xt,p as Jt,q as Yt,r as Qt,R as en,t as st,u as tn}from"./vendor-misc-bJ7Jf8Js.js";import{u as Oe,L as nn}from"./vendor-router-DKSGf3Q_.js";import{S as sn,R as an,C as rn,a as on,T as ln,D as cn,P as dn,O as un,b as mn,c as hn,d as fn,I as gn,V as pn,e as xn,f as bn,g as vn,h as yn,i as wn,j as jn,k as Nn,l as Cn,m as kn,n as En,o as Sn,p as An,q as Dn,r as In,s as Rn}from"./vendor-ui-DOAmEzTl.js";import{t as Fn,c as Tn}from"./vendor-utils-BNe0Xlio.js";import{i as zn,g as Pn,a as _n,b as Mn,c as Bn,d as Un,o as Ln,s as On,G as Kn,e as $n,f as Hn,h as Gn,j as F}from"./vendor-firebase-D6Db8srz.js";import{t as g}from"./vendor-toast-CdQ6zwVl.js";import{c as Wn}from"./vendor-api-6cqsMLzv.js";const qn="modulepreload",Vn=function(t){return"/"+t},at={},ta=function(n,s,i){let o=Promise.resolve();if(s&&s.length>0){let p=function(m){return Promise.all(m.map(u=>Promise.resolve(u).then(l=>({status:"fulfilled",value:l}),l=>({status:"rejected",reason:l}))))};document.getElementsByTagName("link");const c=document.querySelector("meta[property=csp-nonce]"),h=c?.nonce||c?.getAttribute("nonce");o=p(s.map(m=>{if(m=Vn(m),m in at)return;at[m]=!0;const u=m.endsWith(".css"),l=u?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${m}"]${l}`))return;const N=document.createElement("link");if(N.rel=u?"stylesheet":qn,u||(N.as="script"),N.crossOrigin="",N.href=m,h&&N.setAttribute("nonce",h),document.head.appendChild(N),u)return new Promise((j,w)=>{N.addEventListener("load",j),N.addEventListener("error",()=>w(new Error(`Unable to preload CSS for ${m}`)))})}))}function r(c){const h=new Event("vite:preloadError",{cancelable:!0});if(h.payload=c,window.dispatchEvent(h),!h.defaultPrevented)throw c}return o.then(c=>{for(const h of c||[])h.status==="rejected"&&r(h.reason);return n().catch(r)})};var na=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function sa(t){return t&&t.__esModule&&Object.prototype.hasOwnProperty.call(t,"default")?t.default:t}var $e={exports:{}},Ce={};/**
 * @license React
 * react-jsx-runtime.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var rt;function Zn(){if(rt)return Ce;rt=1;var t=zt,n=Symbol.for("react.element"),s=Symbol.for("react.fragment"),i=Object.prototype.hasOwnProperty,o=t.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,r={key:!0,ref:!0,__self:!0,__source:!0};function c(h,p,m){var u,l={},N=null,j=null;m!==void 0&&(N=""+m),p.key!==void 0&&(N=""+p.key),p.ref!==void 0&&(j=p.ref);for(u in p)i.call(p,u)&&!r.hasOwnProperty(u)&&(l[u]=p[u]);if(h&&h.defaultProps)for(u in p=h.defaultProps,p)l[u]===void 0&&(l[u]=p[u]);return{$$typeof:n,type:h,key:N,ref:j,props:l,_owner:o.current}}return Ce.Fragment=s,Ce.jsx=c,Ce.jsxs=c,Ce}var it;function Xn(){return it||(it=1,$e.exports=Zn()),$e.exports}var e=Xn();const Jn=(t,n,s,i)=>{const o=[s,{code:n,...i||{}}];if(t?.services?.logger?.forward)return t.services.logger.forward(o,"warn","react-i18next::",!0);he(o[0])&&(o[0]=`react-i18next:: ${o[0]}`),t?.services?.logger?.warn?t.services.logger.warn(...o):console?.warn&&console.warn(...o)},ot={},yt=(t,n,s,i)=>{he(s)&&ot[s]||(he(s)&&(ot[s]=new Date),Jn(t,n,s,i))},wt=(t,n)=>()=>{if(t.isInitialized)n();else{const s=()=>{setTimeout(()=>{t.off("initialized",s)},0),n()};t.on("initialized",s)}},Ve=(t,n,s)=>{t.loadNamespaces(n,wt(t,s))},lt=(t,n,s,i)=>{if(he(s)&&(s=[s]),t.options.preload&&t.options.preload.indexOf(n)>-1)return Ve(t,s,i);s.forEach(o=>{t.options.ns.indexOf(o)<0&&t.options.ns.push(o)}),t.loadLanguages(n,wt(t,i))},Yn=(t,n,s={})=>!n.languages||!n.languages.length?(yt(n,"NO_LANGUAGES","i18n.languages were undefined or empty",{languages:n.languages}),!0):n.hasLoadedNamespace(t,{lng:s.lng,precheck:(i,o)=>{if(s.bindI18n&&s.bindI18n.indexOf("languageChanging")>-1&&i.services.backendConnector.backend&&i.isLanguageChangingTo&&!o(i.isLanguageChangingTo,t))return!1}}),he=t=>typeof t=="string",Qn=t=>typeof t=="object"&&t!==null,es=/&(?:amp|#38|lt|#60|gt|#62|apos|#39|quot|#34|nbsp|#160|copy|#169|reg|#174|hellip|#8230|#x2F|#47);/g,ts={"&amp;":"&","&#38;":"&","&lt;":"<","&#60;":"<","&gt;":">","&#62;":">","&apos;":"'","&#39;":"'","&quot;":'"',"&#34;":'"',"&nbsp;":" ","&#160;":" ","&copy;":"©","&#169;":"©","&reg;":"®","&#174;":"®","&hellip;":"…","&#8230;":"…","&#x2F;":"/","&#47;":"/"},ns=t=>ts[t],ss=t=>t.replace(es,ns);let Ze={bindI18n:"languageChanged",bindI18nStore:"",transEmptyNodeValue:"",transSupportBasicHtmlNodes:!0,transWrapTextNodes:"",transKeepBasicHtmlNodesFor:["br","strong","i","p"],useSuspense:!0,unescape:ss,transDefaultProps:void 0};const as=(t={})=>{Ze={...Ze,...t}},rs=()=>Ze;let jt;const is=t=>{jt=t},os=()=>jt,aa={type:"3rdParty",init(t){as(t.options.react),is(t)}},ls=mt();class cs{constructor(){this.usedNamespaces={}}addUsedNamespaces(n){n.forEach(s=>{this.usedNamespaces[s]||(this.usedNamespaces[s]=!0)})}getUsedNamespaces(){return Object.keys(this.usedNamespaces)}}const ds=(t,n)=>he(n)?n:Qn(n)&&he(n.defaultValue)?n.defaultValue:Array.isArray(t)?t[t.length-1]:t,us={t:ds,ready:!1},ms=()=>()=>{},Nt=(t,n={})=>{const{i18n:s}=n,{i18n:i,defaultNS:o}=ht(ls)||{},r=s||i||os();r&&!r.reportNamespaces&&(r.reportNamespaces=new cs),r||yt(r,"NO_I18NEXT_INSTANCE","useTranslation: You will need to pass in an i18next instance by using initReactI18next");const c=ce(()=>({...rs(),...r?.options?.react,...n}),[r,n]),{useSuspense:h,keyPrefix:p}=c,m=o||r?.options?.defaultNS,u=he(m)?[m]:m||["translation"],l=ce(()=>u,u);r?.reportNamespaces?.addUsedNamespaces?.(l);const N=M(0),j=$(E=>{if(!r)return ms;const{bindI18n:x,bindI18nStore:C}=c,I=()=>{N.current+=1,E()};return x&&r.on(x,I),C&&r.store.on(C,I),()=>{x&&x.split(" ").forEach(W=>r.off(W,I)),C&&C.split(" ").forEach(W=>r.store.off(W,I))}},[r,c]),w=M(),f=$(()=>{if(!r)return us;const E=!!(r.isInitialized||r.initializedStoreOnce)&&l.every(ee=>Yn(ee,r,c)),x=n.lng||r.language,C=N.current,I=w.current;if(I&&I.ready===E&&I.lng===x&&I.keyPrefix===p&&I.revision===C)return I;const k={t:r.getFixedT(x,c.nsMode==="fallback"?l:l[0],p),ready:E,lng:x,keyPrefix:p,revision:C};return w.current=k,k},[r,l,p,c,n.lng]),[R,D]=b(0),{t:ue,ready:Q}=Pt.useSyncExternalStore(j,f,f);G(()=>{if(r&&!Q&&!h){const E=()=>D(x=>x+1);n.lng?lt(r,n.lng,l,E):Ve(r,l,E)}},[r,n.lng,l,Q,h,R]);const B=r||{},U=M(null),te=M(),ne=E=>{const x=Object.getOwnPropertyDescriptors(E);x.__original&&delete x.__original;const C=Object.create(Object.getPrototypeOf(E),x);if(!Object.prototype.hasOwnProperty.call(C,"__original"))try{Object.defineProperty(C,"__original",{value:E,writable:!1,enumerable:!1,configurable:!1})}catch{}return C},ae=ce(()=>{const E=B,x=E?.language;let C=E;E&&(U.current&&U.current.__original===E?te.current!==x?(C=ne(E),U.current=C,te.current=x):C=U.current:(C=ne(E),U.current=C,te.current=x));const I=[ue,C,Q];return I.t=ue,I.i18n=C,I.ready=Q,I},[ue,B,Q,B.resolvedLanguage,B.language,B.languages]);if(r&&h&&!Q)throw new Promise(E=>{const x=()=>E();n.lng?lt(r,n.lng,l,x):Ve(r,l,x)});return ae},hs=Wn(),fs={apiKey:"AIzaSyCZ8V17HUVMlBKXK0ftrMURS-XP2zIsOps",authDomain:"nexo-jtsky100.firebaseapp.com",projectId:"nexo-jtsky100",storageBucket:"nexo-jtsky100.firebasestorage.app",messagingSenderId:"859320186482",appId:"1:859320186482:web:0c9dcca5d8ce613aaf34eb",measurementId:"G-G8PX4GB2YF"},Ke=zn(fs),ge=Pn(Ke);_n(Ke);const T=Mn(Ke);typeof window<"u"&&Bn(Ke);const Ct=mt(void 0);function ra({children:t}){const[n,s]=b(null),[i,o]=b(!0),[r,c]=b(null);G(()=>(Un(ge).then(f=>{f?.user&&s(f.user)}).catch(f=>{}),Ln(ge,f=>{s(f),o(!1)})),[]);const h=async(w,f)=>{try{c(null);const R=await Hn(ge,w,f)}catch(R){let D="Anmeldung fehlgeschlagen";switch(R.code){case"auth/invalid-email":D="Ungültige E-Mail-Adresse";break;case"auth/user-disabled":D="Dieses Konto wurde deaktiviert";break;case"auth/user-not-found":D="Kein Konto mit dieser E-Mail gefunden";break;case"auth/wrong-password":D="Falsches Passwort";break;case"auth/invalid-credential":D="Ungültige Anmeldedaten";break;default:D=R.message||"Ein Fehler ist aufgetreten"}throw c(D),new Error(D)}},p=async(w,f)=>{try{c(null);const R=await Gn(ge,w,f)}catch(R){let D="Registrierung fehlgeschlagen";switch(R.code){case"auth/email-already-in-use":D="Diese E-Mail wird bereits verwendet";break;case"auth/invalid-email":D="Ungültige E-Mail-Adresse";break;case"auth/weak-password":D="Passwort ist zu schwach";break;default:D=R.message||"Ein Fehler ist aufgetreten"}throw c(D),new Error(D)}},m=async()=>{try{c(null);const w=new Kn;w.addScope("email"),w.addScope("profile"),w.setCustomParameters({prompt:"select_account"}),await $n(ge,w)}catch(w){let f="Ein Fehler ist aufgetreten";switch(w.code){case"auth/unauthorized-domain":f="Diese Domain ist nicht autorisiert. Bitte kontaktieren Sie den Administrator.";break;case"auth/operation-not-allowed":f="Google Sign-In ist nicht aktiviert.";break;case"auth/network-request-failed":f="Netzwerkfehler. Bitte überprüfen Sie Ihre Internetverbindung.";break;default:f=w.message||"Ein unbekannter Fehler ist aufgetreten"}throw c(f),new Error(f)}},u=async()=>{try{await On(ge)}catch{throw new Error("Abmeldung fehlgeschlagen")}},l=h,N=m,j=u;return e.jsx(Ct.Provider,{value:{user:n,loading:i,error:r,signIn:h,signUp:p,signInWithGoogle:m,signOut:u,loginWithEmail:l,loginWithGoogle:N,logout:j},children:t})}function gs(){const t=ht(Ct);if(t===void 0)throw new Error("useAuth must be used within an AuthProvider");return t}function S(...t){return Fn(Tn(t))}const ps=_t("inline-flex items-center justify-center gap-2 whitespace-nowrap rounded-md text-sm font-medium transition-all disabled:pointer-events-none disabled:opacity-50 [&_svg]:pointer-events-none [&_svg:not([class*='size-'])]:size-4 shrink-0 [&_svg]:shrink-0 outline-none focus-visible:border-ring focus-visible:ring-ring/50 focus-visible:ring-[3px] aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive",{variants:{variant:{default:"bg-primary text-primary-foreground hover:bg-primary/90",destructive:"bg-destructive text-white hover:bg-destructive/90 focus-visible:ring-destructive/20 dark:focus-visible:ring-destructive/40 dark:bg-destructive/60",outline:"border bg-transparent shadow-xs hover:bg-accent dark:bg-transparent dark:border-input dark:hover:bg-input/50",secondary:"bg-secondary text-secondary-foreground hover:bg-secondary/80",ghost:"hover:bg-accent dark:hover:bg-accent/50",link:"text-primary underline-offset-4 hover:underline"},size:{default:"h-9 px-4 py-2 has-[>svg]:px-3",sm:"h-8 rounded-md gap-1.5 px-3 has-[>svg]:px-2.5",lg:"h-10 rounded-md px-6 has-[>svg]:px-4",icon:"size-9","icon-sm":"size-8","icon-lg":"size-10"}},defaultVariants:{variant:"default",size:"default"}});function Y({className:t,variant:n,size:s,asChild:i=!1,...o}){const r=i?sn:"button";return e.jsx(r,{"data-slot":"button",className:S(ps({variant:n,size:s,className:t})),...o})}const ct="glassEffectEnabled";function kt(){const[t,n]=b(()=>{const i=localStorage.getItem(ct);return i!==null?i==="true":!0});return G(()=>{localStorage.setItem(ct,String(t))},[t]),{isEnabled:t,toggle:()=>{n(i=>!i)},setIsEnabled:n}}const xs=[{path:"/",icon:Mt,label:"Assistent"},{path:"/dashboard",icon:Je,label:"Dashboard"},{path:"/calendar",icon:ft,label:"Kalender"},{path:"/reminders",icon:Ye,label:"Erinnerungen"},{path:"/finance",icon:ke,label:"Finanzen"},{path:"/people",icon:gt,label:"Personen"},{path:"/bills",icon:Ee,label:"Rechnungen"},{path:"/documents",icon:Ue,label:"Dokumente"},{path:"/shopping",icon:Se,label:"Einkaufen"},{path:"/taxes",icon:pt,label:"Steuern"},{path:"/settings",icon:Le,label:"Einstellungen"}];function bs({open:t,onClose:n,currentChatId:s,onSelectChat:i,onNewChat:o}){const[r]=Oe(),{user:c}=gs(),{isEnabled:h}=kt(),p=()=>{if(c?.displayName){const m=c.displayName.split(" ");return m.length>=2?(m[0][0]+m[1][0]).toUpperCase():c.displayName.substring(0,2).toUpperCase()}return c?.email?c.email.substring(0,2).toUpperCase():"U"};return e.jsxs(e.Fragment,{children:[t&&e.jsx("div",{className:S("fixed inset-0 z-40 transition-opacity",h?"bg-black/5":"bg-black/50"),onClick:n}),e.jsx("aside",{className:S("fixed top-0 left-0 h-full w-full max-w-sm z-50 transform transition-transform duration-300 ease-in-out shadow-xl",t?"translate-x-0":"-translate-x-full",h?"bg-background/95 backdrop-blur-md":"bg-background"),"aria-label":"Hauptnavigation","aria-hidden":!t,children:e.jsxs("div",{className:"flex flex-col h-full",children:[e.jsx("div",{className:"p-4 border-b border-border",children:e.jsxs("div",{className:"flex items-center gap-3 mb-3",children:[e.jsx("button",{onClick:n,className:"p-2 hover:bg-muted rounded-lg transition-colors","aria-label":"Menü schließen",children:e.jsx(Xe,{className:"w-5 h-5"})}),e.jsx("h2",{className:"text-lg font-semibold flex-1",children:"Menü"})]})}),e.jsx("div",{className:"flex-1 overflow-y-auto",children:e.jsxs("div",{className:"p-4 border-b border-border",children:[e.jsx("h3",{className:"text-xs font-semibold text-muted-foreground uppercase tracking-wider mb-3",children:"Navigation"}),e.jsx("nav",{className:"space-y-1",children:xs.map(m=>{const u=m.icon,l=r===m.path;return e.jsx(nn,{href:m.path,children:e.jsxs("button",{onClick:n,className:S("w-full flex items-center gap-3 px-3 py-2.5 rounded-lg transition-colors text-left min-h-[44px]",l?"bg-primary/10 text-primary font-medium":"text-foreground hover:bg-muted"),"aria-label":`Zu ${m.label} navigieren`,"aria-current":l?"page":void 0,"aria-pressed":l,type:"button",role:"menuitem",children:[e.jsx(u,{className:"w-5 h-5 flex-shrink-0","aria-hidden":"true"}),e.jsx("span",{className:"text-sm",children:m.label})]})},m.path)})})]})}),e.jsx("div",{className:"p-4 border-t border-border",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-10 h-10 rounded-full bg-primary text-primary-foreground flex items-center justify-center flex-shrink-0 text-sm font-medium",children:c?.photoURL?e.jsx("img",{src:c.photoURL,alt:c?.displayName||"Benutzerprofilbild",className:"w-10 h-10 rounded-full object-cover"}):e.jsx("span",{"aria-label":"Benutzerinitialen",children:p()})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("p",{className:"text-sm font-medium truncate",children:c?.displayName||"Benutzer"}),e.jsx("p",{className:"text-xs text-muted-foreground truncate",children:c?.email||"Nicht angemeldet"})]})]})})]})})]})}function vs({title:t,showSidebar:n=!1,showQuickActions:s=!1,quickActions:i=[],currentChatId:o,onSelectChat:r,onNewChat:c,sidebarOpen:h,onSidebarToggle:p}){Oe();const[m,u]=b(!1),{isEnabled:l}=kt(),N=h!==void 0?h:m,j=p||u;return e.jsxs(e.Fragment,{children:[n&&e.jsx(bs,{open:N,onClose:()=>j(!1),currentChatId:o,onSelectChat:r,onNewChat:c}),e.jsx("header",{className:S("fixed top-0 left-0 right-0 z-40 border-b safe-top",l?"bg-background/5 backdrop-blur-none border-border/10":"bg-background border-border"),children:e.jsx("div",{className:"px-4 h-14 flex items-center gap-3",children:e.jsx("div",{className:"flex-1 flex items-center justify-center",children:e.jsx("h1",{className:"text-lg font-semibold text-center",children:t})})})})]})}const ys={maxRetries:3,initialDelay:1e3,maxDelay:1e4,backoffMultiplier:2,retryableErrors:["network","timeout","ECONNRESET","ETIMEDOUT","ENOTFOUND","EAI_AGAIN","500","502","503","504"]};function ws(t,n){if(!t)return!1;const s=t.message?.toLowerCase()||"",i=t.code?.toLowerCase()||"",o=t.status?.toString()||"";return n.some(r=>{const c=r.toLowerCase();return s.includes(c)||i.includes(c)||o.includes(c)})}function js(t,n){const s=n.initialDelay*Math.pow(n.backoffMultiplier,t);return Math.min(s,n.maxDelay)}async function Ns(t,n={}){const s={...ys,...n};let i;for(let o=0;o<=s.maxRetries;o++)try{return await t()}catch(r){if(i=r,o>=s.maxRetries||!ws(r,s.retryableErrors))break;const c=js(o,s);await new Promise(h=>setTimeout(h,c))}throw i}async function de(t,n,s={}){return Ns(async()=>(await t(n)).data,s)}const Qe={maxRetries:3,initialDelay:1e3},Ae={maxRetries:2,initialDelay:500};function ia(t){const[n,s]=b([]),[i,o]=b(!0),[r,c]=b(null),[h,p]=b(0);return G(()=>{(async()=>{try{o(!0);const w=(await F(T,"getReminders")(t||{})).data.reminders.map(f=>({...f,dueDate:f.dueDate?.toDate?f.dueDate.toDate():new Date(f.dueDate),createdAt:f.createdAt?.toDate?f.createdAt.toDate():new Date(f.createdAt),updatedAt:f.updatedAt?.toDate?f.updatedAt.toDate():new Date(f.updatedAt)}));s(w),c(null)}catch(l){c(l)}finally{o(!1)}})()},[t?.startDate,t?.endDate,t?.status,h]),{data:n,isLoading:i,error:r,refetch:()=>p(u=>u+1)}}async function Cs(t){const n=F(T,"createReminder");return de(n,t,Qe)}async function oa(t,n){const s=F(T,"updateReminder");await de(s,{id:t,...n},Ae)}async function la(t){const n=F(T,"deleteReminder");await de(n,{id:t},Ae)}function ca(t){const[n,s]=b([]),[i,o]=b(!0),[r,c]=b(null),h=$(async()=>{try{o(!0);const N=(await F(T,"getFinanceEntries")(t||{})).data.entries.map(j=>({...j,date:j.date?.toDate?j.date.toDate():new Date(j.date),createdAt:j.createdAt?.toDate?j.createdAt.toDate():new Date(j.createdAt),updatedAt:j.updatedAt?.toDate?j.updatedAt.toDate():new Date(j.updatedAt)}));s(N),c(null)}catch(m){c(m)}finally{o(!1)}},[t?.startDate,t?.endDate,t?.type]);G(()=>{h()},[h]);const p=$(async()=>{await h()},[h]);return{data:n,isLoading:i,error:r,refetch:p}}async function ks(t){const n=F(T,"createFinanceEntry");return de(n,t,Qe)}async function da(t,n){const s=F(T,"updateFinanceEntry");await de(s,{id:t,...n},Ae)}function ua(){const[t,n]=b([]),[s,i]=b(!0),[o,r]=b(null);return G(()=>{(async()=>{try{i(!0);const u=(await F(T,"getTaxProfiles")({})).data.profiles.map(l=>({...l,createdAt:l.createdAt?.toDate?l.createdAt.toDate():new Date(l.createdAt),updatedAt:l.updatedAt?.toDate?l.updatedAt.toDate():new Date(l.updatedAt)}));n(u),r(null)}catch(h){r(h)}finally{i(!1)}})()},[]),{data:t,isLoading:s,error:o}}async function ma(t){await F(T,"deleteTaxProfile")({id:t})}function ha(){const[t,n]=b([]),[s,i]=b(!0),[o,r]=b(null);return G(()=>{(async()=>{try{i(!0);const u=(await F(T,"getPeople")({})).data.people.map(l=>({...l,createdAt:l.createdAt?.toDate?l.createdAt.toDate():new Date(l.createdAt),updatedAt:l.updatedAt?.toDate?l.updatedAt.toDate():new Date(l.updatedAt)}));n(u),r(null)}catch(h){r(h)}finally{i(!1)}})()},[]),{data:t,isLoading:s,error:o}}async function fa(t){const n=F(T,"createPerson");return de(n,t,Qe)}async function ga(t,n){const s=F(T,"updatePerson");await de(s,{personId:t,...n},Ae)}async function pa(t){const n=F(T,"deletePerson");await de(n,{personId:t},Ae)}function xa(t){const[n,s]=b([]),[i,o]=b(!0),[r,c]=b(null),[h,p]=b(0);return G(()=>{(async()=>{try{o(!0);const w=(await F(T,"getShoppingList")({status:t})).data.items.map(f=>({...f,boughtAt:f.boughtAt?.toDate?f.boughtAt.toDate():f.boughtAt?new Date(f.boughtAt):null,createdAt:f.createdAt?.toDate?f.createdAt.toDate():new Date(f.createdAt),updatedAt:f.updatedAt?.toDate?f.updatedAt.toDate():new Date(f.updatedAt)}));s(w),c(null)}catch(l){c(l)}finally{o(!1)}})()},[t,h]),{data:n,isLoading:i,error:r,refetch:()=>p(u=>u+1)}}async function Es(t){return(await F(T,"createShoppingItem")(t)).data}async function ba(t){await F(T,"deleteShoppingItem")({itemId:t})}async function va(t,n,s){return(await F(T,"markShoppingItemAsBought")({itemId:t,actualPrice:n,createExpense:s})).data}function Ss(){const[t,n]=b([]),[s,i]=b(!0),[o,r]=b(null),[c,h]=b(0);return G(()=>{(async()=>{try{i(!0);const j=(await F(T,"getChatConversations")({})).data.conversations.map(w=>{let f=new Date;w.createdAt&&(typeof w.createdAt=="string"?f=w.createdAt:f=new Date(w.createdAt).toISOString());let R=new Date;return w.updatedAt&&(typeof w.updatedAt=="string"?R=w.updatedAt:R=new Date(w.updatedAt).toISOString()),{...w,createdAt:f,updatedAt:R}});j.sort((w,f)=>{const R=typeof w.updatedAt=="string"?new Date(w.updatedAt).getTime():w.updatedAt.getTime();return(typeof f.updatedAt=="string"?new Date(f.updatedAt).getTime():f.updatedAt.getTime())-R}),n(j),r(null)}catch(u){r(u)}finally{i(!1)}})()},[c]),{data:t,isLoading:s,error:o,refetch:()=>h(m=>m+1)}}async function As(t){return(await F(T,"createChatConversation")(t)).data}async function Ds(t,n){await F(T,"updateChatConversation")({id:t,...n})}const Et=me.createContext({isComposing:()=>!1,setComposing:()=>{},justEndedComposing:()=>!1,markCompositionEnd:()=>{}}),et=()=>me.useContext(Et);function Re({...t}){const n=me.useRef(!1),s=me.useRef(!1),i=me.useRef(null),o=me.useMemo(()=>({isComposing:()=>n.current,setComposing:r=>{n.current=r},justEndedComposing:()=>s.current,markCompositionEnd:()=>{s.current=!0,i.current&&clearTimeout(i.current),i.current=setTimeout(()=>{s.current=!1},150)}}),[]);return e.jsx(Et.Provider,{value:o,children:e.jsx(an,{"data-slot":"dialog",...t})})}function Is({...t}){return e.jsx(dn,{"data-slot":"dialog-portal",...t})}function St({className:t,...n}){return e.jsx(un,{"data-slot":"dialog-overlay",className:S("data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 fixed inset-0 z-50 bg-black/50",t),...n})}St.displayName="DialogOverlay";function Fe({className:t,children:n,showCloseButton:s=!0,onEscapeKeyDown:i,...o}){const{isComposing:r}=et(),c=me.useCallback(h=>{if(h.isComposing||r()){h.preventDefault();return}i?.(h)},[r,i]);return e.jsxs(Is,{"data-slot":"dialog-portal",children:[e.jsx(St,{}),e.jsxs(rn,{"data-slot":"dialog-content",className:S("bg-background data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 fixed top-0 left-0 right-0 bottom-0 z-50 flex flex-col w-full h-full border-0 shadow-lg duration-200 sm:top-[50%] sm:left-[50%] sm:right-auto sm:bottom-auto sm:translate-x-[-50%] sm:translate-y-[-50%] sm:max-w-lg sm:h-auto sm:max-h-[90vh] sm:rounded-lg sm:border sm:m-4 sm:flex sm:flex-col",t),onEscapeKeyDown:c,...o,children:[n,s&&e.jsxs(on,{"data-slot":"dialog-close",className:"ring-offset-background focus:ring-ring data-[state=open]:bg-accent data-[state=open]:text-muted-foreground absolute top-4 right-4 rounded-xs opacity-70 transition-opacity hover:opacity-100 focus:ring-2 focus:ring-offset-2 focus:outline-hidden disabled:pointer-events-none [&_svg]:pointer-events-none [&_svg]:shrink-0 [&_svg:not([class*='size-'])]:size-4",children:[e.jsx(Xe,{}),e.jsx("span",{className:"sr-only",children:"Close"})]})]})]})}function Te({className:t,...n}){return e.jsx("div",{"data-slot":"dialog-header",className:S("flex flex-col gap-2 text-center sm:text-left",t),...n})}function ze({className:t,...n}){return e.jsx("div",{"data-slot":"dialog-footer",className:S("flex flex-col-reverse gap-2 sm:flex-row sm:justify-end",t),...n})}function Pe({className:t,...n}){return e.jsx(ln,{"data-slot":"dialog-title",className:S("text-lg leading-none font-semibold",t),...n})}function ya({className:t,...n}){return e.jsx(cn,{"data-slot":"dialog-description",className:S("text-muted-foreground text-sm",t),...n})}function _e(t){const n=M(t);n.current=t;const s=M(null);return s.current||(s.current=function(...i){return n.current.apply(this,i)}),s.current}function At(t={}){const{onKeyDown:n,onCompositionStart:s,onCompositionEnd:i}=t,o=M(!1),r=M(null),c=M(null),h=_e(l=>{r.current&&(clearTimeout(r.current),r.current=null),c.current&&(clearTimeout(c.current),c.current=null),o.current=!0,s?.(l)}),p=_e(l=>{r.current=setTimeout(()=>{c.current=setTimeout(()=>{o.current=!1})}),i?.(l)}),m=_e(l=>{if(o.current&&(l.key==="Escape"||l.key==="Enter"&&!l.shiftKey)){l.stopPropagation();return}n?.(l)}),u=_e(()=>o.current);return{onCompositionStart:h,onCompositionEnd:p,onKeyDown:m,isComposing:u}}function le({className:t,type:n,onKeyDown:s,onCompositionStart:i,onCompositionEnd:o,...r}){const c=et(),{onCompositionStart:h,onCompositionEnd:p,onKeyDown:m}=At({onKeyDown:u=>{const l=u.nativeEvent.isComposing||c.justEndedComposing();u.key==="Enter"&&l||s?.(u)},onCompositionStart:u=>{c.setComposing(!0),i?.(u)},onCompositionEnd:u=>{c.markCompositionEnd(),setTimeout(()=>{c.setComposing(!1)},100),o?.(u)}});return e.jsx("input",{type:n,"data-slot":"input",className:S("file:text-foreground placeholder:text-muted-foreground selection:bg-primary selection:text-primary-foreground dark:bg-input/30 border-input h-9 w-full min-w-0 rounded-md border bg-transparent px-3 py-1 text-base shadow-xs transition-[color,box-shadow] outline-none file:inline-flex file:h-7 file:border-0 file:bg-transparent file:text-sm file:font-medium disabled:pointer-events-none disabled:cursor-not-allowed disabled:opacity-50 md:text-sm","focus-visible:border-ring focus-visible:ring-ring/50 focus-visible:ring-[3px]","aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive",t),onCompositionStart:h,onCompositionEnd:p,onKeyDown:m,...r})}function K({className:t,...n}){return e.jsx(mn,{"data-slot":"label",className:S("flex items-center gap-2 text-sm leading-none font-medium select-none group-data-[disabled=true]:pointer-events-none group-data-[disabled=true]:opacity-50 peer-disabled:cursor-not-allowed peer-disabled:opacity-50",t),...n})}function pe({...t}){return e.jsx(hn,{"data-slot":"select",...t})}function xe({...t}){return e.jsx(pn,{"data-slot":"select-value",...t})}function be({className:t,size:n="default",children:s,...i}){return e.jsxs(fn,{"data-slot":"select-trigger","data-size":n,className:S("border-input data-[placeholder]:text-muted-foreground [&_svg:not([class*='text-'])]:text-muted-foreground focus-visible:border-ring focus-visible:ring-ring/50 aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive dark:bg-input/30 dark:hover:bg-input/50 flex w-fit items-center justify-between gap-2 rounded-md border bg-transparent px-3 py-2 text-sm whitespace-nowrap shadow-xs transition-[color,box-shadow] outline-none focus-visible:ring-[3px] disabled:cursor-not-allowed disabled:opacity-50 data-[size=default]:h-9 data-[size=sm]:h-8 *:data-[slot=select-value]:line-clamp-1 *:data-[slot=select-value]:flex *:data-[slot=select-value]:items-center *:data-[slot=select-value]:gap-2 [&_svg]:pointer-events-none [&_svg]:shrink-0 [&_svg:not([class*='size-'])]:size-4",t),...i,children:[s,e.jsx(gn,{asChild:!0,children:e.jsx(xt,{className:"size-4 opacity-50"})})]})}function ve({className:t,children:n,position:s="popper",align:i="center",...o}){return e.jsx(xn,{children:e.jsxs(bn,{"data-slot":"select-content",className:S("bg-popover text-popover-foreground data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 relative z-50 max-h-(--radix-select-content-available-height) min-w-[8rem] origin-(--radix-select-content-transform-origin) overflow-x-hidden overflow-y-auto rounded-md border shadow-md",s==="popper"&&"data-[side=bottom]:translate-y-1 data-[side=left]:-translate-x-1 data-[side=right]:translate-x-1 data-[side=top]:-translate-y-1",t),position:s,align:i,...o,children:[e.jsx(Rs,{}),e.jsx(vn,{className:S("p-1",s==="popper"&&"h-[var(--radix-select-trigger-height)] w-full min-w-[var(--radix-select-trigger-width)] scroll-my-1"),children:n}),e.jsx(Fs,{})]})})}function Z({className:t,children:n,...s}){return e.jsxs(yn,{"data-slot":"select-item",className:S("focus:bg-accent focus:text-accent-foreground [&_svg:not([class*='text-'])]:text-muted-foreground relative flex w-full cursor-default items-center gap-2 rounded-sm py-1.5 pr-8 pl-2 text-sm outline-hidden select-none data-[disabled]:pointer-events-none data-[disabled]:opacity-50 [&_svg]:pointer-events-none [&_svg]:shrink-0 [&_svg:not([class*='size-'])]:size-4 *:[span]:last:flex *:[span]:last:items-center *:[span]:last:gap-2",t),...s,children:[e.jsx("span",{className:"absolute right-2 flex size-3.5 items-center justify-center",children:e.jsx(wn,{children:e.jsx(bt,{className:"size-4"})})}),e.jsx(jn,{children:n})]})}function Rs({className:t,...n}){return e.jsx(Nn,{"data-slot":"select-scroll-up-button",className:S("flex cursor-default items-center justify-center py-1",t),...n,children:e.jsx(Bt,{className:"size-4"})})}function Fs({className:t,...n}){return e.jsx(Cn,{"data-slot":"select-scroll-down-button",className:S("flex cursor-default items-center justify-center py-1",t),...n,children:e.jsx(xt,{className:"size-4"})})}function Ts({className:t,...n}){return e.jsx(kn,{"data-slot":"switch",className:S("peer data-[state=checked]:bg-primary data-[state=unchecked]:bg-input focus-visible:border-ring focus-visible:ring-ring/50 dark:data-[state=unchecked]:bg-input/80 inline-flex h-[1.15rem] w-8 shrink-0 items-center rounded-full border border-transparent shadow-xs transition-all outline-none focus-visible:ring-[3px] disabled:cursor-not-allowed disabled:opacity-50",t),...n,children:e.jsx(En,{"data-slot":"switch-thumb",className:S("bg-background dark:data-[state=unchecked]:bg-foreground dark:data-[state=checked]:bg-primary-foreground pointer-events-none block size-4 rounded-full ring-0 transition-transform data-[state=checked]:translate-x-[calc(100%-2px)] data-[state=unchecked]:translate-x-0")})})}const zs={light:10,medium:20,heavy:30,success:[50,50,50],error:[100,50,100],warning:[50,100,50],selection:5};function tt(t="medium"){if(!navigator.vibrate)return;const n=zs[t];try{navigator.vibrate(n)}catch{}}function He(){tt("success")}function Ps(){tt("error")}function wa(){tt("selection")}function _s(t){const n=t;if(n?.code==="unavailable"||n?.message?.includes("network")||n?.message?.includes("fetch"))return{title:"Verbindungsfehler",message:"Keine Internetverbindung. Bitte überprüfen Sie Ihre Netzwerkverbindung und versuchen Sie es erneut.",action:"Erneut versuchen",retryable:!0};if(n?.code==="deadline-exceeded"||n?.message?.includes("timeout"))return{title:"Zeitüberschreitung",message:"Die Anfrage hat zu lange gedauert. Bitte versuchen Sie es erneut.",action:"Erneut versuchen",retryable:!0};if(n?.code==="permission-denied"||n?.message?.includes("permission"))return{title:"Berechtigung verweigert",message:"Sie haben keine Berechtigung für diese Aktion. Bitte kontaktieren Sie den Administrator.",retryable:!1};if(n?.code==="unauthenticated"||n?.message?.includes("auth")||n?.message?.includes("login"))return{title:"Anmeldung erforderlich",message:"Bitte melden Sie sich an, um fortzufahren.",action:"Anmelden",retryable:!1};if(n?.code==="not-found"||n?.message?.includes("not found"))return{title:"Nicht gefunden",message:"Die angeforderte Ressource wurde nicht gefunden.",retryable:!1};if(n?.code==="invalid-argument"||n?.message?.includes("validation")||n?.message?.includes("invalid"))return{title:"Ungültige Eingabe",message:n?.message||"Bitte überprüfen Sie Ihre Eingabe und versuchen Sie es erneut.",retryable:!1};if(n?.code==="resource-exhausted"||n?.message?.includes("quota"))return{title:"Kontingent überschritten",message:"Das Tageslimit wurde erreicht. Bitte versuchen Sie es später erneut.",retryable:!1};if(n?.message?.includes("billing")||n?.message?.includes("Billing"))return{title:"Abrechnungsfehler",message:"Google Cloud Billing ist erforderlich. Bitte kontaktieren Sie den Administrator.",retryable:!1};if(n?.code?.startsWith("functions/"))return{title:"Server-Fehler",message:`Ein Fehler ist aufgetreten: ${n.code.replace("functions/","")}. Bitte versuchen Sie es später erneut.`,action:"Erneut versuchen",retryable:!0};const s=n?.message||n?.toString()||"Ein unbekannter Fehler ist aufgetreten.";return{title:"Fehler",message:s.length>100?`${s.substring(0,100)}...`:s,action:"Erneut versuchen",retryable:!0}}function Ms(t){return _s(t).message}function Bs({className:t,children:n,...s}){return e.jsxs(Sn,{"data-slot":"scroll-area",className:S("relative",t),...s,children:[e.jsx(An,{"data-slot":"scroll-area-viewport",className:"focus-visible:ring-ring/50 size-full rounded-[inherit] transition-[color,box-shadow] outline-none focus-visible:ring-[3px] focus-visible:outline-1",children:n}),e.jsx(Us,{}),e.jsx(Dn,{})]})}function Us({className:t,orientation:n="vertical",...s}){return e.jsx(In,{"data-slot":"scroll-area-scrollbar",orientation:n,className:S("hidden opacity-0 w-0 h-0 invisible pointer-events-none",t),...s,children:e.jsx(Rn,{"data-slot":"scroll-area-thumb",className:"hidden opacity-0 w-0 h-0"})})}const Ls={"layout-dashboard":Je,calendar:ft,bell:Ye,wallet:ke,users:gt,"file-text":pt,folder:Ue,"scan-line":Ue,"shopping-cart":Se,receipt:Ee,"clipboard-list":Ee,settings:Le,check:bt,plus:vt,search:Yt,edit:Jt,trash:Xt,clock:Zt,euro:Vt,"trending-up":qt,"trending-down":Wt,info:Gt,"alert-circle":Ht},Os={dashboard:{path:"/",icon:Je},finance:{path:"/finance",icon:ke},finanzen:{path:"/finance",icon:ke},bills:{path:"/bills",icon:Ee},rechnungen:{path:"/bills",icon:Ee},shopping:{path:"/shopping",icon:Se},einkaufsliste:{path:"/shopping",icon:Se},settings:{path:"/settings",icon:Le},einstellungen:{path:"/settings",icon:Le}};function Ks({content:t,onNavigate:n}){const s=ce(()=>{const i=[],o=t.length>1e4?t.substring(0,1e4)+"...":t;let r=0,c=0;const h=/\[(nav|icon):([a-zA-Z0-9_-]+)(?:[|｜]([^\]]+))?\]/g;let p;const m=[];for(;(p=h.exec(o))!==null;)m.push({index:p.index,type:p[1],key:p[2],label:p[3],endIndex:p.index+p[0].length});for(const u of m){if(u.index>r){const l=o.slice(r,u.index);i.push(e.jsx("span",{dangerouslySetInnerHTML:{__html:Ge(l)}},`text-${c++}`))}if(u.type==="nav"&&u.label){const l=u.key,N=u.label,j=Os[l];if(j&&n){const w=j.icon;i.push(e.jsxs("button",{onClick:f=>{f.preventDefault(),f.stopPropagation();try{n(j.path)}catch{}},className:"inline-flex items-center gap-1.5 px-2 py-1 mx-0.5 rounded-lg bg-primary/10 hover:bg-primary/20 text-primary font-medium text-sm transition-all duration-200 cursor-pointer border border-primary/20 hover:border-primary/40",children:[e.jsx(w,{className:"size-4"}),e.jsx("span",{className:"underline decoration-dotted underline-offset-2",children:Be(N)})]},`nav-${c++}`))}else i.push(e.jsx("span",{className:"font-medium text-primary",children:Be(N)},`nav-text-${c++}`))}else if(u.type==="icon"){const l=u.key,N=Ls[l];N?i.push(e.jsx(N,{className:"inline-block size-4 mx-0.5 align-text-bottom text-primary"},`icon-${c++}`)):i.push(e.jsxs("span",{children:["[",Be(l),"]"]},`unknown-${c++}`))}r=u.endIndex}if(r<o.length){const u=o.slice(r);i.push(e.jsx("span",{dangerouslySetInnerHTML:{__html:Ge(u)}},`text-${c++}`))}return i.length>0?i:[e.jsx("span",{dangerouslySetInnerHTML:{__html:Ge(o)}},"full")]},[t,n]);return e.jsx("div",{className:"prose prose-sm max-w-none",children:s})}function Be(t){const n=document.createElement("div");return n.textContent=t,n.innerHTML}function Ge(t){let n=Be(t);return n=n.replace(/\*\*(.+?)\*\*/g,"<strong>$1</strong>").replace(/__(.+?)__/g,"<strong>$1</strong>"),n=n.replace(new RegExp("(?<!\\*)\\*(?!\\*)(.+?)(?<!\\*)\\*(?!\\*)","g"),"<em>$1</em>"),n=n.replace(/`(.+?)`/g,'<code class="bg-muted px-1.5 py-0.5 rounded text-sm font-mono">$1</code>'),n=n.replace(/\n/g,"<br />"),n}function $s({messages:t,onSendMessage:n,isLoading:s=!1,placeholder:i="Nachricht eingeben...",className:o,height:r="100%",emptyStateMessage:c="Beginne eine Unterhaltung mit dem Assistenten",suggestedPrompts:h}){const{t:p,i18n:m}=Nt(),[,u]=Oe(),[l,N]=b(""),j=M(null),w=M(null),f=M(null),R=M(null),D=M(null),ue=M(null),[Q,B]=b(!1),[U,te]=b(null),[ne,ae]=b(!1),E=M(null),x=$(d=>{localStorage.setItem("nexo_chat_messages",JSON.stringify(t)),localStorage.setItem("nexo_chat_open_popup","true"),localStorage.setItem("nexo_chat_from_route",d),u(d)},[t,u]),C=ce(()=>t.filter(d=>d.role!=="system"),[t]),I=ce(()=>h?h.map(d=>typeof d=="string"?{text:d,icon:"tag"}:d):[],[h]),W=$(()=>{const d=j.current?.querySelector("[data-radix-scroll-area-viewport]");d&&requestAnimationFrame(()=>{d.scrollTo({top:d.scrollHeight,behavior:"smooth"})})},[]);G(()=>{C.length>0&&W()},[C.length,W]),G(()=>{const d=v=>{E.current&&!E.current.contains(v.target)&&ae(!1)};if(ne)return document.addEventListener("mousedown",d),()=>document.removeEventListener("mousedown",d)},[ne]);const k=$(d=>{d.preventDefault();const v=l.trim();if(!(!v||s)){if(v.length>1e4){g.error("Nachricht ist zu lang. Bitte kürze sie auf maximal 10.000 Zeichen.");return}if(s){g.info("Bitte warte auf die Antwort...");return}try{n(v),N(""),W(),R.current?.focus()}catch{g.error("Fehler beim Senden der Nachricht. Bitte versuche es erneut.")}}},[l,s,n,W]),ee=$(d=>{d.key==="Enter"&&!d.shiftKey&&(d.preventDefault(),k(d))},[k]),ye=$(d=>{s||(n(d),W())},[s,n,W]),De=$(async d=>{if(d.size>10485760){g.error(`Datei ist zu groß. Maximal ${(10485760/1024/1024).toFixed(0)}MB erlaubt.`);return}if(!d.name||d.name.length>255){g.error("Ungültiger Dateiname.");return}const _=g.loading("Datei wird hochgeladen...");try{const X=await Promise.race([new Promise((L,z)=>{const V=new FileReader;V.onload=()=>{const J=V.result;if(!J||!J.includes(",")){z(new Error("Ungültiges Dateiformat"));return}L(J.split(",")[1])},V.onerror=()=>z(new Error("Fehler beim Lesen der Datei")),V.readAsDataURL(d)}),new Promise((L,z)=>setTimeout(()=>z(new Error("Upload-Timeout")),3e4))]),A=F(T,"uploadAIChatFile"),P=await Promise.race([A({fileName:d.name,fileData:X,fileType:d.type}),new Promise((L,z)=>setTimeout(()=>z(new Error("Upload-Timeout")),6e4))]);if(!P?.data)throw new Error("Keine Antwort vom Server erhalten");const H=P.data;if(!H.fileUrl||!H.fileName)throw new Error("Ungültige Server-Antwort");g.dismiss(_),n(`[Datei: ${H.fileName}](${H.fileUrl})`),g.success("Datei erfolgreich hochgeladen")}catch(X){g.dismiss(_);const A=X.message||"Unbekannter Fehler";g.error(`Fehler beim Hochladen: ${A}`)}},[n]),q=$(async d=>{if(!d.type.startsWith("image/")){g.error("Bitte wähle ein Bild aus (JPG, PNG, GIF, etc.)");return}const v=5*1024*1024;if(d.size>v){g.error(`Bild ist zu groß. Maximal ${(v/1024/1024).toFixed(0)}MB erlaubt.`);return}if(!d.name||d.name.length>255){g.error("Ungültiger Dateiname.");return}const _=g.loading("Bild wird hochgeladen...");try{const X=await Promise.race([new Promise((L,z)=>{const V=new FileReader;V.onload=()=>{const J=V.result;if(!J||!J.includes(",")){z(new Error("Ungültiges Bildformat"));return}L(J.split(",")[1])},V.onerror=()=>z(new Error("Fehler beim Lesen des Bildes")),V.readAsDataURL(d)}),new Promise((L,z)=>setTimeout(()=>z(new Error("Upload-Timeout")),3e4))]),A=F(T,"uploadAIChatImage"),P=await Promise.race([A({fileName:d.name,fileData:X,fileType:d.type}),new Promise((L,z)=>setTimeout(()=>z(new Error("Upload-Timeout")),6e4))]);if(!P?.data)throw new Error("Keine Antwort vom Server erhalten");const H=P.data;if(!H.imageUrl||!H.fileName)throw new Error("Ungültige Server-Antwort");g.dismiss(_),n(`![${H.fileName}](${H.imageUrl})`),g.success("Bild erfolgreich hochgeladen")}catch(X){g.dismiss(_);const A=X.message||"Unbekannter Fehler";g.error(`Fehler beim Hochladen: ${A}`)}},[n]),ie=$(async()=>{if(Q&&U){try{U.stop(),B(!1),g.info("Aufnahme wird verarbeitet...")}catch{B(!1),g.error("Fehler beim Stoppen der Aufnahme")}return}try{if(!navigator.mediaDevices||!navigator.mediaDevices.getUserMedia){g.error("Mikrofon-Zugriff wird von diesem Browser nicht unterstützt.");return}const d=await Promise.race([navigator.mediaDevices.getUserMedia({audio:!0}),new Promise((A,P)=>setTimeout(()=>P(new Error("Mikrofon-Zugriff-Timeout")),1e4))]),v=new MediaRecorder(d),_=[];let X=null;v.ondataavailable=A=>{A.data.size>0&&_.push(A.data)},v.onstop=async()=>{X&&clearTimeout(X);const A=new Blob(_,{type:"audio/webm"}),P=10*1024*1024;if(A.size>P){g.error("Audio-Aufnahme ist zu groß. Bitte kürze die Aufnahme."),d.getTracks().forEach(L=>L.stop());return}const H=g.loading("Audio wird transkribiert...");try{const L=await Promise.race([new Promise((fe,oe)=>{const re=new FileReader;re.onload=()=>{const je=re.result;if(!je||!je.includes(",")){oe(new Error("Ungültiges Audioformat"));return}fe(je.split(",")[1])},re.onerror=()=>oe(new Error("Fehler beim Lesen der Audio-Datei")),re.readAsDataURL(A)}),new Promise((fe,oe)=>setTimeout(()=>oe(new Error("Audio-Verarbeitung-Timeout")),3e4))]),z=F(T,"transcribeAIChatAudio"),V=await Promise.race([z({audioData:L,mimeType:"audio/webm"}),new Promise((fe,oe)=>setTimeout(()=>oe(new Error("Transkription-Timeout")),6e4))]);if(!V?.data)throw new Error("Keine Antwort vom Server erhalten");const J=V.data;if(J.transcription&&J.transcription.trim())N(J.transcription.trim()),R.current?.focus(),g.dismiss(H),g.success("Spracheingabe erfolgreich");else throw new Error("Keine Transkription erhalten")}catch(L){g.dismiss(H);const z=L.message||"Unbekannter Fehler";g.error(`Fehler bei der Transkription: ${z}`)}finally{d.getTracks().forEach(L=>L.stop())}},v.onerror=A=>{g.error("Fehler bei der Aufnahme"),B(!1),d.getTracks().forEach(P=>P.stop())},X=setTimeout(()=>{v.state==="recording"&&(v.stop(),g.warning("Maximale Aufnahmezeit erreicht (5 Minuten)"))},300*1e3),v.start(),te(v),B(!0),g.info("Aufnahme gestartet... (Klicke erneut zum Stoppen)")}catch(d){B(!1);const v=d.message||"Unbekannter Fehler";v.includes("permission")||v.includes("denied")?g.error("Mikrofon-Zugriff wurde verweigert. Bitte erlaube den Zugriff in den Browser-Einstellungen."):v.includes("not found")||v.includes("not available")?g.error("Kein Mikrofon gefunden. Bitte verbinde ein Mikrofon."):g.error(`Mikrofon-Fehler: ${v}`)}},[Q,U]),Ie=$(()=>{const v=m.language==="de"?"en":"de";m.changeLanguage(v),localStorage.setItem("language",v),g.success(v==="de"?"Sprache auf Deutsch geändert":"Language changed to English")},[m]),we=()=>e.jsxs("form",{ref:f,onSubmit:k,className:"w-full",children:[e.jsx("input",{ref:D,type:"file",className:"hidden",onChange:d=>{const v=d.target.files?.[0];v&&De(v),d.target.value=""},accept:"*/*"}),e.jsx("input",{ref:ue,type:"file",className:"hidden",onChange:d=>{const v=d.target.files?.[0];v&&(q(v),ae(!1)),d.target.value=""},accept:"image/*"}),e.jsx("div",{className:"w-full max-w-full mx-auto",children:e.jsxs("div",{className:"flex items-center gap-2 px-2",style:{alignItems:"center"},children:[e.jsx("div",{className:"relative",ref:E,children:ne&&e.jsxs("div",{className:"absolute bottom-full left-2 mb-2 bg-background border border-border rounded-lg shadow-lg z-50 min-w-[200px] overflow-hidden",children:[e.jsxs("button",{type:"button",onClick:()=>{D.current?.click()},className:"w-full flex items-center gap-3 px-4 py-3 hover:bg-muted transition-colors text-left",children:[e.jsx(Ut,{className:"w-5 h-5 text-muted-foreground"}),e.jsx("span",{className:"text-sm",children:"Datei anhängen"})]}),e.jsxs("button",{type:"button",onClick:()=>{ue.current?.click()},className:"w-full flex items-center gap-3 px-4 py-3 hover:bg-muted transition-colors text-left",children:[e.jsx(Lt,{className:"w-5 h-5 text-muted-foreground"}),e.jsx("span",{className:"text-sm",children:"Bild hinzufügen"})]}),e.jsxs("button",{type:"button",onClick:()=>{Ie(),ae(!1)},className:"w-full flex items-center gap-3 px-4 py-3 hover:bg-muted transition-colors text-left",children:[e.jsx(Ot,{className:"w-5 h-5 text-muted-foreground"}),e.jsx("span",{className:"text-sm",children:"Sprache wechseln"})]})]})}),e.jsxs("div",{className:"flex-1 relative",children:[e.jsx("button",{type:"button",onClick:()=>ae(!ne),className:"absolute left-2 top-1/2 -translate-y-1/2 w-8 h-8 rounded-full bg-transparent hover:bg-muted/50 transition-colors flex items-center justify-center active:scale-95 z-10","aria-label":"Mehr Optionen",disabled:s,children:e.jsx(vt,{className:"w-4 h-4 text-muted-foreground"})}),e.jsx("textarea",{ref:R,value:l,onChange:d=>N(d.target.value),onKeyDown:ee,placeholder:i,rows:1,className:"w-full pl-10 pr-4 py-3 rounded-2xl bg-muted border-0 text-base text-foreground placeholder:text-muted-foreground focus:outline-none focus:ring-2 focus:ring-primary/20 transition-all resize-none overflow-y-auto min-h-[44px] max-h-[120px] leading-relaxed",style:{height:"auto",minHeight:"44px"},disabled:s,onInput:d=>{const v=d.target;v.style.height="auto",v.style.height=`${Math.min(v.scrollHeight,120)}px`}})]}),l.trim()?e.jsx("button",{type:"submit",disabled:s,className:"w-10 h-10 rounded-full bg-primary text-primary-foreground hover:bg-primary/90 transition-colors flex items-center justify-center active:scale-95 shadow-md self-center","aria-label":s?"Wird gesendet...":"Nachricht senden",children:s?e.jsx(nt,{className:"w-5 h-5 animate-spin"}):e.jsx(Kt,{className:"w-5 h-5"})}):e.jsx("button",{type:"button",onClick:ie,className:S("transition-colors flex items-center justify-center active:scale-95 self-center p-2",Q?"text-red-500 hover:text-red-600":"text-foreground hover:text-foreground/80"),"aria-label":"Spracheingabe",disabled:s,children:e.jsx($t,{className:S("w-7 h-7",Q?"text-red-500":"text-foreground")})})]})})]});return e.jsx("div",{ref:w,className:S("flex flex-col bg-background text-foreground",o),style:{height:r},children:C.length===0?e.jsxs("div",{className:"flex flex-col h-full animate-in fade-in duration-300 pb-20",children:[e.jsx("div",{className:"flex-1 flex items-center justify-center px-4",children:e.jsx("div",{className:"w-full max-w-2xl"})}),I.length>0&&e.jsx("div",{className:"fixed bottom-24 left-0 right-0 px-4 pb-2 z-20 pointer-events-none",children:e.jsx("div",{className:"w-full max-w-2xl mx-auto",children:e.jsx("div",{className:"overflow-x-auto scrollbar-hide -mx-4 px-4 pointer-events-auto",children:e.jsx("div",{className:"flex gap-3",style:{width:"max-content"},children:I.map((d,v)=>{const _=d.subtitle&&d.subtitle.trim().length>0;return e.jsxs("button",{onClick:()=>ye(d.text),disabled:s,className:"flex-shrink-0 w-[calc(40vw-1rem)] min-w-[140px] max-w-[160px] rounded-xl bg-muted hover:bg-muted/80 active:bg-muted/70 px-2.5 py-2 text-left transition-all duration-200 disabled:cursor-not-allowed disabled:opacity-50 shadow-sm",type:"button",children:[e.jsx("p",{className:"font-medium text-xs text-foreground mb-0.5 line-clamp-2 leading-tight",children:d.text}),_&&e.jsx("p",{className:"text-[10px] text-muted-foreground line-clamp-2 leading-tight",children:d.subtitle})]},v)})})})})}),e.jsx("div",{className:"fixed bottom-0 left-0 right-0 w-full bg-background px-4 py-3 safe-bottom",style:{paddingBottom:"max(0.75rem, env(safe-area-inset-bottom))"},children:e.jsx("div",{className:"w-full max-w-2xl mx-auto",children:we()})})]}):e.jsxs(e.Fragment,{children:[e.jsx("div",{ref:j,className:"flex-1 overflow-hidden pb-32",children:e.jsx(Bs,{className:"h-full [&>div>div]:!overflow-y-auto [&>div>div]:[-ms-overflow-style:none] [&>div>div]:[scrollbar-width:none] [&>div>div::-webkit-scrollbar]:hidden",children:e.jsxs("div",{className:"flex flex-col p-4 space-y-4 pb-6",children:[C.map((d,v)=>e.jsx("div",{className:S("flex gap-3 animate-in fade-in slide-in-from-bottom-2 duration-300",d.role==="user"?"justify-end":"justify-start"),children:e.jsx("div",{className:S("max-w-[85%] select-text",d.role==="user"?"bg-primary text-primary-foreground rounded-2xl px-4 py-3 text-base":"text-foreground text-base"),onClick:_=>_.stopPropagation(),onMouseDown:_=>_.stopPropagation(),children:d.role==="assistant"?e.jsx(Ks,{content:d.content,onNavigate:x}):e.jsx("p",{className:"whitespace-pre-wrap leading-relaxed",children:d.content})})},v)),s&&e.jsx("div",{className:"flex items-start gap-4 justify-start animate-in fade-in duration-200",children:e.jsx("div",{className:"rounded-lg bg-muted px-4 py-3",children:e.jsx(nt,{className:"size-4 animate-spin text-muted-foreground"})})})]})})}),I.length>0&&e.jsx("div",{className:"fixed bottom-24 left-0 right-0 px-4 pb-2 z-20 pointer-events-none",children:e.jsx("div",{className:"w-full max-w-2xl mx-auto",children:e.jsx("div",{className:"overflow-x-auto scrollbar-hide -mx-4 px-4 pointer-events-auto",children:e.jsx("div",{className:"flex gap-3",style:{width:"max-content"},children:I.map((d,v)=>{const _=d.subtitle&&d.subtitle.trim().length>0;return e.jsxs("button",{onClick:()=>ye(d.text),disabled:s,className:"flex-shrink-0 w-[calc(40vw-1rem)] min-w-[140px] max-w-[160px] rounded-xl bg-muted hover:bg-muted/80 active:bg-muted/70 px-2.5 py-2 text-left transition-all duration-200 disabled:cursor-not-allowed disabled:opacity-50 shadow-sm",type:"button",children:[e.jsx("p",{className:"font-medium text-xs text-foreground mb-0.5 line-clamp-2 leading-tight",children:d.text}),_&&e.jsx("p",{className:"text-[10px] text-muted-foreground line-clamp-2 leading-tight",children:d.subtitle})]},v)})})})})}),e.jsx("div",{className:"fixed bottom-0 left-0 right-0 w-full bg-background/95 backdrop-blur-sm px-4 py-3 safe-bottom flex-shrink-0 z-30",style:{paddingBottom:"max(0.75rem, env(safe-area-inset-bottom))"},children:e.jsx("div",{className:"w-full max-w-2xl mx-auto",children:we()})})]})})}function dt({className:t,onKeyDown:n,onCompositionStart:s,onCompositionEnd:i,...o}){const r=et(),{onCompositionStart:c,onCompositionEnd:h,onKeyDown:p}=At({onKeyDown:m=>{const u=m.nativeEvent.isComposing||r.justEndedComposing();m.key==="Enter"&&!m.shiftKey&&u||n?.(m)},onCompositionStart:m=>{r.setComposing(!0),s?.(m)},onCompositionEnd:m=>{r.markCompositionEnd(),setTimeout(()=>{r.setComposing(!1)},100),i?.(m)}});return e.jsx("textarea",{"data-slot":"textarea",className:S("border-input placeholder:text-muted-foreground focus-visible:border-ring focus-visible:ring-ring/50 aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive dark:bg-input/30 flex field-sizing-content min-h-16 w-full rounded-md border bg-transparent px-3 py-2 text-base shadow-xs transition-[color,box-shadow] outline-none focus-visible:ring-[3px] disabled:cursor-not-allowed disabled:opacity-50 md:text-sm",t),onCompositionStart:c,onCompositionEnd:h,onKeyDown:p,...o})}function Hs(){return Ss()}async function We(t){try{if(t.id&&!t.id.startsWith("chat_"))await Ds(t.id,{title:t.title,messages:t.messages});else{const n=await As({title:t.title,messages:t.messages});t.id=n.id}}catch(n){throw n}}function qe(t,n){return n.find(s=>s.id===t)||null}function Gs(t){return t.length<=50?t:t.substring(0,50)+"..."}function ut(){const t=`chat_${Date.now()}_${Math.random().toString(36).substring(2,9)}`,n=new Date().toISOString();return{id:t,userId:"",title:"Neue Konversation",messages:[],createdAt:n,updatedAt:n}}const Me={role:"system",content:"Du bist ein hilfreicher Assistent für die Nexo-Anwendung. Du hilfst Benutzern bei Fragen zu Finanzen, Rechnungen, Terminen und anderen Funktionen der App."};function ja(){const{t}=Nt();Oe();const{data:n,isLoading:s,refetch:i}=Hs(),[o,r]=b(null),[c,h]=b(!1),[p,m]=b(!1),[u,l]=b(!1),[N,j]=b(!1),[w,f]=b(!1),[R,D]=b(!1),[ue,Q]=b(!1),[B,U]=b(null),te=M(null),ne=M(null),ae=M(null),E=M(null),[x,C]=b({title:"",type:"termin",dueDate:"",isAllDay:!1,amount:"",currency:"CHF",notes:""}),[I,W]=b(!1),[k,ee]=b({type:"ausgabe",amount:"",category:"",description:"",date:new Date().toISOString().split("T")[0],paymentMethod:"Karte"}),[ye,De]=b(!1),[q,ie]=b({name:"",quantity:"1",category:"Lebensmittel",store:""}),[Ie,we]=b(!1),d=["Lebensmittel","Getränke","Haushalt","Hygiene","Tierbedarf","Sonstiges"],v=async()=>{if(!q.name){g.error("Bitte Artikelname eingeben");return}we(!0);try{await Es({item:q.name,quantity:parseInt(q.quantity)||1,category:q.category,estimatedPrice:0,currency:"EUR",unit:null}),g.success("Artikel zur Einkaufsliste hinzugefügt"),f(!1),ie({name:"",quantity:"1",category:"Lebensmittel",store:""})}catch(a){g.error("Fehler beim Hinzufügen des Artikels"),console.error(a)}finally{we(!1)}},_={income:["Gehalt","Freelance","Investitionen","Geschenk","Sonstiges"],expense:["Lebensmittel","Transport","Wohnen","Unterhaltung","Gesundheit","Kleidung","Bildung","Rechnung","Sonstiges"]},X=async()=>{if(!k.amount||!k.category){g.error("Bitte Betrag und Kategorie eingeben");return}De(!0);try{await ks({type:k.type,category:k.category,amount:Math.round(parseFloat(k.amount)*100),currency:"CHF",date:new Date(k.date),paymentMethod:k.paymentMethod,notes:k.description||"",status:k.type==="ausgabe"?"open":void 0}),g.success(k.type==="einnahme"?"Einnahme hinzugefügt":"Ausgabe hinzugefügt"),j(!1),ee({type:"ausgabe",amount:"",category:"",description:"",date:new Date().toISOString().split("T")[0],paymentMethod:"Karte"})}catch(a){g.error("Fehler beim Erstellen des Eintrags"),console.error(a)}finally{De(!1)}};G(()=>{if(!s&&n.length>0&&!o)r(n[0].id);else if(!s&&n.length===0&&!o){const a=ut();We(a).then(()=>{i(),r(a.id)})}},[s,n,o,i]);const[A,P]=b([Me]);G(()=>{if(o&&n.length>0){const a=qe(o,n);a&&a.messages.length>0?P(a.messages):P([Me])}},[o,n]),G(()=>{if(o&&A.length>1){const a=setTimeout(async()=>{const y=qe(o,n);if(y){const O=A.find(se=>se.role==="user");O&&y.title==="Neue Konversation"&&(y.title=Gs(O.content)),y.messages=A,y.updatedAt=new Date().toISOString();try{await We(y),i()}catch{}}},1e3);return()=>clearTimeout(a)}},[A,o,n,i]);const H=$(async()=>{const a=ut();try{await We(a),r(a.id),P([Me]),await i(),g.success("Neue Konversation gestartet")}catch(y){g.error("Fehler beim Erstellen der neuen Konversation: "+(y instanceof Error?y.message:String(y)))}},[i]),L=$(a=>{r(a);const y=qe(a,n);y&&y.messages.length>0?P(y.messages):P([Me])},[n]),z=hs.ai.chat.useMutation({onSuccess:a=>{const y={role:"assistant",content:a.content};P(O=>[...O,y])},onError:a=>{let y="Ein unbekannter Fehler ist aufgetreten.";a.message.includes("<!doctype")||a.message.includes("Unexpected token")||a.message.includes("Failed to fetch")?y="Der Server ist nicht erreichbar oder gibt eine ungültige Antwort zurück. Bitte stelle sicher, dass der Server läuft und du eine Internetverbindung hast.":a.message.includes("Unable to transform")||a.message.includes("NetworkError")?y="Fehler bei der Datenübertragung. Bitte überprüfe deine Internetverbindung und versuche es erneut.":a.data?.code==="UNAUTHORIZED"||a.message.includes("unauthenticated")?y="Du bist nicht angemeldet. Bitte melde dich an.":a.data?.code==="INTERNAL_SERVER_ERROR"||a.message.includes("500")?y="Ein Serverfehler ist aufgetreten. Bitte versuche es später erneut.":a.message.includes("timeout")||a.message.includes("Timeout")?y="Die Anfrage hat zu lange gedauert. Bitte versuche es erneut.":a.message.includes("rate limit")||a.message.includes("429")?y="Zu viele Anfragen. Bitte warte einen Moment und versuche es erneut.":y=a.message||"Ein Fehler ist aufgetreten.";const O={role:"assistant",content:`**Fehler aufgetreten**

${y}

Bitte versuche es erneut oder starte eine neue Konversation.`};P(se=>[...se,O]),g.error("Fehler beim Senden der Nachricht")}}),V=$(a=>{if(a.length>1e4){g.error("Nachricht ist zu lang. Bitte kürze sie auf maximal 10.000 Zeichen.");return}if(A.filter(O=>O.role==="user").length>=50){g.warning("Zu viele Nachrichten in dieser Konversation. Bitte starte eine neue Konversation.");return}try{const O={role:"user",content:a},se=[...A,O];P(se),z.mutate({messages:se})}catch{g.error("Fehler beim Senden der Nachricht. Bitte versuche es erneut.")}},[A,z]),J=ce(()=>[{text:"Wie funktioniert die Rechnungsverwaltung?",subtitle:"Lerne die Rechnungsverwaltung kennen",icon:"receipt"},{text:"Wie erstelle ich eine Erinnerung?",subtitle:"Erstelle Termine und Erinnerungen",icon:"bell"},{text:"Wie verwalte ich meine Finanzen?",subtitle:"Verwalte Einnahmen und Ausgaben",icon:"wallet"},{text:"Was kann ich mit der Einkaufsliste machen?",subtitle:"Verwalte deine Einkaufsliste",icon:"shoppingCart"},{text:"Wie funktioniert das Raten-System?",subtitle:"Lerne Ratenzahlungen zu verwalten",icon:"calendar"},{text:"Wie scanne ich eine Rechnung?",subtitle:"Erfasse Rechnungen automatisch",icon:"scan"}],[]),fe=A.some(a=>a.role==="user"),oe=()=>o&&n.length>0&&n.find(y=>y.id===o)?.title||"Assistent",re=ce(()=>[{id:"reminder",label:"Erinnerung erstellen",path:"#",icon:Ye,onClick:()=>m(!0)},{id:"scan",label:"Rechnung scannen",path:"#",icon:Ue,onClick:()=>{l(!0),U(null)}},{id:"finance",label:"Finanzübersicht",path:"#",icon:ke,onClick:()=>j(!0)},{id:"shopping",label:"Einkaufsliste",path:"#",icon:Se,onClick:()=>f(!0)}],[]),je=async()=>{if(!x.title||!x.dueDate){g.error("Bitte füllen Sie Titel und Datum aus");return}W(!0);try{const a=x.amount?Math.round(parseFloat(x.amount)*100):void 0;await Cs({title:x.title,type:x.type,dueDate:new Date(x.dueDate),isAllDay:x.isAllDay,amount:a,currency:x.currency,notes:x.notes||""}),g.success("Erinnerung erstellt"),m(!1),C({title:"",type:"termin",dueDate:"",isAllDay:!1,amount:"",currency:"CHF",notes:""})}catch(a){g.error("Fehler beim Erstellen der Erinnerung"),console.error(a)}finally{W(!1)}},Dt=async()=>{try{const a=await navigator.mediaDevices.getUserMedia({video:{facingMode:"environment"}});E.current=a,te.current&&(te.current.srcObject=a),D(!0),He()}catch(a){g.error(Ms(a)),Ps()}},Ne=()=>{E.current&&(E.current.getTracks().forEach(a=>a.stop()),E.current=null),D(!1)},It=()=>{if(te.current&&ne.current){const a=te.current,y=ne.current;y.width=a.videoWidth,y.height=a.videoHeight;const O=y.getContext("2d");if(O){O.drawImage(a,0,0);const se=y.toDataURL("image/jpeg");U(se),Ne(),He()}}},Rt=a=>{const y=a.target.files?.[0];if(y){const O=new FileReader;O.onload=se=>{const Tt=se.target?.result;U(Tt),He()},O.readAsDataURL(y)}},Ft=async()=>{if(B){const a={role:"user",content:`![Gescanntes Bild](${B})`};P(y=>[...y,a]),U(null),l(!1),g.success("Scan zum Chat hinzugefügt");try{z.mutate({messages:[...A,a]})}catch(y){console.error("Error sending scan to chat:",y)}}};return G(()=>()=>{u||Ne()},[u]),e.jsxs("div",{className:"min-h-screen bg-background flex flex-col safe-area-inset",children:[e.jsx(vs,{title:oe(),showSidebar:!0,showQuickActions:!0,quickActions:re,currentChatId:o||void 0,onSelectChat:L,onNewChat:H,sidebarOpen:c,onSidebarToggle:h}),re.length>0&&e.jsxs("div",{className:"fixed top-14 left-0 right-0 z-30 px-4 py-3 flex flex-row gap-3 justify-center safe-top",style:{paddingTop:"max(0.75rem, env(safe-area-inset-top))"},children:[e.jsx("button",{onClick:()=>h(!0),className:"w-12 h-12 rounded-full bg-background hover:bg-muted border border-border transition-colors flex items-center justify-center active:scale-95 shadow-sm","aria-label":"Menü öffnen","aria-expanded":c,"aria-controls":"sidebar-menu",title:"Menü öffnen",children:e.jsx(Qt,{className:"w-5 h-5 text-foreground"})}),re.map(a=>{const y=a.icon;return e.jsx("button",{onClick:a.onClick,className:"w-12 h-12 rounded-full bg-background hover:bg-muted border border-border transition-colors flex items-center justify-center active:scale-95 shadow-sm","aria-label":a.label,title:a.label,children:y&&e.jsx(y,{className:"w-5 h-5 text-foreground"})},a.id)}),fe&&e.jsx("button",{onClick:H,className:"w-12 h-12 rounded-full bg-background hover:bg-muted border border-border transition-colors flex items-center justify-center active:scale-95 shadow-sm","aria-label":"Neue Konversation",title:"Neue Konversation",children:e.jsx(en,{className:"w-5 h-5 text-foreground"})})]}),e.jsx("div",{className:"flex-1 overflow-hidden flex flex-col bg-background",style:{paddingTop:re.length>0?"7rem":"3.5rem"},children:e.jsx("div",{className:"flex-1 flex flex-col w-full overflow-hidden min-h-0",children:e.jsx($s,{messages:A,onSendMessage:V,isLoading:z.isPending,placeholder:t("common.typeMessage","Nachricht eingeben..."),height:"100%",emptyStateMessage:"Wähle eine Frage oder stelle deine eigene",suggestedPrompts:fe?[]:J})})}),e.jsx(Re,{open:p,onOpenChange:m,children:e.jsxs(Fe,{className:"!fixed !top-[50%] !left-[50%] !right-auto !bottom-auto !translate-x-[-50%] !translate-y-[-50%] !w-[85vw] !max-w-sm !max-h-fit !rounded-3xl !m-0 !overflow-visible !shadow-2xl",children:[e.jsx(Te,{className:"px-5 pt-5 pb-3",children:e.jsx(Pe,{className:"text-lg font-semibold",children:"Erinnerung erstellen"})}),e.jsxs("div",{className:"space-y-3 px-5 pb-2",children:[e.jsxs("div",{children:[e.jsx(K,{className:"text-sm font-medium",children:"Titel *"}),e.jsx(le,{value:x.title,onChange:a=>C({...x,title:a.target.value}),placeholder:"Titel",className:"h-11 min-h-[44px] mt-1.5 rounded-xl"})]}),e.jsxs("div",{children:[e.jsx(K,{className:"text-sm font-medium",children:"Typ *"}),e.jsxs(pe,{value:x.type,onValueChange:a=>C({...x,type:a}),children:[e.jsx(be,{className:"h-11 min-h-[44px] mt-1.5 rounded-xl",children:e.jsx(xe,{})}),e.jsxs(ve,{children:[e.jsx(Z,{value:"termin",children:"Termin"}),e.jsx(Z,{value:"zahlung",children:"Zahlung"}),e.jsx(Z,{value:"aufgabe",children:"Aufgabe"})]})]})]}),e.jsxs("div",{children:[e.jsx(K,{className:"text-sm font-medium",children:"Datum & Uhrzeit *"}),e.jsx(le,{type:"datetime-local",value:x.dueDate,onChange:a=>C({...x,dueDate:a.target.value}),className:"h-11 min-h-[44px] mt-1.5 rounded-xl"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Ts,{checked:x.isAllDay,onCheckedChange:a=>C({...x,isAllDay:a})}),e.jsx(K,{className:"text-sm font-medium",children:"Ganztägig"})]}),x.type==="zahlung"&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{children:[e.jsx(K,{children:"Betrag"}),e.jsx(le,{type:"number",step:"0.01",value:x.amount,onChange:a=>C({...x,amount:a.target.value}),placeholder:"0.00",className:"h-10 min-h-[44px] mt-1"})]}),e.jsxs("div",{children:[e.jsx(K,{className:"text-sm font-medium",children:"Währung"}),e.jsxs(pe,{value:x.currency,onValueChange:a=>C({...x,currency:a}),children:[e.jsx(be,{className:"h-10 min-h-[44px] mt-1",children:e.jsx(xe,{})}),e.jsxs(ve,{children:[e.jsx(Z,{value:"CHF",children:"CHF"}),e.jsx(Z,{value:"EUR",children:"EUR"}),e.jsx(Z,{value:"USD",children:"USD"})]})]})]})]}),e.jsxs("div",{children:[e.jsx(K,{className:"text-sm font-medium",children:"Notizen"}),e.jsx(dt,{value:x.notes,onChange:a=>C({...x,notes:a.target.value}),placeholder:"Notizen...",className:"mt-1.5 min-h-[90px] rounded-xl"})]})]}),e.jsxs(ze,{className:"px-5 pb-3 pt-2 gap-2.5",children:[e.jsx(Y,{variant:"outline",onClick:()=>m(!1),className:"h-11 min-h-[44px] flex-1 rounded-xl text-sm font-medium",children:"Abbrechen"}),e.jsx(Y,{onClick:je,disabled:I,className:"h-11 min-h-[44px] flex-1 rounded-xl text-sm font-medium",children:I?"Speichert...":"Erstellen"})]})]})}),e.jsx(Re,{open:u,onOpenChange:a=>{l(a),a||(Ne(),U(null))},children:e.jsxs(Fe,{className:"!fixed !top-[50%] !left-[50%] !right-auto !bottom-auto !translate-x-[-50%] !translate-y-[-50%] !w-[85vw] !max-w-sm !max-h-fit !rounded-3xl !m-0 !overflow-visible !shadow-2xl",children:[e.jsx(Te,{className:"px-5 pt-5 pb-3",children:e.jsx(Pe,{className:"text-lg font-semibold",children:"Rechnung scannen"})}),e.jsxs("div",{className:"space-y-3 px-5 pb-2",children:[!R&&!B&&e.jsxs("div",{className:"space-y-2.5",children:[e.jsxs(Y,{onClick:Dt,className:"w-full h-11 flex items-center justify-center gap-2 rounded-xl text-sm font-medium",children:[e.jsx(st,{className:"w-4 h-4"}),"Kamera öffnen"]}),e.jsxs("div",{className:"relative",children:[e.jsx("input",{ref:ae,type:"file",accept:"image/*",onChange:Rt,className:"hidden"}),e.jsxs(Y,{variant:"outline",onClick:()=>ae.current?.click(),className:"w-full h-11 flex items-center justify-center gap-2 rounded-xl text-sm font-medium",children:[e.jsx(tn,{className:"w-4 h-4"}),"Bild hochladen"]})]})]}),R&&e.jsxs("div",{className:"space-y-2.5",children:[e.jsxs("div",{className:"relative bg-black rounded-xl overflow-hidden aspect-video",children:[e.jsx("video",{ref:te,autoPlay:!0,playsInline:!0,className:"w-full h-full object-cover"}),e.jsx("canvas",{ref:ne,className:"hidden"})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(Y,{variant:"outline",onClick:Ne,className:"flex-1 h-11 rounded-xl text-sm font-medium",children:[e.jsx(Xe,{className:"w-4 h-4 mr-2"}),"Abbrechen"]}),e.jsxs(Y,{onClick:It,className:"flex-1 h-11 rounded-xl text-sm font-medium",children:[e.jsx(st,{className:"w-4 h-4 mr-2"}),"Aufnehmen"]})]})]}),B&&e.jsxs("div",{className:"space-y-2.5",children:[e.jsx("div",{className:"relative bg-black rounded-xl overflow-hidden",children:e.jsx("img",{src:B,alt:"Gescanntes Bild",className:"w-full h-auto"})}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(Y,{variant:"outline",onClick:()=>{U(null),D(!1)},className:"flex-1 h-11 rounded-xl text-sm font-medium",children:"Neu scannen"}),e.jsx(Y,{onClick:Ft,className:"flex-1 h-11 rounded-xl text-sm font-medium",children:"Zum Chat hinzufügen"})]})]})]}),e.jsx(ze,{className:"px-5 pb-3 pt-2",children:e.jsx(Y,{variant:"outline",onClick:()=>{l(!1),Ne(),U(null)},className:"h-11 min-h-[44px] w-full rounded-xl text-sm font-medium",children:"Schließen"})})]})}),e.jsx(Re,{open:N,onOpenChange:a=>{j(a),a||ee({type:"ausgabe",amount:"",category:"",description:"",date:new Date().toISOString().split("T")[0],paymentMethod:"Karte"})},children:e.jsxs(Fe,{className:"!fixed !top-[50%] !left-[50%] !right-auto !bottom-auto !translate-x-[-50%] !translate-y-[-50%] !w-[85vw] !max-w-sm !max-h-fit !rounded-3xl !m-0 !overflow-visible !shadow-2xl",children:[e.jsx(Te,{className:"px-5 pt-5 pb-3",children:e.jsx(Pe,{className:"text-lg font-semibold",children:"Einnahme / Ausgabe"})}),e.jsxs("div",{className:"space-y-3 px-5 pb-2",children:[e.jsxs("div",{children:[e.jsx(K,{className:"text-sm font-medium",children:"Typ *"}),e.jsxs(pe,{value:k.type,onValueChange:a=>{ee({...k,type:a,category:""})},children:[e.jsx(be,{className:"h-11 min-h-[44px] mt-1.5 rounded-xl",children:e.jsx(xe,{})}),e.jsxs(ve,{children:[e.jsx(Z,{value:"einnahme",children:"Einnahme"}),e.jsx(Z,{value:"ausgabe",children:"Ausgabe"})]})]})]}),e.jsxs("div",{children:[e.jsx(K,{children:"Betrag *"}),e.jsx(le,{type:"number",step:"0.01",value:k.amount,onChange:a=>ee({...k,amount:a.target.value}),placeholder:"0.00",className:"h-11 min-h-[44px] mt-1.5 rounded-xl"})]}),e.jsxs("div",{children:[e.jsx(K,{className:"text-sm font-medium",children:"Kategorie *"}),e.jsxs(pe,{value:k.category,onValueChange:a=>ee({...k,category:a}),children:[e.jsx(be,{className:"h-11 min-h-[44px] mt-1.5 rounded-xl",children:e.jsx(xe,{placeholder:"Kategorie wählen"})}),e.jsx(ve,{children:(k.type==="einnahme"?_.income:_.expense).map(a=>e.jsx(Z,{value:a,children:a},a))})]})]}),e.jsxs("div",{children:[e.jsx(K,{className:"text-sm font-medium",children:"Datum *"}),e.jsx(le,{type:"date",value:k.date,onChange:a=>ee({...k,date:a.target.value}),className:"h-11 min-h-[44px] mt-1.5 rounded-xl"})]}),e.jsxs("div",{children:[e.jsx(K,{children:"Zahlungsmethode"}),e.jsxs(pe,{value:k.paymentMethod,onValueChange:a=>ee({...k,paymentMethod:a}),children:[e.jsx(be,{className:"h-11 min-h-[44px] mt-1.5 rounded-xl",children:e.jsx(xe,{})}),e.jsxs(ve,{children:[e.jsx(Z,{value:"Karte",children:"Karte"}),e.jsx(Z,{value:"Bar",children:"Bar"}),e.jsx(Z,{value:"Überweisung",children:"Überweisung"}),e.jsx(Z,{value:"Andere",children:"Andere"})]})]})]}),e.jsxs("div",{children:[e.jsx(K,{children:"Beschreibung"}),e.jsx(dt,{value:k.description,onChange:a=>ee({...k,description:a.target.value}),placeholder:"Beschreibung...",className:"mt-1 min-h-[80px]"})]})]}),e.jsxs(ze,{className:"px-5 pb-3 pt-2 gap-2.5",children:[e.jsx(Y,{variant:"outline",onClick:()=>j(!1),className:"h-11 min-h-[44px] flex-1 rounded-xl text-sm font-medium",children:"Abbrechen"}),e.jsx(Y,{onClick:X,disabled:ye,className:"h-11 min-h-[44px] flex-1 rounded-xl text-sm font-medium",children:ye?"Speichert...":"Erstellen"})]})]})}),e.jsx(Re,{open:w,onOpenChange:a=>{f(a),a||ie({name:"",quantity:"1",category:"Lebensmittel",store:""})},children:e.jsxs(Fe,{className:"!fixed !top-[50%] !left-[50%] !right-auto !bottom-auto !translate-x-[-50%] !translate-y-[-50%] !w-[85vw] !max-w-sm !max-h-fit !rounded-3xl !m-0 !overflow-visible !shadow-2xl",children:[e.jsx(Te,{className:"px-5 pt-5 pb-3",children:e.jsx(Pe,{className:"text-lg font-semibold",children:"Artikel zur Einkaufsliste hinzufügen"})}),e.jsxs("div",{className:"space-y-3 px-5 pb-2",children:[e.jsxs("div",{children:[e.jsx(K,{className:"text-sm font-medium",children:"Artikelname *"}),e.jsx(le,{value:q.name,onChange:a=>ie({...q,name:a.target.value}),placeholder:"z.B. Milch",className:"h-11 min-h-[44px] mt-1.5 rounded-xl"})]}),e.jsxs("div",{children:[e.jsx(K,{className:"text-sm font-medium",children:"Menge"}),e.jsx(le,{type:"number",min:"1",value:q.quantity,onChange:a=>ie({...q,quantity:a.target.value}),placeholder:"1",className:"h-11 min-h-[44px] mt-1.5 rounded-xl"})]}),e.jsxs("div",{children:[e.jsx(K,{className:"text-sm font-medium",children:"Kategorie"}),e.jsxs(pe,{value:q.category,onValueChange:a=>ie({...q,category:a}),children:[e.jsx(be,{className:"h-11 min-h-[44px] mt-1.5 rounded-xl",children:e.jsx(xe,{})}),e.jsx(ve,{children:d.map(a=>e.jsx(Z,{value:a,children:a},a))})]})]}),e.jsxs("div",{children:[e.jsx(K,{className:"text-sm font-medium",children:"Geschäft (optional)"}),e.jsx(le,{value:q.store,onChange:a=>ie({...q,store:a.target.value}),placeholder:"z.B. Migros",className:"h-11 min-h-[44px] mt-1.5 rounded-xl"})]})]}),e.jsxs(ze,{className:"px-5 pb-3 pt-2 gap-2.5",children:[e.jsx(Y,{variant:"outline",onClick:()=>f(!1),className:"h-11 min-h-[44px] flex-1 rounded-xl text-sm font-medium",children:"Abbrechen"}),e.jsx(Y,{onClick:v,disabled:Ie,className:"h-11 min-h-[44px] flex-1 rounded-xl text-sm font-medium",children:Ie?"Speichert...":"Hinzufügen"})]})]})})]})}export{Ts as A,Y as B,da as C,Re as D,oa as E,Cs as F,gs as G,kt as H,le as I,la as J,ha as K,K as L,fa as M,ga as N,pa as O,vs as P,ya as Q,ua as R,pe as S,dt as T,ma as U,ra as V,ja as W,hs as X,ge as Y,ta as _,ia as a,Fe as b,S as c,Te as d,Pe as e,T as f,ze as g,xa as h,be as i,e as j,xe as k,ve as l,Z as m,Es as n,He as o,Ps as p,va as q,wa as r,Ms as s,ba as t,Nt as u,ks as v,na as w,sa as x,aa as y,ca as z};
