import*as Me from"react";import Gt,{createContext as Vt,useContext as Zt,useMemo as Ne,useRef as Y,useCallback as ae,useState as j,useEffect as G}from"react";import"./vendor-i18n-CxwOOByA.js";import{s as gn,c as xn,X as Be,W as Xt,C as ht,a as Dt,b as Jt,S as Qt,d as bn,e as yn,f as vn,g as Oe,M as wn,L as Et,h as kt,B as gt,U as ft,i as Ze,j as Xe,k as st,F as At,l as pt,m as jn,H as Nn,T as Dn,n as Cn,o as en,p as tn,q as Sn,P as En,I as kn,r as zt,t as An,u as In,v as nn,A as Fn,w as Tn,x as Rn,y as Ln,z as zn,D as Pn,E as Mn,G as On,J as Bn,K as _n,N as Un,O as $n,Q as Pt,R as Hn}from"./vendor-misc-Dgoprpj-.js";import{u as at,L as Kn}from"./vendor-router-D6hxBhhV.js";import{S as Wn,R as Yn,C as qn,a as Gn,D as Vn,T as Zn,P as Xn,O as Jn,b as Qn,c as es,d as ts,I as ns,V as ss,e as as,f as rs,g as is,h as os,i as ls,j as cs,k as ds,l as us,m as ms,n as hs,o as fs,p as ps,q as gs,r as xs,s as bs,t as ys,u as vs}from"./vendor-ui-lt1so0uj.js";import{t as ws,c as js}from"./vendor-utils-BNe0Xlio.js";import{i as Ns,g as Ds,a as Cs,b as Ss,c as Es,d as ks,o as As,s as Is,G as Fs,e as Ts,f as Rs,h as Ls,j as zs,u as Ps,k as $,q as pe,w as je,l as _e,T as Mt,m as rt,n as Ue}from"./vendor-firebase-Dpcgiyci.js";import{t as N}from"./vendor-toast-CdQ6zwVl.js";import{c as Ms}from"./vendor-api-CWSsqTq_.js";const Os="modulepreload",Bs=function(t){return"/"+t},Ot={},_s=function(n,s,o){let c=Promise.resolve();if(s&&s.length>0){let a=function(h){return Promise.all(h.map(p=>Promise.resolve(p).then(m=>({status:"fulfilled",value:m}),m=>({status:"rejected",reason:m}))))};document.getElementsByTagName("link");const d=document.querySelector("meta[property=csp-nonce]"),u=d?.nonce||d?.getAttribute("nonce");c=a(s.map(h=>{if(h=Bs(h),h in Ot)return;Ot[h]=!0;const p=h.endsWith(".css"),m=p?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${h}"]${m}`))return;const f=document.createElement("link");if(f.rel=p?"stylesheet":Os,p||(f.as="script"),f.crossOrigin="",f.href=h,u&&f.setAttribute("nonce",u),document.head.appendChild(f),p)return new Promise((b,i)=>{f.addEventListener("load",b),f.addEventListener("error",()=>i(new Error(`Unable to preload CSS for ${h}`)))})}))}function l(d){const u=new Event("vite:preloadError",{cancelable:!0});if(u.payload=d,window.dispatchEvent(u),!u.defaultPrevented)throw d}return c.then(d=>{for(const u of d||[])u.status==="rejected"&&l(u.reason);return n().catch(l)})};var Ga=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function Va(t){return t&&t.__esModule&&Object.prototype.hasOwnProperty.call(t,"default")?t.default:t}var yt={exports:{}},et={};/**
 * @license React
 * react-jsx-runtime.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var Bt;function Us(){if(Bt)return et;Bt=1;var t=Gt,n=Symbol.for("react.element"),s=Symbol.for("react.fragment"),o=Object.prototype.hasOwnProperty,c=t.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,l={key:!0,ref:!0,__self:!0,__source:!0};function d(u,a,h){var p,m={},f=null,b=null;h!==void 0&&(f=""+h),a.key!==void 0&&(f=""+a.key),a.ref!==void 0&&(b=a.ref);for(p in a)o.call(a,p)&&!l.hasOwnProperty(p)&&(m[p]=a[p]);if(u&&u.defaultProps)for(p in a=u.defaultProps,a)m[p]===void 0&&(m[p]=a[p]);return{$$typeof:n,type:u,key:f,ref:b,props:m,_owner:c.current}}return et.Fragment=s,et.jsx=d,et.jsxs=d,et}var _t;function $s(){return _t||(_t=1,yt.exports=Us()),yt.exports}var e=$s();const Hs=(t,n,s,o)=>{const c=[s,{code:n,...o||{}}];if(t?.services?.logger?.forward)return t.services.logger.forward(c,"warn","react-i18next::",!0);$e(c[0])&&(c[0]=`react-i18next:: ${c[0]}`),t?.services?.logger?.warn?t.services.logger.warn(...c):console?.warn&&console.warn(...c)},Ut={},sn=(t,n,s,o)=>{$e(s)&&Ut[s]||($e(s)&&(Ut[s]=new Date),Hs(t,n,s,o))},an=(t,n)=>()=>{if(t.isInitialized)n();else{const s=()=>{setTimeout(()=>{t.off("initialized",s)},0),n()};t.on("initialized",s)}},Ct=(t,n,s)=>{t.loadNamespaces(n,an(t,s))},$t=(t,n,s,o)=>{if($e(s)&&(s=[s]),t.options.preload&&t.options.preload.indexOf(n)>-1)return Ct(t,s,o);s.forEach(c=>{t.options.ns.indexOf(c)<0&&t.options.ns.push(c)}),t.loadLanguages(n,an(t,o))},Ks=(t,n,s={})=>!n.languages||!n.languages.length?(sn(n,"NO_LANGUAGES","i18n.languages were undefined or empty",{languages:n.languages}),!0):n.hasLoadedNamespace(t,{lng:s.lng,precheck:(o,c)=>{if(s.bindI18n&&s.bindI18n.indexOf("languageChanging")>-1&&o.services.backendConnector.backend&&o.isLanguageChangingTo&&!c(o.isLanguageChangingTo,t))return!1}}),$e=t=>typeof t=="string",Ws=t=>typeof t=="object"&&t!==null,Ys=/&(?:amp|#38|lt|#60|gt|#62|apos|#39|quot|#34|nbsp|#160|copy|#169|reg|#174|hellip|#8230|#x2F|#47);/g,qs={"&amp;":"&","&#38;":"&","&lt;":"<","&#60;":"<","&gt;":">","&#62;":">","&apos;":"'","&#39;":"'","&quot;":'"',"&#34;":'"',"&nbsp;":" ","&#160;":" ","&copy;":"©","&#169;":"©","&reg;":"®","&#174;":"®","&hellip;":"…","&#8230;":"…","&#x2F;":"/","&#47;":"/"},Gs=t=>qs[t],Vs=t=>t.replace(Ys,Gs);let St={bindI18n:"languageChanged",bindI18nStore:"",transEmptyNodeValue:"",transSupportBasicHtmlNodes:!0,transWrapTextNodes:"",transKeepBasicHtmlNodesFor:["br","strong","i","p"],useSuspense:!0,unescape:Vs,transDefaultProps:void 0};const Zs=(t={})=>{St={...St,...t}},Xs=()=>St;let rn;const Js=t=>{rn=t},Qs=()=>rn,Za={type:"3rdParty",init(t){Zs(t.options.react),Js(t)}},ea=Vt();class ta{constructor(){this.usedNamespaces={}}addUsedNamespaces(n){n.forEach(s=>{this.usedNamespaces[s]||(this.usedNamespaces[s]=!0)})}getUsedNamespaces(){return Object.keys(this.usedNamespaces)}}const na=(t,n)=>$e(n)?n:Ws(n)&&$e(n.defaultValue)?n.defaultValue:Array.isArray(t)?t[t.length-1]:t,sa={t:na,ready:!1},aa=()=>()=>{},It=(t,n={})=>{const{i18n:s}=n,{i18n:o,defaultNS:c}=Zt(ea)||{},l=s||o||Qs();l&&!l.reportNamespaces&&(l.reportNamespaces=new ta),l||sn(l,"NO_I18NEXT_INSTANCE","useTranslation: You will need to pass in an i18next instance by using initReactI18next");const d=Ne(()=>({...Xs(),...l?.options?.react,...n}),[l,n]),{useSuspense:u,keyPrefix:a}=d,h=c||l?.options?.defaultNS,p=$e(h)?[h]:h||["translation"],m=Ne(()=>p,p);l?.reportNamespaces?.addUsedNamespaces?.(m);const f=Y(0),b=ae(I=>{if(!l)return aa;const{bindI18n:D,bindI18nStore:T}=d,k=()=>{f.current+=1,I()};return D&&l.on(D,k),T&&l.store.on(T,k),()=>{D&&D.split(" ").forEach(ne=>l.off(ne,k)),T&&T.split(" ").forEach(ne=>l.store.off(ne,k))}},[l,d]),i=Y(),g=ae(()=>{if(!l)return sa;const I=!!(l.isInitialized||l.initializedStoreOnce)&&m.every(se=>Ks(se,l,d)),D=n.lng||l.language,T=f.current,k=i.current;if(k&&k.ready===I&&k.lng===D&&k.keyPrefix===a&&k.revision===T)return k;const z={t:l.getFixedT(D,d.nsMode==="fallback"?m:m[0],a),ready:I,lng:D,keyPrefix:a,revision:T};return i.current=z,z},[l,m,a,d,n.lng]),[w,F]=j(0),{t:L,ready:re}=gn.useSyncExternalStore(b,g,g);G(()=>{if(l&&!re&&!u){const I=()=>F(D=>D+1);n.lng?$t(l,n.lng,m,I):Ct(l,m,I)}},[l,n.lng,m,re,u,w]);const q=l||{},Q=Y(null),ie=Y(),ee=I=>{const D=Object.getOwnPropertyDescriptors(I);D.__original&&delete D.__original;const T=Object.create(Object.getPrototypeOf(I),D);if(!Object.prototype.hasOwnProperty.call(T,"__original"))try{Object.defineProperty(T,"__original",{value:I,writable:!1,enumerable:!1,configurable:!1})}catch{}return T},ue=Ne(()=>{const I=q,D=I?.language;let T=I;I&&(Q.current&&Q.current.__original===I?ie.current!==D?(T=ee(I),Q.current=T,ie.current=D):T=Q.current:(T=ee(I),Q.current=T,ie.current=D));const k=[L,T,re];return k.t=L,k.i18n=T,k.ready=re,k},[L,q,re,q.resolvedLanguage,q.language,q.languages]);if(l&&u&&!re)throw new Promise(I=>{const D=()=>I();n.lng?$t(l,n.lng,m,D):Ct(l,m,D)});return ue},ra=Ms(),ia={apiKey:"AIzaSyCZ8V17HUVMlBKXK0ftrMURS-XP2zIsOps",authDomain:"nexo-jtsky100.firebaseapp.com",projectId:"nexo-jtsky100",storageBucket:"nexo-jtsky100.firebasestorage.app",messagingSenderId:"859320186482",appId:"1:859320186482:web:0c9dcca5d8ce613aaf34eb",measurementId:"G-G8PX4GB2YF"},xt=Ns(ia),Pe=Ds(xt),He=Cs(xt),H=Ss(xt,"us-central1");typeof window<"u"&&Es(xt);const on=Vt(void 0);function Xa({children:t}){const[n,s]=j(null),[o,c]=j(!0),[l,d]=j(null);G(()=>(ks(Pe).then(g=>{g?.user&&s(g.user)}).catch(g=>{if(g.code&&g.code!=="auth/no-auth-event"){let w="Ein Fehler ist aufgetreten";switch(g.code){case"auth/internal-error":w="Ein interner Fehler ist aufgetreten. Bitte versuchen Sie es erneut oder verwenden Sie die E-Mail-Anmeldung.";break;case"auth/unauthorized-domain":w="Diese Domain ist nicht autorisiert. Bitte kontaktieren Sie den Administrator.";break;case"auth/operation-not-allowed":w="Google Sign-In ist nicht aktiviert.";break;case"auth/network-request-failed":w="Netzwerkfehler. Bitte überprüfen Sie Ihre Internetverbindung.";break;default:w=g.message||"Ein unbekannter Fehler ist aufgetreten"}d(w)}}),As(Pe,g=>{s(g),c(!1)})),[]);const u=async(i,g)=>{try{d(null);const w=await Ls(Pe,i,g)}catch(w){let F="Anmeldung fehlgeschlagen";switch(w.code){case"auth/invalid-email":F="Ungültige E-Mail-Adresse";break;case"auth/user-disabled":F="Dieses Konto wurde deaktiviert";break;case"auth/user-not-found":F="Kein Konto mit dieser E-Mail gefunden";break;case"auth/wrong-password":F="Falsches Passwort";break;case"auth/invalid-credential":F="Ungültige Anmeldedaten";break;default:F=w.message||"Ein Fehler ist aufgetreten"}throw d(F),new Error(F)}},a=async(i,g,w)=>{try{d(null);const F=await zs(Pe,i,g);w&&F.user&&await Ps(F.user,{displayName:w})}catch(F){let L="Registrierung fehlgeschlagen";switch(F.code){case"auth/email-already-in-use":L="Diese E-Mail wird bereits verwendet";break;case"auth/invalid-email":L="Ungültige E-Mail-Adresse";break;case"auth/weak-password":L="Passwort ist zu schwach";break;default:L=F.message||"Ein Fehler ist aufgetreten"}throw d(L),new Error(L)}},h=async()=>{try{d(null);const i=new Fs;i.addScope("email"),i.addScope("profile"),i.setCustomParameters({prompt:"select_account"});try{await Ts(Pe,i)}catch(g){if(g.code==="auth/popup-blocked"||g.code==="auth/popup-closed-by-user")await Rs(Pe,i);else throw g}}catch(i){let g="Ein Fehler ist aufgetreten";switch(i.code){case"auth/internal-error":g="Ein interner Fehler ist aufgetreten. Bitte versuchen Sie es erneut oder verwenden Sie die E-Mail-Anmeldung.";break;case"auth/popup-blocked":g="Popup wurde blockiert. Bitte erlauben Sie Popups für diese Seite.";break;case"auth/popup-closed-by-user":g="Anmeldung abgebrochen.";break;case"auth/unauthorized-domain":g="Diese Domain ist nicht autorisiert. Bitte kontaktieren Sie den Administrator.";break;case"auth/operation-not-allowed":g="Google Sign-In ist nicht aktiviert.";break;case"auth/network-request-failed":g="Netzwerkfehler. Bitte überprüfen Sie Ihre Internetverbindung.";break;case"auth/cancelled-popup-request":g="Nur ein Popup kann gleichzeitig geöffnet sein.";break;default:g=i.message||"Ein unbekannter Fehler ist aufgetreten"}throw d(g),new Error(g)}},p=async()=>{try{await Is(Pe)}catch{throw new Error("Abmeldung fehlgeschlagen")}},m=u,f=h,b=p;return e.jsx(on.Provider,{value:{user:n,loading:o,error:l,signIn:u,signUp:a,signInWithGoogle:h,signOut:p,loginWithEmail:m,loginWithGoogle:f,logout:b},children:t})}function Je(){const t=Zt(on);if(t===void 0)throw new Error("useAuth must be used within an AuthProvider");return t}const oa={maxRetries:3,initialDelay:1e3,maxDelay:1e4,backoffMultiplier:2,retryableErrors:["network","timeout","ECONNRESET","ETIMEDOUT","ENOTFOUND","EAI_AGAIN","500","502","503","504"]};function la(t,n){if(!t)return!1;const s=t.message?.toLowerCase()||"",o=t.code?.toLowerCase()||"",c=t.status?.toString()||"";return n.some(l=>{const d=l.toLowerCase();return s.includes(d)||o.includes(d)||c.includes(d)})}function ca(t,n){const s=n.initialDelay*Math.pow(n.backoffMultiplier,t);return Math.min(s,n.maxDelay)}async function da(t,n={}){const s={...oa,...n};let o;for(let c=0;c<=s.maxRetries;c++)try{return await t()}catch(l){if(o=l,c>=s.maxRetries||!la(l,s.retryableErrors))break;const d=ca(c,s);await new Promise(u=>setTimeout(u,d))}throw o}async function Ee(t,n,s={}){return da(async()=>(await t(n)).data,s)}const Ft={maxRetries:3,initialDelay:1e3},Qe={maxRetries:2,initialDelay:500};function ua(t){const[n,s]=j([]),[o,c]=j(!0),[l,d]=j(null),{user:u}=Je();return G(()=>{if(!u){s([]),c(!1);return}c(!0);let h=pe(_e(He,"reminders"),je("userId","==",u.uid));t?.status&&(h=pe(h,je("status","==",t.status))),t?.startDate&&(h=pe(h,je("dueDate",">=",Mt.fromDate(t.startDate)))),t?.endDate&&(h=pe(h,je("dueDate","<=",Mt.fromDate(t.endDate)))),h=pe(h,rt("dueDate"));const p=Ue(h,m=>{try{const f=m.docs.map(b=>{const i=b.data();if(!i)return null;let g=new Date;if(i.dueDate){if(i.dueDate.toDate&&typeof i.dueDate.toDate=="function")g=i.dueDate.toDate();else if(i.dueDate instanceof Date)g=i.dueDate;else if(typeof i.dueDate=="string"){const L=new Date(i.dueDate);isNaN(L.getTime())||(g=L)}}let w=new Date;if(i.createdAt){if(i.createdAt.toDate&&typeof i.createdAt.toDate=="function")w=i.createdAt.toDate();else if(i.createdAt instanceof Date)w=i.createdAt;else if(typeof i.createdAt=="string"){const L=new Date(i.createdAt);isNaN(L.getTime())||(w=L)}}let F=new Date;if(i.updatedAt){if(i.updatedAt.toDate&&typeof i.updatedAt.toDate=="function")F=i.updatedAt.toDate();else if(i.updatedAt instanceof Date)F=i.updatedAt;else if(typeof i.updatedAt=="string"){const L=new Date(i.updatedAt);isNaN(L.getTime())||(F=L)}}return{id:b.id,userId:i.userId||u.uid,title:i.title||"",type:i.type||"erinnerung",dueDate:g,isAllDay:i.isAllDay||!1,amount:i.amount||null,currency:i.currency||"CHF",notes:i.notes||null,recurrenceRule:i.recurrenceRule||null,personId:i.personId||null,personName:i.personName||null,status:i.status||"offen",createdAt:w,updatedAt:F}}).filter(b=>b!==null);s(f),d(null)}catch(f){d(f),console.error("[useReminders] Error processing snapshot:",f)}finally{c(!1)}},m=>{m?.code==="failed-precondition"&&(console.error("[useReminders] Firestore index missing:",m.message),N.error("Index fehlt - Bitte Firebase Console prüfen")),d(m),c(!1),console.error("[useReminders] Snapshot error:",m)});return()=>p()},[u,t?.startDate,t?.endDate,t?.status]),{data:n,isLoading:o,error:l,refetch:()=>{s(h=>[...h])}}}async function ln(t){const n=$(H,"createReminder");return Ee(n,t,Ft)}async function Ja(t,n){const s=$(H,"updateReminder");await Ee(s,{id:t,...n},Qe)}async function Qa(t){const n=$(H,"deleteReminder");await Ee(n,{id:t},Qe)}function er(t){const[n,s]=j([]),[o,c]=j(!0),[l,d]=j(null),{user:u}=Je();return G(()=>{if(!u){s([]),c(!1);return}c(!0);let h=pe(_e(He,"financeEntries"),je("userId","==",u.uid));h=pe(h,rt("date","desc"));const p=Ue(h,m=>{try{const f=m.docs.map(b=>{const i=b.data();if(!i)return null;let g=new Date;if(i.date){if(i.date.toDate&&typeof i.date.toDate=="function")g=i.date.toDate();else if(i.date instanceof Date)g=i.date;else if(typeof i.date=="string"){const L=new Date(i.date);isNaN(L.getTime())||(g=L)}}let w=new Date;if(i.createdAt){if(i.createdAt.toDate&&typeof i.createdAt.toDate=="function")w=i.createdAt.toDate();else if(i.createdAt instanceof Date)w=i.createdAt;else if(typeof i.createdAt=="string"){const L=new Date(i.createdAt);isNaN(L.getTime())||(w=L)}}let F=new Date;if(i.updatedAt){if(i.updatedAt.toDate&&typeof i.updatedAt.toDate=="function")F=i.updatedAt.toDate();else if(i.updatedAt instanceof Date)F=i.updatedAt;else if(typeof i.updatedAt=="string"){const L=new Date(i.updatedAt);isNaN(L.getTime())||(F=L)}}return{id:b.id,userId:i.userId||u.uid,type:i.type||"ausgabe",category:i.category||"",description:i.description||"",amount:i.amount||0,currency:i.currency||"CHF",paymentMethod:i.paymentMethod||"Karte",date:g,isRecurring:i.isRecurring||!1,recurrenceRule:i.recurrenceRule||null,createdAt:w,updatedAt:F}}).filter(b=>b!==null);s(f),d(null)}catch(f){d(f),console.error("[useFinanceEntries] Error processing snapshot:",f)}finally{c(!1)}},m=>{m?.code==="failed-precondition"&&(console.error("[useFinanceEntries] Firestore index missing:",m.message),N.error("Index fehlt - Bitte Firebase Console prüfen")),d(m),c(!1),console.error("[useFinanceEntries] Snapshot error:",m)});return()=>p()},[u,t?.startDate,t?.endDate,t?.type]),{data:n,isLoading:o,error:l,refetch:()=>{s(h=>[...h])}}}async function cn(t){const n=$(H,"createFinanceEntry");return Ee(n,t,Ft)}async function tr(t,n){const s=$(H,"updateFinanceEntry");await Ee(s,{id:t,...n},Qe)}async function nr(t){const n=$(H,"deleteFinanceEntry");await Ee(n,{id:t},Qe)}function sr(t){const[n,s]=j([]),[o,c]=j(!0),[l,d]=j(null);return G(()=>{(async()=>{try{c(!0),d(null);const m=((await $(H,"getTaxProfiles")({})).data.profiles||[]).map(f=>({...f,createdAt:f.createdAt?.toDate?f.createdAt.toDate():f.createdAt?new Date(f.createdAt):new Date,updatedAt:f.updatedAt?.toDate?f.updatedAt.toDate():f.updatedAt?new Date(f.updatedAt):new Date}));s(m)}catch(a){console.error("Error fetching tax profiles:",a),d(a),s([])}finally{c(!1)}})()},[t]),{data:n,isLoading:o,error:l}}async function ar(t){await $(H,"deleteTaxProfile")({id:t})}function rr(){const[t,n]=j([]),[s,o]=j(!0),[c,l]=j(null),{user:d}=Je();return G(()=>{if(!d){n([]),o(!1);return}o(!0);let a=pe(_e(He,"people"),je("userId","==",d.uid));try{a=pe(a,rt("createdAt","desc"))}catch{console.warn("[usePeople] Index missing for createdAt, using unsorted query")}const h=Ue(a,p=>{try{const f=p.docs.map(b=>{const i=b.data();if(!i)return null;let g=new Date;if(i.createdAt){if(i.createdAt.toDate&&typeof i.createdAt.toDate=="function")g=i.createdAt.toDate();else if(i.createdAt instanceof Date)g=i.createdAt;else if(typeof i.createdAt=="string"){const F=new Date(i.createdAt);isNaN(F.getTime())||(g=F)}}let w=new Date;if(i.updatedAt){if(i.updatedAt.toDate&&typeof i.updatedAt.toDate=="function")w=i.updatedAt.toDate();else if(i.updatedAt instanceof Date)w=i.updatedAt;else if(typeof i.updatedAt=="string"){const F=new Date(i.updatedAt);isNaN(F.getTime())||(w=F)}}return{id:b.id,userId:i.userId||d.uid,name:i.name||"",email:i.email||null,phone:i.phone||null,totalOwed:i.totalOwed||0,currency:i.currency||"CHF",createdAt:g,updatedAt:w}}).filter(b=>b!==null).sort((b,i)=>i.createdAt.getTime()-b.createdAt.getTime());n(f),l(null)}catch(m){l(m),console.error("[usePeople] Error processing snapshot:",m)}finally{o(!1)}},p=>{if(p?.code==="failed-precondition"){console.error("[usePeople] Firestore index missing:",p.message);const m=pe(_e(He,"people"),je("userId","==",d.uid)),f=Ue(m,b=>{try{const i=b.docs.map(g=>{const w=g.data();return w?{id:g.id,userId:w.userId||d.uid,name:w.name||"",email:w.email||null,phone:w.phone||null,totalOwed:w.totalOwed||0,currency:w.currency||"CHF",createdAt:w.createdAt?.toDate?.()||new Date,updatedAt:w.updatedAt?.toDate?.()||new Date}:null}).filter(g=>g!==null);n(i.sort((g,w)=>w.createdAt.getTime()-g.createdAt.getTime())),l(null)}catch(i){l(i),console.error("[usePeople] Error processing fallback snapshot:",i)}finally{o(!1)}},b=>{l(b),o(!1),console.error("[usePeople] Fallback snapshot error:",b)});return()=>f()}else l(p),o(!1),console.error("[usePeople] Snapshot error:",p)});return()=>h()},[d]),{data:t,isLoading:s,error:c,refetch:()=>{n(a=>[...a])}}}async function ir(t){const n=$(H,"createPerson");return Ee(n,t,Ft)}async function or(t,n){const s=$(H,"updatePerson");await Ee(s,{personId:t,...n},Qe)}async function lr(t){const n=$(H,"deletePerson");await Ee(n,{personId:t},Qe)}function cr(){const[t,n]=j([]),[s,o]=j(!0),[c,l]=j(null),{user:d}=Je();return G(()=>{if(!d){n([]),o(!1);return}o(!0);let u=pe(_e(He,"shoppingLists"),je("userId","==",d.uid));try{u=pe(u,rt("createdAt","desc"))}catch{console.warn("[useShoppingLists] Index missing for createdAt, using unsorted query")}const a=Ue(u,h=>{try{const p=h.docs.map(m=>{const f=m.data();return f?{id:m.id,userId:f.userId,name:f.name,isDefault:f.isDefault||!1,createdAt:f.createdAt?.toDate?f.createdAt.toDate():new Date(f.createdAt),updatedAt:f.updatedAt?.toDate?f.updatedAt.toDate():new Date(f.updatedAt)}:null}).filter(m=>m!==null);p.sort((m,f)=>f.createdAt.getTime()-m.createdAt.getTime()),n(p),l(null)}catch(p){console.error("[useShoppingLists] Error mapping lists:",p),l(p)}finally{o(!1)}},h=>{if(console.error("[useShoppingLists] Snapshot error:",h),h?.code==="failed-precondition"){console.warn("[useShoppingLists] Index missing, trying without orderBy");const p=pe(_e(He,"shoppingLists"),je("userId","==",d.uid)),m=Ue(p,f=>{try{const b=f.docs.map(i=>{const g=i.data();return g?{id:i.id,userId:g.userId,name:g.name,isDefault:g.isDefault||!1,createdAt:g.createdAt?.toDate?g.createdAt.toDate():new Date(g.createdAt),updatedAt:g.updatedAt?.toDate?g.updatedAt.toDate():new Date(g.updatedAt)}:null}).filter(i=>i!==null);b.sort((i,g)=>g.createdAt.getTime()-i.createdAt.getTime()),n(b),l(null)}catch(b){console.error("[useShoppingLists] Error mapping lists (fallback):",b),l(b)}finally{o(!1)}},f=>{console.error("[useShoppingLists] Fallback snapshot error:",f),l(f),o(!1)});return()=>m()}else l(h),o(!1)});return()=>a()},[d]),{data:t,isLoading:s,error:c}}function dr(t,n){const[s,o]=j([]),[c,l]=j(!0),[d,u]=j(null),[a,h]=j(0);return G(()=>{t?(async()=>{try{l(!0);const g=(await $(H,"getShoppingList")({listId:t,status:n})).data.items.map(w=>({...w,boughtAt:w.boughtAt?.toDate?w.boughtAt.toDate():w.boughtAt?new Date(w.boughtAt):null,createdAt:w.createdAt?.toDate?w.createdAt.toDate():new Date(w.createdAt),updatedAt:w.updatedAt?.toDate?w.updatedAt.toDate():new Date(w.updatedAt)}));o(g),u(null)}catch(f){u(f)}finally{l(!1)}})():(o([]),l(!1))},[t,n,a]),{data:s,isLoading:c,error:d,refetch:()=>h(m=>m+1)}}async function ur(t,n){return(await $(H,"createShoppingList")({name:t,isDefault:n})).data}async function mr(t,n){await $(H,"updateShoppingList")({listId:t,...n})}async function hr(t){await $(H,"deleteShoppingList")({listId:t})}async function ma(t){return(await $(H,"createShoppingItem")(t)).data}async function fr(t,n){await $(H,"updateShoppingItem")({itemId:t,...n})}async function pr(t){await $(H,"deleteShoppingItem")({itemId:t})}async function gr(t,n,s){return(await $(H,"markShoppingItemAsBought")({itemId:t,actualPrice:n,createExpense:s})).data}function ha(){const[t,n]=j([]),[s,o]=j(!0),[c,l]=j(null),{user:d}=Je();return G(()=>{if(!d){n([]),o(!1);return}o(!0);const a=pe(_e(He,"chatConversations"),je("userId","==",d.uid),rt("updatedAt","desc")),h=Ue(a,p=>{try{const m=p.docs.map(f=>{const b=f.data();let i=new Date;b.createdAt&&(b.createdAt.toDate?i=b.createdAt.toDate().toISOString():typeof b.createdAt=="string"?i=b.createdAt:i=new Date(b.createdAt).toISOString());let g=new Date;return b.updatedAt&&(b.updatedAt.toDate?g=b.updatedAt.toDate().toISOString():typeof b.updatedAt=="string"?g=b.updatedAt:g=new Date(b.updatedAt).toISOString()),{id:f.id,userId:b.userId||d.uid,title:b.title||"Neue Konversation",messages:b.messages||[],createdAt:i,updatedAt:g}});m.sort((f,b)=>{const i=typeof f.updatedAt=="string"?new Date(f.updatedAt).getTime():f.updatedAt.getTime();return(typeof b.updatedAt=="string"?new Date(b.updatedAt).getTime():b.updatedAt.getTime())-i}),n(m),l(null)}catch(m){console.error("Error processing chat conversations:",m),l(m)}finally{o(!1)}},p=>{p.code==="permission-denied"?console.warn("[useChatConversations] Permission denied - user may not be authenticated"):p.code==="failed-precondition"?(console.warn("[useChatConversations] Index missing - query may need an index"),N.error("Index fehlt. Bitte warten Sie, bis der Index erstellt wurde.")):console.error("[useChatConversations] Firestore listener error:",p),l(p),o(!1),n([])});return()=>h()},[d]),{data:t,isLoading:s,error:c,refetch:async()=>{}}}const tt=new Map,fa=300*1e3,pa=500;function dn(t,n){const[s,o]=j(null),[c,l]=j(!1),[d,u]=j(null),a=Y(null);return G(()=>{if(a.current&&(clearTimeout(a.current),a.current=null),!t){o(null),u(null),l(!1);return}const p=`${t.toISOString().split("T")[0]}_${n||"no-location"}`,m=tt.get(p);if(m&&Date.now()-m.timestamp<fa){o(m.data),u(m.error),l(!1);return}return a.current=setTimeout(async()=>{try{if(l(!0),u(null),!n){const g=new Error("Location ist erforderlich. Bitte in den Einstellungen einen Standort eingeben.");u(g),o(null),l(!1),tt.set(p,{data:null,timestamp:Date.now(),error:g});return}const i=(await $(H,"getWeather")({date:t.toISOString(),location:n})).data;if(i)o(i),u(null),tt.set(p,{data:i,timestamp:Date.now(),error:null});else{const g=new Date;g.setHours(0,0,0,0);const w=new Date(t);w.setHours(0,0,0,0);const F=w<g?new Error("Historische Wetterdaten sind nur aus dem Cache verfügbar."):new Error("Keine Wetterdaten verfügbar. Bitte überprüfen Sie den Standort in den Einstellungen.");u(F),o(null),tt.set(p,{data:null,timestamp:Date.now(),error:F})}}catch(f){f?.code!=="internal"&&!f?.message?.includes("ERR_INSUFFICIENT_RESOURCES")&&console.error("[useWeather] Error:",f);const b=f?.message||f?.code||"Unbekannter Fehler beim Laden der Wetterdaten",i=new Error(b);u(i),o(null),tt.set(p,{data:null,timestamp:Date.now(),error:i})}finally{l(!1)}},pa),()=>{a.current&&(clearTimeout(a.current),a.current=null)}},[t?.toISOString(),n]),{data:s,isLoading:c,error:d}}function Tt(){const[t,n]=j(null),[s,o]=j(!0),[c,l]=j(null);G(()=>{(async()=>{try{o(!0),l(null);const p=(await $(H,"getUserSettings")({})).data;n(p)}catch(a){l(a)}finally{o(!1)}})()},[]);const d=ae(async u=>{try{return await $(H,"updateUserSettings")(u),n(h=>h?{...h,...u}:u),{success:!0}}catch(a){throw l(a),a}},[]);return{settings:t,isLoading:s,error:c,updateSettings:d}}async function ga(t){return(await $(H,"createChatConversation")(t)).data}async function xa(t,n){await $(H,"updateChatConversation")({id:t,...n})}async function ba(){return(await $(H,"clearAllChatConversations")({})).data}function M(...t){return ws(js(t))}const ya=xn("inline-flex items-center justify-center gap-2 whitespace-nowrap rounded-md text-sm font-medium transition-all disabled:pointer-events-none disabled:opacity-50 [&_svg]:pointer-events-none [&_svg:not([class*='size-'])]:size-4 shrink-0 [&_svg]:shrink-0 outline-none focus-visible:border-ring focus-visible:ring-ring/50 focus-visible:ring-[3px] aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive",{variants:{variant:{default:"bg-primary text-primary-foreground hover:bg-primary/90",destructive:"bg-destructive text-white hover:bg-destructive/90 focus-visible:ring-destructive/20 dark:focus-visible:ring-destructive/40 dark:bg-destructive/60",outline:"border bg-transparent shadow-xs hover:bg-accent dark:bg-transparent dark:border-input dark:hover:bg-input/50",secondary:"bg-secondary text-secondary-foreground hover:bg-secondary/80",ghost:"hover:bg-accent dark:hover:bg-accent/50",link:"text-primary underline-offset-4 hover:underline"},size:{default:"h-9 px-4 py-2 has-[>svg]:px-3",sm:"h-8 rounded-md gap-1.5 px-3 has-[>svg]:px-2.5",lg:"h-10 rounded-md px-6 has-[>svg]:px-4",icon:"size-9","icon-sm":"size-8","icon-lg":"size-10"}},defaultVariants:{variant:"default",size:"default"}});function U({className:t,variant:n,size:s,asChild:o=!1,...c}){const l=o?Wn:"button";return e.jsx(l,{"data-slot":"button",className:M(ya({variant:n,size:s,className:t})),...c})}function dt({className:t,...n}){return e.jsx("div",{"data-slot":"card",className:M("bg-card text-card-foreground flex flex-col gap-6 rounded-xl border py-6 shadow-sm",t),...n})}function xr({className:t,...n}){return e.jsx("div",{"data-slot":"card-header",className:M("@container/card-header grid auto-rows-min grid-rows-[auto_auto] items-start gap-2 px-6 has-data-[slot=card-action]:grid-cols-[1fr_auto] [.border-b]:pb-6",t),...n})}function br({className:t,...n}){return e.jsx("div",{"data-slot":"card-title",className:M("leading-none font-semibold",t),...n})}function yr({className:t,...n}){return e.jsx("div",{"data-slot":"card-description",className:M("text-muted-foreground text-sm",t),...n})}function ut({className:t,...n}){return e.jsx("div",{"data-slot":"card-content",className:M("px-6",t),...n})}const it="glassEffectEnabled";function un(){const{settings:t,updateSettings:n,isLoading:s}=Tt(),[o,c]=j(()=>{if(t?.glassEffectEnabled!==void 0)return t.glassEffectEnabled;const d=localStorage.getItem(it);return d!==null?d==="true":!0});return G(()=>{if(!s&&t?.glassEffectEnabled!==void 0)c(t.glassEffectEnabled);else if(!s&&!t?.glassEffectEnabled){const d=localStorage.getItem(it);if(d!==null){const u=d==="true";n({glassEffectEnabled:u}).then(()=>{localStorage.removeItem(it)}).catch(console.error),c(u)}}},[t?.glassEffectEnabled,s,n]),G(()=>{!s&&n&&(n({glassEffectEnabled:o}).catch(console.error),localStorage.setItem(it,String(o)))},[o,s,n]),{isEnabled:o,toggle:()=>{c(d=>!d)},setIsEnabled:c}}const mn=Me.createContext({isComposing:()=>!1,setComposing:()=>{},justEndedComposing:()=>!1,markCompositionEnd:()=>{}}),Rt=()=>Me.useContext(mn);function Ae({...t}){const n=Me.useRef(!1),s=Me.useRef(!1),o=Me.useRef(null),c=Me.useMemo(()=>({isComposing:()=>n.current,setComposing:l=>{n.current=l},justEndedComposing:()=>s.current,markCompositionEnd:()=>{s.current=!0,o.current&&clearTimeout(o.current),o.current=setTimeout(()=>{s.current=!1},150)}}),[]);return e.jsx(mn.Provider,{value:c,children:e.jsx(Yn,{"data-slot":"dialog",...t})})}function va({...t}){return e.jsx(Xn,{"data-slot":"dialog-portal",...t})}function hn({className:t,...n}){return e.jsx(Jn,{"data-slot":"dialog-overlay",className:M("data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 fixed inset-0 z-50 bg-black/50",t),...n})}hn.displayName="DialogOverlay";function Ie({className:t,children:n,showCloseButton:s=!0,onEscapeKeyDown:o,...c}){const{isComposing:l}=Rt(),d=Me.useCallback(u=>{if(u.isComposing||l()){u.preventDefault();return}o?.(u)},[l,o]);return e.jsxs(va,{"data-slot":"dialog-portal",children:[e.jsx(hn,{}),e.jsxs(qn,{"data-slot":"dialog-content",className:M("bg-background data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 fixed top-0 left-0 right-0 bottom-0 z-50 flex flex-col w-full h-full border-0 shadow-lg duration-200 sm:top-[50%] sm:left-[50%] sm:right-auto sm:bottom-auto sm:translate-x-[-50%] sm:translate-y-[-50%] sm:max-w-lg sm:h-auto sm:max-h-[90vh] sm:rounded-lg sm:border sm:m-4 sm:flex sm:flex-col",t),onEscapeKeyDown:d,...c,children:[n,s&&e.jsxs(Gn,{"data-slot":"dialog-close",className:"ring-offset-background focus:ring-ring data-[state=open]:bg-accent data-[state=open]:text-muted-foreground absolute top-4 right-4 rounded-xs opacity-70 transition-opacity hover:opacity-100 focus:ring-2 focus:ring-offset-2 focus:outline-hidden disabled:pointer-events-none [&_svg]:pointer-events-none [&_svg]:shrink-0 [&_svg:not([class*='size-'])]:size-4",children:[e.jsx(Be,{}),e.jsx("span",{className:"sr-only",children:"Close"})]})]})]})}function Fe({className:t,...n}){return e.jsx("div",{"data-slot":"dialog-header",className:M("flex flex-col gap-2 text-center sm:text-left",t),...n})}function Te({className:t,...n}){return e.jsx("div",{"data-slot":"dialog-footer",className:M("flex flex-col-reverse gap-2 sm:flex-row sm:justify-end",t),...n})}function Re({className:t,...n}){return e.jsx(Zn,{"data-slot":"dialog-title",className:M("text-lg leading-none font-semibold",t),...n})}function Le({className:t,...n}){return e.jsx(Vn,{"data-slot":"dialog-description",className:M("text-muted-foreground text-sm",t),...n})}function wa({selectedDate:t}){const{settings:n,isLoading:s}=Tt(),o=n?.weatherLocation||"Zurich, CH",{data:c,isLoading:l,error:d}=dn(t,o);Gt.useEffect(()=>{},[t,o,s,c,l,d]);const u=h=>{switch(h){case"sun":return e.jsx(Qt,{className:"w-5 h-5"});case"cloud-sun":return e.jsx(Jt,{className:"w-5 h-5"});case"cloud":return e.jsx(ht,{className:"w-5 h-5"});case"rain":return e.jsx(Dt,{className:"w-5 h-5"});case"snow":return e.jsx(Dt,{className:"w-5 h-5"});default:return e.jsx(ht,{className:"w-5 h-5"})}};if(!t)return null;const a=t.toLocaleDateString("de-CH",{weekday:"long",day:"numeric",month:"long"});return e.jsxs("div",{className:"p-3 border-b border-border",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("h4",{className:"text-xs font-semibold text-muted-foreground",children:"Wetter"}),e.jsx("span",{className:"text-[10px] text-muted-foreground",children:a})]}),l?e.jsx("div",{className:"flex items-center justify-center py-4",children:e.jsx("div",{className:"text-xs text-muted-foreground",children:"Lädt..."})}):c?e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[u(c.icon),e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-baseline gap-1",children:[e.jsxs("span",{className:"text-lg font-bold",children:[c.temperature,"°"]}),e.jsx("span",{className:"text-xs text-muted-foreground",children:"C"})]}),e.jsx("div",{className:"text-[10px] text-muted-foreground",children:c.condition})]})]}),c.humidity!==void 0&&c.windSpeed!==void 0&&e.jsxs("div",{className:"flex gap-3 text-[9px] text-muted-foreground pt-1 border-t border-border/50",children:[e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(Xt,{className:"w-3 h-3"}),e.jsxs("span",{children:[c.windSpeed," km/h"]})]}),e.jsx("div",{children:e.jsxs("span",{children:["Luftfeuchtigkeit: ",c.humidity,"%"]})})]})]}):d?e.jsxs("div",{className:"space-y-1",children:[e.jsx("div",{className:"text-xs text-muted-foreground text-center py-2",children:d.message||"Fehler beim Laden der Wetterdaten"}),e.jsxs("div",{className:"text-[10px] text-muted-foreground/70 text-center",children:["Standort: ",o]})]}):s?e.jsx("div",{className:"flex items-center justify-center py-4",children:e.jsx("div",{className:"text-xs text-muted-foreground",children:"Lädt Einstellungen..."})}):e.jsxs("div",{className:"space-y-1",children:[e.jsx("div",{className:"text-xs text-muted-foreground text-center py-2",children:"Keine Wetterdaten verfügbar"}),e.jsxs("div",{className:"text-[10px] text-muted-foreground/70 text-center",children:["Standort: ",o]})]})]})}function vr(t){if(!t||!t.includes("T"))throw new Error("Invalid datetime-local format. Expected: YYYY-MM-DDTHH:mm");const[n,s]=t.split("T"),[o,c,l]=n.split("-").map(Number),[d,u]=s?s.split(":").map(Number):[0,0];return new Date(o,c-1,l,d,u,0,0)}function wr(t,n){if(!t)return"N/A";try{let s;if(t?.toDate&&typeof t.toDate=="function")s=t.toDate();else if(typeof t=="string")s=new Date(t);else if(t instanceof Date)s=t;else return"N/A";if(isNaN(s.getTime()))return"N/A";const o=s.getDate().toString().padStart(2,"0"),c=(s.getMonth()+1).toString().padStart(2,"0"),l=s.getFullYear();return n?.includeTime,`${o}.${c}.${l}`}catch{return"N/A"}}function ot(t){if(!t)return ot(new Date);try{let n;if(t?.toDate&&typeof t.toDate=="function")n=t.toDate();else if(typeof t=="string")n=new Date(t);else if(t instanceof Date)n=t;else return ot(new Date);if(isNaN(n.getTime()))return ot(new Date);const s=n.getFullYear(),o=(n.getMonth()+1).toString().padStart(2,"0"),c=n.getDate().toString().padStart(2,"0"),l=n.getHours().toString().padStart(2,"0"),d=n.getMinutes().toString().padStart(2,"0");return`${s}-${o}-${c}T${l}:${d}`}catch{return ot(new Date)}}function Ht(t,n=!1){if(!t)return"N/A";try{let s;if(t?.toDate&&typeof t.toDate=="function")s=t.toDate();else if(typeof t=="string")s=new Date(t);else if(t instanceof Date)s=t;else return"N/A";if(isNaN(s.getTime()))return"N/A";const o=s.getHours().toString().padStart(2,"0"),c=s.getMinutes().toString().padStart(2,"0");if(n){const l=s.getSeconds().toString().padStart(2,"0");return`${o}:${c}:${l}`}return`${o}:${c}`}catch{return"N/A"}}function Kt(t){if(!t)return"";try{let n;if(typeof t=="object"&&t!==null&&"toDate"in t&&typeof t.toDate=="function")n=t.toDate();else if(t instanceof Date)n=t;else if(typeof t=="string"){if(!t.includes("T")&&t.match(/^\d{4}-\d{2}-\d{2}$/))return t;n=new Date(t)}else n=new Date(t);if(isNaN(n.getTime()))return"";const s=n.getFullYear(),o=String(n.getMonth()+1).padStart(2,"0"),c=String(n.getDate()).padStart(2,"0");return`${s}-${o}-${c}`}catch{return""}}function we(t){if(!(t instanceof Date)||isNaN(t.getTime()))throw new Error("Invalid date: must be a valid Date object");const n=t.getFullYear(),s=String(t.getMonth()+1).padStart(2,"0"),o=String(t.getDate()).padStart(2,"0");return`${n}-${s}-${o}`}function fe(t){if(!t)return"";try{let n;if(typeof t=="string")if(t.match(/^\d{4}-\d{2}-\d{2}$/)){const[l,d,u]=t.split("-").map(Number);n=new Date(l,d-1,u)}else n=new Date(t);else if(t instanceof Date)n=t;else return"";if(isNaN(n.getTime()))return"";const s=String(n.getDate()).padStart(2,"0"),o=String(n.getMonth()+1).padStart(2,"0"),c=n.getFullYear();return`${s}.${o}.${c}`}catch{return""}}function Ve(t){if(!t)return"";try{t=t.trim();const n=t.split(".");if(n.length===3){const s=parseInt(n[0],10),o=parseInt(n[1],10),c=parseInt(n[2],10);if(isNaN(s)||isNaN(o)||isNaN(c))return"";const l=new Date(c,o-1,s);return l.getDate()!==s||l.getMonth()!==o-1||l.getFullYear()!==c?"":`${c}-${String(o).padStart(2,"0")}-${String(s).padStart(2,"0")}`}return t.match(/^\d{4}-\d{2}-\d{2}$/)?t:""}catch{return""}}function jr(t){if(!t)return"";try{let n;if(typeof t=="string")if(t.includes("T")){const[u,a]=t.split("T"),[h,p,m]=u.split("-").map(Number),[f,b]=a?a.split(":").map(Number):[0,0];n=new Date(h,p-1,m,f,b)}else if(t.match(/^\d{4}-\d{2}-\d{2}$/)){const[u,a,h]=t.split("-").map(Number);n=new Date(u,a-1,h)}else n=new Date(t);else if(t instanceof Date)n=t;else return"";if(isNaN(n.getTime()))return"";const s=String(n.getDate()).padStart(2,"0"),o=String(n.getMonth()+1).padStart(2,"0"),c=n.getFullYear(),l=String(n.getHours()).padStart(2,"0"),d=String(n.getMinutes()).padStart(2,"0");return`${s}.${o}.${c} ${l}:${d}`}catch{return""}}function Nr(t){if(!t)return"";try{t=t.trim();const n=t.split(" ");if(n.length===2){const s=n[0],o=n[1],c=s.split(".");if(c.length===3){const l=parseInt(c[0],10),d=parseInt(c[1],10),u=parseInt(c[2],10),a=o.split(":"),h=a.length>=1?parseInt(a[0],10):0,p=a.length>=2?parseInt(a[1],10):0;if(isNaN(l)||isNaN(d)||isNaN(u)||isNaN(h)||isNaN(p))return"";const m=new Date(u,d-1,l,h,p);return m.getDate()!==l||m.getMonth()!==d-1||m.getFullYear()!==u?"":`${u}-${String(d).padStart(2,"0")}-${String(l).padStart(2,"0")}T${String(h).padStart(2,"0")}:${String(p).padStart(2,"0")}`}}return t.match(/^\d{4}-\d{2}-\d{2}T\d{2}:\d{2}/)?t:""}catch{return""}}function ja(){const[,t]=at(),[n,s]=j(new Date),[o,c]=j([]),[l,d]=j(!1),[u,a]=j(null),[h,p]=j(null),[m,f]=j(!1),[b,i]=j(!1),[g,w]=j(!1),[F,L]=j(!1),[re,q]=j(fe(new Date)),[Q,ie]=j(fe(new Date)),{data:ee=[]}=ua(),{settings:ue}=Tt(),I=ue?.weatherLocation||"Zurich, CH",D=u?new Date(u.getFullYear(),u.getMonth(),u.getDate()):null,{data:T,isLoading:k}=dn(D,I);G(()=>{if(!u){const y=new Date,C=new Date(y.getFullYear(),y.getMonth(),y.getDate());a(C)}},[]);const ne=["Januar","Februar","März","April","Mai","Juni","Juli","August","September","Oktober","November","Dezember"],z=["Mo","Di","Mi","Do","Fr","Sa","So"],se=ae(async()=>{try{d(!0);const y=$(H,"getCalendarEvents"),C=$(H,"getVacations"),P=$(H,"getSchoolSchedules"),V=$(H,"getSchoolHolidays"),K=new Date(n.getFullYear(),n.getMonth()-1,1),Z=new Date(n.getFullYear(),n.getMonth()+2,0),[A,W,oe,_]=await Promise.all([y({startDate:K.toISOString(),endDate:Z.toISOString()}).catch(()=>({data:{events:[]}})),C({startDate:K.toISOString(),endDate:Z.toISOString()}).catch(()=>({data:{vacations:[]}})),P({startDate:K.toISOString(),endDate:Z.toISOString()}).catch(()=>({data:{schedules:[]}})),V({startDate:K.toISOString(),endDate:Z.toISOString()}).catch(()=>({data:{holidays:[]}}))]),te=A.data,me=W.data,Se=oe.data,x=_.data,S=[...te.events||[],...(me.vacations||[]).map(E=>({id:`vacation-${E.id}`,type:"work",title:E.title||"Ferien",date:E.startDate,description:E.description})),...(Se.schedules||[]).map(E=>({id:`school-${E.id}`,type:"school",title:E.childName?`${E.childName} - Schule`:"Schule",date:E.date,schoolType:E.type})),...(x.holidays||[]).map(E=>({id:`holiday-${E.id}`,type:"school-holiday",title:E.title||"Schulferien",date:E.date}))];c(S)}catch{}finally{d(!1)}},[n]);G(()=>{se()},[se]);const ze=y=>{const C=new Date(y),P=C.getDay(),V=C.getDate()-(P===0?6:P-1);return new Date(C.setDate(V))},ge=Ne(()=>{const y=ze(n),C=[],P=V=>{const K=we(V),Z=o.filter(_=>{if(!_.date)return!1;let te=Kt(_.date);if(!te&&typeof _.date=="string"){const me=_.date.split("T")[0];me.match(/^\d{4}-\d{2}-\d{2}/)&&(te=me)}return te===K}),W=ee.filter(_=>{if(!_.dueDate)return!1;let te;if(_.dueDate instanceof Date)te=_.dueDate;else if(typeof _.dueDate=="string")te=new Date(_.dueDate);else return!1;return isNaN(te.getTime())?!1:we(te)===K}).map(_=>{let te="appointment";_.type==="termin"?te="appointment":_.type==="zahlung"?te="due":_.type==="aufgabe"&&(te="reminder");let me;if(_.dueDate instanceof Date)me=_.dueDate;else if(typeof _.dueDate=="string")me=new Date(_.dueDate);else throw new Error(`Invalid dueDate for reminder ${_.id}`);return{id:`reminder-${_.id}`,type:te,title:_.title,date:we(me),time:_.isAllDay?void 0:Ht(me),description:_.notes||void 0,status:_.status}}),oe=[...Z];for(const _ of W)oe.some(te=>te.id===_.id)||oe.push(_);return oe};for(let V=0;V<7;V++){const K=new Date(y);K.setDate(y.getDate()+V);const Z=P(K);C.push({date:K,events:Z})}return C},[n,o,ee]),le=()=>{const y=new Date(n);y.setDate(y.getDate()-7),s(y)},xe=()=>{const y=new Date(n);y.setDate(y.getDate()+7),s(y)},B=()=>{s(new Date)},be=y=>{const C=new Date;return y.toDateString()===C.toDateString()},ve=y=>{const C=new Date(y.getFullYear(),y.getMonth(),y.getDate());console.log("[SidebarCalendar] handleDayClick:",{originalDate:y.toISOString(),normalizedDate:C.toISOString(),dateStr:we(C)}),a(C),f(!0)},Ke=y=>{const C=new Date(y.getFullYear(),y.getMonth(),y.getDate());a(C)},De=y=>{p(y),i(!0)},Ce=Ne(()=>{if(!u)return console.log("[SidebarCalendar] dayEvents - no selectedDate"),[];const y=new Date(u.getFullYear(),u.getMonth(),u.getDate()),C=we(y);console.log("[SidebarCalendar] dayEvents filter - START:",{selectedDate:u.toISOString(),normalizedSelectedDate:y.toISOString(),dateStr:C,totalEvents:o.length,totalReminders:ee.length});const P=o.filter(A=>{if(!A.date)return console.log("[SidebarCalendar] Event skipped - no date:",A.title),!1;let W=Kt(A.date);if(!W&&typeof A.date=="string"){const _=A.date.split("T")[0];_.match(/^\d{4}-\d{2}-\d{2}/)&&(W=_,console.log("[SidebarCalendar] Using fallback date extraction for filter:",W))}if(!W)return console.log("[SidebarCalendar] Event skipped - invalid date:",A.title,A.date),!1;const oe=W===C;return oe&&console.log("[SidebarCalendar] Event matched:",{eventTitle:A.title,eventDate:A.date,eventDateStr:W,selectedDateStr:C}),oe}),V=ee.filter(A=>{if(!A.dueDate)return!1;let W;if(A.dueDate instanceof Date)W=A.dueDate;else if(typeof A.dueDate=="string")W=new Date(A.dueDate);else return!1;return isNaN(W.getTime())?!1:we(W)===C});console.log("[SidebarCalendar] Reminders for date:",{dateStr:C,remindersForDate:V.length,reminders:V.map(A=>({id:A.id,title:A.title,dueDate:A.dueDate}))});const K=V.map(A=>{let W="appointment";A.type==="termin"?W="appointment":A.type==="zahlung"?W="due":A.type==="aufgabe"&&(W="reminder");let oe;if(A.dueDate instanceof Date)oe=A.dueDate;else if(typeof A.dueDate=="string")oe=new Date(A.dueDate);else throw new Error(`Invalid dueDate for reminder ${A.id}`);return{id:`reminder-${A.id}`,type:W,title:A.title,date:we(oe),time:A.isAllDay?void 0:Ht(oe),description:A.notes||void 0,status:A.status}}),Z=[...P];for(const A of K)Z.some(W=>W.id===A.id)||Z.push(A);return console.log("[SidebarCalendar] dayEvents filter - RESULT:",{selectedDate:y.toISOString(),dateStr:C,filteredFromEvents:P.length,fromReminders:K.length,totalDayEvents:Z.length,allDayEvents:Z.map(A=>({id:A.id,title:A.title,date:A.date,type:A.type}))}),Z},[u,o,ee]),ye=y=>{switch(y){case"due":return"bg-pink-500";case"reminder":case"appointment":case"termin":return"bg-orange-500";case"work":return"bg-slate-400";case"vacation":case"frei":return"bg-emerald-400";case"school-holiday":return"bg-sky-400";case"school":return"bg-purple-400";case"hort":return"bg-fuchsia-500";default:return"bg-gray-500"}};return e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"p-2 border-b border-border",children:[e.jsxs("div",{className:"flex items-center justify-between mb-1.5",children:[e.jsx(U,{variant:"ghost",size:"sm",onClick:le,className:"h-5 w-5 p-0 min-w-0",children:e.jsx(bn,{className:"w-3 h-3"})}),e.jsx("div",{className:"flex-1 text-center px-1",children:e.jsxs("h3",{className:"text-[11px] font-semibold leading-tight",children:[ne[n.getMonth()]," ",n.getFullYear()]})}),e.jsx(U,{variant:"ghost",size:"sm",onClick:xe,className:"h-5 w-5 p-0 min-w-0",children:e.jsx(yn,{className:"w-3 h-3"})})]}),e.jsx("div",{className:"grid grid-cols-7 gap-0",children:z.map((y,C)=>{const P=ge[C],V=P?be(P.date):!1;return e.jsxs("div",{className:"flex flex-col items-center",children:[e.jsx("div",{className:"text-center text-[10px] font-medium text-muted-foreground mb-1 w-full",children:y}),P&&e.jsxs("button",{onClick:()=>{Ke(P.date),ve(P.date)},className:M("w-full aspect-square min-h-[28px] max-h-[30px] rounded-sm transition-colors flex flex-col items-center justify-center relative","text-foreground",u&&P.date.toDateString()===u.toDateString()?"bg-primary/20 ring-1 ring-primary":V?"bg-primary text-primary-foreground font-semibold":"hover:bg-muted/50"),children:[e.jsx("span",{className:"text-[12px] leading-none font-medium",children:P.date.getDate()}),P.events.length>0&&e.jsx("div",{className:"absolute bottom-0.5 left-0 right-0 flex gap-0.5 justify-center",children:P.events.slice(0,2).map((K,Z)=>e.jsx("div",{onClick:A=>{A.stopPropagation(),De(K)},className:M("h-0.5 w-0.5 rounded-full",ye(K.type)),title:K.title},Z))})]})]},C)})}),e.jsx(U,{variant:"ghost",size:"sm",onClick:B,className:"w-full h-6 mt-1.5 text-[10px]",children:"Heute"})]}),e.jsx(wa,{selectedDate:u}),e.jsx(Ae,{open:m,onOpenChange:f,children:e.jsxs(Ie,{className:"!fixed !top-[50%] !left-[50%] !right-auto !bottom-auto !translate-x-[-50%] !translate-y-[-50%] !w-[85vw] !max-w-sm !max-h-[85vh] !rounded-3xl !m-0 !overflow-y-auto !shadow-2xl",children:[e.jsxs(Fe,{className:"px-5 pt-5 pb-3 sticky top-0 bg-background z-10 border-b border-border",children:[e.jsx(Le,{className:"sr-only",children:"Details für den ausgewählten Tag mit Wetter, Terminen und Schnellaktionen"}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx(Re,{className:"text-lg font-semibold",children:u?.toLocaleDateString("de-CH",{weekday:"long",day:"numeric",month:"long",year:"numeric"})}),e.jsx(U,{variant:"ghost",size:"sm",onClick:()=>f(!1),className:"h-8 w-8 p-0",children:e.jsx(Be,{className:"h-4 w-4"})})]})]}),e.jsxs("div",{className:"space-y-4 px-5 pb-2",children:[e.jsxs("div",{className:"bg-muted/30 rounded-xl p-4 space-y-3",children:[e.jsx("div",{className:"flex items-center justify-between",children:e.jsxs("h3",{className:"text-sm font-semibold flex items-center gap-2",children:[e.jsx(ht,{className:"w-4 h-4"}),"Wetter"]})}),k?e.jsx("div",{className:"flex items-center justify-center py-4",children:e.jsx("div",{className:"text-xs text-muted-foreground",children:"Lädt Wetterdaten..."})}):T?e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[T.icon==="sun"&&e.jsx(Qt,{className:"w-6 h-6 text-yellow-500"}),T.icon==="cloud-sun"&&e.jsx(Jt,{className:"w-6 h-6 text-gray-500"}),T.icon==="cloud"&&e.jsx(ht,{className:"w-6 h-6 text-gray-500"}),T.icon==="rain"&&e.jsx(Dt,{className:"w-6 h-6 text-blue-500"}),e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-baseline gap-1",children:[e.jsxs("span",{className:"text-2xl font-bold",children:[T.temperature,"°"]}),e.jsx("span",{className:"text-sm text-muted-foreground",children:"C"})]}),e.jsx("div",{className:"text-xs text-muted-foreground",children:T.condition})]})]}),(T.humidity!==void 0||T.windSpeed!==void 0)&&e.jsxs("div",{className:"flex gap-4 text-xs text-muted-foreground pt-2 border-t border-border/50",children:[T.windSpeed!==void 0&&e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(Xt,{className:"w-3 h-3"}),e.jsxs("span",{children:[T.windSpeed," km/h"]})]}),T.humidity!==void 0&&e.jsx("div",{children:e.jsxs("span",{children:["Luftfeuchtigkeit: ",T.humidity,"%"]})})]})]}):e.jsx("div",{className:"text-xs text-muted-foreground text-center py-2",children:"Keine Wetterdaten verfügbar"})]}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-sm font-semibold mb-2",children:"Termine & Events"}),Ce.length===0?e.jsx("p",{className:"text-sm text-muted-foreground text-center py-4 bg-muted/30 rounded-lg",children:"Keine Events an diesem Tag"}):e.jsx("div",{className:"space-y-2",children:Ce.map(y=>e.jsx(dt,{className:"cursor-pointer hover:bg-muted/50 transition-colors",onClick:()=>{f(!1),De(y)},children:e.jsx(ut,{className:"p-3",children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("div",{className:M("w-3 h-3 rounded-full mt-1 flex-shrink-0",ye(y.type))}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("p",{className:"font-medium text-sm truncate",children:y.title}),y.time&&e.jsx("p",{className:"text-xs text-muted-foreground mt-1",children:y.time}),y.personName&&e.jsx("p",{className:"text-xs text-muted-foreground mt-1",children:y.personName})]})]})})},y.id))})]}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-sm font-semibold mb-2",children:"Schnellaktionen"}),e.jsxs("div",{className:"grid grid-cols-2 gap-2",children:[e.jsxs(U,{variant:"outline",onClick:()=>{w(!0)},className:"h-auto py-3 flex flex-col items-center gap-2 rounded-xl",children:[e.jsx(vn,{className:"w-5 h-5"}),e.jsx("span",{className:"text-xs",children:"Termin erstellen"})]}),e.jsxs(U,{variant:"outline",onClick:()=>{L(!0)},className:"h-auto py-3 flex flex-col items-center gap-2 rounded-xl",children:[e.jsx(Oe,{className:"w-5 h-5"}),e.jsx("span",{className:"text-xs",children:"Finanz-Eintrag"})]})]})]})]}),e.jsxs(Te,{className:"px-5 pb-3 pt-2 sticky bottom-0 bg-background border-t border-border",children:[e.jsx(U,{variant:"outline",onClick:()=>{try{f(!1),setTimeout(()=>{try{t("/calendar")}catch(y){console.error("Navigation error:",y),N.error("Fehler beim Navigieren zum Kalender")}},100)}catch(y){console.error("Dialog close error:",y),N.error("Fehler beim Schliessen des Dialogs")}},className:"h-11 min-h-[44px] flex-1 rounded-xl text-sm font-medium",children:"Zum Kalender"}),e.jsx(U,{variant:"default",onClick:()=>f(!1),className:"h-11 min-h-[44px] flex-1 rounded-xl text-sm font-medium",children:"Schliessen"})]})]})}),e.jsx(Ae,{open:g,onOpenChange:y=>{w(y),y&&q(fe(u||new Date))},children:e.jsxs(Ie,{className:"!fixed !top-[50%] !left-[50%] !right-auto !bottom-auto !translate-x-[-50%] !translate-y-[-50%] !w-[85vw] !max-w-sm !max-h-fit !rounded-3xl !m-0 !overflow-visible !shadow-2xl",children:[e.jsxs(Fe,{className:"px-5 pt-5 pb-3",children:[e.jsx(Re,{className:"text-lg font-semibold",children:"Termin erstellen"}),e.jsx(Le,{className:"sr-only",children:"Erstellen Sie einen neuen Termin mit Titel, Datum, Uhrzeit und optionalen Notizen"})]}),e.jsxs("div",{className:"px-5 pb-2 space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium mb-1 block",children:"Titel"}),e.jsx("input",{type:"text",id:"reminder-title",placeholder:"z.B. Arzttermin",className:"w-full px-3 py-2 border border-border rounded-lg text-sm",autoFocus:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium mb-1 block",children:"Datum"}),e.jsx("input",{type:"text",id:"reminder-date",placeholder:"DD.MM.YYYY",value:re,onChange:y=>{const C=y.target.value;q(C)},onBlur:y=>{const C=Ve(y.target.value);C?q(fe(C)):y.target.value&&u&&q(fe(u))},className:"w-full px-3 py-2 border border-border rounded-lg text-sm"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium mb-1 block",children:"Uhrzeit (optional)"}),e.jsx("input",{type:"time",id:"reminder-time",className:"w-full px-3 py-2 border border-border rounded-lg text-sm"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium mb-1 block",children:"Notizen (optional)"}),e.jsx("textarea",{id:"reminder-notes",placeholder:"Weitere Details...",rows:3,className:"w-full px-3 py-2 border border-border rounded-lg text-sm resize-none"})]})]}),e.jsxs(Te,{className:"px-5 pb-3 pt-2",children:[e.jsx(U,{variant:"outline",onClick:()=>w(!1),className:"h-11 min-h-[44px] flex-1 rounded-xl text-sm font-medium",children:"Abbrechen"}),e.jsx(U,{variant:"default",onClick:async()=>{try{const y=document.getElementById("reminder-title"),C=document.getElementById("reminder-date"),P=document.getElementById("reminder-time"),V=document.getElementById("reminder-notes");if(!y.value.trim()){N.error("Bitte gib einen Titel ein");return}const K=Ve(C.value);if(!K){N.error("Bitte gib ein gültiges Datum ein (DD.MM.YYYY)");return}const Z=new Date(K);if(P.value){const[A,W]=P.value.split(":");Z.setHours(parseInt(A),parseInt(W))}else Z.setHours(12,0);await ln({title:y.value.trim(),type:"termin",dueDate:Z,isAllDay:!P.value,notes:V.value.trim()||null}),N.success("Termin erstellt"),w(!1),f(!1),se()}catch(y){N.error(y.message||"Fehler beim Erstellen des Termins")}},className:"h-11 min-h-[44px] flex-1 rounded-xl text-sm font-medium",children:"Erstellen"})]})]})}),e.jsx(Ae,{open:F,onOpenChange:y=>{L(y),y&&ie(fe(u||new Date))},children:e.jsxs(Ie,{className:"!fixed !top-[50%] !left-[50%] !right-auto !bottom-auto !translate-x-[-50%] !translate-y-[-50%] !w-[85vw] !max-w-sm !max-h-fit !rounded-3xl !m-0 !overflow-visible !shadow-2xl",children:[e.jsxs(Fe,{className:"px-5 pt-5 pb-3",children:[e.jsx(Re,{className:"text-lg font-semibold",children:"Finanz-Eintrag erstellen"}),e.jsx(Le,{className:"sr-only",children:"Erstellen Sie einen neuen Finanz-Eintrag mit Beschreibung, Betrag, Typ und Datum"})]}),e.jsxs("div",{className:"px-5 pb-2 space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium mb-1 block",children:"Beschreibung"}),e.jsx("input",{type:"text",id:"finance-description",placeholder:"z.B. Einkauf, Gehalt",className:"w-full px-3 py-2 border border-border rounded-lg text-sm",autoFocus:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium mb-1 block",children:"Betrag (CHF)"}),e.jsx("input",{type:"number",id:"finance-amount",placeholder:"0.00",step:"0.01",className:"w-full px-3 py-2 border border-border rounded-lg text-sm"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium mb-1 block",children:"Typ"}),e.jsxs("select",{id:"finance-type",className:"w-full px-3 py-2 border border-border rounded-lg text-sm",children:[e.jsx("option",{value:"einnahme",children:"Einnahme"}),e.jsx("option",{value:"ausgabe",children:"Ausgabe"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium mb-1 block",children:"Datum"}),e.jsx("input",{type:"text",id:"finance-date",placeholder:"DD.MM.YYYY",value:Q,onChange:y=>{const C=y.target.value;ie(C)},onBlur:y=>{const C=Ve(y.target.value);C?ie(fe(C)):y.target.value&&u&&ie(fe(u))},className:"w-full px-3 py-2 border border-border rounded-lg text-sm"})]})]}),e.jsxs(Te,{className:"px-5 pb-3 pt-2",children:[e.jsx(U,{variant:"outline",onClick:()=>L(!1),className:"h-11 min-h-[44px] flex-1 rounded-xl text-sm font-medium",children:"Abbrechen"}),e.jsx(U,{variant:"default",onClick:async()=>{try{const y=document.getElementById("finance-description"),C=document.getElementById("finance-amount"),P=document.getElementById("finance-type"),V=document.getElementById("finance-date");if(!y.value.trim()){N.error("Bitte gib eine Beschreibung ein");return}const K=Ve(V.value);if(!K){N.error("Bitte gib ein gültiges Datum ein (DD.MM.YYYY)");return}if(!C.value||parseFloat(C.value)<=0){N.error("Bitte gib einen gültigen Betrag ein");return}await cn({description:y.value.trim(),amount:Math.round(parseFloat(C.value)*100),type:P.value,date:new Date(K),category:"Sonstiges",currency:"CHF",isRecurring:!1}),N.success("Finanz-Eintrag erstellt"),L(!1),f(!1)}catch(y){N.error(y.message||"Fehler beim Erstellen des Finanz-Eintrags")}},className:"h-11 min-h-[44px] flex-1 rounded-xl text-sm font-medium",children:"Erstellen"})]})]})}),e.jsx(Ae,{open:b,onOpenChange:i,children:e.jsxs(Ie,{className:"!fixed !top-[50%] !left-[50%] !right-auto !bottom-auto !translate-x-[-50%] !translate-y-[-50%] !w-[85vw] !max-w-sm !max-h-fit !rounded-3xl !m-0 !overflow-visible !shadow-2xl",children:[e.jsxs(Fe,{className:"px-5 pt-5 pb-3",children:[e.jsx(Re,{className:"text-lg font-semibold",children:h?.title}),e.jsx(Le,{className:"sr-only",children:"Detaillierte Informationen zum ausgewählten Event"})]}),e.jsxs("div",{className:"space-y-3 px-5 pb-2",children:[h?.date&&e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-muted-foreground mb-1",children:"Datum"}),e.jsx("p",{className:"text-sm",children:new Date(h.date).toLocaleDateString("de-CH",{weekday:"long",day:"numeric",month:"long",year:"numeric"})})]}),h?.time&&e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-muted-foreground mb-1",children:"Uhrzeit"}),e.jsx("p",{className:"text-sm",children:h.time})]}),h?.description&&e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-muted-foreground mb-1",children:"Beschreibung"}),e.jsx("p",{className:"text-sm",children:h.description})]}),h?.personName&&e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-muted-foreground mb-1",children:"Person"}),e.jsx("p",{className:"text-sm",children:h.personName})]}),h?.amount&&e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-muted-foreground mb-1",children:"Betrag"}),e.jsxs("p",{className:"text-sm",children:["CHF ",h.amount.toFixed(2)]})]})]}),e.jsxs(Te,{className:"px-5 pb-3 pt-2",children:[e.jsx(U,{variant:"outline",onClick:()=>{i(!1),t("/calendar")},className:"h-11 min-h-[44px] w-full rounded-xl text-sm font-medium",children:"Zum Kalender"}),e.jsx(U,{variant:"outline",onClick:()=>i(!1),className:"h-11 min-h-[44px] w-full rounded-xl text-sm font-medium",children:"Schliessen"})]})]})})]})}function Na({open:t,onClose:n,currentChatId:s,onSelectChat:o,onNewChat:c}){const[l]=at(),{user:d}=Je(),{isEnabled:u}=un(),{t:a}=It(),h=[{path:"/",icon:wn,label:a("nav.assistant")},{path:"/dashboard",icon:Et,label:a("nav.dashboard")},{path:"/calendar",icon:kt,label:a("nav.calendar")},{path:"/reminders",icon:gt,label:a("nav.reminders")},{path:"/finance",icon:Oe,label:a("nav.finance")},{path:"/people",icon:ft,label:a("nav.people")},{path:"/bills",icon:Ze,label:a("nav.bills")},{path:"/documents",icon:Xe,label:a("nav.documents")},{path:"/shopping",icon:st,label:a("nav.shopping")},{path:"/taxes",icon:At,label:a("nav.taxes")},{path:"/settings",icon:pt,label:a("nav.settings")}],p=()=>{if(d?.displayName){const m=d.displayName.split(" ");return m.length>=2?(m[0][0]+m[1][0]).toUpperCase():d.displayName.substring(0,2).toUpperCase()}return d?.email?d.email.substring(0,2).toUpperCase():"U"};return e.jsxs(e.Fragment,{children:[t&&e.jsx("div",{className:M("fixed inset-0 z-40 transition-opacity",u?"bg-black/5":"bg-black/50"),onClick:n}),e.jsx("aside",{className:M("fixed top-0 left-0 h-full w-full max-w-sm z-50 transform transition-transform duration-300 ease-in-out shadow-xl",t?"translate-x-0":"-translate-x-full",u?"bg-background/95 backdrop-blur-md":"bg-background"),"aria-label":"Hauptnavigation","aria-hidden":!t,children:e.jsxs("div",{className:"flex flex-col h-full",children:[e.jsx("div",{className:"p-4 border-b border-border",children:e.jsxs("div",{className:"flex items-center gap-3 mb-3",children:[e.jsx("button",{onClick:n,className:"p-2 hover:bg-muted rounded-lg transition-colors","aria-label":"Menü schliessen",tabIndex:t?0:-1,children:e.jsx(Be,{className:"w-5 h-5"})}),e.jsx("h2",{className:"text-lg font-semibold flex-1",children:"Menü"})]})}),e.jsxs("div",{className:"flex-1 overflow-y-auto",children:[e.jsxs("div",{className:"p-4 border-b border-border",children:[e.jsx("h3",{className:"text-xs font-semibold text-muted-foreground uppercase tracking-wider mb-3",children:"Navigation"}),e.jsx("nav",{className:"space-y-1",children:h.map(m=>{const f=m.icon,b=l===m.path;return e.jsx(Kn,{href:m.path,children:e.jsxs("button",{onClick:n,className:M("w-full flex items-center gap-3 px-3 py-2.5 rounded-lg transition-colors text-left min-h-[44px]",b?"bg-primary/10 text-primary font-medium":"text-foreground hover:bg-muted"),"aria-label":`Zu ${m.label} navigieren`,"aria-current":b?"page":void 0,"aria-pressed":b,type:"button",role:"menuitem",tabIndex:t?0:-1,children:[e.jsx(f,{className:"w-5 h-5 flex-shrink-0","aria-hidden":"true"}),e.jsx("span",{className:"text-sm",children:m.label})]})},m.path)})})]}),e.jsx(ja,{})]}),e.jsx("div",{className:"p-4 border-t border-border",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-10 h-10 rounded-full bg-primary text-primary-foreground flex items-center justify-center flex-shrink-0 text-sm font-medium",children:d?.photoURL?e.jsx("img",{src:d.photoURL,alt:d?.displayName||"Benutzerprofilbild",className:"w-10 h-10 rounded-full object-cover"}):e.jsx("span",{"aria-label":"Benutzerinitialen",children:p()})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("p",{className:"text-sm font-medium truncate",children:d?.displayName||"Benutzer"}),e.jsx("p",{className:"text-xs text-muted-foreground truncate",children:d?.email||"Nicht angemeldet"})]})]})})]})})]})}function fn(){return ha()}async function lt(t){try{if(t.id&&!t.id.startsWith("chat_"))await xa(t.id,{title:t.title,messages:t.messages});else{const n=await ga({title:t.title,messages:t.messages});t.id=n.id}}catch(n){throw n}}async function Da(){try{return{deletedCount:(await ba()).deletedCount}}catch(t){throw t}}function vt(t,n){return n.find(s=>s.id===t)||null}function Wt(t){return t.length<=50?t:t.substring(0,50)+"..."}function Yt(){const t=`chat_${Date.now()}_${Math.random().toString(36).substring(2,9)}`,n=new Date().toISOString();return{id:t,userId:"",title:"Neue Konversation",messages:[],createdAt:n,updatedAt:n}}function Ca({title:t,showSidebar:n=!1,showQuickActions:s=!1,quickActions:o=[],currentChatId:c,onSelectChat:l,onNewChat:d,sidebarOpen:u,onSidebarToggle:a}){at();const[h,p]=j(!1),{isEnabled:m}=un(),[f,b]=j(!1),[i,g]=j(!1),[w,F]=j(!1),{data:L,refetch:re}=fn(),q=Y(null),Q=u!==void 0?u:h,ie=a||p;G(()=>{f&&re()},[f,re]),G(()=>{const I=D=>{q.current&&!q.current.contains(D.target)&&b(!1)};return document.addEventListener("mousedown",I),()=>document.removeEventListener("mousedown",I)},[]);const ee=I=>{const D=typeof I=="string"?new Date(I):typeof I=="number"?new Date(I):I,k=new Date().getTime()-D.getTime(),ne=Math.floor(k/(1e3*60*60*24));return ne===0?"Heute":ne===1?"Gestern":ne<7?`${ne} Tage`:D.toLocaleDateString("de-DE",{day:"2-digit",month:"2-digit"})},ue=async()=>{if(L.length===0){N.info("Keine Chats zum Löschen vorhanden");return}F(!0);try{const I=await Da();N.success(`${I.deletedCount} Chat${I.deletedCount!==1?"s":""} gelöscht`),g(!1),b(!1),await re(),d&&d()}catch(I){console.error("Fehler beim Löschen aller Chats:",I),N.error("Fehler beim Löschen der Chats")}finally{F(!1)}};return e.jsxs(e.Fragment,{children:[n&&e.jsx(Na,{open:Q,onClose:()=>ie(!1),currentChatId:c,onSelectChat:l,onNewChat:d}),e.jsx("header",{className:M("fixed top-0 left-0 right-0 z-40 border-b safe-top",m?"bg-background/95 backdrop-blur-md border-border/30":"bg-background border-border"),children:e.jsxs("div",{className:"px-4 h-14 flex items-center gap-3",children:[e.jsx("div",{className:"flex-1 flex items-center justify-center",children:e.jsx("h1",{className:"text-lg font-semibold text-center",children:t})}),d&&e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{onClick:()=>{d&&d()},className:"p-2 hover:bg-muted rounded-lg transition-colors","aria-label":"Neue Konversation",children:e.jsx(jn,{className:"w-5 h-5"})}),e.jsxs("div",{className:"relative",ref:q,children:[e.jsx("button",{onClick:()=>{b(!f),f||re()},className:"p-2 hover:bg-muted rounded-lg transition-colors","aria-label":"Chat-Verlauf",children:e.jsx(Nn,{className:"w-5 h-5"})}),f&&e.jsxs("div",{className:"absolute top-full right-0 mt-2 w-72 bg-background border border-border rounded-lg shadow-lg z-50 overflow-hidden max-h-[60vh] flex flex-col",children:[e.jsxs("div",{className:"p-3 border-b border-border flex items-center justify-between",children:[e.jsx("h3",{className:"text-sm font-semibold",children:"Chat-Verlauf"}),e.jsx("button",{onClick:()=>b(!1),className:"p-1 hover:bg-muted rounded transition-colors",children:e.jsx(Be,{className:"w-4 h-4"})})]}),e.jsx("div",{className:"overflow-y-auto",children:L.length===0?e.jsx("p",{className:"text-sm text-muted-foreground py-4 px-3 text-center",children:"Noch keine Konversationen"}):e.jsx("div",{className:"p-2",children:L.map(I=>{const D=c===I.id;return e.jsx("button",{onClick:()=>{l&&l(I.id),b(!1)},className:M("w-full flex items-center justify-between gap-2 px-3 py-2.5 rounded-lg transition-colors text-left",D?"bg-primary/10 text-primary":"hover:bg-muted"),children:e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("p",{className:M("text-sm truncate",D&&"font-medium"),children:I.title}),e.jsx("p",{className:"text-xs text-muted-foreground mt-0.5",children:ee(I.updatedAt)})]})},I.id)})})}),L.length>0&&e.jsx("div",{className:"p-3 border-t border-border",children:e.jsxs("button",{onClick:()=>g(!0),className:"w-full flex items-center justify-center gap-2 px-3 py-2 rounded-lg bg-destructive/10 hover:bg-destructive/20 text-destructive transition-colors text-sm font-medium",disabled:w,children:[e.jsx(Dn,{className:"w-4 h-4"}),e.jsx("span",{children:"Alle löschen"})]})})]})]})]})]})}),i&&e.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black/50 p-4",children:e.jsxs("div",{className:"bg-background border border-border rounded-lg shadow-lg max-w-sm w-full p-6",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[e.jsx("div",{className:"p-2 rounded-full bg-destructive/10",children:e.jsx(Cn,{className:"w-5 h-5 text-destructive"})}),e.jsx("h3",{className:"text-lg font-semibold",children:"Alle Chats löschen?"})]}),e.jsxs("p",{className:"text-sm text-muted-foreground mb-6",children:["Diese Aktion kann nicht rückgängig gemacht werden. Alle ",L.length," Chat",L.length!==1?"s":""," werden permanent gelöscht."]}),e.jsxs("div",{className:"flex gap-3",children:[e.jsx("button",{onClick:()=>g(!1),className:"flex-1 px-4 py-2 rounded-lg border border-border hover:bg-muted transition-colors text-sm font-medium",disabled:w,children:"Abbrechen"}),e.jsx("button",{onClick:ue,className:"flex-1 px-4 py-2 rounded-lg bg-destructive text-destructive-foreground hover:bg-destructive/90 transition-colors text-sm font-medium",disabled:w,children:w?"Löschen...":"Ja, alle löschen"})]})]})})]})}function ct(t){const n=Y(t);n.current=t;const s=Y(null);return s.current||(s.current=function(...o){return n.current.apply(this,o)}),s.current}function pn(t={}){const{onKeyDown:n,onCompositionStart:s,onCompositionEnd:o}=t,c=Y(!1),l=Y(null),d=Y(null),u=ct(m=>{l.current&&(clearTimeout(l.current),l.current=null),d.current&&(clearTimeout(d.current),d.current=null),c.current=!0,s?.(m)}),a=ct(m=>{l.current=setTimeout(()=>{d.current=setTimeout(()=>{c.current=!1})}),o?.(m)}),h=ct(m=>{if(c.current&&(m.key==="Escape"||m.key==="Enter"&&!m.shiftKey)){m.stopPropagation();return}n?.(m)}),p=ct(()=>c.current);return{onCompositionStart:u,onCompositionEnd:a,onKeyDown:h,isComposing:p}}function ke({className:t,type:n,onKeyDown:s,onCompositionStart:o,onCompositionEnd:c,...l}){const d=Rt(),{onCompositionStart:u,onCompositionEnd:a,onKeyDown:h}=pn({onKeyDown:p=>{const m=p.nativeEvent.isComposing||d.justEndedComposing();p.key==="Enter"&&m||s?.(p)},onCompositionStart:p=>{d.setComposing(!0),o?.(p)},onCompositionEnd:p=>{d.markCompositionEnd(),setTimeout(()=>{d.setComposing(!1)},100),c?.(p)}});return e.jsx("input",{type:n,"data-slot":"input",className:M("file:text-foreground placeholder:text-muted-foreground selection:bg-primary selection:text-primary-foreground dark:bg-input/30 border-input h-9 w-full min-w-0 rounded-md border bg-transparent px-3 py-1 text-base shadow-xs transition-[color,box-shadow] outline-none file:inline-flex file:h-7 file:border-0 file:bg-transparent file:text-sm file:font-medium disabled:pointer-events-none disabled:cursor-not-allowed disabled:opacity-50 md:text-sm","focus-visible:border-ring focus-visible:ring-ring/50 focus-visible:ring-[3px]","aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive",t),onCompositionStart:u,onCompositionEnd:a,onKeyDown:h,...l})}function de({className:t,...n}){return e.jsx(Qn,{"data-slot":"label",className:M("flex items-center gap-2 text-sm leading-none font-medium select-none group-data-[disabled=true]:pointer-events-none group-data-[disabled=true]:opacity-50 peer-disabled:cursor-not-allowed peer-disabled:opacity-50",t),...n})}function We({...t}){return e.jsx(es,{"data-slot":"select",...t})}function Ye({...t}){return e.jsx(ss,{"data-slot":"select-value",...t})}function qe({className:t,size:n="default",children:s,...o}){return e.jsxs(ts,{"data-slot":"select-trigger","data-size":n,className:M("border-input data-[placeholder]:text-muted-foreground [&_svg:not([class*='text-'])]:text-muted-foreground focus-visible:border-ring focus-visible:ring-ring/50 aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive dark:bg-input/30 dark:hover:bg-input/50 flex w-fit items-center justify-between gap-2 rounded-md border bg-transparent px-3 py-2 text-sm whitespace-nowrap shadow-xs transition-[color,box-shadow] outline-none focus-visible:ring-[3px] disabled:cursor-not-allowed disabled:opacity-50 data-[size=default]:h-9 data-[size=sm]:h-8 *:data-[slot=select-value]:line-clamp-1 *:data-[slot=select-value]:flex *:data-[slot=select-value]:items-center *:data-[slot=select-value]:gap-2 [&_svg]:pointer-events-none [&_svg]:shrink-0 [&_svg:not([class*='size-'])]:size-4",t),...o,children:[s,e.jsx(ns,{asChild:!0,children:e.jsx(en,{className:"size-4 opacity-50"})})]})}function Ge({className:t,children:n,position:s="popper",align:o="center",...c}){return e.jsx(as,{children:e.jsxs(rs,{"data-slot":"select-content",className:M("bg-popover text-popover-foreground data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 relative z-50 max-h-(--radix-select-content-available-height) min-w-[8rem] origin-(--radix-select-content-transform-origin) overflow-x-hidden overflow-y-auto rounded-md border shadow-md",s==="popper"&&"data-[side=bottom]:translate-y-1 data-[side=left]:-translate-x-1 data-[side=right]:translate-x-1 data-[side=top]:-translate-y-1",t),position:s,align:o,...c,children:[e.jsx(Sa,{}),e.jsx(is,{className:M("p-1",s==="popper"&&"h-[var(--radix-select-trigger-height)] w-full min-w-[var(--radix-select-trigger-width)] scroll-my-1"),children:n}),e.jsx(Ea,{})]})})}function he({className:t,children:n,...s}){return e.jsxs(os,{"data-slot":"select-item",className:M("focus:bg-accent focus:text-accent-foreground [&_svg:not([class*='text-'])]:text-muted-foreground relative flex w-full cursor-default items-center gap-2 rounded-sm py-1.5 pr-8 pl-2 text-sm outline-hidden select-none data-[disabled]:pointer-events-none data-[disabled]:opacity-50 [&_svg]:pointer-events-none [&_svg]:shrink-0 [&_svg:not([class*='size-'])]:size-4 *:[span]:last:flex *:[span]:last:items-center *:[span]:last:gap-2",t),...s,children:[e.jsx("span",{className:"absolute right-2 flex size-3.5 items-center justify-center",children:e.jsx(ls,{children:e.jsx(tn,{className:"size-4"})})}),e.jsx(cs,{children:n})]})}function Sa({className:t,...n}){return e.jsx(ds,{"data-slot":"select-scroll-up-button",className:M("flex cursor-default items-center justify-center py-1",t),...n,children:e.jsx(Sn,{className:"size-4"})})}function Ea({className:t,...n}){return e.jsx(us,{"data-slot":"select-scroll-down-button",className:M("flex cursor-default items-center justify-center py-1",t),...n,children:e.jsx(en,{className:"size-4"})})}function ka({className:t,...n}){return e.jsx(ms,{"data-slot":"switch",className:M("peer data-[state=checked]:bg-primary data-[state=unchecked]:bg-input focus-visible:border-ring focus-visible:ring-ring/50 dark:data-[state=unchecked]:bg-input/80 inline-flex h-[1.15rem] w-8 shrink-0 items-center rounded-full border border-transparent shadow-xs transition-all outline-none focus-visible:ring-[3px] disabled:cursor-not-allowed disabled:opacity-50",t),...n,children:e.jsx(hs,{"data-slot":"switch-thumb",className:M("bg-background dark:data-[state=unchecked]:bg-foreground dark:data-[state=checked]:bg-primary-foreground pointer-events-none block size-4 rounded-full ring-0 transition-transform data-[state=checked]:translate-x-[calc(100%-2px)] data-[state=unchecked]:translate-x-0")})})}const Aa={light:10,medium:20,heavy:30,success:[50,50,50],error:[100,50,100],warning:[50,100,50],selection:5};function Lt(t="medium"){if(!navigator.vibrate)return;const n=Aa[t];try{navigator.vibrate(n)}catch{}}function wt(){Lt("success")}function Ia(){Lt("error")}function Dr(){Lt("selection")}function Fa(t){const n=t,s=n?.data?.requestId||n?.requestId||null;if(n?.code==="unavailable"||n?.message?.includes("network")||n?.message?.includes("fetch"))return{title:"Verbindungsfehler",message:"Keine Internetverbindung. Bitte überprüfen Sie Ihre Netzwerkverbindung und versuchen Sie es erneut.",action:"Erneut versuchen",retryable:!0};if(n?.code==="deadline-exceeded"||n?.message?.includes("timeout"))return{title:"Zeitüberschreitung",message:"Die Anfrage hat zu lange gedauert. Bitte versuchen Sie es erneut.",action:"Erneut versuchen",retryable:!0};if(n?.code==="permission-denied"||n?.message?.includes("permission"))return{title:"Berechtigung verweigert",message:"Sie haben keine Berechtigung für diese Aktion. Bitte kontaktieren Sie den Administrator.",retryable:!1};if(n?.code==="unauthenticated"||n?.message?.includes("auth")||n?.message?.includes("login"))return{title:"Anmeldung erforderlich",message:"Bitte melden Sie sich an, um fortzufahren.",action:"Anmelden",retryable:!1};if(n?.code==="not-found"||n?.message?.includes("not found"))return{title:"Nicht gefunden",message:"Die angeforderte Ressource wurde nicht gefunden.",retryable:!1};if(n?.code==="invalid-argument"||n?.message?.includes("validation")||n?.message?.includes("invalid"))return{title:"Ungültige Eingabe",message:n?.message||"Bitte überprüfen Sie Ihre Eingabe und versuchen Sie es erneut.",retryable:!1};if(n?.code==="resource-exhausted"||n?.message?.includes("quota"))return{title:"Kontingent überschritten",message:"Das Tageslimit wurde erreicht. Bitte versuchen Sie es später erneut.",retryable:!1};if(n?.message?.includes("billing")||n?.message?.includes("Billing"))return{title:"Abrechnungsfehler",message:"Google Cloud Billing ist erforderlich. Bitte kontaktieren Sie den Administrator.",retryable:!1};if(n?.code?.startsWith("functions/"))return{title:"Server-Fehler",message:`Ein Fehler ist aufgetreten: ${n.code.replace("functions/","")}. Bitte versuchen Sie es später erneut.`,action:"Erneut versuchen",retryable:!0};let o=n?.message||n?.toString()||"Ein unbekannter Fehler ist aufgetreten.";return s&&(o+=`

Request ID: ${s.substring(0,8)}...`),{title:"Fehler",message:o.length>200?`${o.substring(0,200)}...`:o,action:"Erneut versuchen",retryable:!0,requestId:s||void 0}}function Ta(t){return Fa(t).message}function Ra({className:t,children:n,...s}){return e.jsxs(fs,{"data-slot":"scroll-area",className:M("relative",t),...s,children:[e.jsx(ps,{"data-slot":"scroll-area-viewport",className:"focus-visible:ring-ring/50 size-full rounded-[inherit] transition-[color,box-shadow] outline-none focus-visible:ring-[3px] focus-visible:outline-1",children:n}),e.jsx(La,{}),e.jsx(gs,{})]})}function La({className:t,orientation:n="vertical",...s}){return e.jsx(xs,{"data-slot":"scroll-area-scrollbar",orientation:n,className:M("hidden opacity-0 w-0 h-0 invisible pointer-events-none",t),...s,children:e.jsx(bs,{"data-slot":"scroll-area-thumb",className:"hidden opacity-0 w-0 h-0"})})}function jt({className:t,value:n,...s}){return e.jsx(ys,{"data-slot":"progress",className:M("bg-primary/20 relative h-2 w-full overflow-hidden rounded-full",t),...s,children:e.jsx(vs,{"data-slot":"progress-indicator",className:"bg-primary h-full w-full flex-1 transition-all",style:{transform:`translateX(-${100-(n||0)}%)`}})})}const za={"layout-dashboard":Et,calendar:kt,bell:gt,wallet:Oe,users:ft,"file-text":At,folder:Xe,"scan-line":Xe,"shopping-cart":st,receipt:Ze,"clipboard-list":Ze,settings:pt,check:tn,plus:nn,search:Un,edit:_n,trash:Bn,clock:On,euro:Mn,"trending-up":Pn,"trending-down":zn,info:Ln,"alert-circle":Rn},Pa={dashboard:{path:"/",icon:Et},calendar:{path:"/calendar",icon:kt},reminders:{path:"/reminders",icon:gt},finances:{path:"/finance",icon:Oe},finance:{path:"/finance",icon:Oe},finanzen:{path:"/finance",icon:Oe},people:{path:"/people",icon:ft},personen:{path:"/people",icon:ft},invoices:{path:"/bills",icon:Ze},bills:{path:"/bills",icon:Ze},rechnungen:{path:"/bills",icon:Ze},documents:{path:"/documents",icon:Xe},dokumente:{path:"/documents",icon:Xe},shopping:{path:"/shopping",icon:st},einkaufsliste:{path:"/shopping",icon:st},settings:{path:"/settings",icon:pt},einstellungen:{path:"/settings",icon:pt}};function Ma({content:t,onNavigate:n}){const s=Ne(()=>{const o=[],c=t.length>1e4?t.substring(0,1e4)+"...":t;let l=0,d=0;const u=/\[(nav|icon):([a-zA-Z0-9_-]+)(?:[|｜]([^\]]+))?\]/g;let a;const h=[];for(;(a=u.exec(c))!==null;)h.push({index:a.index,type:a[1],key:a[2],label:a[3],endIndex:a.index+a[0].length});for(const p of h){if(p.index>l){const m=c.slice(l,p.index);o.push(e.jsx("span",{dangerouslySetInnerHTML:{__html:Nt(m)}},`text-${d++}`))}if(p.type==="nav"&&p.label){const m=p.key,f=p.label,b=Pa[m];if(b&&n){const i=b.icon;o.push(e.jsxs("button",{onClick:g=>{g.preventDefault(),g.stopPropagation();try{n(b.path)}catch{}},className:"inline-flex items-center gap-1.5 px-2 py-1 mx-0.5 rounded-lg bg-primary/10 hover:bg-primary/20 text-primary font-medium text-sm transition-all duration-200 cursor-pointer border border-primary/20 hover:border-primary/40 hover:shadow-sm",title:`Zu ${f} navigieren`,children:[e.jsx(i,{className:"size-4"}),e.jsx("span",{className:"underline decoration-dotted underline-offset-2",children:mt(f)})]},`nav-${d++}`))}else o.push(e.jsx("span",{className:"font-medium text-primary",children:mt(f)},`nav-text-${d++}`))}else if(p.type==="icon"){const m=p.key,f=za[m];f?o.push(e.jsx(f,{className:"inline-block size-4 mx-0.5 align-text-bottom text-primary"},`icon-${d++}`)):o.push(e.jsxs("span",{children:["[",mt(m),"]"]},`unknown-${d++}`))}l=p.endIndex}if(l<c.length){const p=c.slice(l);o.push(e.jsx("span",{dangerouslySetInnerHTML:{__html:Nt(p)}},`text-${d++}`))}return o.length>0?o:[e.jsx("span",{dangerouslySetInnerHTML:{__html:Nt(c)}},"full")]},[t,n]);return e.jsx("div",{className:"prose prose-sm max-w-none",children:s})}function mt(t){const n=document.createElement("div");return n.textContent=t,n.innerHTML}function Nt(t){let n=mt(t);return n=n.replace(/\*\*(.+?)\*\*/g,"<strong>$1</strong>").replace(/__(.+?)__/g,"<strong>$1</strong>"),n=n.replace(new RegExp("(?<!\\*)\\*(?!\\*)(.+?)(?<!\\*)\\*(?!\\*)","g"),"<em>$1</em>"),n=n.replace(/`(.+?)`/g,'<code class="bg-muted px-1.5 py-0.5 rounded text-sm font-mono">$1</code>'),n=n.replace(/\n/g,"<br />"),n}function Oa({messages:t,onSendMessage:n,isLoading:s=!1,placeholder:o="Nachricht eingeben...",className:c,height:l="100%",emptyStateMessage:d="Beginne eine Unterhaltung mit dem Assistenten",suggestedPrompts:u}){const{t:a,i18n:h}=It(),[,p]=at(),[m,f]=j(""),b=Y(null),i=Y(null),g=Y(null),w=Y(null),F=Y(null),L=Y(null),[re,q]=j(!1),[Q,ie]=j(null),[ee,ue]=j(!1),I=Y(null),D=Y(null),T=Y(null),[k,ne]=j(null),[z,se]=j(null),[ze,ge]=j(!1),le=Y(null),[xe,B]=j(0),[be,ve]=j(!1),Ke=ae(async x=>{p(x);const{eventBus:S,Events:E}=await _s(async()=>{const{eventBus:ce,Events:X}=await import("./eventBus-CWDWdm45.js");return{eventBus:ce,Events:X}},[]);setTimeout(()=>{S.emit(E.CHAT_DIALOG_OPEN)},300)},[p]),De=Ne(()=>t.filter(x=>x.role!=="system"),[t]),Ce=Ne(()=>u?u.map(x=>typeof x=="string"?{text:x,icon:"tag"}:x):[],[u]),ye=ae(()=>{const x=b.current?.querySelector("[data-radix-scroll-area-viewport]");x&&requestAnimationFrame(()=>{x.scrollTo({top:x.scrollHeight,behavior:"smooth"})})},[]);G(()=>{De.length>0&&ye()},[De.length,ye]);const[y,C]=j({bottom:0,left:0});G(()=>{if(ee&&D.current){const x=D.current.getBoundingClientRect();C({bottom:window.innerHeight-x.top+8,left:x.left})}},[ee]),G(()=>{const x=S=>{const E=S.target,ce=T.current?.contains(E),X=D.current?.contains(E),J=I.current?.contains(E);!ce&&!X&&!J&&ue(!1)};if(ee)return document.addEventListener("mousedown",x),document.addEventListener("touchstart",x),()=>{document.removeEventListener("mousedown",x),document.removeEventListener("touchstart",x)}},[ee]);const P=ae(x=>{x.preventDefault();const S=m.trim();if(!(!S||s)){if(S.length>1e4){N.error(a("aiChat.messageTooLong"));return}if(s){N.info(a("aiChat.waitForResponse"));return}try{n(S),f(""),ye(),w.current?.focus()}catch{N.error(a("aiChat.unknownError"))}}},[m,s,n,ye,a]),V=ae(x=>{x.key==="Enter"&&!x.shiftKey&&(x.preventDefault(),P(x))},[P]),K=ae(x=>{s||(n(x),ye())},[s,n,ye]),Z=ae(x=>{if(x.size>10485760){N.error(a("aiChat.fileTooLarge",{maxSize:(10485760/1024/1024).toFixed(0)}));return}if(!x.name||x.name.length>255){N.error(a("aiChat.invalidFilename"));return}const E=URL.createObjectURL(x);ne({file:x,url:E,type:x.type.startsWith("image/")?"image":"file"})},[a]),A=ae(async()=>{if(!k)return;ve(!0),B(0);const x=N.loading(a("aiChat.uploadingFile"));try{const S=await Promise.race([new Promise((r,v)=>{const R=new FileReader;R.onprogress=O=>{O.lengthComputable&&B(Math.round(O.loaded/O.total*30))},R.onload=()=>{const O=R.result;if(!O||!O.includes(",")){v(new Error(a("aiChat.invalidFileFormat")));return}B(30),r(O.split(",")[1])},R.onerror=()=>v(new Error(a("aiChat.fileReadError"))),R.readAsDataURL(k.file)}),new Promise((r,v)=>setTimeout(()=>v(new Error(a("aiChat.uploadTimeout"))),3e4))]);B(40);const E=$(H,"uploadAIChatFile"),ce=setInterval(()=>{B(r=>r<90?r+5:r)},200),X=await Promise.race([E({fileName:k.file.name,fileData:S,fileType:k.file.type}),new Promise((r,v)=>setTimeout(()=>v(new Error(a("aiChat.uploadConnectionTimeout"))),6e4))]);if(clearInterval(ce),B(100),!X?.data)throw new Error(a("aiChat.noServerResponse"));const J=X.data;if(!J.fileUrl||!J.fileName)throw new Error(a("aiChat.invalidServerResponse"));N.dismiss(x),n(`[Datei: ${J.fileName}](${J.fileUrl})`),N.success(a("aiChat.fileUploadSuccess")),ne(null),URL.revokeObjectURL(k.url)}catch(S){N.dismiss(x);const E=S.message||a("aiChat.unknownError");N.error(a("aiChat.uploadError",{error:E}))}finally{ve(!1),B(0)}},[k,n,a]),W=ae(x=>{if(!x.type.startsWith("image/")){N.error(a("aiChat.selectImage"));return}const S=5*1024*1024;if(x.size>S){N.error(a("aiChat.imageTooLarge",{maxSize:(S/1024/1024).toFixed(0)}));return}if(!x.name||x.name.length>255){N.error(a("aiChat.invalidFilename"));return}const E=URL.createObjectURL(x);ne({file:x,url:E,type:"image"})},[a]),oe=ae(async()=>{if(!k||k.type!=="image")return;ve(!0),B(0);const x=N.loading(a("aiChat.uploadingImage"));try{const S=await Promise.race([new Promise((r,v)=>{const R=new FileReader;R.onprogress=O=>{O.lengthComputable&&B(Math.round(O.loaded/O.total*30))},R.onload=()=>{const O=R.result;if(!O||!O.includes(",")){v(new Error(a("aiChat.invalidImageFormat")));return}B(30),r(O.split(",")[1])},R.onerror=()=>v(new Error(a("aiChat.imageReadError"))),R.readAsDataURL(k.file)}),new Promise((r,v)=>setTimeout(()=>v(new Error(a("aiChat.imageUploadTimeout"))),3e4))]);B(40);const E=$(H,"uploadAIChatImage"),ce=setInterval(()=>{B(r=>r<90?r+5:r)},200),X=await Promise.race([E({fileName:k.file.name,fileData:S,fileType:k.file.type}),new Promise((r,v)=>setTimeout(()=>v(new Error(a("aiChat.uploadConnectionTimeout"))),6e4))]);if(clearInterval(ce),B(100),!X?.data)throw new Error(a("aiChat.noServerResponse"));const J=X.data;if(!J.imageUrl||!J.fileName)throw new Error(a("aiChat.invalidServerResponse"));N.dismiss(x),n(`![${J.fileName}](${J.imageUrl})`),N.success(a("aiChat.imageUploadSuccess")),ne(null),URL.revokeObjectURL(k.url)}catch(S){N.dismiss(x);const E=S.message||a("aiChat.unknownError");N.error(a("aiChat.uploadError",{error:E}))}finally{ve(!1),B(0)}},[k,n,a]),_=ae(async()=>{if(re&&Q){try{Q.stop(),q(!1),N.info(a("aiChat.processingRecording"))}catch{q(!1),N.error(a("aiChat.stopRecordingError"))}return}try{if(!navigator.mediaDevices||!navigator.mediaDevices.getUserMedia){N.error(a("aiChat.microphoneNotSupported"));return}const x=await Promise.race([navigator.mediaDevices.getUserMedia({audio:!0}),new Promise((X,J)=>setTimeout(()=>J(new Error(a("aiChat.microphoneTimeout"))),1e4))]),S=new MediaRecorder(x),E=[];let ce=null;S.ondataavailable=X=>{X.data.size>0&&E.push(X.data)},S.onstop=async()=>{ce&&clearTimeout(ce);const X=new Blob(E,{type:"audio/webm"}),J=10*1024*1024;if(X.size>J){N.error(a("aiChat.audioTooLarge")),x.getTracks().forEach(v=>v.stop());return}const r=URL.createObjectURL(X);se({blob:X,url:r}),x.getTracks().forEach(v=>v.stop())},S.onerror=X=>{N.error(a("aiChat.recordingError")),q(!1),x.getTracks().forEach(J=>J.stop())},ce=setTimeout(()=>{S.state==="recording"&&(S.stop(),N.warning(a("aiChat.maxRecordingTime")))},300*1e3),S.start(),ie(S),q(!0),N.info(a("aiChat.recordingStarted"))}catch(x){q(!1);const S=x.message||a("aiChat.unknownError");S.includes("permission")||S.includes("denied")?N.error(a("aiChat.microphonePermissionDenied")):S.includes("not found")||S.includes("not available")?N.error(a("aiChat.microphoneNotFound")):N.error(a("aiChat.microphoneError",{error:S}))}},[re,Q,a]),te=ae(async()=>{if(!z)return;ve(!0),B(0);const x=N.loading(a("aiChat.transcribingAudio"));try{const S=await Promise.race([new Promise((r,v)=>{const R=new FileReader;R.onprogress=O=>{O.lengthComputable&&B(Math.round(O.loaded/O.total*20))},R.onload=()=>{const O=R.result;if(!O||!O.includes(",")){v(new Error(a("aiChat.invalidAudioFormat")));return}B(20),r(O.split(",")[1])},R.onerror=()=>v(new Error(a("aiChat.audioReadError"))),R.readAsDataURL(z.blob)}),new Promise((r,v)=>setTimeout(()=>v(new Error(a("aiChat.audioProcessingTimeout"))),3e4))]);B(30);const E=$(H,"transcribeAIChatAudio"),ce=setInterval(()=>{B(r=>r<90?r+5:r)},300),X=await Promise.race([E({audioData:S,mimeType:"audio/webm"}),new Promise((r,v)=>setTimeout(()=>v(new Error(a("aiChat.transcriptionTimeout"))),6e4))]);if(clearInterval(ce),B(100),!X?.data)throw new Error(a("aiChat.noServerResponse"));const J=X.data;if(J.transcription&&J.transcription.trim())f(J.transcription.trim()),w.current?.focus(),N.dismiss(x),N.success(a("aiChat.voiceInputSuccess")),se(null),URL.revokeObjectURL(z.url);else throw new Error(a("aiChat.noTranscription"))}catch(S){N.dismiss(x);const E=S.message||a("aiChat.unknownError");N.error(a("aiChat.transcriptionError",{error:E}))}finally{ve(!1),B(0)}},[z,a]),me=ae(()=>{z&&(le.current||(le.current=new Audio(z.url),le.current.onended=()=>ge(!1),le.current.onpause=()=>ge(!1)),ze?(le.current.pause(),ge(!1)):(le.current.play(),ge(!0)))},[z,ze]);G(()=>()=>{z&&URL.revokeObjectURL(z.url),k&&URL.revokeObjectURL(k.url),le.current&&(le.current.pause(),le.current=null)},[z,k]),ae(()=>{const S=h.language==="de"?"en":"de";h.changeLanguage(S),localStorage.setItem("language",S),N.success(a("aiChat.languageChanged",{lang:a(S==="de"?"common.german":"common.english")}))},[h,a]);const Se=()=>e.jsxs("form",{ref:g,onSubmit:P,className:"w-full space-y-2",children:[k&&e.jsx(dt,{className:"p-3",children:e.jsxs(ut,{className:"p-0 space-y-2",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-sm font-medium",children:k.type==="image"?a("aiChat.previewImage"):a("aiChat.previewFile")}),e.jsx(U,{type:"button",variant:"ghost",size:"sm",onClick:()=>{ne(null),URL.revokeObjectURL(k.url)},className:"h-6 w-6 p-0",children:e.jsx(Be,{className:"w-4 h-4"})})]}),k.type==="image"?e.jsx("img",{src:k.url,alt:"Preview",className:"w-full rounded-lg max-h-48 object-contain"}):e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(At,{className:"w-8 h-8 text-muted-foreground"}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("p",{className:"text-sm font-medium truncate",children:k.file.name}),e.jsxs("p",{className:"text-xs text-muted-foreground",children:[(k.file.size/1024).toFixed(1)," KB"]})]})]}),be?e.jsxs("div",{className:"space-y-1",children:[e.jsx(jt,{value:xe,className:"h-2"}),e.jsx("p",{className:"text-xs text-muted-foreground text-center",children:k.type==="image"?a("aiChat.imageUploadProgress",{percent:xe}):a("aiChat.uploadProgress",{percent:xe})})]}):e.jsx(U,{type:"button",onClick:k.type==="image"?oe:A,className:"w-full",size:"sm",children:k.type==="image"?a("aiChat.sendImage"):a("aiChat.sendFile")})]})}),z&&e.jsx(dt,{className:"p-3",children:e.jsxs(ut,{className:"p-0 space-y-2",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-sm font-medium",children:a("aiChat.previewAudio")}),e.jsx(U,{type:"button",variant:"ghost",size:"sm",onClick:()=>{se(null),URL.revokeObjectURL(z.url),le.current&&(le.current.pause(),le.current=null)},className:"h-6 w-6 p-0",children:e.jsx(Be,{className:"w-4 h-4"})})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(U,{type:"button",variant:"outline",size:"sm",onClick:me,className:"flex-shrink-0",children:ze?e.jsxs(e.Fragment,{children:[e.jsx(An,{className:"w-4 h-4 mr-2"}),a("aiChat.pauseAudio")]}):e.jsxs(e.Fragment,{children:[e.jsx(In,{className:"w-4 h-4 mr-2"}),a("aiChat.playAudio")]})}),e.jsx("div",{className:"flex-1",children:e.jsx("p",{className:"text-sm text-muted-foreground",children:a("aiChat.previewAudio")})})]}),be?e.jsxs("div",{className:"space-y-1",children:[e.jsx(jt,{value:xe,className:"h-2"}),e.jsx("p",{className:"text-xs text-muted-foreground text-center",children:a("aiChat.transcriptionProgress",{percent:xe})})]}):e.jsx(U,{type:"button",onClick:te,className:"w-full",size:"sm",children:a("aiChat.sendTranscription")})]})}),be&&!k&&!z&&e.jsx(dt,{className:"p-2",children:e.jsxs(ut,{className:"p-0 space-y-1",children:[e.jsx(jt,{value:xe,className:"h-2"}),e.jsx("p",{className:"text-xs text-muted-foreground text-center",children:a("aiChat.uploadProgress",{percent:xe})})]})}),e.jsx("input",{ref:F,type:"file",className:"hidden",onChange:x=>{const S=x.target.files?.[0];S&&Z(S),x.target.value=""},accept:"*/*"}),e.jsx("input",{ref:L,type:"file",className:"hidden",onChange:x=>{const S=x.target.files?.[0];S&&(W(S),ue(!1)),x.target.value=""},accept:"image/*"}),e.jsx("div",{className:"w-full max-w-full mx-auto",children:e.jsxs("div",{className:"flex items-center gap-2 px-2",style:{alignItems:"center"},children:[e.jsxs("div",{className:"flex-1 relative",children:[e.jsx("button",{ref:D,type:"button",onClick:()=>ue(!ee),className:"absolute left-2 top-1/2 -translate-y-1/2 w-8 h-8 rounded-full bg-transparent hover:bg-muted/50 transition-colors flex items-center justify-center active:scale-95 z-10","aria-label":"Mehr Optionen",disabled:s,children:e.jsx(nn,{className:"w-4 h-4 text-muted-foreground"})}),e.jsx("textarea",{ref:w,value:m,onChange:x=>f(x.target.value),onKeyDown:V,placeholder:o,rows:1,className:"w-full pl-10 pr-4 py-3 rounded-2xl bg-muted border-0 text-base text-foreground placeholder:text-muted-foreground focus:outline-none focus:ring-2 focus:ring-primary/20 transition-all resize-none overflow-y-auto min-h-[44px] max-h-[120px] leading-relaxed",style:{height:"auto",minHeight:"44px"},disabled:s,onInput:x=>{const S=x.target;S.style.height="auto",S.style.height=`${Math.min(S.scrollHeight,120)}px`}})]}),m.trim()?e.jsx("button",{type:"submit",disabled:s,className:"w-10 h-10 rounded-full bg-primary text-primary-foreground hover:bg-primary/90 transition-colors flex items-center justify-center active:scale-95 shadow-md self-center","aria-label":s?"Wird gesendet...":"Nachricht senden",children:s?e.jsx(zt,{className:"w-5 h-5 animate-spin"}):e.jsx(Fn,{className:"w-5 h-5"})}):e.jsx("button",{type:"button",onClick:_,className:M("transition-colors flex items-center justify-center active:scale-95 self-center p-2",re?"text-red-500 hover:text-red-600":"text-foreground hover:text-foreground/80"),"aria-label":"Spracheingabe",disabled:s,children:e.jsx(Tn,{className:M("w-7 h-7",re?"text-red-500":"text-foreground")})})]})})]});return e.jsxs(e.Fragment,{children:[ee&&e.jsxs("div",{ref:T,className:"fixed bg-background border border-border rounded-lg shadow-2xl z-[99999] min-w-[200px] overflow-hidden",style:{bottom:`${y.bottom}px`,left:`${y.left}px`},children:[e.jsxs("button",{type:"button",onClick:()=>{F.current?.click(),ue(!1)},className:"w-full flex items-center gap-3 px-4 py-3 hover:bg-muted transition-colors text-left",children:[e.jsx(En,{className:"w-5 h-5 text-muted-foreground"}),e.jsx("span",{className:"text-sm",children:"Datei anhängen"})]}),e.jsxs("button",{type:"button",onClick:()=>{L.current?.click(),ue(!1)},className:"w-full flex items-center gap-3 px-4 py-3 hover:bg-muted transition-colors text-left",children:[e.jsx(kn,{className:"w-5 h-5 text-muted-foreground"}),e.jsx("span",{className:"text-sm",children:"Bild hinzufügen"})]})]}),e.jsx("div",{ref:i,className:M("flex flex-col bg-background text-foreground",c),style:{height:l},children:De.length===0?e.jsxs("div",{className:"flex flex-col h-full animate-in fade-in duration-300 pb-20",children:[e.jsx("div",{className:"flex-1 flex items-center justify-center px-4",children:e.jsx("div",{className:"w-full max-w-2xl"})}),Ce.length>0&&e.jsx("div",{className:"fixed bottom-24 left-0 right-0 px-4 pb-2 z-[1] pointer-events-none",children:e.jsx("div",{className:"w-full max-w-2xl mx-auto",children:e.jsx("div",{className:"overflow-x-auto scrollbar-hide -mx-4 px-4 pointer-events-auto",children:e.jsx("div",{className:"flex gap-3",style:{width:"max-content"},children:Ce.map((x,S)=>{const E=x.subtitle&&x.subtitle.trim().length>0;return e.jsxs("button",{onClick:()=>K(x.text),disabled:s,className:"flex-shrink-0 w-[calc(40vw-1rem)] min-w-[140px] max-w-[160px] rounded-xl bg-muted hover:bg-muted/80 active:bg-muted/70 px-2.5 py-2 text-left transition-all duration-200 disabled:cursor-not-allowed disabled:opacity-50 shadow-sm",type:"button",children:[e.jsx("p",{className:"font-medium text-xs text-foreground mb-0.5 line-clamp-2 leading-tight",children:x.text}),E&&e.jsx("p",{className:"text-[10px] text-muted-foreground line-clamp-2 leading-tight",children:x.subtitle})]},S)})})})})}),e.jsx("div",{className:"fixed bottom-0 left-0 right-0 w-full bg-background px-4 py-3 safe-bottom",style:{paddingBottom:"max(0.75rem, env(safe-area-inset-bottom))"},children:e.jsx("div",{className:"w-full max-w-2xl mx-auto",children:Se()})})]}):e.jsxs(e.Fragment,{children:[e.jsx("div",{ref:b,className:"flex-1 overflow-hidden pb-32",children:e.jsx(Ra,{className:"h-full [&>div>div]:!overflow-y-auto [&>div>div]:[-ms-overflow-style:none] [&>div>div]:[scrollbar-width:none] [&>div>div::-webkit-scrollbar]:hidden",children:e.jsxs("div",{className:"flex flex-col p-4 space-y-4 pb-6",children:[De.map((x,S)=>e.jsx("div",{className:M("flex gap-3 animate-in fade-in slide-in-from-bottom-2 duration-300",x.role==="user"?"justify-end":"justify-start"),children:e.jsx("div",{className:M("max-w-[85%] select-text",x.role==="user"?"bg-primary text-primary-foreground rounded-2xl px-4 py-3 text-base":"text-foreground text-base"),onClick:E=>{E.target.closest("button, a")||E.stopPropagation()},onMouseDown:E=>{E.target.closest("button, a")||E.stopPropagation()},children:x.role==="assistant"?e.jsx(Ma,{content:x.content,onNavigate:Ke}):e.jsx("p",{className:"whitespace-pre-wrap leading-relaxed",children:x.content})})},S)),s&&e.jsx("div",{className:"flex items-start gap-4 justify-start animate-in fade-in duration-200",children:e.jsx("div",{className:"rounded-lg bg-muted px-4 py-3",children:e.jsx(zt,{className:"size-4 animate-spin text-muted-foreground"})})})]})})}),Ce.length>0&&e.jsx("div",{className:"fixed bottom-24 left-0 right-0 px-4 pb-2 z-[1] pointer-events-none",children:e.jsx("div",{className:"w-full max-w-2xl mx-auto",children:e.jsx("div",{className:"overflow-x-auto scrollbar-hide -mx-4 px-4 pointer-events-auto",children:e.jsx("div",{className:"flex gap-3",style:{width:"max-content"},children:Ce.map((x,S)=>{const E=x.subtitle&&x.subtitle.trim().length>0;return e.jsxs("button",{onClick:()=>K(x.text),disabled:s,className:"flex-shrink-0 w-[calc(40vw-1rem)] min-w-[140px] max-w-[160px] rounded-xl bg-muted hover:bg-muted/80 active:bg-muted/70 px-2.5 py-2 text-left transition-all duration-200 disabled:cursor-not-allowed disabled:opacity-50 shadow-sm",type:"button",children:[e.jsx("p",{className:"font-medium text-xs text-foreground mb-0.5 line-clamp-2 leading-tight",children:x.text}),E&&e.jsx("p",{className:"text-[10px] text-muted-foreground line-clamp-2 leading-tight",children:x.subtitle})]},S)})})})})}),e.jsx("div",{className:"fixed bottom-0 left-0 right-0 w-full bg-background/95 backdrop-blur-sm px-4 py-3 safe-bottom flex-shrink-0 z-30",style:{paddingBottom:"max(0.75rem, env(safe-area-inset-bottom))"},children:e.jsx("div",{className:"w-full max-w-2xl mx-auto",children:Se()})})]})})]})}function qt({className:t,onKeyDown:n,onCompositionStart:s,onCompositionEnd:o,...c}){const l=Rt(),{onCompositionStart:d,onCompositionEnd:u,onKeyDown:a}=pn({onKeyDown:h=>{const p=h.nativeEvent.isComposing||l.justEndedComposing();h.key==="Enter"&&!h.shiftKey&&p||n?.(h)},onCompositionStart:h=>{l.setComposing(!0),s?.(h)},onCompositionEnd:h=>{l.markCompositionEnd(),setTimeout(()=>{l.setComposing(!1)},100),o?.(h)}});return e.jsx("textarea",{"data-slot":"textarea",className:M("border-input placeholder:text-muted-foreground focus-visible:border-ring focus-visible:ring-ring/50 aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive dark:bg-input/30 flex field-sizing-content min-h-16 w-full rounded-md border bg-transparent px-3 py-2 text-base shadow-xs transition-[color,box-shadow] outline-none focus-visible:ring-[3px] disabled:cursor-not-allowed disabled:opacity-50 md:text-sm",t),onCompositionStart:d,onCompositionEnd:u,onKeyDown:a,...c})}const nt={role:"system",content:'Du bist ein hilfreicher Assistent für die Nexo-Anwendung. Du hilfst Benutzern bei Fragen zu Finanzen, Rechnungen, Terminen und anderen Funktionen der App. WICHTIG: Verwende IMMER "ss" statt "ß" in allen deutschen Texten (Schweizer Grammatik).'};function Cr(){const{t}=It();at();const{data:n,isLoading:s,refetch:o}=fn(),[c,l]=j(null),[d,u]=j(!1),[a,h]=j(!1),[p,m]=j(!1),[f,b]=j(!1),[i,g]=j(!1),[w,F]=j(!1),[L,re]=j(!1),[q,Q]=j(null),ie=Y(null),ee=Y(null),ue=Y(null),I=Y(null),[D,T]=j({title:"",type:"termin",dueDate:"",isAllDay:!1,amount:"",currency:"CHF",notes:""}),[k,ne]=j(!1),[z,se]=j({type:"ausgabe",amount:"",category:"",description:"",date:we(new Date),paymentMethod:"Karte"}),[ze,ge]=j(fe(new Date)),[le,xe]=j(!1),[B,be]=j({name:"",quantity:"1",category:"Lebensmittel",store:""}),[ve,Ke]=j(!1),De=["Lebensmittel","Getränke","Haushalt","Hygiene","Tierbedarf","Sonstiges"],Ce=async()=>{if(!B.name){N.error("Bitte Artikelname eingeben");return}Ke(!0);try{await ma({item:B.name,quantity:parseInt(B.quantity)||1,category:B.category,estimatedPrice:0,currency:"EUR",unit:null}),N.success("Artikel zur Einkaufsliste hinzugefügt"),g(!1),be({name:"",quantity:"1",category:"Lebensmittel",store:""})}catch(r){N.error("Fehler beim Hinzufügen des Artikels"),console.error(r)}finally{Ke(!1)}},ye={income:["Gehalt","Freelance","Investitionen","Geschenk","Sonstiges"],expense:["Lebensmittel","Transport","Wohnen","Unterhaltung","Gesundheit","Kleidung","Bildung","Rechnung","Sonstiges"]},y=async()=>{if(!z.amount||!z.category){N.error("Bitte Betrag und Kategorie eingeben");return}xe(!0);try{await cn({type:z.type,category:z.category,amount:Math.round(parseFloat(z.amount)*100),currency:"CHF",date:new Date(z.date),paymentMethod:z.paymentMethod,notes:z.description||"",status:z.type==="ausgabe"?"open":void 0}),N.success(z.type==="einnahme"?"Einnahme hinzugefügt":"Ausgabe hinzugefügt");const r=we(new Date);b(!1),se({type:"ausgabe",amount:"",category:"",description:"",date:r,paymentMethod:"Karte"}),ge(fe(r))}catch(r){N.error("Fehler beim Erstellen des Eintrags"),console.error(r)}finally{xe(!1)}};G(()=>{!s&&n.length>0&&!c&&l(n[0].id)},[s,n,c]);const[C,P]=j([nt]),V=Y(null),K=Y(!1);G(()=>{if(c&&c!==V.current)if(V.current=c,n.length>0){const r=vt(c,n);r&&r.messages.length>0?P(r.messages):P([nt])}else P([nt])},[c,n]),G(()=>{if(!K.current&&c&&C.length>1){const r=setTimeout(async()=>{K.current=!0;try{const v=vt(c,n);if(v){const R=C.find(O=>O.role==="user");R&&v.title===t("aiChat.newConversation")&&(v.title=Wt(R.content)),v.messages=C,v.updatedAt=new Date().toISOString(),await lt(v)}else{const R=C.find(bt=>bt.role==="user"),O={id:c,userId:"",title:R?Wt(R.content):t("aiChat.newConversation"),messages:C,createdAt:new Date().toISOString(),updatedAt:new Date().toISOString()};await lt(O),O.id.startsWith("chat_")&&l(O.id)}}catch{}finally{K.current=!1}},1e3);return()=>clearTimeout(r)}},[C,c,n]);const Z=ae(async()=>{try{const r=Yt();await lt(r),l(r.id),P([nt]),await o(),N.success(t("aiChat.conversationStarted"))}catch(r){console.error("Error creating new chat:",r);let v="Fehler beim Erstellen der neuen Konversation";r?.code==="unauthenticated"||r?.message?.includes("unauthenticated")?v="Bitte melde dich an, um eine neue Konversation zu erstellen":r?.code==="permission-denied"||r?.message?.includes("permission")?v="Keine Berechtigung zum Erstellen einer Konversation":r?.message?v=`Fehler: ${r.message}`:typeof r=="string"&&(v=`Fehler: ${r}`),N.error(v)}},[o]),A=ae(r=>{l(r);const v=vt(r,n);v&&v.messages.length>0?P(v.messages):P([nt])},[n]),W=ra.ai.chat.useMutation({onSuccess:r=>{const v={role:"assistant",content:r.content};P(R=>[...R,v])},onError:r=>{let v="Ein unbekannter Fehler ist aufgetreten.";r.message.includes("<!doctype")||r.message.includes("Unexpected token")||r.message.includes("Failed to fetch")?v="Der Server ist nicht erreichbar oder gibt eine ungültige Antwort zurück. Bitte stelle sicher, dass der Server läuft und du eine Internetverbindung hast.":r.message.includes("Unable to transform")||r.message.includes("NetworkError")?v="Fehler bei der Datenübertragung. Bitte überprüfe deine Internetverbindung und versuche es erneut.":r.data?.code==="UNAUTHORIZED"||r.message.includes("unauthenticated")?v="Du bist nicht angemeldet. Bitte melde dich an.":r.data?.code==="INTERNAL_SERVER_ERROR"||r.message.includes("500")?v="Ein Serverfehler ist aufgetreten. Bitte versuche es später erneut.":r.message.includes("timeout")||r.message.includes("Timeout")?v="Die Anfrage hat zu lange gedauert. Bitte versuche es erneut.":r.message.includes("rate limit")||r.message.includes("429")?v="Zu viele Anfragen. Bitte warte einen Moment und versuche es erneut.":v=r.message||"Ein Fehler ist aufgetreten.";const R={role:"assistant",content:`**Fehler aufgetreten**

${v}

Bitte versuche es erneut oder starte eine neue Konversation.`};P(O=>[...O,R]),N.error("Fehler beim Senden der Nachricht")}}),oe=ae(async r=>{if(r.length>1e4){N.error("Nachricht ist zu lang. Bitte kürze sie auf maximal 10.000 Zeichen.");return}if(!c)try{const R=Yt();await lt(R),l(R.id),await o()}catch{N.error("Fehler beim Erstellen der Konversation");return}if(C.filter(R=>R.role==="user").length>=50){N.warning("Zu viele Nachrichten in dieser Konversation. Bitte starte eine neue Konversation.");return}try{const R={role:"user",content:r},O=[...C,R];P(O),W.mutate({messages:O})}catch{N.error("Fehler beim Senden der Nachricht. Bitte versuche es erneut.")}},[C,W,c,o]),_=Ne(()=>[{text:"Wie funktioniert die Rechnungsverwaltung?",subtitle:"Lerne die Rechnungsverwaltung kennen",icon:"receipt"},{text:"Wie erstelle ich eine Erinnerung?",subtitle:"Erstelle Termine und Erinnerungen",icon:"bell"},{text:"Wie verwalte ich meine Finanzen?",subtitle:"Verwalte Einnahmen und Ausgaben",icon:"wallet"},{text:"Was kann ich mit der Einkaufsliste machen?",subtitle:"Verwalte deine Einkaufsliste",icon:"shoppingCart"},{text:"Wie funktioniert das Raten-System?",subtitle:"Lerne Ratenzahlungen zu verwalten",icon:"calendar"},{text:"Wie scanne ich eine Rechnung?",subtitle:"Erfasse Rechnungen automatisch",icon:"scan"}],[]),te=C.some(r=>r.role==="user"),me=()=>c&&n.length>0&&n.find(v=>v.id===c)?.title||t("aiChat.title"),Se=Ne(()=>[{id:"reminder",label:"Erinnerung erstellen",path:"#",icon:gt,onClick:()=>h(!0)},{id:"scan",label:"Rechnung scannen",path:"#",icon:Xe,onClick:()=>{m(!0),Q(null)}},{id:"finance",label:"Finanzübersicht",path:"#",icon:Oe,onClick:()=>b(!0)},{id:"shopping",label:"Einkaufsliste",path:"#",icon:st,onClick:()=>g(!0)}],[]),x=async()=>{if(!D.title||!D.dueDate){N.error("Bitte füllen Sie Titel und Datum aus");return}ne(!0);try{const r=D.amount?Math.round(parseFloat(D.amount)*100):void 0;await ln({title:D.title,type:D.type,dueDate:new Date(D.dueDate),isAllDay:D.isAllDay,amount:r,currency:D.currency,notes:D.notes||""}),N.success("Erinnerung erstellt"),h(!1),T({title:"",type:"termin",dueDate:"",isAllDay:!1,amount:"",currency:"CHF",notes:""})}catch(r){N.error("Fehler beim Erstellen der Erinnerung"),console.error(r)}finally{ne(!1)}},S=async()=>{try{const r=await navigator.mediaDevices.getUserMedia({video:{facingMode:"environment"}});I.current=r,ie.current&&(ie.current.srcObject=r),F(!0),wt()}catch(r){N.error(Ta(r)),Ia()}},E=()=>{I.current&&(I.current.getTracks().forEach(r=>r.stop()),I.current=null),F(!1)},ce=()=>{if(ie.current&&ee.current){const r=ie.current,v=ee.current;v.width=r.videoWidth,v.height=r.videoHeight;const R=v.getContext("2d");if(R){R.drawImage(r,0,0);const O=v.toDataURL("image/jpeg");Q(O),E(),wt()}}},X=r=>{const v=r.target.files?.[0];if(v){const R=new FileReader;R.onload=O=>{const bt=O.target?.result;Q(bt),wt()},R.readAsDataURL(v)}},J=async()=>{if(q){const r={role:"user",content:`![Gescanntes Bild](${q})`};P(v=>[...v,r]),Q(null),m(!1),N.success("Scan zum Chat hinzugefügt");try{W.mutate({messages:[...C,r]})}catch(v){console.error("Error sending scan to chat:",v)}}};return G(()=>()=>{p||E()},[p]),e.jsxs("div",{className:"min-h-screen bg-background flex flex-col safe-area-inset",children:[e.jsx(Ca,{title:me(),showSidebar:!0,showQuickActions:!0,quickActions:Se,currentChatId:c||void 0,onSelectChat:A,onNewChat:Z,sidebarOpen:d,onSidebarToggle:u}),Se.length>0&&e.jsxs("div",{className:"fixed top-14 left-0 right-0 z-30 px-4 py-3 flex flex-row gap-3 justify-center safe-top",style:{paddingTop:"max(0.75rem, env(safe-area-inset-top))"},children:[e.jsx("button",{onClick:()=>u(!0),className:"w-12 h-12 rounded-full bg-background hover:bg-muted border border-border transition-colors flex items-center justify-center active:scale-95 shadow-sm","aria-label":"Menü öffnen","aria-expanded":d,"aria-controls":"sidebar-menu",title:"Menü öffnen",children:e.jsx($n,{className:"w-5 h-5 text-foreground"})}),Se.map(r=>{const v=r.icon;return e.jsx("button",{onClick:r.onClick,className:"w-12 h-12 rounded-full bg-background hover:bg-muted border border-border transition-colors flex items-center justify-center active:scale-95 shadow-sm","aria-label":r.label,title:r.label,children:v&&e.jsx(v,{className:"w-5 h-5 text-foreground"})},r.id)})]}),e.jsx("div",{className:"flex-1 overflow-hidden flex flex-col bg-background",style:{paddingTop:Se.length>0?"7rem":"3.5rem"},children:e.jsx("div",{className:"flex-1 flex flex-col w-full overflow-hidden min-h-0",children:e.jsx(Oa,{messages:C,onSendMessage:oe,isLoading:W.isPending,placeholder:t("common.typeMessage","Nachricht eingeben..."),height:"100%",emptyStateMessage:"Wähle eine Frage oder stelle deine eigene",suggestedPrompts:te?[]:_})})}),e.jsx(Ae,{open:a,onOpenChange:r=>{h(r),r||T({title:"",type:"termin",dueDate:"",isAllDay:!1,amount:"",currency:"CHF",notes:""})},children:e.jsxs(Ie,{className:"!fixed !top-[50%] !left-[50%] !right-auto !bottom-auto !translate-x-[-50%] !translate-y-[-50%] !w-[85vw] !max-w-sm !max-h-fit !rounded-3xl !m-0 !overflow-visible !shadow-2xl",children:[e.jsxs(Fe,{className:"px-5 pt-5 pb-3",children:[e.jsx(Re,{className:"text-lg font-semibold",children:"Erinnerung erstellen"}),e.jsx(Le,{className:"sr-only",children:"Erstellen Sie eine neue Erinnerung basierend auf der Chat-Konversation"})]}),e.jsxs("div",{className:"space-y-3 px-5 pb-2",children:[e.jsxs("div",{className:"w-full",children:[e.jsx(de,{className:"text-sm font-medium",children:"Titel *"}),e.jsx(ke,{value:D.title,onChange:r=>T({...D,title:r.target.value}),placeholder:"Titel",className:"h-11 min-h-[44px] mt-1.5 rounded-xl w-full"})]}),e.jsxs("div",{className:"w-full",children:[e.jsx(de,{className:"text-sm font-medium",children:"Typ *"}),e.jsxs(We,{value:D.type,onValueChange:r=>T({...D,type:r}),children:[e.jsx(qe,{className:"h-11 min-h-[44px] mt-1.5 rounded-xl w-full",children:e.jsx(Ye,{})}),e.jsxs(Ge,{children:[e.jsx(he,{value:"termin",children:"Termin"}),e.jsx(he,{value:"zahlung",children:"Zahlung"}),e.jsx(he,{value:"aufgabe",children:"Aufgabe"})]})]})]}),e.jsxs("div",{className:"w-full",children:[e.jsx(de,{className:"text-sm font-medium",children:"Datum & Uhrzeit *"}),e.jsx("div",{className:"relative w-full mt-1.5",children:e.jsx(ke,{type:"datetime-local",placeholder:"Datum & Uhrzeit auswählen",value:D.dueDate,onChange:r=>{T({...D,dueDate:r.target.value})},className:"h-11 min-h-[44px] rounded-xl w-full",style:{boxSizing:"border-box",fontSize:"16px",height:"44px",minHeight:"44px",maxHeight:"44px",padding:"0.5rem 0.75rem",lineHeight:"1.5rem",appearance:"none",WebkitAppearance:"none",MozAppearance:"textfield"}})})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(ka,{checked:D.isAllDay,onCheckedChange:r=>T({...D,isAllDay:r})}),e.jsx(de,{className:"text-sm font-medium",children:"Ganztägig"})]}),D.type==="zahlung"&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"w-full",children:[e.jsx(de,{className:"text-sm font-medium",children:"Betrag"}),e.jsx(ke,{type:"number",step:"0.01",value:D.amount,onChange:r=>T({...D,amount:r.target.value}),placeholder:"0.00",className:"h-11 min-h-[44px] mt-1.5 rounded-xl w-full"})]}),e.jsxs("div",{className:"w-full",children:[e.jsx(de,{className:"text-sm font-medium",children:"Währung"}),e.jsxs(We,{value:D.currency,onValueChange:r=>T({...D,currency:r}),children:[e.jsx(qe,{className:"h-11 min-h-[44px] mt-1.5 rounded-xl w-full",children:e.jsx(Ye,{})}),e.jsxs(Ge,{children:[e.jsx(he,{value:"CHF",children:"CHF"}),e.jsx(he,{value:"EUR",children:"EUR"}),e.jsx(he,{value:"USD",children:"USD"})]})]})]})]}),e.jsxs("div",{className:"w-full",children:[e.jsx(de,{className:"text-sm font-medium",children:"Notizen"}),e.jsx(qt,{value:D.notes,onChange:r=>T({...D,notes:r.target.value}),placeholder:"Notizen...",className:"mt-1.5 min-h-[80px] rounded-xl w-full"})]})]}),e.jsxs(Te,{className:"px-5 pb-3 pt-2 gap-2.5",children:[e.jsx(U,{variant:"outline",onClick:()=>h(!1),className:"h-11 min-h-[44px] flex-1 rounded-xl text-sm font-medium",children:"Abbrechen"}),e.jsx(U,{onClick:x,disabled:k,className:"h-11 min-h-[44px] flex-1 rounded-xl text-sm font-medium",children:k?"Speichert...":"Erstellen"})]})]})}),e.jsx(Ae,{open:p,onOpenChange:r=>{m(r),r||(E(),Q(null))},children:e.jsxs(Ie,{className:"!fixed !top-[50%] !left-[50%] !right-auto !bottom-auto !translate-x-[-50%] !translate-y-[-50%] !w-[85vw] !max-w-sm !max-h-fit !rounded-3xl !m-0 !overflow-visible !shadow-2xl",children:[e.jsxs(Fe,{className:"px-5 pt-5 pb-3",children:[e.jsx(Re,{className:"text-lg font-semibold",children:"Rechnung scannen"}),e.jsx(Le,{className:"sr-only",children:"Scannen Sie eine Rechnung mit der Kamera oder laden Sie ein Bild hoch"})]}),e.jsxs("div",{className:"space-y-3 px-5 pb-2",children:[!w&&!q&&e.jsxs("div",{className:"space-y-2.5",children:[e.jsxs(U,{onClick:S,className:"w-full h-11 flex items-center justify-center gap-2 rounded-xl text-sm font-medium",children:[e.jsx(Pt,{className:"w-4 h-4"}),"Kamera öffnen"]}),e.jsxs("div",{className:"relative",children:[e.jsx("input",{ref:ue,type:"file",accept:"image/*",onChange:X,className:"hidden"}),e.jsxs(U,{variant:"outline",onClick:()=>ue.current?.click(),className:"w-full h-11 flex items-center justify-center gap-2 rounded-xl text-sm font-medium",children:[e.jsx(Hn,{className:"w-4 h-4"}),"Bild hochladen"]})]})]}),w&&e.jsxs("div",{className:"space-y-2.5",children:[e.jsxs("div",{className:"relative bg-black rounded-xl overflow-hidden aspect-video",children:[e.jsx("video",{ref:ie,autoPlay:!0,playsInline:!0,className:"w-full h-full object-cover"}),e.jsx("canvas",{ref:ee,className:"hidden"})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(U,{variant:"outline",onClick:E,className:"flex-1 h-11 rounded-xl text-sm font-medium",children:[e.jsx(Be,{className:"w-4 h-4 mr-2"}),"Abbrechen"]}),e.jsxs(U,{onClick:ce,className:"flex-1 h-11 rounded-xl text-sm font-medium",children:[e.jsx(Pt,{className:"w-4 h-4 mr-2"}),"Aufnehmen"]})]})]}),q&&e.jsxs("div",{className:"space-y-2.5",children:[e.jsx("div",{className:"relative bg-black rounded-xl overflow-hidden",children:e.jsx("img",{src:q,alt:"Gescanntes Bild",className:"w-full h-auto"})}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(U,{variant:"outline",onClick:()=>{Q(null),F(!1)},className:"flex-1 h-11 rounded-xl text-sm font-medium",children:"Neu scannen"}),e.jsx(U,{onClick:J,className:"flex-1 h-11 rounded-xl text-sm font-medium",children:"Zum Chat hinzufügen"})]})]})]}),e.jsx(Te,{className:"px-5 pb-3 pt-2",children:e.jsx(U,{variant:"outline",onClick:()=>{m(!1),E(),Q(null)},className:"h-11 min-h-[44px] w-full rounded-xl text-sm font-medium",children:"Schliessen"})})]})}),e.jsx(Ae,{open:f,onOpenChange:r=>{if(b(r),r){const v=we(new Date);se(R=>({...R,date:v})),ge(fe(v))}else{const v=we(new Date);se({type:"ausgabe",amount:"",category:"",description:"",date:v,paymentMethod:"Karte"}),ge(fe(v))}},children:e.jsxs(Ie,{className:"!fixed !top-[50%] !left-[50%] !right-auto !bottom-auto !translate-x-[-50%] !translate-y-[-50%] !w-[85vw] !max-w-sm !max-h-fit !rounded-3xl !m-0 !overflow-visible !shadow-2xl",children:[e.jsxs(Fe,{className:"px-5 pt-5 pb-3",children:[e.jsx(Re,{className:"text-lg font-semibold",children:"Einnahme / Ausgabe"}),e.jsx(Le,{className:"sr-only",children:"Erstellen Sie einen neuen Finanz-Eintrag für Einnahmen oder Ausgaben"})]}),e.jsxs("div",{className:"space-y-3 px-5 pb-2",children:[e.jsxs("div",{children:[e.jsx(de,{className:"text-sm font-medium",children:"Typ *"}),e.jsxs(We,{value:z.type,onValueChange:r=>{se({...z,type:r,category:""})},children:[e.jsx(qe,{className:"h-11 min-h-[44px] mt-1.5 rounded-xl",children:e.jsx(Ye,{})}),e.jsxs(Ge,{children:[e.jsx(he,{value:"einnahme",children:"Einnahme"}),e.jsx(he,{value:"ausgabe",children:"Ausgabe"})]})]})]}),e.jsxs("div",{children:[e.jsx(de,{children:"Betrag *"}),e.jsx(ke,{type:"number",step:"0.01",value:z.amount,onChange:r=>se({...z,amount:r.target.value}),placeholder:"0.00",className:"h-11 min-h-[44px] mt-1.5 rounded-xl"})]}),e.jsxs("div",{children:[e.jsx(de,{className:"text-sm font-medium",children:"Kategorie *"}),e.jsxs(We,{value:z.category,onValueChange:r=>se({...z,category:r}),children:[e.jsx(qe,{className:"h-11 min-h-[44px] mt-1.5 rounded-xl",children:e.jsx(Ye,{placeholder:"Kategorie wählen"})}),e.jsx(Ge,{children:(z.type==="einnahme"?ye.income:ye.expense).map(r=>e.jsx(he,{value:r,children:r},r))})]})]}),e.jsxs("div",{children:[e.jsx(de,{className:"text-sm font-medium",children:"Datum *"}),e.jsx(ke,{type:"text",placeholder:"DD.MM.YYYY",value:ze,onChange:r=>{const v=r.target.value;ge(v);const R=Ve(v);R&&se({...z,date:R})},onBlur:r=>{const v=Ve(r.target.value);v?(se({...z,date:v}),ge(fe(v))):r.target.value&&ge(fe(z.date))},className:"h-11 min-h-[44px] mt-1.5 rounded-xl"})]}),e.jsxs("div",{children:[e.jsx(de,{children:"Zahlungsmethode"}),e.jsxs(We,{value:z.paymentMethod,onValueChange:r=>se({...z,paymentMethod:r}),children:[e.jsx(qe,{className:"h-11 min-h-[44px] mt-1.5 rounded-xl",children:e.jsx(Ye,{})}),e.jsxs(Ge,{children:[e.jsx(he,{value:"Karte",children:"Karte"}),e.jsx(he,{value:"Bar",children:"Bar"}),e.jsx(he,{value:"Überweisung",children:"Überweisung"}),e.jsx(he,{value:"Andere",children:"Andere"})]})]})]}),e.jsxs("div",{children:[e.jsx(de,{children:"Beschreibung"}),e.jsx(qt,{value:z.description,onChange:r=>se({...z,description:r.target.value}),placeholder:"Beschreibung...",className:"mt-1 min-h-[80px]"})]})]}),e.jsxs(Te,{className:"px-5 pb-3 pt-2 gap-2.5",children:[e.jsx(U,{variant:"outline",onClick:()=>b(!1),className:"h-11 min-h-[44px] flex-1 rounded-xl text-sm font-medium",children:"Abbrechen"}),e.jsx(U,{onClick:y,disabled:le,className:"h-11 min-h-[44px] flex-1 rounded-xl text-sm font-medium",children:le?"Speichert...":"Erstellen"})]})]})}),e.jsx(Ae,{open:i,onOpenChange:r=>{g(r),r||be({name:"",quantity:"1",category:"Lebensmittel",store:""})},children:e.jsxs(Ie,{className:"!fixed !top-[50%] !left-[50%] !right-auto !bottom-auto !translate-x-[-50%] !translate-y-[-50%] !w-[85vw] !max-w-sm !max-h-fit !rounded-3xl !m-0 !overflow-visible !shadow-2xl",children:[e.jsxs(Fe,{className:"px-5 pt-5 pb-3",children:[e.jsx(Re,{className:"text-lg font-semibold",children:"Artikel zur Einkaufsliste hinzufügen"}),e.jsx(Le,{className:"sr-only",children:"Fügen Sie einen neuen Artikel zur Einkaufsliste hinzu"})]}),e.jsxs("div",{className:"space-y-3 px-5 pb-2",children:[e.jsxs("div",{children:[e.jsx(de,{className:"text-sm font-medium",children:"Artikelname *"}),e.jsx(ke,{value:B.name,onChange:r=>be({...B,name:r.target.value}),placeholder:"z.B. Milch",className:"h-11 min-h-[44px] mt-1.5 rounded-xl"})]}),e.jsxs("div",{children:[e.jsx(de,{className:"text-sm font-medium",children:"Menge"}),e.jsx(ke,{type:"number",min:"1",value:B.quantity,onChange:r=>be({...B,quantity:r.target.value}),placeholder:"1",className:"h-11 min-h-[44px] mt-1.5 rounded-xl"})]}),e.jsxs("div",{children:[e.jsx(de,{className:"text-sm font-medium",children:"Kategorie"}),e.jsxs(We,{value:B.category,onValueChange:r=>be({...B,category:r}),children:[e.jsx(qe,{className:"h-11 min-h-[44px] mt-1.5 rounded-xl",children:e.jsx(Ye,{})}),e.jsx(Ge,{children:De.map(r=>e.jsx(he,{value:r,children:r},r))})]})]}),e.jsxs("div",{children:[e.jsx(de,{className:"text-sm font-medium",children:"Geschäft (optional)"}),e.jsx(ke,{value:B.store,onChange:r=>be({...B,store:r.target.value}),placeholder:"z.B. Migros",className:"h-11 min-h-[44px] mt-1.5 rounded-xl"})]})]}),e.jsxs(Te,{className:"px-5 pb-3 pt-2 gap-2.5",children:[e.jsx(U,{variant:"outline",onClick:()=>g(!1),className:"h-11 min-h-[44px] flex-1 rounded-xl text-sm font-medium",children:"Abbrechen"}),e.jsx(U,{onClick:Ce,disabled:ve,className:"h-11 min-h-[44px] flex-1 rounded-xl text-sm font-medium",children:ve?"Speichert...":"Hinzufügen"})]})]})})]})}export{br as $,Dr as A,U as B,Na as C,Ae as D,gr as E,fr as F,Ta as G,Ia as H,wt as I,pr as J,qe as K,de as L,Ye as M,Ge as N,he as O,Ca as P,ke as Q,ka as R,We as S,ma as T,ur as U,hr as V,mr as W,Ga as X,Va as Y,Za as Z,xr as _,ua as a,yr as a0,nr as a1,tr as a2,Ja as a3,Je as a4,un as a5,He as a6,ir as a7,ot as a8,jr as a9,wr as aa,Nr as ab,qt as ac,vr as ad,Qa as ae,or as af,lr as ag,jt as ah,sr as ai,ar as aj,Xa as ak,Cr as al,_s as am,ra as an,er as b,M as c,rr as d,Tt as e,fe as f,dn as g,H as h,Pe as i,e as j,we as k,Ht as l,dt as m,Kt as n,ut as o,Ie as p,Fe as q,Re as r,Le as s,Te as t,It as u,Ve as v,ln as w,cn as x,cr as y,dr as z};
