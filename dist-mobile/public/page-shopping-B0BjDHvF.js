import{x as _s,y as Ws,z as Qs,j as e,S as he,A as xe,E as fe,F as ge,G as g,B as u,I as K,D as mt,o as ut,p as ht,q as xt,r as ft,H as Ys,L as Qt,s as gt,J as Me,K as y,M as b,N as f,g as pe,O as Zs,Q as Js,R as Xs,T as ea,U as ta,V as sa,W as Yt,w as aa}from"./page-aichat-BIjC68B_.js";import{useEffect as be,useState as l,useRef as z,useMemo as Zt}from"react";import{M as na}from"./page-calendar-G-ZCdum-.js";import{t as r}from"./vendor-toast-CdQ6zwVl.js";import{m as je}from"./vendor-firebase-0-z-9MSQ.js";import{F as pt,k as bt,p as J,T as Be,X as T,V as Re,Y as ra,N as $e,t as qe,Z as la,j as Ke,O as ia,_ as ca,q as jt,o as Nt,h as oa,z as da,$ as Jt,a0 as ma,a1 as ua,a2 as ha}from"./vendor-misc-CeDaE8No.js";const Xt=["Lebensmittel","Getränke","Haushalt","Hygiene","Tierbedarf","Sonstiges"];function Aa(){const{t:H}=_s();be(()=>{const t=document.createElement("style");return t.textContent=`
      @keyframes scan-line {
        0% { transform: translateY(0); opacity: 0.3; }
        50% { transform: translateY(100%); opacity: 1; }
        100% { transform: translateY(0); opacity: 0.3; }
      }
    `,document.head.appendChild(t),()=>{document.head.contains(t)&&document.head.removeChild(t)}},[]);const{data:k=[],isLoading:es}=Ws(),[C,Ne]=l(null),[ts,we]=l(!1),[ss,ve]=l(!1),[V,_]=l(""),[as,He]=l(null);be(()=>{if(k.length>0&&!C){const t=k.find(s=>s.isDefault)||k[0];t&&Ne(t.id)}},[k,C]);const{data:ye=[],isLoading:ns,refetch:O}=Qs(C||void 0),[wt,Oe]=l(!1),[vt,ke]=l(!1),[N,X]=l({name:"",quantity:"1",category:"Lebensmittel",store:""}),[p,M]=l([]),[yt,kt]=l(!1),[ee,W]=l("camera"),[Q,Ce]=l("receipt"),[j,U]=l(!1),[c,Ue]=l(null),[S,Y]=l([]),[P,B]=l([]),[rs,R]=l(0),[I,Se]=l(null),[te,se]=l(1),[Ge,ls]=l(!0),[Ve,is]=l(!0),[_e,cs]=l(!0),h=z(null),Z=z(null),Ct=z(null),[d,ae]=l(null),[St,We]=l(!1),[ne,Qe]=l(null),[Pt,It]=l(!1),$=z(null),Ye=z(null),[Lt,Ft]=l(null),Pe=z(null),[At,Ze]=l(!1),[Je,Xe]=l(null),[et,Dt]=l(!1),q=z(null),tt=z(null),[Et,zt]=l(null),st=Zt(()=>ye.filter(t=>t.status==="not_bought"),[ye]),Ie=Zt(()=>ye.filter(t=>t.status==="bought"),[ye]),os=async()=>{if(!N.name.trim()){r.error("Bitte Artikelname eingeben");return}try{await Me({listId:C||void 0,item:N.name.trim(),quantity:parseInt(N.quantity)||1,category:N.category,estimatedPrice:0,currency:"CHF",store:N.store||null}),r.success("Artikel hinzugefügt"),y(),Oe(!1),X({name:"",quantity:"1",category:"Lebensmittel",store:""}),await O()}catch(t){r.error("Fehler: "+b(t)),f()}},ds=()=>{const t={store:"",items:[]};M([...p,t])},ms=t=>{M(p.filter((s,a)=>a!==t))},us=(t,s)=>{const a=[...p];a[t].store=s,M(a)},hs=t=>{const s=[...p];s[t].items.push({id:Date.now().toString()+Math.random().toString(36).substr(2,9),name:"",quantity:"1",category:"Lebensmittel",price:"",articleNumber:"",productInfo:null,saveToDatabase:!1}),M(s)},xs=(t,s)=>{const a=[...p];a[t].items=a[t].items.filter(n=>n.id!==s),M(a)},L=(t,s,a,n)=>{const o=[...p],i=o[t].items.findIndex(m=>m.id===s);i!==-1&&(o[t].items[i][a]=n,M(o))},fs=(t,s)=>{Qe({groupIndex:t,itemId:s}),We(!0),setTimeout(()=>gs(),100)},gs=async()=>{try{if(!navigator.mediaDevices||!navigator.mediaDevices.getUserMedia){r.error("Kamera wird nicht unterstützt");return}const t=await navigator.mediaDevices.getUserMedia({video:{facingMode:"environment"}});Ft(t),$.current&&($.current.srcObject=t,await $.current.play()),It(!0),ps(),y()}catch(t){r.error("Kamera-Fehler: "+b(t)),f()}},ps=()=>{if(!("BarcodeDetector"in window)){r.error("Barcode-Erkennung nicht unterstützt");return}const t=new window.BarcodeDetector({formats:["ean_13","ean_8","code_128","code_39","upc_a","upc_e"]});Pe.current=setInterval(async()=>{if(!$.current||!Ye.current||!Pt)return;const s=$.current,a=Ye.current,n=a.getContext("2d");if(!(!n||s.readyState!==4)){a.width=s.videoWidth,a.height=s.videoHeight,n.drawImage(s,0,0);try{const o=await t.detect(a);if(o.length>0){const i=o[0].rawValue;Tt(),ne&&(L(ne.groupIndex,ne.itemId,"articleNumber",i),r.success(`Barcode gescannt: ${i}`),y(),await ys(ne.groupIndex,ne.itemId,i)),We(!1),Qe(null)}}catch{}}},500)},Tt=()=>{Pe.current&&(clearInterval(Pe.current),Pe.current=null),Lt&&(Lt.getTracks().forEach(t=>t.stop()),Ft(null)),$.current&&($.current.srcObject=null),It(!1)},bs=()=>{Tt(),We(!1),Qe(null)},js=(t,s)=>{Xe({groupIndex:t,itemId:s}),Ze(!0),setTimeout(()=>Ns(),100)},Ns=async()=>{try{if(!navigator.mediaDevices||!navigator.mediaDevices.getUserMedia){r.error("Kamera wird nicht unterstützt");return}const t=await navigator.mediaDevices.getUserMedia({video:{facingMode:"environment"}});zt(t),q.current&&(q.current.srcObject=t,await q.current.play()),y()}catch(t){r.error("Kamera-Fehler: "+b(t)),f()}},ws=async()=>{if(!(!q.current||!tt.current||!Je)){Dt(!0);try{const t=q.current,s=tt.current;s.width=t.videoWidth,s.height=t.videoHeight;const a=s.getContext("2d");if(a){a.drawImage(t,0,0);const n=s.toDataURL("image/jpeg");await ks(Je.groupIndex,Je.itemId,n),Mt(),Ze(!1),Xe(null)}}catch(t){r.error("Fehler beim Erfassen: "+b(t)),f()}finally{Dt(!1)}}},Mt=()=>{Et&&(Et.getTracks().forEach(t=>t.stop()),zt(null)),q.current&&(q.current.srcObject=null)},vs=()=>{Mt(),Ze(!1),Xe(null)},ys=async(t,s,a)=>{try{if(!p[t]?.items.find(F=>F.id===s))return;const o=p[t]?.store||"",m=await je(pe,"searchProductInfo")({articleNumber:a,store:o});m.data&&m.data.productInfo&&(L(t,s,"productInfo",m.data.productInfo),r.success("Produktinformationen gefunden"))}catch(n){console.log("Product info fetch failed:",n)}},ks=async(t,s,a)=>{try{const n=p[t]?.items.find(F=>F.id===s);if(!n)return;const o=p[t]?.store||"",m=await je(pe,"analyzeProductImage")({imageData:a,store:o,articleNumber:n.articleNumber});m.data&&m.data.productInfo?(L(t,s,"productInfo",m.data.productInfo),m.data.articleNumber&&!n.articleNumber&&L(t,s,"articleNumber",m.data.articleNumber),r.success("Produktinformationen erkannt"),y()):r.info("Keine Produktinformationen erkannt")}catch(n){r.error("Fehler bei Analyse: "+b(n)),f()}},Cs=async(t,s)=>{fs(t,s)},Ss=async(t,s)=>{js(t,s)},Ps=async()=>{try{let t=0;for(const s of p){if(!s.store){r.error("Bitte Laden für alle Gruppen angeben");return}for(const a of s.items){if(!a.name.trim()){r.error("Bitte Artikelname für alle Artikel eingeben");return}await Me({listId:C||void 0,item:a.name.trim(),quantity:parseInt(a.quantity)||1,category:a.category,estimatedPrice:parseFloat(a.price||"0")*100,currency:"CHF",store:s.store,articleNumber:a.articleNumber||null,productInfo:a.productInfo||null,saveToDatabase:a.saveToDatabase||!1}),t++}}r.success(`${t} Artikel hinzugefügt`),y(),ke(!1),M([]),await O()}catch(t){r.error("Fehler: "+b(t)),f()}},Bt=async()=>{if(!V.trim()){r.error("Bitte Listenname eingeben");return}try{const t=await Zs(V.trim(),k.length===0);r.success("Liste erstellt"),y(),ve(!1),_(""),Ne(t.id)}catch(t){r.error("Fehler: "+b(t)),f()}},Is=async t=>{if(k.length<=1){r.error("Mindestens eine Liste muss vorhanden sein");return}try{if(await Js(t),r.success("Liste gelöscht"),y(),C===t){const s=k.find(a=>a.id!==t);Ne(s?.id||null)}}catch(s){r.error("Fehler: "+b(s)),f()}},Ls=async(t,s,a)=>{try{await Xs(t,{name:s,isDefault:a}),r.success("Liste aktualisiert"),y(),He(null)}catch(n){r.error("Fehler: "+b(n)),f()}},Rt=async(t,s)=>{try{(s==="bought"?"not_bought":"bought")==="bought"?await ea(t):await ta(t,{status:"not_bought"}),sa(),await O()}catch(a){r.error(b(a)),f()}},Fs=async t=>{try{await Yt(t),y(),await O()}catch(s){r.error(b(s)),f()}},As=async()=>{try{for(const t of Ie)await Yt(t.id);r.success("Eingekaufte Artikel gelöscht"),y(),await O()}catch(t){r.error(b(t)),f()}},[xa,re]=l("idle"),[fa,$t]=l(0),D=z(null),[ga,Ds]=l({topLeft:{x:10,y:15},topRight:{x:90,y:15},bottomLeft:{x:10,y:75},bottomRight:{x:90,y:75}}),[pa,ba]=l(null),[ja,Na]=l(!1),le=async()=>{try{if(!navigator.mediaDevices||!navigator.mediaDevices.getUserMedia){r.error("Kamera wird nicht unterstützt"),W("upload");return}d&&(d.getTracks().forEach(a=>{a.stop()}),ae(null),await new Promise(a=>setTimeout(a,100))),h.current&&(h.current.srcObject=null);let t=null,s={video:{facingMode:"environment",width:{ideal:3840},height:{ideal:2160},aspectRatio:{ideal:16/9}},audio:!1};try{t=await navigator.mediaDevices.getUserMedia(s)}catch{s={video:{facingMode:"environment",width:{ideal:1920},height:{ideal:1080}},audio:!1};try{t=await navigator.mediaDevices.getUserMedia(s)}catch{t=await navigator.mediaDevices.getUserMedia({video:{facingMode:"environment"},audio:!1})}}if(!t||t.getVideoTracks().length===0)throw new Error("Kein Kamera-Stream erhalten");if(ae(t),re("scanning"),await new Promise(a=>setTimeout(a,50)),h.current){const a=h.current;a.srcObject=t,await new Promise((n,o)=>{const i=setTimeout(()=>{o(new Error("Video-Timeout"))},5e3),m=()=>{clearTimeout(i),a.removeEventListener("loadedmetadata",m),a.removeEventListener("error",F),n()},F=it=>{clearTimeout(i),a.removeEventListener("loadedmetadata",m),a.removeEventListener("error",F),o(new Error("Video-Fehler"))};if(a.readyState>=2){clearTimeout(i),n();return}a.addEventListener("loadedmetadata",m,{once:!0}),a.addEventListener("error",F,{once:!0})});try{await a.play(),r.success("Kamera aktiv"),qt()}catch{r.success("Kamera aktiv"),qt()}}}catch(t){d&&(d.getTracks().forEach(n=>n.stop()),ae(null)),h.current&&(h.current.srcObject=null);const s=t;let a="Kamera-Fehler";s.name==="NotAllowedError"||s.name==="PermissionDeniedError"?a="Kamera-Berechtigung verweigert. Bitte in den Browser-Einstellungen erlauben.":s.name==="NotFoundError"||s.name==="DevicesNotFoundError"?a="Keine Kamera gefunden":s.name==="NotReadableError"||s.name==="TrackStartError"?a="Kamera wird bereits verwendet":s.name==="OverconstrainedError"||s.name==="ConstraintNotSatisfiedError"?a="Kamera-Unterstützung nicht verfügbar":s.message==="Video-Timeout"?a="Kamera-Initialisierung zu langsam":a=`Kamera-Fehler: ${s.message||s.name}`,r.error(a),W("upload"),re("idle")}},at=()=>{D.current&&(cancelAnimationFrame(D.current),D.current=null),d&&(d.getTracks().forEach(t=>t.stop()),ae(null)),re("idle"),$t(0)},qt=()=>{Ds({topLeft:{x:15,y:10},topRight:{x:85,y:10},bottomLeft:{x:15,y:85},bottomRight:{x:85,y:85}}),re("scanning"),$t(0)},Es=()=>{if(!h.current||!Z.current)return;D.current&&(cancelAnimationFrame(D.current),D.current=null),re("capturing");const t=h.current,s=Z.current;s.width=t.videoWidth,s.height=t.videoHeight;const a=s.getContext("2d");a&&(a.imageSmoothingEnabled=!1,a.drawImage(t,0,0),r.success("Foto aufgenommen!"),s.toBlob(async n=>{if(n){at();const o=new File([n],"photo.jpg",{type:"image/jpeg"});await Kt(o)}},"image/jpeg",1))};be(()=>()=>{!d&&h.current&&h.current.srcObject&&(h.current.srcObject.getTracks().forEach(s=>s.stop()),h.current.srcObject=null)},[d]),be(()=>()=>{D.current&&(cancelAnimationFrame(D.current),D.current=null),d&&(d.getTracks().forEach(t=>t.stop()),ae(null)),h.current&&(h.current.srcObject=null)},[]);const zs=async t=>{const s=t.target.files?.[0];s&&await Kt(s)},Kt=async t=>{U(!0),Y([]),Ue(null);try{const s=new FileReader;s.onload=async()=>{try{const a=s.result.split(",")[1];r.info("Analysiere mit OCR...");const i=(await je(pe,"analyzeReceipt")({fileData:a,fileType:t.type||"image/jpeg",fileName:t.name||"photo.jpg"})).data;i.success&&i.items&&i.items.length>0?(Ue({store:i.store||{name:"Unbekannt"},purchase:i.purchase||{},items:i.items,totals:i.totals||{total:0},confidence:i.confidence||50}),Y(i.items.map(m=>({...m,selected:!0}))),r.success(`${i.items.length} Artikel erkannt!`)):i.error?.includes("Vision API")||i.error?.includes("PERMISSION_DENIED")?r.error("OCR nicht verfügbar. Google Cloud Vision API muss aktiviert werden.",{duration:5e3}):i.error?.includes("billing")?r.error("Google Cloud Billing erforderlich",{duration:5e3}):i.rawText?r.error("Text erkannt aber keine Artikel gefunden. Versuche bessere Bildqualität.",{duration:4e3}):r.error(i.error||"Keine Artikel erkannt. Bitte bessere Bildqualität verwenden.",{duration:4e3})}catch(a){r.error(b(a)),f()}U(!1)},s.onerror=()=>{r.error("Datei konnte nicht gelesen werden"),f(),U(!1)},s.readAsDataURL(t)}catch(s){r.error(b(s)),f(),U(!1)}},[nt,ie]=l(null),[w,Ht]=l(!1),[Le,Fe]=l(null),[Ts,Ms]=l(0),[rt,ce]=l(new Set),[wa,Bs]=l([]),lt=async()=>{if(!h.current||!Z.current||j)return;const t=Date.now();if(t-Ts<1500)return;Ms(t),U(!0),ie(null);const s=h.current,a=Z.current,n=s.videoWidth||1920,o=s.videoHeight||1080,i=Math.max(n,1920),m=Math.max(o,1080);a.width=i,a.height=m;const F=a.getContext("2d",{willReadFrequently:!0,alpha:!1});F&&(F.drawImage(s,0,0,n,o,0,0,i,m),a.toBlob(async it=>{if(it)try{const Ae=new FileReader;Ae.onload=async()=>{const Vs=Ae.result.split(",")[1];try{const de=(await je(pe,"analyzeReceipt")({fileData:Vs,fileType:"image/jpeg",fileName:"live-scan-full.jpg"})).data;if(de.success&&de.items&&de.items.length>0){const ct=(de.rawText||"").split(/[\n\r]+/),De=de.items.map((x,E)=>{const Ee=(x.name||"Unbekannt").toLowerCase().trim(),me=(x.unitPrice||x.totalPrice||0).toFixed(2),G=x.articleNumber||"";let ue=-1;for(let A=0;A<ct.length;A++)if(ct[A].includes(x.name||"")||G&&ct[A].includes(G)){ue=A;break}const v=`${Ee}_${me}_${G}_${ue>=0?ue:E}_${E}`;return{item:{name:x.name||"Unbekannt",articleNumber:x.articleNumber,quantity:x.quantity||1,unitPrice:x.unitPrice||x.totalPrice||0,totalPrice:x.totalPrice||x.unitPrice*(x.quantity||1),selected:!0},positionId:v}}).filter(({positionId:x})=>!rt.has(x));if(De.length>0){const x=new Set(rt);De.forEach(({positionId:E})=>{x.add(E)}),ce(x),B(E=>{const Ee=new Set(E.map(v=>{const A=v.name.toLowerCase().trim(),ze=v.unitPrice.toFixed(2),ot=v.articleNumber||"";return`${A}_${ze}_${ot}`})),me=[...E];let G=0;De.forEach(({item:v,positionId:A})=>{const ze=v.name.toLowerCase().trim(),ot=v.unitPrice.toFixed(2),dt=v.articleNumber||"",Wt=`${ze}_${ot}_${dt}`;Ee.has(Wt)||dt&&E.some(Te=>Te.articleNumber===dt)||E.some(Te=>Te.name.toLowerCase().trim()===ze&&Math.abs(Te.unitPrice-v.unitPrice)<.01)||(me.push(v),G++,Ee.add(Wt))});const ue=me.reduce((v,A)=>v+A.totalPrice,0);return R(ue),G>0?(r.success(`${G} neue Artikel erkannt!`,{duration:1500}),navigator.vibrate&&navigator.vibrate(200)):De.length>0&&(w||r.info("Alle Artikel bereits in Liste",{duration:1e3})),me})}else w||r.info("Alle Artikel bereits erkannt",{duration:1e3})}else w||ie("Keine Artikel erkannt")}catch(Vt){if(!w){const _t=b(Vt);ie(_t)}f()}U(!1)},Ae.readAsDataURL(it)}catch{f(),U(!1)}},"image/jpeg",.95))};be(()=>{if(w&&d&&Q==="single"){const t=setTimeout(()=>{!j&&d&&lt()},500),s=setInterval(()=>{!j&&d&&lt()},2e3);return Fe(s),()=>{clearInterval(s),clearTimeout(t),Fe(null)}}else Le&&(clearInterval(Le),Fe(null))},[w,d,Q,j]);const Rs=async()=>{await lt()},$s=()=>{if(!I)return;const t={...I,quantity:te,totalPrice:I.unitPrice*te};B(s=>[...s,t]),R(s=>s+t.totalPrice),Se(null),se(1),r.success(`${t.name} (${te}x) hinzugefügt`),y()},qs=()=>{Se(null),se(1)},Ot=t=>{B(s=>{const a=s[t];return R(n=>n-a.totalPrice),s.filter((n,o)=>o!==t)})},Ut=(t,s)=>{if(s<1){Ot(t);return}B(a=>{const n=[...a],o=n[t],i=o.totalPrice;return n[t]={...o,quantity:s,totalPrice:o.unitPrice*s},R(m=>m-i+n[t].totalPrice),n})},Ks=async()=>{if(P.length===0){r.error("Keine Artikel gescannt");return}try{for(const t of P)await Me({listId:C||void 0,item:t.name,quantity:t.quantity||1,category:Gt(t.name),estimatedPrice:(t.totalPrice||t.unitPrice||0)*100,currency:"CHF",store:c?.store?.name||null});r.success(`${P.length} Artikel hinzugefügt!`),B([]),R(0),oe(),await O()}catch(t){r.error("Fehler: "+t.message)}},Hs=async()=>{const t=S.filter(s=>s.selected);if(t.length===0){r.error("Bitte mindestens einen Artikel auswählen");return}try{for(const s of t)await Me({listId:C||void 0,item:s.name,quantity:s.quantity||1,category:Gt(s.name),estimatedPrice:(s.totalPrice||s.unitPrice||0)*100,currency:"CHF",store:c?.store?.name||null});r.success(`${t.length} Artikel hinzugefügt!`),oe(),await O()}catch(s){r.error("Fehler: "+s.message)}},Os=async()=>{if(c)try{await je(pe,"saveReceipt")({receiptData:c}),r.success("Quittung gespeichert!")}catch(t){r.error("Fehler: "+t.message)}},Us=async()=>{if(c)try{await aa({type:"ausgabe",amount:c.totals.total*100,category:"Lebensmittel",notes:`Einkauf bei ${c.store.name}`,date:c.purchase.date||new Date().toISOString().split("T")[0],paymentMethod:c.purchase.paymentMethod||"Karte",currency:"CHF",isRecurring:!1}),r.success("Zu Finanzen hinzugefügt!"),y(),oe()}catch(t){r.error(b(t)),f()}},Gt=t=>{const s=t.toLowerCase(),a={Getränke:["bier","wein","saft","wasser","cola","fanta","sprite","energy","shot","drink"],"Obst & Gemüse":["apfel","orange","banane","tomate","salat","gurke","karotte","bio oran","gemüse"],Milchprodukte:["milch","joghurt","käse","butter","sahne","quark","naturejog"],Fleisch:["fleisch","steak","wurst","schinken","poulet","rind","schwein","ragout"],Backwaren:["brot","brötchen","toast","croissant","kuchen","keks","butterkeks"],Süsswaren:["schoko","bonbon","gummi","chips","zucker","gelatine"]};for(const[n,o]of Object.entries(a))if(o.some(i=>s.includes(i)))return n;return"Lebensmittel"},Gs=()=>{kt(!0),Y([]),W("camera"),setTimeout(()=>le(),100)},oe=()=>{at(),kt(!1),Y([]),Ue(null),B([]),R(0),Ce("receipt"),Se(null),se(1),ie(null),Ht(!1),ce(new Set),Bs([]),Le&&(clearInterval(Le),Fe(null))};return e.jsxs(na,{title:H("nav.shopping","Einkaufsliste"),showSidebar:!0,children:[e.jsxs("div",{className:"mb-4 flex items-center gap-2",children:[e.jsxs(he,{value:C||"",onValueChange:t=>Ne(t),disabled:es,children:[e.jsx(xe,{className:"flex-1 h-11",children:e.jsx(fe,{placeholder:"Liste wählen"})}),e.jsx(ge,{children:k.map(t=>e.jsxs(g,{value:t.id,children:[t.name," ",t.isDefault&&"(Standard)"]},t.id))})]}),e.jsx(u,{variant:"outline",size:"icon",onClick:()=>we(!0),className:"h-11 w-11",children:e.jsx(pt,{className:"w-5 h-5"})})]}),e.jsxs("div",{className:"mobile-card mb-4 bg-primary text-primary-foreground",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-3",children:[e.jsx(bt,{className:"w-6 h-6 opacity-70"}),e.jsx("p",{className:"text-sm opacity-70 font-medium",children:k.find(t=>t.id===C)?.name||H("shopping.list","Einkaufsliste")})]}),e.jsx("p",{className:"text-3xl font-semibold mb-2",children:st.length}),e.jsx("p",{className:"text-sm opacity-60",children:H("shopping.itemsOpen","Artikel offen")})]}),ns?e.jsx("div",{className:"text-center py-8 text-muted-foreground",children:H("common.loading","Laden...")}):st.length===0?e.jsxs("div",{className:"mobile-card text-center py-8",children:[e.jsx(J,{className:"w-10 h-10 mx-auto status-success mb-2"}),e.jsx("p",{className:"text-muted-foreground",children:H("shopping.empty","Liste ist leer")})]}):e.jsx("div",{className:"space-y-3 mb-4",children:st.map(t=>e.jsxs("div",{className:"mobile-card flex items-center gap-4 py-3",children:[e.jsx("button",{onClick:()=>Rt(t.id,t.status),className:"w-6 h-6 rounded border-2 border-border flex items-center justify-center shrink-0"}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("p",{className:"font-medium truncate",children:t.item}),e.jsxs("p",{className:"text-xs text-muted-foreground",children:[t.quantity>1&&`${t.quantity}x • `,t.category,t.store&&` • ${t.store}`]})]}),e.jsx("button",{onClick:()=>Fs(t.id),className:"w-10 h-10 rounded-lg flex items-center justify-center text-muted-foreground active:opacity-80",children:e.jsx(Be,{className:"w-4 h-4"})})]},t.id))}),Ie.length>0&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsxs("p",{className:"text-xs font-medium text-muted-foreground uppercase tracking-wider",children:[H("shopping.bought","Eingekauft")," (",Ie.length,")"]}),e.jsx("button",{onClick:As,className:"text-xs status-error active:opacity-80",children:H("shopping.clearBought","Löschen")})]}),e.jsx("div",{className:"space-y-3 opacity-60",children:Ie.map(t=>e.jsxs("div",{className:"mobile-card flex items-center gap-4 py-3",children:[e.jsx("button",{onClick:()=>Rt(t.id,t.status),className:"w-6 h-6 rounded bg-status-success flex items-center justify-center shrink-0",children:e.jsx(J,{className:"w-4 h-4 status-success"})}),e.jsx("p",{className:"font-medium line-through flex-1 truncate",children:t.item})]},t.id))})]}),wt&&e.jsx("div",{className:"fixed inset-0 z-50 bg-black/50 flex items-end",children:e.jsxs("div",{className:"bg-background w-full rounded-t-2xl p-6 safe-bottom animate-in slide-in-from-bottom",children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsx("h2",{className:"text-lg font-semibold",children:"Artikel hinzufügen"}),e.jsx("button",{onClick:()=>Oe(!1),className:"w-10 h-10 rounded-lg bg-muted flex items-center justify-center",children:e.jsx(T,{className:"w-5 h-5"})})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsx("div",{children:e.jsx(K,{value:N.name,onChange:t=>X({...N,name:t.target.value}),placeholder:"Artikelname",className:"mobile-input",autoFocus:!0})}),e.jsxs("div",{className:"flex gap-3",children:[e.jsx("div",{className:"w-20",children:e.jsx(K,{type:"number",value:N.quantity,onChange:t=>X({...N,quantity:t.target.value}),placeholder:"1",className:"mobile-input text-center",min:"1"})}),e.jsx("div",{className:"flex-1",children:e.jsxs(he,{value:N.category,onValueChange:t=>X({...N,category:t}),children:[e.jsx(xe,{className:"mobile-input",children:e.jsx(fe,{})}),e.jsx(ge,{children:Xt.map(t=>e.jsx(g,{value:t,children:t},t))})]})})]}),e.jsx("div",{children:e.jsxs(he,{value:N.store||"none",onValueChange:t=>X({...N,store:t==="none"?"":t}),children:[e.jsx(xe,{className:"mobile-input",children:e.jsx(fe,{placeholder:"Laden (optional)"})}),e.jsxs(ge,{children:[e.jsx(g,{value:"none",children:"Kein Laden"}),e.jsx(g,{value:"Migros",children:"Migros"}),e.jsx(g,{value:"Coop",children:"Coop"}),e.jsx(g,{value:"Aldi",children:"Aldi"}),e.jsx(g,{value:"Lidl",children:"Lidl"}),e.jsx(g,{value:"Denner",children:"Denner"})]})]})}),e.jsx(u,{onClick:os,className:"w-full mobile-btn bg-primary text-primary-foreground mt-4",children:"Hinzufügen"})]})]})}),e.jsx(mt,{open:vt,onOpenChange:ke,children:e.jsxs(ut,{className:"!fixed !top-[50%] !left-[50%] !right-auto !bottom-auto !translate-x-[-50%] !translate-y-[-50%] !w-[90vw] !max-w-2xl !max-h-[90vh] !rounded-3xl !m-0 !overflow-hidden !shadow-2xl !flex !flex-col",children:[e.jsxs(ht,{className:"px-5 pt-5 pb-3 flex-shrink-0",children:[e.jsx(xt,{className:"text-lg font-semibold",children:"Mehrere Artikel hinzufügen"}),e.jsx(ft,{className:"sr-only",children:"Fügen Sie mehrere Artikel gruppiert nach Laden hinzu"})]}),e.jsxs("div",{className:"px-5 pb-2 overflow-y-auto flex-1 min-h-0 space-y-4",children:[p.length===0&&e.jsxs("div",{className:"text-center py-8 text-muted-foreground",children:[e.jsx(Re,{className:"w-12 h-12 mx-auto mb-3 opacity-50"}),e.jsx("p",{children:"Keine Laden-Gruppen vorhanden"}),e.jsx("p",{className:"text-sm mt-1",children:'Klicken Sie auf "Laden hinzufügen" um zu beginnen'})]}),p.map((t,s)=>e.jsxs("div",{className:"border rounded-xl p-4 space-y-3 bg-muted/30",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Re,{className:"w-4 h-4 text-muted-foreground"}),e.jsxs(he,{value:t.store||"none",onValueChange:a=>us(s,a==="none"?"":a),children:[e.jsx(xe,{className:"flex-1 h-9",children:e.jsx(fe,{placeholder:"Laden wählen"})}),e.jsxs(ge,{children:[e.jsx(g,{value:"none",children:"Laden wählen"}),e.jsx(g,{value:"Migros",children:"Migros"}),e.jsx(g,{value:"Coop",children:"Coop"}),e.jsx(g,{value:"Aldi",children:"Aldi"}),e.jsx(g,{value:"Lidl",children:"Lidl"}),e.jsx(g,{value:"Denner",children:"Denner"}),e.jsx(g,{value:"Volg",children:"Volg"}),e.jsx(g,{value:"Spar",children:"Spar"})]})]}),e.jsx(u,{variant:"ghost",size:"sm",onClick:()=>ms(s),className:"h-9 w-9 p-0",children:e.jsx(T,{className:"w-4 h-4"})})]}),e.jsxs("div",{className:"space-y-2",children:[t.items.map(a=>e.jsx("div",{className:"bg-background rounded-lg p-3 space-y-2 border",children:e.jsxs("div",{className:"flex items-start gap-2",children:[e.jsxs("div",{className:"flex-1 space-y-2",children:[e.jsxs("div",{className:"flex gap-2",children:[e.jsx(K,{placeholder:"Artikelname *",value:a.name,onChange:n=>L(s,a.id,"name",n.target.value),className:"flex-1 h-9"}),e.jsx(K,{type:"number",placeholder:"Menge",value:a.quantity,onChange:n=>L(s,a.id,"quantity",n.target.value),className:"w-20 h-9",min:"1"})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(he,{value:a.category,onValueChange:n=>L(s,a.id,"category",n),children:[e.jsx(xe,{className:"flex-1 h-9",children:e.jsx(fe,{})}),e.jsx(ge,{children:Xt.map(n=>e.jsx(g,{value:n,children:n},n))})]}),e.jsx(K,{type:"number",step:"0.01",placeholder:"Preis (CHF)",value:a.price,onChange:n=>L(s,a.id,"price",n.target.value),className:"w-24 h-9"})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(K,{placeholder:"Artikelnummer (EAN/Barcode)",value:a.articleNumber,onChange:n=>L(s,a.id,"articleNumber",n.target.value),className:"flex-1 h-9"}),e.jsx(u,{variant:"outline",size:"sm",onClick:()=>Cs(s,a.id),className:"h-9",title:"Barcode scannen",children:e.jsx(ra,{className:"w-4 h-4"})}),e.jsx(u,{variant:"outline",size:"sm",onClick:()=>Ss(s,a.id),className:"h-9",title:"Produktinfo scannen",children:e.jsx($e,{className:"w-4 h-4"})})]}),a.productInfo&&e.jsxs("div",{className:"bg-muted/50 rounded p-2 text-xs space-y-1",children:[a.productInfo.brand&&e.jsxs("p",{children:[e.jsx("strong",{children:"Marke:"})," ",a.productInfo.brand]}),a.productInfo.description&&e.jsxs("p",{children:[e.jsx("strong",{children:"Beschreibung:"})," ",a.productInfo.description]}),a.productInfo.price&&e.jsxs("p",{children:[e.jsx("strong",{children:"Preis:"})," CHF ",a.productInfo.price]}),a.productInfo.imageUrl&&e.jsx("img",{src:a.productInfo.imageUrl,alt:"Produkt",className:"w-full h-24 object-contain mt-2 rounded"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Ys,{checked:a.saveToDatabase||!1,onCheckedChange:n=>L(s,a.id,"saveToDatabase",n)}),e.jsx(Qt,{className:"text-xs",children:"Für zukünftige Käufe speichern"})]})]}),e.jsx(u,{variant:"ghost",size:"sm",onClick:()=>xs(s,a.id),className:"h-9 w-9 p-0",children:e.jsx(Be,{className:"w-4 h-4"})})]})},a.id)),e.jsxs(u,{variant:"outline",size:"sm",onClick:()=>hs(s),className:"w-full h-9",children:[e.jsx(qe,{className:"w-4 h-4 mr-2"}),"Artikel hinzufügen"]})]})]},s)),e.jsxs(u,{variant:"outline",onClick:ds,className:"w-full",children:[e.jsx(Re,{className:"w-4 h-4 mr-2"}),"Laden hinzufügen"]})]}),e.jsxs(gt,{className:"px-5 pb-3 pt-2 gap-2.5 flex-shrink-0",children:[e.jsx(u,{variant:"outline",onClick:()=>{ke(!1),M([])},className:"h-11 min-h-[44px] flex-1 rounded-xl text-sm font-medium",children:"Abbrechen"}),e.jsxs(u,{onClick:Ps,disabled:p.length===0||p.every(t=>t.items.length===0),className:"h-11 min-h-[44px] flex-1 rounded-xl text-sm font-medium",children:[p.reduce((t,s)=>t+s.items.length,0)," Artikel hinzufügen"]})]})]})}),yt&&e.jsxs("div",{className:"fixed inset-0 z-50 bg-black flex flex-col",children:[e.jsxs("div",{className:"flex items-center justify-between p-4 bg-black/50",children:[e.jsx("h2",{className:"text-white font-semibold",children:"Liste scannen"}),e.jsx("button",{onClick:oe,className:"w-10 h-10 rounded-lg bg-white/20 flex items-center justify-center",children:e.jsx(T,{className:"w-5 h-5 text-white"})})]}),e.jsxs("div",{className:"flex gap-2 px-4 py-2",children:[e.jsxs("button",{onClick:()=>{Ce("receipt"),W("camera"),le()},className:`flex-1 py-2 px-3 rounded-lg flex items-center justify-center gap-1.5 text-sm ${Q==="receipt"&&ee==="camera"?"bg-white text-black":"bg-white/20 text-white"}`,children:[e.jsx(la,{className:"w-4 h-4"}),"Quittung"]}),e.jsxs("button",{onClick:async()=>{Ce("single"),W("camera"),B([]),R(0),ce(new Set),Se(null),ie(null),await le()},className:`flex-1 py-2 px-3 rounded-lg flex items-center justify-center gap-1.5 text-sm ${Q==="single"?"bg-white text-black":"bg-white/20 text-white"}`,children:[e.jsx(Ke,{className:"w-4 h-4"}),"Einzeln"]}),e.jsxs("button",{onClick:()=>{Ce("receipt"),W("upload"),at()},className:`flex-1 py-2 px-3 rounded-lg flex items-center justify-center gap-1.5 text-sm ${ee==="upload"?"bg-white text-black":"bg-white/20 text-white"}`,children:[e.jsx(ia,{className:"w-4 h-4"}),"Upload"]})]}),ee==="camera"&&Q==="receipt"&&S.length===0&&e.jsxs("div",{className:"flex-1 relative",children:[e.jsx("video",{ref:h,autoPlay:!0,playsInline:!0,muted:!0,preload:"auto",className:"absolute inset-0 w-full h-full object-cover"}),e.jsx("canvas",{ref:Z,className:"hidden"}),d&&e.jsxs("div",{className:"absolute inset-0 pointer-events-none",children:[e.jsx("div",{className:"absolute inset-8 border-2 border-white/60 rounded-lg"}),e.jsx("div",{className:"absolute top-8 left-8 w-6 h-6 border-t-4 border-l-4 border-white rounded-tl"}),e.jsx("div",{className:"absolute top-8 right-8 w-6 h-6 border-t-4 border-r-4 border-white rounded-tr"}),e.jsx("div",{className:"absolute bottom-8 left-8 w-6 h-6 border-b-4 border-l-4 border-white rounded-bl"}),e.jsx("div",{className:"absolute bottom-8 right-8 w-6 h-6 border-b-4 border-r-4 border-white rounded-br"})]}),e.jsx("div",{className:"absolute top-4 left-4 right-4 z-20",children:e.jsx("div",{className:"bg-black/60 rounded-lg p-3 text-center",children:e.jsx("p",{className:"text-white text-sm font-medium",children:j?"Analysiere...":"Quittung fotografieren"})})}),e.jsx("div",{className:"absolute bottom-8 left-0 right-0 z-20",children:d?e.jsxs("div",{className:"flex justify-center items-center gap-4",children:[e.jsx("button",{onClick:oe,className:"w-12 h-12 rounded-full bg-white/20 flex items-center justify-center active:opacity-80",children:e.jsx(T,{className:"w-6 h-6 text-white"})}),e.jsx("button",{onClick:Es,disabled:j,className:"w-20 h-20 rounded-full bg-white shadow-lg flex items-center justify-center active:opacity-80 border-4 border-white/50",children:j?e.jsx("div",{className:"w-8 h-8 border-3 border-gray-300 border-t-gray-600 rounded-full animate-spin"}):e.jsx("div",{className:"w-14 h-14 rounded-full bg-white"})}),e.jsx("div",{className:"w-12 h-12"})]}):e.jsx("div",{className:"flex justify-center",children:e.jsxs("button",{onClick:le,className:"px-6 py-3 rounded-full bg-white shadow-lg flex items-center justify-center gap-2 active:opacity-80",children:[e.jsx($e,{className:"w-5 h-5 text-gray-800"}),e.jsx("span",{className:"font-medium text-gray-800",children:"Kamera starten"})]})})})]}),ee==="camera"&&Q==="single"&&e.jsxs("div",{className:"flex-1 flex flex-col bg-background w-full h-full overflow-hidden",children:[e.jsx("div",{className:"w-full px-4 py-3 bg-background/95 backdrop-blur-sm border-b border-border/50 flex-shrink-0",children:e.jsxs("div",{className:"flex items-center justify-between gap-3",children:[e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[e.jsx("div",{className:`w-2 h-2 rounded-full ${d?"bg-green-500 animate-pulse":"bg-gray-400"}`}),e.jsx("p",{className:"text-xs font-medium text-muted-foreground",children:d?"Kamera aktiv":"Kamera inaktiv"})]}),e.jsx("p",{className:"text-sm font-bold truncate",children:j?"Analysiere...":w?`${rt.size} Positionen erkannt`:P.length>0?`${P.length} Artikel gescannt`:"Bereit zum Scannen"})]}),e.jsxs("button",{onClick:()=>Ht(!w),disabled:!d,className:`px-3 py-2 rounded-lg flex items-center gap-1.5 flex-shrink-0 transition-all ${w&&d?"bg-green-500 text-white shadow-lg":"bg-muted text-muted-foreground"} ${d?"":"opacity-50"}`,children:[e.jsx("div",{className:`w-2 h-2 rounded-full ${w&&d?"bg-white":"bg-foreground/50"}`}),e.jsx("span",{className:"text-xs font-semibold",children:"Auto"})]})]})}),e.jsxs("div",{className:"flex-1 flex flex-col w-full overflow-hidden min-h-0 relative",children:[e.jsxs("div",{className:"relative bg-black w-full flex-1 flex-shrink-0 min-h-0",children:[e.jsx("video",{ref:h,autoPlay:!0,playsInline:!0,muted:!0,preload:"auto",className:"absolute inset-0 w-full h-full object-cover",style:{minWidth:"100%",minHeight:"100%"}}),e.jsx("canvas",{ref:Z,className:"hidden"}),d&&w&&e.jsxs("div",{className:"absolute inset-0 pointer-events-none",children:[j&&e.jsx("div",{className:"absolute left-0 right-0 h-1 bg-green-500/50",style:{top:"50%",animation:"scan-line 1.5s ease-in-out infinite",boxShadow:"0 0 20px rgba(16, 185, 129, 0.6)",transform:"translateY(-50%)"}}),e.jsx("div",{className:"absolute top-4 left-1/2 transform -translate-x-1/2 z-10",children:e.jsxs("div",{className:"bg-green-500/90 backdrop-blur-sm text-white px-4 py-2 rounded-full text-xs font-semibold flex items-center gap-2 shadow-lg",children:[e.jsx("div",{className:"w-2 h-2 bg-white rounded-full animate-pulse"}),j?"Analysiere...":`Live-Scan (${P.length} Artikel)`]})})]}),d&&!w&&e.jsx("div",{className:"absolute top-4 left-1/2 transform -translate-x-1/2 z-10",children:e.jsx("div",{className:"bg-black/60 backdrop-blur-sm text-white px-4 py-2 rounded-full text-xs font-medium",children:"Quittung vollständig sichtbar machen"})}),d&&!I&&e.jsx("div",{className:"absolute bottom-0 left-0 right-0 z-20 p-4 bg-gradient-to-t from-black/80 via-black/40 to-transparent",children:e.jsx("button",{onClick:Rs,disabled:j,className:`w-full py-4 rounded-xl shadow-2xl flex items-center justify-center gap-3 transition-all transform ${j?"bg-gray-600/90":"bg-green-500 hover:bg-green-600 active:scale-95"}`,children:j?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"w-6 h-6 border-2 border-white/30 border-t-white rounded-full animate-spin"}),e.jsx("span",{className:"font-bold text-white text-lg",children:"Analysiere..."})]}):e.jsxs(e.Fragment,{children:[e.jsx(Ke,{className:"w-6 h-6 text-white"}),e.jsx("span",{className:"font-bold text-white text-lg",children:"ALLE SCANNEN"})]})})}),!d&&e.jsxs("div",{className:"absolute inset-0 flex flex-col items-center justify-center bg-gradient-to-b from-black/90 to-black/70",children:[e.jsxs("div",{className:"text-center mb-8",children:[e.jsx("div",{className:"w-20 h-20 mx-auto mb-4 rounded-full bg-white/10 backdrop-blur-sm flex items-center justify-center",children:e.jsx($e,{className:"w-10 h-10 text-white"})}),e.jsx("p",{className:"text-white text-lg font-semibold mb-2",children:"Kamera starten"}),e.jsx("p",{className:"text-white/70 text-sm",children:"Für das Scannen von Quittungen"})]}),e.jsxs("button",{onClick:le,className:"px-8 py-4 rounded-xl bg-white shadow-2xl flex items-center justify-center gap-3 hover:bg-gray-50 active:scale-95 transition-all",children:[e.jsx($e,{className:"w-6 h-6 text-gray-800"}),e.jsx("span",{className:"font-bold text-gray-800 text-base",children:"Kamera aktivieren"})]})]})]}),e.jsxs("div",{className:"flex-1 overflow-y-auto bg-background w-full p-4 min-h-0",children:[nt&&!I&&e.jsxs("div",{className:"mb-4 p-4 bg-red-500/10 border border-red-500/30 rounded-xl backdrop-blur-sm",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx("div",{className:"w-2 h-2 rounded-full bg-red-500"}),e.jsx("p",{className:"text-red-600 font-semibold text-sm",children:"Fehler"})]}),e.jsx("p",{className:"text-red-600 font-medium text-center text-sm",children:nt}),e.jsx("p",{className:"text-red-500/70 text-xs text-center mt-1",children:"Quittung näher halten und erneut scannen"})]}),I&&e.jsxs("div",{className:"mb-4 p-5 bg-green-500/10 border border-green-500/40 rounded-xl backdrop-blur-sm",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-3",children:[e.jsx("div",{className:"w-2 h-2 rounded-full bg-green-500 animate-pulse"}),e.jsx("p",{className:"text-green-600 font-bold text-sm",children:"ERKANNT"})]}),e.jsxs("div",{className:"bg-background/80 backdrop-blur-sm rounded-lg p-4 mb-4 border border-border/50",children:[e.jsx("p",{className:"font-bold text-base mb-1",children:I.name}),e.jsxs("p",{className:"text-xs text-muted-foreground",children:["CHF ",I.unitPrice.toFixed(2)," pro Stück"]})]}),e.jsxs("div",{className:"flex items-center justify-center gap-4 mb-4",children:[e.jsx("button",{onClick:()=>se(t=>Math.max(1,t-1)),className:"w-11 h-11 rounded-full bg-muted flex items-center justify-center text-xl font-bold active:scale-95 transition-transform",children:"−"}),e.jsx("div",{className:"w-16 h-11 rounded-lg bg-background border border-border flex items-center justify-center",children:e.jsx("span",{className:"text-2xl font-bold",children:te})}),e.jsx("button",{onClick:()=>se(t=>t+1),className:"w-11 h-11 rounded-full bg-muted flex items-center justify-center text-xl font-bold active:scale-95 transition-transform",children:"+"})]}),e.jsxs("div",{className:"text-center mb-4 p-3 bg-background/50 rounded-lg border border-border/50",children:[e.jsx("p",{className:"text-xs text-muted-foreground mb-1",children:"Total"}),e.jsxs("p",{className:"text-xl font-bold",children:["CHF ",(I.unitPrice*te).toFixed(2)]})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs("button",{onClick:qs,className:"flex-1 py-3 rounded-lg bg-muted flex items-center justify-center gap-2 text-sm font-semibold active:scale-95 transition-transform",children:[e.jsx(T,{className:"w-4 h-4"}),"Abbrechen"]}),e.jsxs("button",{onClick:$s,className:"flex-1 py-3 rounded-lg bg-green-500 text-white flex items-center justify-center gap-2 text-sm font-semibold shadow-lg active:scale-95 transition-transform",children:[e.jsx(J,{className:"w-4 h-4"}),"Hinzufügen"]})]})]}),!I&&P.length===0&&!nt&&e.jsxs("div",{className:"text-center py-8",children:[e.jsx("div",{className:"w-16 h-16 mx-auto mb-4 rounded-full bg-muted/50 flex items-center justify-center",children:e.jsx(Ke,{className:"w-8 h-8 text-muted-foreground/40"})}),e.jsx("p",{className:"text-base font-bold text-foreground mb-2",children:"Artikel scannen"}),e.jsx("p",{className:"text-xs text-muted-foreground/70 px-4",children:w?e.jsx(e.Fragment,{children:"Auto-Scan aktiv: Quittung in den Rahmen halten"}):e.jsx(e.Fragment,{children:'Quittung in den Rahmen halten und "ALLE SCANNEN" drücken'})})]}),P.length>0&&e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center justify-between mb-3 p-3 bg-green-500/10 rounded-xl border border-green-500/30 backdrop-blur-sm",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-8 h-8 rounded-full bg-green-500/20 flex items-center justify-center",children:e.jsx(bt,{className:"w-4 h-4 text-green-600"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-muted-foreground",children:"Gesamt"}),e.jsxs("p",{className:"font-bold text-sm",children:[P.reduce((t,s)=>t+s.quantity,0)," Artikel"]})]})]}),e.jsxs("div",{className:"text-right",children:[e.jsx("p",{className:"text-xs text-muted-foreground",children:"Total"}),e.jsxs("p",{className:"text-xl font-bold text-green-600",children:["CHF ",rs.toFixed(2)]})]})]}),e.jsx("div",{className:"space-y-2.5 mb-3",children:P.map((t,s)=>e.jsxs("div",{className:"p-3 bg-muted/80 backdrop-blur-sm rounded-xl border border-border/50",children:[e.jsxs("div",{className:"flex items-start justify-between mb-2.5",children:[e.jsxs("div",{className:"flex items-center gap-2.5 flex-1 min-w-0",children:[e.jsx("div",{className:"w-9 h-9 rounded-full bg-green-500 text-white text-xs font-bold flex items-center justify-center flex-shrink-0 shadow-sm",children:t.quantity}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("p",{className:"font-bold text-sm mb-0.5 truncate",children:t.name}),e.jsxs("p",{className:"text-xs text-muted-foreground",children:["CHF ",t.unitPrice.toFixed(2)," pro Stück"]})]})]}),e.jsx("button",{onClick:()=>Ot(s),className:"w-8 h-8 rounded-full bg-red-500/10 flex items-center justify-center flex-shrink-0 active:scale-95 transition-transform",children:e.jsx(T,{className:"w-4 h-4 text-red-500"})})]}),e.jsxs("div",{className:"flex items-center justify-between pt-2 border-t border-border/50",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{onClick:()=>Ut(s,t.quantity-1),className:"w-9 h-9 rounded-full bg-background border border-border flex items-center justify-center text-lg font-bold active:scale-95 transition-transform",children:"−"}),e.jsx("div",{className:"w-10 h-9 rounded-lg bg-background border border-border flex items-center justify-center",children:e.jsx("span",{className:"text-lg font-bold",children:t.quantity})}),e.jsx("button",{onClick:()=>Ut(s,t.quantity+1),className:"w-9 h-9 rounded-full bg-background border border-border flex items-center justify-center text-lg font-bold active:scale-95 transition-transform",children:"+"})]}),e.jsxs("div",{className:"text-right",children:[e.jsx("p",{className:"text-xs text-muted-foreground",children:"Total"}),e.jsxs("p",{className:"font-bold text-base",children:["CHF ",t.totalPrice.toFixed(2)]})]})]})]},s))}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs("button",{onClick:()=>{ce(new Set),r.success("Positionen zurückgesetzt")},className:"px-3 py-2.5 rounded-lg bg-muted flex items-center justify-center gap-1.5 text-xs font-semibold active:scale-95 transition-transform",children:[e.jsx(ca,{className:"w-3.5 h-3.5"}),"Reset"]}),e.jsxs("button",{onClick:()=>{B([]),R(0),ce(new Set)},className:"flex-1 py-2.5 rounded-lg bg-muted flex items-center justify-center gap-1.5 text-xs font-semibold active:scale-95 transition-transform",children:[e.jsx(Be,{className:"w-3.5 h-3.5"}),"Alle löschen"]}),e.jsxs("button",{onClick:Ks,className:"flex-1 py-2.5 rounded-lg bg-primary text-primary-foreground flex items-center justify-center gap-1.5 text-xs font-semibold shadow-lg active:scale-95 transition-transform",children:[e.jsx(J,{className:"w-3.5 h-3.5"}),"Fertig"]})]})]})]})]})]}),ee==="upload"&&S.length===0&&e.jsxs("div",{className:"flex-1 flex items-center justify-center p-4",children:[e.jsxs("button",{onClick:()=>Ct.current?.click(),className:"w-full max-w-sm p-8 border-2 border-dashed border-white/30 rounded-xl text-center",children:[e.jsx(pt,{className:"w-12 h-12 mx-auto text-white/50 mb-4"}),e.jsx("p",{className:"text-white font-medium",children:"Foto auswählen"}),e.jsx("p",{className:"text-white/50 text-sm mt-2",children:"JPG, PNG oder PDF"})]}),e.jsx("input",{ref:Ct,type:"file",accept:"image/*,application/pdf",capture:"environment",className:"hidden",onChange:zs})]}),j&&e.jsx("div",{className:"flex-1 flex items-center justify-center",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"w-12 h-12 border-2 border-white/30 border-t-white rounded-full animate-spin mx-auto mb-4"}),e.jsx("p",{className:"text-white",children:"Analysiere Liste..."})]})}),c&&S.length>0&&e.jsx("div",{className:"flex-1 bg-background overflow-y-auto",children:e.jsxs("div",{className:"p-4 space-y-4",children:[e.jsxs("div",{className:"bg-muted rounded-xl overflow-hidden",children:[e.jsxs("button",{onClick:()=>ls(!Ge),className:"w-full p-3 flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Re,{className:"w-4 h-4 text-primary"}),e.jsx("span",{className:"font-medium",children:"Geschäft"})]}),Ge?e.jsx(jt,{className:"w-4 h-4"}):e.jsx(Nt,{className:"w-4 h-4"})]}),Ge&&e.jsxs("div",{className:"px-3 pb-3 space-y-1",children:[e.jsx("p",{className:"font-semibold text-lg",children:c.store.name}),c.store.address&&e.jsx("p",{className:"text-sm text-muted-foreground",children:c.store.address}),c.store.city&&e.jsxs("p",{className:"text-sm text-muted-foreground",children:[c.store.postalCode," ",c.store.city]}),e.jsxs("div",{className:"flex gap-4 mt-2 text-xs text-muted-foreground",children:[c.purchase.date&&e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx(oa,{className:"w-3 h-3"}),new Date(c.purchase.date).toLocaleDateString("de-CH")]}),c.purchase.time&&e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx(da,{className:"w-3 h-3"}),c.purchase.time]})]})]})]}),e.jsxs("div",{className:"bg-muted rounded-xl overflow-hidden",children:[e.jsxs("button",{onClick:()=>is(!Ve),className:"w-full p-3 flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(bt,{className:"w-4 h-4 text-primary"}),e.jsxs("span",{className:"font-medium",children:["Artikel (",S.length,")"]}),e.jsxs("span",{className:"text-xs bg-primary text-primary-foreground px-2 py-0.5 rounded-full",children:[S.filter(t=>t.selected).length," ausgewählt"]})]}),Ve?e.jsx(jt,{className:"w-4 h-4"}):e.jsx(Nt,{className:"w-4 h-4"})]}),Ve&&e.jsxs("div",{className:"px-3 pb-3",children:[e.jsx("div",{className:"flex justify-end mb-2",children:e.jsx("button",{onClick:()=>Y(t=>t.map(s=>({...s,selected:!S.every(a=>a.selected)}))),className:"text-xs text-primary",children:S.every(t=>t.selected)?"Alle abwählen":"Alle auswählen"})}),e.jsx("div",{className:"space-y-2 max-h-64 overflow-y-auto",children:S.map((t,s)=>e.jsx("div",{className:`p-2.5 rounded-lg border ${t.selected?"bg-background border-primary":"bg-background/50 border-border"}`,onClick:()=>Y(a=>a.map((n,o)=>o===s?{...n,selected:!n.selected}:n)),children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:`w-5 h-5 rounded border-2 ${t.selected?"bg-primary border-primary":"border-border"} flex items-center justify-center shrink-0`,children:t.selected&&e.jsx(J,{className:"w-3 h-3 text-white"})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("p",{className:"font-medium text-sm truncate",children:t.name}),e.jsxs("p",{className:"text-xs text-muted-foreground",children:[t.articleNumber&&e.jsxs("span",{className:"mr-2",children:["#",t.articleNumber]}),t.quantity,"x à CHF ",t.unitPrice.toFixed(2)]})]}),e.jsxs("p",{className:"font-semibold text-sm shrink-0",children:["CHF ",t.totalPrice.toFixed(2)]})]})},s))})]})]}),e.jsxs("div",{className:"bg-muted rounded-xl overflow-hidden",children:[e.jsxs("button",{onClick:()=>cs(!_e),className:"w-full p-3 flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Jt,{className:"w-4 h-4 text-primary"}),e.jsx("span",{className:"font-medium",children:"Zahlung"})]}),_e?e.jsx(jt,{className:"w-4 h-4"}):e.jsx(Nt,{className:"w-4 h-4"})]}),_e&&e.jsxs("div",{className:"px-3 pb-3 space-y-2",children:[c.totals.subtotal&&e.jsxs("div",{className:"flex justify-between text-sm",children:[e.jsx("span",{className:"text-muted-foreground",children:"Zwischensumme"}),e.jsxs("span",{children:["CHF ",c.totals.subtotal.toFixed(2)]})]}),c.totals.rounding&&e.jsxs("div",{className:"flex justify-between text-sm",children:[e.jsx("span",{className:"text-muted-foreground",children:"Rundung"}),e.jsxs("span",{children:["CHF ",c.totals.rounding.toFixed(2)]})]}),e.jsxs("div",{className:"flex justify-between font-semibold text-lg pt-2 border-t",children:[e.jsx("span",{children:"Total"}),e.jsxs("span",{children:["CHF ",c.totals.total.toFixed(2)]})]}),c.purchase.paymentMethod&&e.jsxs("div",{className:"flex items-center gap-2 text-xs text-muted-foreground",children:[e.jsx(Jt,{className:"w-3 h-3"}),c.purchase.paymentMethod]})]})]}),e.jsxs("div",{className:"flex items-center justify-center gap-2 text-xs text-muted-foreground",children:[e.jsx("div",{className:`w-2 h-2 rounded-full ${c.confidence>=70?"bg-green-500":c.confidence>=40?"bg-yellow-500":"bg-red-500"}`}),"Erkennungsqualität: ",c.confidence,"%"]}),e.jsxs("div",{className:"space-y-2 pt-2",children:[e.jsxs(u,{onClick:Hs,className:"w-full",children:[e.jsx(qe,{className:"w-4 h-4 mr-2"}),S.filter(t=>t.selected).length," Artikel zur Liste"]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(u,{variant:"outline",onClick:Os,className:"flex-1",children:[e.jsx(ma,{className:"w-4 h-4 mr-1"}),"Speichern"]}),e.jsxs(u,{variant:"outline",onClick:Us,className:"flex-1",children:[e.jsx(ua,{className:"w-4 h-4 mr-1"}),"Zu Finanzen"]})]})]})]})})]}),St&&e.jsxs("div",{className:"fixed inset-0 z-[100] bg-black flex flex-col",children:[e.jsxs("div",{className:"flex items-center justify-between p-4 bg-black/50",children:[e.jsx("h2",{className:"text-white font-semibold",children:"Barcode scannen"}),e.jsx("button",{onClick:bs,className:"w-10 h-10 rounded-lg bg-white/20 flex items-center justify-center",children:e.jsx(T,{className:"w-5 h-5 text-white"})})]}),e.jsxs("div",{className:"flex-1 relative flex items-center justify-center",children:[e.jsx("video",{ref:$,autoPlay:!0,playsInline:!0,className:"w-full h-full object-cover"}),e.jsx("canvas",{ref:Ye,className:"hidden"}),e.jsx("div",{className:"absolute inset-0 flex items-center justify-center",children:e.jsx("div",{className:"w-64 h-32 border-2 border-white rounded-lg"})}),Pt&&e.jsx("div",{className:"absolute bottom-20 left-0 right-0 text-center",children:e.jsx("p",{className:"text-white bg-black/50 px-4 py-2 rounded-lg inline-block",children:"Barcode in den Rahmen positionieren"})})]})]}),At&&e.jsxs("div",{className:"fixed inset-0 z-[100] bg-black flex flex-col",children:[e.jsxs("div",{className:"flex items-center justify-between p-4 bg-black/50",children:[e.jsx("h2",{className:"text-white font-semibold",children:"Produkt fotografieren"}),e.jsx("button",{onClick:vs,className:"w-10 h-10 rounded-lg bg-white/20 flex items-center justify-center",children:e.jsx(T,{className:"w-5 h-5 text-white"})})]}),e.jsxs("div",{className:"flex-1 relative flex items-center justify-center",children:[e.jsx("video",{ref:q,autoPlay:!0,playsInline:!0,className:"w-full h-full object-cover"}),e.jsx("canvas",{ref:tt,className:"hidden"}),et&&e.jsx("div",{className:"absolute inset-0 flex items-center justify-center bg-black/50",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"w-12 h-12 border-2 border-white/30 border-t-white rounded-full animate-spin mx-auto mb-4"}),e.jsx("p",{className:"text-white",children:"Analysiere Produkt..."})]})})]}),e.jsx("div",{className:"p-4 bg-black/50",children:e.jsx(u,{onClick:ws,disabled:et,className:"w-full bg-primary text-primary-foreground",children:et?"Analysiere...":"Foto aufnehmen"})})]}),e.jsx(mt,{open:ts,onOpenChange:we,children:e.jsxs(ut,{className:"!fixed !top-[50%] !left-[50%] !right-auto !bottom-auto !translate-x-[-50%] !translate-y-[-50%] !w-[85vw] !max-w-sm !max-h-[90vh] !rounded-3xl !m-0 !overflow-hidden !shadow-2xl !flex !flex-col",children:[e.jsxs(ht,{className:"px-5 pt-5 pb-3 flex-shrink-0",children:[e.jsx(xt,{className:"text-lg font-semibold",children:"Einkaufslisten"}),e.jsx(ft,{className:"sr-only",children:"Verwalten Sie Ihre Einkaufslisten"})]}),e.jsx("div",{className:"px-5 pb-2 overflow-y-auto flex-1 min-h-0 space-y-2",children:k.map(t=>e.jsx("div",{className:"flex items-center gap-2 p-3 border rounded-lg",children:as===t.id?e.jsxs("div",{className:"flex-1 flex items-center gap-2",children:[e.jsx(K,{value:V,onChange:s=>_(s.target.value),className:"flex-1 h-9",placeholder:"Listenname",autoFocus:!0}),e.jsx(u,{size:"sm",onClick:()=>Ls(t.id,V),className:"h-9",children:e.jsx(J,{className:"w-4 h-4"})}),e.jsx(u,{variant:"ghost",size:"sm",onClick:()=>{He(null),_("")},className:"h-9",children:e.jsx(T,{className:"w-4 h-4"})})]}):e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("p",{className:"font-medium",children:t.name}),t.isDefault&&e.jsx("p",{className:"text-xs text-muted-foreground",children:"Standard"})]}),e.jsx(u,{variant:"ghost",size:"sm",onClick:()=>{He(t.id),_(t.name)},className:"h-9 w-9 p-0",children:e.jsx(pt,{className:"w-4 h-4"})}),!t.isDefault&&e.jsx(u,{variant:"ghost",size:"sm",onClick:()=>Is(t.id),className:"h-9 w-9 p-0 text-red-500",children:e.jsx(Be,{className:"w-4 h-4"})})]})},t.id))}),e.jsxs(gt,{className:"px-5 pb-3 pt-2 gap-2.5 flex-shrink-0",children:[e.jsx(u,{variant:"outline",onClick:()=>we(!1),className:"h-11 min-h-[44px] flex-1 rounded-xl text-sm font-medium",children:"Schließen"}),e.jsxs(u,{onClick:()=>{we(!1),ve(!0)},className:"h-11 min-h-[44px] flex-1 rounded-xl text-sm font-medium",children:[e.jsx(qe,{className:"w-4 h-4 mr-2"}),"Neue Liste"]})]})]})}),e.jsx(mt,{open:ss,onOpenChange:ve,children:e.jsxs(ut,{className:"!fixed !top-[50%] !left-[50%] !right-auto !bottom-auto !translate-x-[-50%] !translate-y-[-50%] !w-[85vw] !max-w-sm !max-h-fit !rounded-3xl !m-0 !overflow-visible !shadow-2xl !flex !flex-col",children:[e.jsxs(ht,{className:"px-5 pt-5 pb-3 flex-shrink-0",children:[e.jsx(xt,{className:"text-lg font-semibold",children:"Neue Liste erstellen"}),e.jsx(ft,{className:"sr-only",children:"Erstellen Sie eine neue Einkaufsliste"})]}),e.jsx("div",{className:"space-y-3 px-5 pb-2 overflow-y-auto flex-1 min-h-0",children:e.jsxs("div",{className:"w-full",children:[e.jsx(Qt,{className:"text-sm font-medium",children:"Listenname *"}),e.jsx(K,{value:V,onChange:t=>_(t.target.value),placeholder:"z.B. Wochenendeinkauf",className:"h-11 min-h-[44px] mt-1.5 rounded-xl w-full",onKeyDown:t=>{t.key==="Enter"&&Bt()}})]})}),e.jsxs(gt,{className:"px-5 pb-3 pt-2 gap-2.5 flex-shrink-0",children:[e.jsx(u,{variant:"outline",onClick:()=>{ve(!1),_("")},className:"h-11 min-h-[44px] flex-1 rounded-xl text-sm font-medium",children:"Abbrechen"}),e.jsx(u,{onClick:Bt,disabled:!V.trim(),className:"h-11 min-h-[44px] flex-1 rounded-xl text-sm font-medium",children:"Erstellen"})]})]})}),!wt&&!yt&&!vt&&!St&&!At&&e.jsxs("div",{className:"fixed right-4 bottom-20 flex flex-col gap-3 safe-bottom",children:[e.jsx("button",{onClick:Gs,className:"w-12 h-12 rounded-full bg-secondary text-secondary-foreground shadow-lg flex items-center justify-center active:opacity-80 transition-opacity",children:e.jsx(Ke,{className:"w-5 h-5"})}),e.jsx("button",{onClick:()=>ke(!0),className:"w-12 h-12 rounded-full bg-secondary text-secondary-foreground shadow-lg flex items-center justify-center active:opacity-80 transition-opacity",title:"Mehrere Artikel hinzufügen",children:e.jsx(ha,{className:"w-5 h-5"})}),e.jsx("button",{onClick:()=>Oe(!0),className:"w-14 h-14 rounded-full bg-primary text-primary-foreground shadow-lg flex items-center justify-center active:opacity-80 transition-opacity",children:e.jsx(qe,{className:"w-6 h-6"})})]})]})}export{Aa as M};
