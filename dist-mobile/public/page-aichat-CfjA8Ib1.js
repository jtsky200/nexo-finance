import*as ke from"react";import Bt,{createContext as Ot,useContext as _t,useMemo as xe,useRef as G,useCallback as ie,useState as w,useEffect as V}from"react";import"./vendor-i18n-CxwOOByA.js";import{s as mn,c as fn,X as Je,W as Ut,C as rt,a as xt,b as $t,S as Ht,d as hn,e as gn,f as pn,g as Ae,M as xn,L as vt,h as wt,B as lt,U as it,i as Ke,j as We,k as Ze,F as Kt,l as ot,m as bn,H as yn,T as vn,n as wn,o as Wt,p as Yt,q as jn,P as Nn,I as Dn,r as Ct,t as qt,A as Sn,u as Cn,v as En,w as kn,x as An,y as In,E as Fn,z as Tn,D as Rn,G as zn,J as Mn,K as Ln,N as Et,O as Pn}from"./vendor-misc-D1Cv2iiA.js";import{u as Xe,L as Bn}from"./vendor-router-CjTIubLE.js";import{S as On,R as _n,C as Un,a as $n,D as Hn,T as Kn,P as Wn,O as Yn,b as qn,c as Gn,d as Vn,I as Zn,V as Jn,e as Xn,f as Qn,g as es,h as ts,i as ns,j as ss,k as as,l as rs,m as is,n as os,o as ls,p as cs,q as ds,r as us,s as ms}from"./vendor-ui-BnFnq7nj.js";import{t as fs,c as hs}from"./vendor-utils-BNe0Xlio.js";import{i as gs,g as ps,a as xs,b as bs,c as ys,d as vs,o as ws,s as js,G as Ns,e as Ds,f as Ss,h as Cs,q as de,w as pe,j as Ie,T as kt,k as Qe,l as Fe,m as _}from"./vendor-firebase-BWip-oO3.js";import{t as N}from"./vendor-toast-CdQ6zwVl.js";import{c as Es}from"./vendor-api-eYhQX7Av.js";const ks="modulepreload",As=function(t){return"/"+t},At={},Is=function(n,s,r){let o=Promise.resolve();if(s&&s.length>0){let p=function(u){return Promise.all(u.map(g=>Promise.resolve(g).then(m=>({status:"fulfilled",value:m}),m=>({status:"rejected",reason:m}))))};document.getElementsByTagName("link");const l=document.querySelector("meta[property=csp-nonce]"),d=l?.nonce||l?.getAttribute("nonce");o=p(s.map(u=>{if(u=As(u),u in At)return;At[u]=!0;const g=u.endsWith(".css"),m=g?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${u}"]${m}`))return;const h=document.createElement("link");if(h.rel=g?"stylesheet":ks,g||(h.as="script"),h.crossOrigin="",h.href=u,d&&h.setAttribute("nonce",d),document.head.appendChild(h),g)return new Promise((y,a)=>{h.addEventListener("load",y),h.addEventListener("error",()=>a(new Error(`Unable to preload CSS for ${u}`)))})}))}function i(l){const d=new Event("vite:preloadError",{cancelable:!0});if(d.payload=l,window.dispatchEvent(d),!d.defaultPrevented)throw l}return o.then(l=>{for(const d of l||[])d.status==="rejected"&&i(d.reason);return n().catch(i)})};var $a=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function Ha(t){return t&&t.__esModule&&Object.prototype.hasOwnProperty.call(t,"default")?t.default:t}var mt={exports:{}},qe={};/**
 * @license React
 * react-jsx-runtime.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var It;function Fs(){if(It)return qe;It=1;var t=Bt,n=Symbol.for("react.element"),s=Symbol.for("react.fragment"),r=Object.prototype.hasOwnProperty,o=t.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,i={key:!0,ref:!0,__self:!0,__source:!0};function l(d,p,u){var g,m={},h=null,y=null;u!==void 0&&(h=""+u),p.key!==void 0&&(h=""+p.key),p.ref!==void 0&&(y=p.ref);for(g in p)r.call(p,g)&&!i.hasOwnProperty(g)&&(m[g]=p[g]);if(d&&d.defaultProps)for(g in p=d.defaultProps,p)m[g]===void 0&&(m[g]=p[g]);return{$$typeof:n,type:d,key:h,ref:y,props:m,_owner:o.current}}return qe.Fragment=s,qe.jsx=l,qe.jsxs=l,qe}var Ft;function Ts(){return Ft||(Ft=1,mt.exports=Fs()),mt.exports}var e=Ts();const Rs=(t,n,s,r)=>{const o=[s,{code:n,...r||{}}];if(t?.services?.logger?.forward)return t.services.logger.forward(o,"warn","react-i18next::",!0);Te(o[0])&&(o[0]=`react-i18next:: ${o[0]}`),t?.services?.logger?.warn?t.services.logger.warn(...o):console?.warn&&console.warn(...o)},Tt={},Gt=(t,n,s,r)=>{Te(s)&&Tt[s]||(Te(s)&&(Tt[s]=new Date),Rs(t,n,s,r))},Vt=(t,n)=>()=>{if(t.isInitialized)n();else{const s=()=>{setTimeout(()=>{t.off("initialized",s)},0),n()};t.on("initialized",s)}},bt=(t,n,s)=>{t.loadNamespaces(n,Vt(t,s))},Rt=(t,n,s,r)=>{if(Te(s)&&(s=[s]),t.options.preload&&t.options.preload.indexOf(n)>-1)return bt(t,s,r);s.forEach(o=>{t.options.ns.indexOf(o)<0&&t.options.ns.push(o)}),t.loadLanguages(n,Vt(t,r))},zs=(t,n,s={})=>!n.languages||!n.languages.length?(Gt(n,"NO_LANGUAGES","i18n.languages were undefined or empty",{languages:n.languages}),!0):n.hasLoadedNamespace(t,{lng:s.lng,precheck:(r,o)=>{if(s.bindI18n&&s.bindI18n.indexOf("languageChanging")>-1&&r.services.backendConnector.backend&&r.isLanguageChangingTo&&!o(r.isLanguageChangingTo,t))return!1}}),Te=t=>typeof t=="string",Ms=t=>typeof t=="object"&&t!==null,Ls=/&(?:amp|#38|lt|#60|gt|#62|apos|#39|quot|#34|nbsp|#160|copy|#169|reg|#174|hellip|#8230|#x2F|#47);/g,Ps={"&amp;":"&","&#38;":"&","&lt;":"<","&#60;":"<","&gt;":">","&#62;":">","&apos;":"'","&#39;":"'","&quot;":'"',"&#34;":'"',"&nbsp;":" ","&#160;":" ","&copy;":"©","&#169;":"©","&reg;":"®","&#174;":"®","&hellip;":"…","&#8230;":"…","&#x2F;":"/","&#47;":"/"},Bs=t=>Ps[t],Os=t=>t.replace(Ls,Bs);let yt={bindI18n:"languageChanged",bindI18nStore:"",transEmptyNodeValue:"",transSupportBasicHtmlNodes:!0,transWrapTextNodes:"",transKeepBasicHtmlNodesFor:["br","strong","i","p"],useSuspense:!0,unescape:Os,transDefaultProps:void 0};const _s=(t={})=>{yt={...yt,...t}},Us=()=>yt;let Zt;const $s=t=>{Zt=t},Hs=()=>Zt,Ka={type:"3rdParty",init(t){_s(t.options.react),$s(t)}},Ks=Ot();class Ws{constructor(){this.usedNamespaces={}}addUsedNamespaces(n){n.forEach(s=>{this.usedNamespaces[s]||(this.usedNamespaces[s]=!0)})}getUsedNamespaces(){return Object.keys(this.usedNamespaces)}}const Ys=(t,n)=>Te(n)?n:Ms(n)&&Te(n.defaultValue)?n.defaultValue:Array.isArray(t)?t[t.length-1]:t,qs={t:Ys,ready:!1},Gs=()=>()=>{},Jt=(t,n={})=>{const{i18n:s}=n,{i18n:r,defaultNS:o}=_t(Ks)||{},i=s||r||Hs();i&&!i.reportNamespaces&&(i.reportNamespaces=new Ws),i||Gt(i,"NO_I18NEXT_INSTANCE","useTranslation: You will need to pass in an i18next instance by using initReactI18next");const l=xe(()=>({...Us(),...i?.options?.react,...n}),[i,n]),{useSuspense:d,keyPrefix:p}=l,u=o||i?.options?.defaultNS,g=Te(u)?[u]:u||["translation"],m=xe(()=>g,g);i?.reportNamespaces?.addUsedNamespaces?.(m);const h=G(0),y=ie(A=>{if(!i)return Gs;const{bindI18n:S,bindI18nStore:F}=l,W=()=>{h.current+=1,A()};return S&&i.on(S,W),F&&i.store.on(F,W),()=>{S&&S.split(" ").forEach(te=>i.off(te,W)),F&&F.split(" ").forEach(te=>i.store.off(te,W))}},[i,l]),a=G(),b=ie(()=>{if(!i)return qs;const A=!!(i.isInitialized||i.initializedStoreOnce)&&m.every(Z=>zs(Z,i,l)),S=n.lng||i.language,F=h.current,W=a.current;if(W&&W.ready===A&&W.lng===S&&W.keyPrefix===p&&W.revision===F)return W;const O={t:i.getFixedT(S,l.nsMode==="fallback"?m:m[0],p),ready:A,lng:S,keyPrefix:p,revision:F};return a.current=O,O},[i,m,p,l,n.lng]),[j,I]=w(0),{t:P,ready:ee}=mn.useSyncExternalStore(y,b,b);V(()=>{if(i&&!ee&&!d){const A=()=>I(S=>S+1);n.lng?Rt(i,n.lng,m,A):bt(i,m,A)}},[i,n.lng,m,ee,d,j]);const K=i||{},J=G(null),ne=G(),X=A=>{const S=Object.getOwnPropertyDescriptors(A);S.__original&&delete S.__original;const F=Object.create(Object.getPrototypeOf(A),S);if(!Object.prototype.hasOwnProperty.call(F,"__original"))try{Object.defineProperty(F,"__original",{value:A,writable:!1,enumerable:!1,configurable:!1})}catch{}return F},oe=xe(()=>{const A=K,S=A?.language;let F=A;A&&(J.current&&J.current.__original===A?ne.current!==S?(F=X(A),J.current=F,ne.current=S):F=J.current:(F=X(A),J.current=F,ne.current=S));const W=[P,F,ee];return W.t=P,W.i18n=F,W.ready=ee,W},[P,K,ee,K.resolvedLanguage,K.language,K.languages]);if(i&&d&&!ee)throw new Promise(A=>{const S=()=>A();n.lng?Rt(i,n.lng,m,S):bt(i,m,S)});return oe},Vs=Es(),Zs={apiKey:"AIzaSyCZ8V17HUVMlBKXK0ftrMURS-XP2zIsOps",authDomain:"nexo-jtsky100.firebaseapp.com",projectId:"nexo-jtsky100",storageBucket:"nexo-jtsky100.firebasestorage.app",messagingSenderId:"859320186482",appId:"1:859320186482:web:0c9dcca5d8ce613aaf34eb",measurementId:"G-G8PX4GB2YF"},ct=gs(Zs),Be=ps(ct),Re=xs(ct),U=bs(ct,"us-central1");typeof window<"u"&&ys(ct);const Xt=Ot(void 0);function Wa({children:t}){const[n,s]=w(null),[r,o]=w(!0),[i,l]=w(null);V(()=>(vs(Be).then(b=>{b?.user&&s(b.user)}).catch(b=>{}),ws(Be,b=>{s(b),o(!1)})),[]);const d=async(a,b)=>{try{l(null);const j=await Ss(Be,a,b)}catch(j){let I="Anmeldung fehlgeschlagen";switch(j.code){case"auth/invalid-email":I="Ungültige E-Mail-Adresse";break;case"auth/user-disabled":I="Dieses Konto wurde deaktiviert";break;case"auth/user-not-found":I="Kein Konto mit dieser E-Mail gefunden";break;case"auth/wrong-password":I="Falsches Passwort";break;case"auth/invalid-credential":I="Ungültige Anmeldedaten";break;default:I=j.message||"Ein Fehler ist aufgetreten"}throw l(I),new Error(I)}},p=async(a,b)=>{try{l(null);const j=await Cs(Be,a,b)}catch(j){let I="Registrierung fehlgeschlagen";switch(j.code){case"auth/email-already-in-use":I="Diese E-Mail wird bereits verwendet";break;case"auth/invalid-email":I="Ungültige E-Mail-Adresse";break;case"auth/weak-password":I="Passwort ist zu schwach";break;default:I=j.message||"Ein Fehler ist aufgetreten"}throw l(I),new Error(I)}},u=async()=>{try{l(null);const a=new Ns;a.addScope("email"),a.addScope("profile"),a.setCustomParameters({prompt:"select_account"}),await Ds(Be,a)}catch(a){let b="Ein Fehler ist aufgetreten";switch(a.code){case"auth/unauthorized-domain":b="Diese Domain ist nicht autorisiert. Bitte kontaktieren Sie den Administrator.";break;case"auth/operation-not-allowed":b="Google Sign-In ist nicht aktiviert.";break;case"auth/network-request-failed":b="Netzwerkfehler. Bitte überprüfen Sie Ihre Internetverbindung.";break;default:b=a.message||"Ein unbekannter Fehler ist aufgetreten"}throw l(b),new Error(b)}},g=async()=>{try{await js(Be)}catch{throw new Error("Abmeldung fehlgeschlagen")}},m=d,h=u,y=g;return e.jsx(Xt.Provider,{value:{user:n,loading:r,error:i,signIn:d,signUp:p,signInWithGoogle:u,signOut:g,loginWithEmail:m,loginWithGoogle:h,logout:y},children:t})}function Ye(){const t=_t(Xt);if(t===void 0)throw new Error("useAuth must be used within an AuthProvider");return t}const Js={maxRetries:3,initialDelay:1e3,maxDelay:1e4,backoffMultiplier:2,retryableErrors:["network","timeout","ECONNRESET","ETIMEDOUT","ENOTFOUND","EAI_AGAIN","500","502","503","504"]};function Xs(t,n){if(!t)return!1;const s=t.message?.toLowerCase()||"",r=t.code?.toLowerCase()||"",o=t.status?.toString()||"";return n.some(i=>{const l=i.toLowerCase();return s.includes(l)||r.includes(l)||o.includes(l)})}function Qs(t,n){const s=n.initialDelay*Math.pow(n.backoffMultiplier,t);return Math.min(s,n.maxDelay)}async function ea(t,n={}){const s={...Js,...n};let r;for(let o=0;o<=s.maxRetries;o++)try{return await t()}catch(i){if(r=i,o>=s.maxRetries||!Xs(i,s.retryableErrors))break;const l=Qs(o,s);await new Promise(d=>setTimeout(d,l))}throw r}async function Ce(t,n,s={}){return ea(async()=>(await t(n)).data,s)}const jt={maxRetries:3,initialDelay:1e3},et={maxRetries:2,initialDelay:500};function ta(t){const[n,s]=w([]),[r,o]=w(!0),[i,l]=w(null),{user:d}=Ye();return V(()=>{if(!d){s([]),o(!1);return}o(!0);let u=de(Ie(Re,"reminders"),pe("userId","==",d.uid));t?.status&&(u=de(u,pe("status","==",t.status))),t?.startDate&&(u=de(u,pe("dueDate",">=",kt.fromDate(t.startDate)))),t?.endDate&&(u=de(u,pe("dueDate","<=",kt.fromDate(t.endDate)))),u=de(u,Qe("dueDate"));const g=Fe(u,m=>{try{const h=m.docs.map(y=>{const a=y.data();if(!a)return null;let b=new Date;if(a.dueDate){if(a.dueDate.toDate&&typeof a.dueDate.toDate=="function")b=a.dueDate.toDate();else if(a.dueDate instanceof Date)b=a.dueDate;else if(typeof a.dueDate=="string"){const P=new Date(a.dueDate);isNaN(P.getTime())||(b=P)}}let j=new Date;if(a.createdAt){if(a.createdAt.toDate&&typeof a.createdAt.toDate=="function")j=a.createdAt.toDate();else if(a.createdAt instanceof Date)j=a.createdAt;else if(typeof a.createdAt=="string"){const P=new Date(a.createdAt);isNaN(P.getTime())||(j=P)}}let I=new Date;if(a.updatedAt){if(a.updatedAt.toDate&&typeof a.updatedAt.toDate=="function")I=a.updatedAt.toDate();else if(a.updatedAt instanceof Date)I=a.updatedAt;else if(typeof a.updatedAt=="string"){const P=new Date(a.updatedAt);isNaN(P.getTime())||(I=P)}}return{id:y.id,userId:a.userId||d.uid,title:a.title||"",type:a.type||"erinnerung",dueDate:b,isAllDay:a.isAllDay||!1,amount:a.amount||null,currency:a.currency||"CHF",notes:a.notes||null,recurrenceRule:a.recurrenceRule||null,personId:a.personId||null,personName:a.personName||null,status:a.status||"offen",createdAt:j,updatedAt:I}}).filter(y=>y!==null);s(h),l(null)}catch(h){l(h),console.error("[useReminders] Error processing snapshot:",h)}finally{o(!1)}},m=>{m?.code==="failed-precondition"&&(console.error("[useReminders] Firestore index missing:",m.message),N.error("Index fehlt - Bitte Firebase Console prüfen")),l(m),o(!1),console.error("[useReminders] Snapshot error:",m)});return()=>g()},[d,t?.startDate,t?.endDate,t?.status]),{data:n,isLoading:r,error:i,refetch:()=>{s(u=>[...u])}}}async function Qt(t){const n=_(U,"createReminder");return Ce(n,t,jt)}async function Ya(t,n){const s=_(U,"updateReminder");await Ce(s,{id:t,...n},et)}async function qa(t){const n=_(U,"deleteReminder");await Ce(n,{id:t},et)}function Ga(t){const[n,s]=w([]),[r,o]=w(!0),[i,l]=w(null),{user:d}=Ye();return V(()=>{if(!d){s([]),o(!1);return}o(!0);let u=de(Ie(Re,"financeEntries"),pe("userId","==",d.uid));u=de(u,Qe("date","desc"));const g=Fe(u,m=>{try{const h=m.docs.map(y=>{const a=y.data();if(!a)return null;let b=new Date;if(a.date){if(a.date.toDate&&typeof a.date.toDate=="function")b=a.date.toDate();else if(a.date instanceof Date)b=a.date;else if(typeof a.date=="string"){const P=new Date(a.date);isNaN(P.getTime())||(b=P)}}let j=new Date;if(a.createdAt){if(a.createdAt.toDate&&typeof a.createdAt.toDate=="function")j=a.createdAt.toDate();else if(a.createdAt instanceof Date)j=a.createdAt;else if(typeof a.createdAt=="string"){const P=new Date(a.createdAt);isNaN(P.getTime())||(j=P)}}let I=new Date;if(a.updatedAt){if(a.updatedAt.toDate&&typeof a.updatedAt.toDate=="function")I=a.updatedAt.toDate();else if(a.updatedAt instanceof Date)I=a.updatedAt;else if(typeof a.updatedAt=="string"){const P=new Date(a.updatedAt);isNaN(P.getTime())||(I=P)}}return{id:y.id,userId:a.userId||d.uid,type:a.type||"ausgabe",category:a.category||"",description:a.description||"",amount:a.amount||0,currency:a.currency||"CHF",paymentMethod:a.paymentMethod||"Karte",date:b,isRecurring:a.isRecurring||!1,recurrenceRule:a.recurrenceRule||null,createdAt:j,updatedAt:I}}).filter(y=>y!==null);s(h),l(null)}catch(h){l(h),console.error("[useFinanceEntries] Error processing snapshot:",h)}finally{o(!1)}},m=>{m?.code==="failed-precondition"&&(console.error("[useFinanceEntries] Firestore index missing:",m.message),N.error("Index fehlt - Bitte Firebase Console prüfen")),l(m),o(!1),console.error("[useFinanceEntries] Snapshot error:",m)});return()=>g()},[d,t?.startDate,t?.endDate,t?.type]),{data:n,isLoading:r,error:i,refetch:()=>{s(u=>[...u])}}}async function en(t){const n=_(U,"createFinanceEntry");return Ce(n,t,jt)}async function Va(t,n){const s=_(U,"updateFinanceEntry");await Ce(s,{id:t,...n},et)}function Za(t){const[n,s]=w([]),[r,o]=w(!0),[i,l]=w(null);return V(()=>{(async()=>{try{o(!0),l(null);const m=((await _(U,"getTaxProfiles")({})).data.profiles||[]).map(h=>({...h,createdAt:h.createdAt?.toDate?h.createdAt.toDate():h.createdAt?new Date(h.createdAt):new Date,updatedAt:h.updatedAt?.toDate?h.updatedAt.toDate():h.updatedAt?new Date(h.updatedAt):new Date}));s(m)}catch(p){console.error("Error fetching tax profiles:",p),l(p),s([])}finally{o(!1)}})()},[t]),{data:n,isLoading:r,error:i}}async function Ja(t){await _(U,"deleteTaxProfile")({id:t})}function Xa(){const[t,n]=w([]),[s,r]=w(!0),[o,i]=w(null),{user:l}=Ye();return V(()=>{if(!l){n([]),r(!1);return}r(!0);let p=de(Ie(Re,"people"),pe("userId","==",l.uid));try{p=de(p,Qe("createdAt","desc"))}catch{console.warn("[usePeople] Index missing for createdAt, using unsorted query")}const u=Fe(p,g=>{try{const h=g.docs.map(y=>{const a=y.data();if(!a)return null;let b=new Date;if(a.createdAt){if(a.createdAt.toDate&&typeof a.createdAt.toDate=="function")b=a.createdAt.toDate();else if(a.createdAt instanceof Date)b=a.createdAt;else if(typeof a.createdAt=="string"){const I=new Date(a.createdAt);isNaN(I.getTime())||(b=I)}}let j=new Date;if(a.updatedAt){if(a.updatedAt.toDate&&typeof a.updatedAt.toDate=="function")j=a.updatedAt.toDate();else if(a.updatedAt instanceof Date)j=a.updatedAt;else if(typeof a.updatedAt=="string"){const I=new Date(a.updatedAt);isNaN(I.getTime())||(j=I)}}return{id:y.id,userId:a.userId||l.uid,name:a.name||"",email:a.email||null,phone:a.phone||null,totalOwed:a.totalOwed||0,currency:a.currency||"CHF",createdAt:b,updatedAt:j}}).filter(y=>y!==null).sort((y,a)=>a.createdAt.getTime()-y.createdAt.getTime());n(h),i(null)}catch(m){i(m),console.error("[usePeople] Error processing snapshot:",m)}finally{r(!1)}},g=>{if(g?.code==="failed-precondition"){console.error("[usePeople] Firestore index missing:",g.message);const m=de(Ie(Re,"people"),pe("userId","==",l.uid)),h=Fe(m,y=>{try{const a=y.docs.map(b=>{const j=b.data();return j?{id:b.id,userId:j.userId||l.uid,name:j.name||"",email:j.email||null,phone:j.phone||null,totalOwed:j.totalOwed||0,currency:j.currency||"CHF",createdAt:j.createdAt?.toDate?.()||new Date,updatedAt:j.updatedAt?.toDate?.()||new Date}:null}).filter(b=>b!==null);n(a.sort((b,j)=>j.createdAt.getTime()-b.createdAt.getTime())),i(null)}catch(a){i(a),console.error("[usePeople] Error processing fallback snapshot:",a)}finally{r(!1)}},y=>{i(y),r(!1),console.error("[usePeople] Fallback snapshot error:",y)});return()=>h()}else i(g),r(!1),console.error("[usePeople] Snapshot error:",g)});return()=>u()},[l]),{data:t,isLoading:s,error:o,refetch:()=>{n(p=>[...p])}}}async function Qa(t){const n=_(U,"createPerson");return Ce(n,t,jt)}async function er(t,n){const s=_(U,"updatePerson");await Ce(s,{personId:t,...n},et)}async function tr(t){const n=_(U,"deletePerson");await Ce(n,{personId:t},et)}function nr(){const[t,n]=w([]),[s,r]=w(!0),[o,i]=w(null),{user:l}=Ye();return V(()=>{if(!l){n([]),r(!1);return}r(!0);let d=de(Ie(Re,"shoppingLists"),pe("userId","==",l.uid));try{d=de(d,Qe("createdAt","desc"))}catch{console.warn("[useShoppingLists] Index missing for createdAt, using unsorted query")}const p=Fe(d,u=>{try{const g=u.docs.map(m=>{const h=m.data();return h?{id:m.id,userId:h.userId,name:h.name,isDefault:h.isDefault||!1,createdAt:h.createdAt?.toDate?h.createdAt.toDate():new Date(h.createdAt),updatedAt:h.updatedAt?.toDate?h.updatedAt.toDate():new Date(h.updatedAt)}:null}).filter(m=>m!==null);g.sort((m,h)=>h.createdAt.getTime()-m.createdAt.getTime()),n(g),i(null)}catch(g){console.error("[useShoppingLists] Error mapping lists:",g),i(g)}finally{r(!1)}},u=>{if(console.error("[useShoppingLists] Snapshot error:",u),u?.code==="failed-precondition"){console.warn("[useShoppingLists] Index missing, trying without orderBy");const g=de(Ie(Re,"shoppingLists"),pe("userId","==",l.uid)),m=Fe(g,h=>{try{const y=h.docs.map(a=>{const b=a.data();return b?{id:a.id,userId:b.userId,name:b.name,isDefault:b.isDefault||!1,createdAt:b.createdAt?.toDate?b.createdAt.toDate():new Date(b.createdAt),updatedAt:b.updatedAt?.toDate?b.updatedAt.toDate():new Date(b.updatedAt)}:null}).filter(a=>a!==null);y.sort((a,b)=>b.createdAt.getTime()-a.createdAt.getTime()),n(y),i(null)}catch(y){console.error("[useShoppingLists] Error mapping lists (fallback):",y),i(y)}finally{r(!1)}},h=>{console.error("[useShoppingLists] Fallback snapshot error:",h),i(h),r(!1)});return()=>m()}else i(u),r(!1)});return()=>p()},[l]),{data:t,isLoading:s,error:o}}function sr(t,n){const[s,r]=w([]),[o,i]=w(!0),[l,d]=w(null),[p,u]=w(0);return V(()=>{t?(async()=>{try{i(!0);const b=(await _(U,"getShoppingList")({listId:t,status:n})).data.items.map(j=>({...j,boughtAt:j.boughtAt?.toDate?j.boughtAt.toDate():j.boughtAt?new Date(j.boughtAt):null,createdAt:j.createdAt?.toDate?j.createdAt.toDate():new Date(j.createdAt),updatedAt:j.updatedAt?.toDate?j.updatedAt.toDate():new Date(j.updatedAt)}));r(b),d(null)}catch(h){d(h)}finally{i(!1)}})():(r([]),i(!1))},[t,n,p]),{data:s,isLoading:o,error:l,refetch:()=>u(m=>m+1)}}async function ar(t,n){return(await _(U,"createShoppingList")({name:t,isDefault:n})).data}async function rr(t,n){await _(U,"updateShoppingList")({listId:t,...n})}async function ir(t){await _(U,"deleteShoppingList")({listId:t})}async function na(t){return(await _(U,"createShoppingItem")(t)).data}async function or(t,n){await _(U,"updateShoppingItem")({itemId:t,...n})}async function lr(t){await _(U,"deleteShoppingItem")({itemId:t})}async function cr(t,n,s){return(await _(U,"markShoppingItemAsBought")({itemId:t,actualPrice:n,createExpense:s})).data}function sa(){const[t,n]=w([]),[s,r]=w(!0),[o,i]=w(null),{user:l}=Ye();return V(()=>{if(!l){n([]),r(!1);return}r(!0);const p=de(Ie(Re,"chatConversations"),pe("userId","==",l.uid),Qe("updatedAt","desc")),u=Fe(p,g=>{try{const m=g.docs.map(h=>{const y=h.data();let a=new Date;y.createdAt&&(y.createdAt.toDate?a=y.createdAt.toDate().toISOString():typeof y.createdAt=="string"?a=y.createdAt:a=new Date(y.createdAt).toISOString());let b=new Date;return y.updatedAt&&(y.updatedAt.toDate?b=y.updatedAt.toDate().toISOString():typeof y.updatedAt=="string"?b=y.updatedAt:b=new Date(y.updatedAt).toISOString()),{id:h.id,userId:y.userId||l.uid,title:y.title||"Neue Konversation",messages:y.messages||[],createdAt:a,updatedAt:b}});m.sort((h,y)=>{const a=typeof h.updatedAt=="string"?new Date(h.updatedAt).getTime():h.updatedAt.getTime();return(typeof y.updatedAt=="string"?new Date(y.updatedAt).getTime():y.updatedAt.getTime())-a}),n(m),i(null)}catch(m){console.error("Error processing chat conversations:",m),i(m)}finally{r(!1)}},g=>{g.code==="permission-denied"?console.warn("[useChatConversations] Permission denied - user may not be authenticated"):g.code==="failed-precondition"?(console.warn("[useChatConversations] Index missing - query may need an index"),N.error("Index fehlt. Bitte warten Sie, bis der Index erstellt wurde.")):console.error("[useChatConversations] Firestore listener error:",g),i(g),r(!1),n([])});return()=>u()},[l]),{data:t,isLoading:s,error:o,refetch:async()=>{}}}const Ge=new Map,aa=300*1e3,ra=500;function tn(t,n){const[s,r]=w(null),[o,i]=w(!1),[l,d]=w(null),p=G(null);return V(()=>{if(p.current&&(clearTimeout(p.current),p.current=null),!t){r(null),d(null),i(!1);return}const g=`${t.toISOString().split("T")[0]}_${n||"no-location"}`,m=Ge.get(g);if(m&&Date.now()-m.timestamp<aa){r(m.data),d(m.error),i(!1);return}return p.current=setTimeout(async()=>{try{if(i(!0),d(null),!n){const b=new Error("Location ist erforderlich. Bitte in den Einstellungen einen Standort eingeben.");d(b),r(null),i(!1),Ge.set(g,{data:null,timestamp:Date.now(),error:b});return}const a=(await _(U,"getWeather")({date:t.toISOString(),location:n})).data;if(a)r(a),d(null),Ge.set(g,{data:a,timestamp:Date.now(),error:null});else{const b=new Date;b.setHours(0,0,0,0);const j=new Date(t);j.setHours(0,0,0,0);const I=j<b?new Error("Historische Wetterdaten sind nur aus dem Cache verfügbar."):new Error("Keine Wetterdaten verfügbar. Bitte überprüfen Sie den Standort in den Einstellungen.");d(I),r(null),Ge.set(g,{data:null,timestamp:Date.now(),error:I})}}catch(h){h?.code!=="internal"&&!h?.message?.includes("ERR_INSUFFICIENT_RESOURCES")&&console.error("[useWeather] Error:",h);const y=h?.message||h?.code||"Unbekannter Fehler beim Laden der Wetterdaten",a=new Error(y);d(a),r(null),Ge.set(g,{data:null,timestamp:Date.now(),error:a})}finally{i(!1)}},ra),()=>{p.current&&(clearTimeout(p.current),p.current=null)}},[t?.toISOString(),n]),{data:s,isLoading:o,error:l}}function Nt(){const[t,n]=w(null),[s,r]=w(!0),[o,i]=w(null);V(()=>{(async()=>{try{r(!0),i(null);const g=(await _(U,"getUserSettings")({})).data;n(g)}catch(p){i(p)}finally{r(!1)}})()},[]);const l=ie(async d=>{try{return await _(U,"updateUserSettings")(d),n(u=>u?{...u,...d}:d),{success:!0}}catch(p){throw i(p),p}},[]);return{settings:t,isLoading:s,error:o,updateSettings:l}}async function ia(t){return(await _(U,"createChatConversation")(t)).data}async function oa(t,n){await _(U,"updateChatConversation")({id:t,...n})}async function la(){return(await _(U,"clearAllChatConversations")({})).data}function z(...t){return fs(hs(t))}const ca=fn("inline-flex items-center justify-center gap-2 whitespace-nowrap rounded-md text-sm font-medium transition-all disabled:pointer-events-none disabled:opacity-50 [&_svg]:pointer-events-none [&_svg:not([class*='size-'])]:size-4 shrink-0 [&_svg]:shrink-0 outline-none focus-visible:border-ring focus-visible:ring-ring/50 focus-visible:ring-[3px] aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive",{variants:{variant:{default:"bg-primary text-primary-foreground hover:bg-primary/90",destructive:"bg-destructive text-white hover:bg-destructive/90 focus-visible:ring-destructive/20 dark:focus-visible:ring-destructive/40 dark:bg-destructive/60",outline:"border bg-transparent shadow-xs hover:bg-accent dark:bg-transparent dark:border-input dark:hover:bg-input/50",secondary:"bg-secondary text-secondary-foreground hover:bg-secondary/80",ghost:"hover:bg-accent dark:hover:bg-accent/50",link:"text-primary underline-offset-4 hover:underline"},size:{default:"h-9 px-4 py-2 has-[>svg]:px-3",sm:"h-8 rounded-md gap-1.5 px-3 has-[>svg]:px-2.5",lg:"h-10 rounded-md px-6 has-[>svg]:px-4",icon:"size-9","icon-sm":"size-8","icon-lg":"size-10"}},defaultVariants:{variant:"default",size:"default"}});function H({className:t,variant:n,size:s,asChild:r=!1,...o}){const i=r?On:"button";return e.jsx(i,{"data-slot":"button",className:z(ca({variant:n,size:s,className:t})),...o})}function da({className:t,...n}){return e.jsx("div",{"data-slot":"card",className:z("bg-card text-card-foreground flex flex-col gap-6 rounded-xl border py-6 shadow-sm",t),...n})}function dr({className:t,...n}){return e.jsx("div",{"data-slot":"card-header",className:z("@container/card-header grid auto-rows-min grid-rows-[auto_auto] items-start gap-2 px-6 has-data-[slot=card-action]:grid-cols-[1fr_auto] [.border-b]:pb-6",t),...n})}function ur({className:t,...n}){return e.jsx("div",{"data-slot":"card-title",className:z("leading-none font-semibold",t),...n})}function mr({className:t,...n}){return e.jsx("div",{"data-slot":"card-description",className:z("text-muted-foreground text-sm",t),...n})}function ua({className:t,...n}){return e.jsx("div",{"data-slot":"card-content",className:z("px-6",t),...n})}const tt="glassEffectEnabled";function nn(){const{settings:t,updateSettings:n,isLoading:s}=Nt(),[r,o]=w(()=>{if(t?.glassEffectEnabled!==void 0)return t.glassEffectEnabled;const l=localStorage.getItem(tt);return l!==null?l==="true":!0});return V(()=>{if(!s&&t?.glassEffectEnabled!==void 0)o(t.glassEffectEnabled);else if(!s&&!t?.glassEffectEnabled){const l=localStorage.getItem(tt);if(l!==null){const d=l==="true";n({glassEffectEnabled:d}).then(()=>{localStorage.removeItem(tt)}).catch(console.error),o(d)}}},[t?.glassEffectEnabled,s,n]),V(()=>{!s&&n&&(n({glassEffectEnabled:r}).catch(console.error),localStorage.setItem(tt,String(r)))},[r,s,n]),{isEnabled:r,toggle:()=>{o(l=>!l)},setIsEnabled:o}}const sn=ke.createContext({isComposing:()=>!1,setComposing:()=>{},justEndedComposing:()=>!1,markCompositionEnd:()=>{}}),Dt=()=>ke.useContext(sn);function ve({...t}){const n=ke.useRef(!1),s=ke.useRef(!1),r=ke.useRef(null),o=ke.useMemo(()=>({isComposing:()=>n.current,setComposing:i=>{n.current=i},justEndedComposing:()=>s.current,markCompositionEnd:()=>{s.current=!0,r.current&&clearTimeout(r.current),r.current=setTimeout(()=>{s.current=!1},150)}}),[]);return e.jsx(sn.Provider,{value:o,children:e.jsx(_n,{"data-slot":"dialog",...t})})}function ma({...t}){return e.jsx(Wn,{"data-slot":"dialog-portal",...t})}function an({className:t,...n}){return e.jsx(Yn,{"data-slot":"dialog-overlay",className:z("data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 fixed inset-0 z-50 bg-black/50",t),...n})}an.displayName="DialogOverlay";function we({className:t,children:n,showCloseButton:s=!0,onEscapeKeyDown:r,...o}){const{isComposing:i}=Dt(),l=ke.useCallback(d=>{if(d.isComposing||i()){d.preventDefault();return}r?.(d)},[i,r]);return e.jsxs(ma,{"data-slot":"dialog-portal",children:[e.jsx(an,{}),e.jsxs(Un,{"data-slot":"dialog-content",className:z("bg-background data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 fixed top-0 left-0 right-0 bottom-0 z-50 flex flex-col w-full h-full border-0 shadow-lg duration-200 sm:top-[50%] sm:left-[50%] sm:right-auto sm:bottom-auto sm:translate-x-[-50%] sm:translate-y-[-50%] sm:max-w-lg sm:h-auto sm:max-h-[90vh] sm:rounded-lg sm:border sm:m-4 sm:flex sm:flex-col",t),onEscapeKeyDown:l,...o,children:[n,s&&e.jsxs($n,{"data-slot":"dialog-close",className:"ring-offset-background focus:ring-ring data-[state=open]:bg-accent data-[state=open]:text-muted-foreground absolute top-4 right-4 rounded-xs opacity-70 transition-opacity hover:opacity-100 focus:ring-2 focus:ring-offset-2 focus:outline-hidden disabled:pointer-events-none [&_svg]:pointer-events-none [&_svg]:shrink-0 [&_svg:not([class*='size-'])]:size-4",children:[e.jsx(Je,{}),e.jsx("span",{className:"sr-only",children:"Close"})]})]})]})}function je({className:t,...n}){return e.jsx("div",{"data-slot":"dialog-header",className:z("flex flex-col gap-2 text-center sm:text-left",t),...n})}function Ne({className:t,...n}){return e.jsx("div",{"data-slot":"dialog-footer",className:z("flex flex-col-reverse gap-2 sm:flex-row sm:justify-end",t),...n})}function De({className:t,...n}){return e.jsx(Kn,{"data-slot":"dialog-title",className:z("text-lg leading-none font-semibold",t),...n})}function Se({className:t,...n}){return e.jsx(Hn,{"data-slot":"dialog-description",className:z("text-muted-foreground text-sm",t),...n})}function fa({selectedDate:t}){const{settings:n,isLoading:s}=Nt(),r=n?.weatherLocation||"Zurich, CH",{data:o,isLoading:i,error:l}=tn(t,r);Bt.useEffect(()=>{},[t,r,s,o,i,l]);const d=u=>{switch(u){case"sun":return e.jsx(Ht,{className:"w-5 h-5"});case"cloud-sun":return e.jsx($t,{className:"w-5 h-5"});case"cloud":return e.jsx(rt,{className:"w-5 h-5"});case"rain":return e.jsx(xt,{className:"w-5 h-5"});case"snow":return e.jsx(xt,{className:"w-5 h-5"});default:return e.jsx(rt,{className:"w-5 h-5"})}};if(!t)return null;const p=t.toLocaleDateString("de-CH",{weekday:"long",day:"numeric",month:"long"});return e.jsxs("div",{className:"p-3 border-b border-border",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("h4",{className:"text-xs font-semibold text-muted-foreground",children:"Wetter"}),e.jsx("span",{className:"text-[10px] text-muted-foreground",children:p})]}),i?e.jsx("div",{className:"flex items-center justify-center py-4",children:e.jsx("div",{className:"text-xs text-muted-foreground",children:"Lädt..."})}):o?e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[d(o.icon),e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-baseline gap-1",children:[e.jsxs("span",{className:"text-lg font-bold",children:[o.temperature,"°"]}),e.jsx("span",{className:"text-xs text-muted-foreground",children:"C"})]}),e.jsx("div",{className:"text-[10px] text-muted-foreground",children:o.condition})]})]}),o.humidity!==void 0&&o.windSpeed!==void 0&&e.jsxs("div",{className:"flex gap-3 text-[9px] text-muted-foreground pt-1 border-t border-border/50",children:[e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(Ut,{className:"w-3 h-3"}),e.jsxs("span",{children:[o.windSpeed," km/h"]})]}),e.jsx("div",{children:e.jsxs("span",{children:["Luftfeuchtigkeit: ",o.humidity,"%"]})})]})]}):l?e.jsxs("div",{className:"space-y-1",children:[e.jsx("div",{className:"text-xs text-muted-foreground text-center py-2",children:l.message||"Fehler beim Laden der Wetterdaten"}),e.jsxs("div",{className:"text-[10px] text-muted-foreground/70 text-center",children:["Standort: ",r]})]}):s?e.jsx("div",{className:"flex items-center justify-center py-4",children:e.jsx("div",{className:"text-xs text-muted-foreground",children:"Lädt Einstellungen..."})}):e.jsxs("div",{className:"space-y-1",children:[e.jsx("div",{className:"text-xs text-muted-foreground text-center py-2",children:"Keine Wetterdaten verfügbar"}),e.jsxs("div",{className:"text-[10px] text-muted-foreground/70 text-center",children:["Standort: ",r]})]})]})}function fr(t){if(!t||!t.includes("T"))throw new Error("Invalid datetime-local format. Expected: YYYY-MM-DDTHH:mm");const[n,s]=t.split("T"),[r,o,i]=n.split("-").map(Number),[l,d]=s?s.split(":").map(Number):[0,0];return new Date(r,o-1,i,l,d,0,0)}function hr(t,n){if(!t)return"N/A";try{let s;if(t?.toDate&&typeof t.toDate=="function")s=t.toDate();else if(typeof t=="string")s=new Date(t);else if(t instanceof Date)s=t;else return"N/A";if(isNaN(s.getTime()))return"N/A";const r=s.getDate().toString().padStart(2,"0"),o=(s.getMonth()+1).toString().padStart(2,"0"),i=s.getFullYear();return n?.includeTime,`${r}.${o}.${i}`}catch{return"N/A"}}function nt(t){if(!t)return nt(new Date);try{let n;if(t?.toDate&&typeof t.toDate=="function")n=t.toDate();else if(typeof t=="string")n=new Date(t);else if(t instanceof Date)n=t;else return nt(new Date);if(isNaN(n.getTime()))return nt(new Date);const s=n.getFullYear(),r=(n.getMonth()+1).toString().padStart(2,"0"),o=n.getDate().toString().padStart(2,"0"),i=n.getHours().toString().padStart(2,"0"),l=n.getMinutes().toString().padStart(2,"0");return`${s}-${r}-${o}T${i}:${l}`}catch{return nt(new Date)}}function zt(t,n=!1){if(!t)return"N/A";try{let s;if(t?.toDate&&typeof t.toDate=="function")s=t.toDate();else if(typeof t=="string")s=new Date(t);else if(t instanceof Date)s=t;else return"N/A";if(isNaN(s.getTime()))return"N/A";const r=s.getHours().toString().padStart(2,"0"),o=s.getMinutes().toString().padStart(2,"0");if(n){const i=s.getSeconds().toString().padStart(2,"0");return`${r}:${o}:${i}`}return`${r}:${o}`}catch{return"N/A"}}function Mt(t){if(!t)return"";try{let n;if(typeof t=="object"&&t!==null&&"toDate"in t&&typeof t.toDate=="function")n=t.toDate();else if(t instanceof Date)n=t;else if(typeof t=="string"){if(!t.includes("T")&&t.match(/^\d{4}-\d{2}-\d{2}$/))return t;n=new Date(t)}else n=new Date(t);if(isNaN(n.getTime()))return"";const s=n.getFullYear(),r=String(n.getMonth()+1).padStart(2,"0"),o=String(n.getDate()).padStart(2,"0");return`${s}-${r}-${o}`}catch{return""}}function ue(t){if(!(t instanceof Date)||isNaN(t.getTime()))throw new Error("Invalid date: must be a valid Date object");const n=t.getFullYear(),s=String(t.getMonth()+1).padStart(2,"0"),r=String(t.getDate()).padStart(2,"0");return`${n}-${s}-${r}`}function ce(t){if(!t)return"";try{let n;if(typeof t=="string")if(t.match(/^\d{4}-\d{2}-\d{2}$/)){const[i,l,d]=t.split("-").map(Number);n=new Date(i,l-1,d)}else n=new Date(t);else if(t instanceof Date)n=t;else return"";if(isNaN(n.getTime()))return"";const s=String(n.getDate()).padStart(2,"0"),r=String(n.getMonth()+1).padStart(2,"0"),o=n.getFullYear();return`${s}.${r}.${o}`}catch{return""}}function He(t){if(!t)return"";try{t=t.trim();const n=t.split(".");if(n.length===3){const s=parseInt(n[0],10),r=parseInt(n[1],10),o=parseInt(n[2],10);if(isNaN(s)||isNaN(r)||isNaN(o))return"";const i=new Date(o,r-1,s);return i.getDate()!==s||i.getMonth()!==r-1||i.getFullYear()!==o?"":`${o}-${String(r).padStart(2,"0")}-${String(s).padStart(2,"0")}`}return t.match(/^\d{4}-\d{2}-\d{2}$/)?t:""}catch{return""}}function gr(t){if(!t)return"";try{let n;if(typeof t=="string")if(t.includes("T")){const[d,p]=t.split("T"),[u,g,m]=d.split("-").map(Number),[h,y]=p?p.split(":").map(Number):[0,0];n=new Date(u,g-1,m,h,y)}else if(t.match(/^\d{4}-\d{2}-\d{2}$/)){const[d,p,u]=t.split("-").map(Number);n=new Date(d,p-1,u)}else n=new Date(t);else if(t instanceof Date)n=t;else return"";if(isNaN(n.getTime()))return"";const s=String(n.getDate()).padStart(2,"0"),r=String(n.getMonth()+1).padStart(2,"0"),o=n.getFullYear(),i=String(n.getHours()).padStart(2,"0"),l=String(n.getMinutes()).padStart(2,"0");return`${s}.${r}.${o} ${i}:${l}`}catch{return""}}function pr(t){if(!t)return"";try{t=t.trim();const n=t.split(" ");if(n.length===2){const s=n[0],r=n[1],o=s.split(".");if(o.length===3){const i=parseInt(o[0],10),l=parseInt(o[1],10),d=parseInt(o[2],10),p=r.split(":"),u=p.length>=1?parseInt(p[0],10):0,g=p.length>=2?parseInt(p[1],10):0;if(isNaN(i)||isNaN(l)||isNaN(d)||isNaN(u)||isNaN(g))return"";const m=new Date(d,l-1,i,u,g);return m.getDate()!==i||m.getMonth()!==l-1||m.getFullYear()!==d?"":`${d}-${String(l).padStart(2,"0")}-${String(i).padStart(2,"0")}T${String(u).padStart(2,"0")}:${String(g).padStart(2,"0")}`}}return t.match(/^\d{4}-\d{2}-\d{2}T\d{2}:\d{2}/)?t:""}catch{return""}}function ha(){const[,t]=Xe(),[n,s]=w(new Date),[r,o]=w([]),[i,l]=w(!1),[d,p]=w(null),[u,g]=w(null),[m,h]=w(!1),[y,a]=w(!1),[b,j]=w(!1),[I,P]=w(!1),[ee,K]=w(ce(new Date)),[J,ne]=w(ce(new Date)),{data:X=[]}=ta(),{settings:oe}=Nt(),A=oe?.weatherLocation||"Zurich, CH",S=d?new Date(d.getFullYear(),d.getMonth(),d.getDate()):null,{data:F,isLoading:W}=tn(S,A);V(()=>{if(!d){const f=new Date,v=new Date(f.getFullYear(),f.getMonth(),f.getDate());p(v)}},[]);const te=["Januar","Februar","März","April","Mai","Juni","Juli","August","September","Oktober","November","Dezember"],O=["Mo","Di","Mi","Do","Fr","Sa","So"],Z=ie(async()=>{try{l(!0);const f=_(U,"getCalendarEvents"),v=_(U,"getVacations"),E=_(U,"getSchoolSchedules"),B=_(U,"getSchoolHolidays"),R=new Date(n.getFullYear(),n.getMonth()-1,1),M=new Date(n.getFullYear(),n.getMonth()+2,0),[D,T,$,L]=await Promise.all([f({startDate:R.toISOString(),endDate:M.toISOString()}).catch(()=>({data:{events:[]}})),v({startDate:R.toISOString(),endDate:M.toISOString()}).catch(()=>({data:{vacations:[]}})),E({startDate:R.toISOString(),endDate:M.toISOString()}).catch(()=>({data:{schedules:[]}})),B({startDate:R.toISOString(),endDate:M.toISOString()}).catch(()=>({data:{holidays:[]}}))]),Y=D.data,ae=T.data,he=$.data,dt=L.data,ut=[...Y.events||[],...(ae.vacations||[]).map(Q=>({id:`vacation-${Q.id}`,type:"work",title:Q.title||"Ferien",date:Q.startDate,description:Q.description})),...(he.schedules||[]).map(Q=>({id:`school-${Q.id}`,type:"school",title:Q.childName?`${Q.childName} - Schule`:"Schule",date:Q.date,schoolType:Q.type})),...(dt.holidays||[]).map(Q=>({id:`holiday-${Q.id}`,type:"school-holiday",title:Q.title||"Schulferien",date:Q.date}))];o(ut)}catch{}finally{l(!1)}},[n]);V(()=>{Z()},[Z]);const ze=f=>{const v=new Date(f),E=v.getDay(),B=v.getDate()-(E===0?6:E-1);return new Date(v.setDate(B))},me=xe(()=>{const f=ze(n),v=[],E=B=>{const R=ue(B),M=r.filter(L=>{if(!L.date)return!1;let Y=Mt(L.date);if(!Y&&typeof L.date=="string"){const ae=L.date.split("T")[0];ae.match(/^\d{4}-\d{2}-\d{2}/)&&(Y=ae)}return Y===R}),T=X.filter(L=>{if(!L.dueDate)return!1;let Y;if(L.dueDate instanceof Date)Y=L.dueDate;else if(typeof L.dueDate=="string")Y=new Date(L.dueDate);else return!1;return isNaN(Y.getTime())?!1:ue(Y)===R}).map(L=>{let Y="appointment";L.type==="termin"?Y="appointment":L.type==="zahlung"?Y="due":L.type==="aufgabe"&&(Y="reminder");let ae;if(L.dueDate instanceof Date)ae=L.dueDate;else if(typeof L.dueDate=="string")ae=new Date(L.dueDate);else throw new Error(`Invalid dueDate for reminder ${L.id}`);return{id:`reminder-${L.id}`,type:Y,title:L.title,date:ue(ae),time:L.isAllDay?void 0:zt(ae),description:L.notes||void 0,status:L.status}}),$=[...M];for(const L of T)$.some(Y=>Y.id===L.id)||$.push(L);return $};for(let B=0;B<7;B++){const R=new Date(f);R.setDate(f.getDate()+B);const M=E(R);v.push({date:R,events:M})}return v},[n,r,X]),be=()=>{const f=new Date(n);f.setDate(f.getDate()-7),s(f)},Me=()=>{const f=new Date(n);f.setDate(f.getDate()+7),s(f)},se=()=>{s(new Date)},fe=f=>{const v=new Date;return f.toDateString()===v.toDateString()},Le=f=>{const v=new Date(f.getFullYear(),f.getMonth(),f.getDate());console.log("[SidebarCalendar] handleDayClick:",{originalDate:f.toISOString(),normalizedDate:v.toISOString(),dateStr:ue(v)}),p(v),h(!0)},Pe=f=>{const v=new Date(f.getFullYear(),f.getMonth(),f.getDate());p(v)},Ee=f=>{g(f),a(!0)},x=xe(()=>{if(!d)return console.log("[SidebarCalendar] dayEvents - no selectedDate"),[];const f=new Date(d.getFullYear(),d.getMonth(),d.getDate()),v=ue(f);console.log("[SidebarCalendar] dayEvents filter - START:",{selectedDate:d.toISOString(),normalizedSelectedDate:f.toISOString(),dateStr:v,totalEvents:r.length,totalReminders:X.length});const E=r.filter(D=>{if(!D.date)return console.log("[SidebarCalendar] Event skipped - no date:",D.title),!1;let T=Mt(D.date);if(!T&&typeof D.date=="string"){const L=D.date.split("T")[0];L.match(/^\d{4}-\d{2}-\d{2}/)&&(T=L,console.log("[SidebarCalendar] Using fallback date extraction for filter:",T))}if(!T)return console.log("[SidebarCalendar] Event skipped - invalid date:",D.title,D.date),!1;const $=T===v;return $&&console.log("[SidebarCalendar] Event matched:",{eventTitle:D.title,eventDate:D.date,eventDateStr:T,selectedDateStr:v}),$}),B=X.filter(D=>{if(!D.dueDate)return!1;let T;if(D.dueDate instanceof Date)T=D.dueDate;else if(typeof D.dueDate=="string")T=new Date(D.dueDate);else return!1;return isNaN(T.getTime())?!1:ue(T)===v});console.log("[SidebarCalendar] Reminders for date:",{dateStr:v,remindersForDate:B.length,reminders:B.map(D=>({id:D.id,title:D.title,dueDate:D.dueDate}))});const R=B.map(D=>{let T="appointment";D.type==="termin"?T="appointment":D.type==="zahlung"?T="due":D.type==="aufgabe"&&(T="reminder");let $;if(D.dueDate instanceof Date)$=D.dueDate;else if(typeof D.dueDate=="string")$=new Date(D.dueDate);else throw new Error(`Invalid dueDate for reminder ${D.id}`);return{id:`reminder-${D.id}`,type:T,title:D.title,date:ue($),time:D.isAllDay?void 0:zt($),description:D.notes||void 0,status:D.status}}),M=[...E];for(const D of R)M.some(T=>T.id===D.id)||M.push(D);return console.log("[SidebarCalendar] dayEvents filter - RESULT:",{selectedDate:f.toISOString(),dateStr:v,filteredFromEvents:E.length,fromReminders:R.length,totalDayEvents:M.length,allDayEvents:M.map(D=>({id:D.id,title:D.title,date:D.date,type:D.type}))}),M},[d,r,X]),k=f=>{switch(f){case"due":return"bg-pink-500";case"reminder":case"appointment":case"termin":return"bg-orange-500";case"work":return"bg-slate-400";case"vacation":case"frei":return"bg-emerald-400";case"school-holiday":return"bg-sky-400";case"school":return"bg-purple-400";case"hort":return"bg-fuchsia-500";default:return"bg-gray-500"}};return e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"p-2 border-b border-border",children:[e.jsxs("div",{className:"flex items-center justify-between mb-1.5",children:[e.jsx(H,{variant:"ghost",size:"sm",onClick:be,className:"h-5 w-5 p-0 min-w-0",children:e.jsx(hn,{className:"w-3 h-3"})}),e.jsx("div",{className:"flex-1 text-center px-1",children:e.jsxs("h3",{className:"text-[11px] font-semibold leading-tight",children:[te[n.getMonth()]," ",n.getFullYear()]})}),e.jsx(H,{variant:"ghost",size:"sm",onClick:Me,className:"h-5 w-5 p-0 min-w-0",children:e.jsx(gn,{className:"w-3 h-3"})})]}),e.jsx("div",{className:"grid grid-cols-7 gap-0",children:O.map((f,v)=>{const E=me[v],B=E?fe(E.date):!1;return e.jsxs("div",{className:"flex flex-col items-center",children:[e.jsx("div",{className:"text-center text-[10px] font-medium text-muted-foreground mb-1 w-full",children:f}),E&&e.jsxs("button",{onClick:()=>{Pe(E.date),Le(E.date)},className:z("w-full aspect-square min-h-[28px] max-h-[30px] rounded-sm transition-colors flex flex-col items-center justify-center relative","text-foreground",d&&E.date.toDateString()===d.toDateString()?"bg-primary/20 ring-1 ring-primary":B?"bg-primary text-primary-foreground font-semibold":"hover:bg-muted/50"),children:[e.jsx("span",{className:"text-[12px] leading-none font-medium",children:E.date.getDate()}),E.events.length>0&&e.jsx("div",{className:"absolute bottom-0.5 left-0 right-0 flex gap-0.5 justify-center",children:E.events.slice(0,2).map((R,M)=>e.jsx("div",{onClick:D=>{D.stopPropagation(),Ee(R)},className:z("h-0.5 w-0.5 rounded-full",k(R.type)),title:R.title},M))})]})]},v)})}),e.jsx(H,{variant:"ghost",size:"sm",onClick:se,className:"w-full h-6 mt-1.5 text-[10px]",children:"Heute"})]}),e.jsx(fa,{selectedDate:d}),e.jsx(ve,{open:m,onOpenChange:h,children:e.jsxs(we,{className:"!fixed !top-[50%] !left-[50%] !right-auto !bottom-auto !translate-x-[-50%] !translate-y-[-50%] !w-[85vw] !max-w-sm !max-h-[85vh] !rounded-3xl !m-0 !overflow-y-auto !shadow-2xl",children:[e.jsxs(je,{className:"px-5 pt-5 pb-3 sticky top-0 bg-background z-10 border-b border-border",children:[e.jsx(Se,{className:"sr-only",children:"Details für den ausgewählten Tag mit Wetter, Terminen und Schnellaktionen"}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx(De,{className:"text-lg font-semibold",children:d?.toLocaleDateString("de-CH",{weekday:"long",day:"numeric",month:"long",year:"numeric"})}),e.jsx(H,{variant:"ghost",size:"sm",onClick:()=>h(!1),className:"h-8 w-8 p-0",children:e.jsx(Je,{className:"h-4 w-4"})})]})]}),e.jsxs("div",{className:"space-y-4 px-5 pb-2",children:[e.jsxs("div",{className:"bg-muted/30 rounded-xl p-4 space-y-3",children:[e.jsx("div",{className:"flex items-center justify-between",children:e.jsxs("h3",{className:"text-sm font-semibold flex items-center gap-2",children:[e.jsx(rt,{className:"w-4 h-4"}),"Wetter"]})}),W?e.jsx("div",{className:"flex items-center justify-center py-4",children:e.jsx("div",{className:"text-xs text-muted-foreground",children:"Lädt Wetterdaten..."})}):F?e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[F.icon==="sun"&&e.jsx(Ht,{className:"w-6 h-6 text-yellow-500"}),F.icon==="cloud-sun"&&e.jsx($t,{className:"w-6 h-6 text-gray-500"}),F.icon==="cloud"&&e.jsx(rt,{className:"w-6 h-6 text-gray-500"}),F.icon==="rain"&&e.jsx(xt,{className:"w-6 h-6 text-blue-500"}),e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-baseline gap-1",children:[e.jsxs("span",{className:"text-2xl font-bold",children:[F.temperature,"°"]}),e.jsx("span",{className:"text-sm text-muted-foreground",children:"C"})]}),e.jsx("div",{className:"text-xs text-muted-foreground",children:F.condition})]})]}),(F.humidity!==void 0||F.windSpeed!==void 0)&&e.jsxs("div",{className:"flex gap-4 text-xs text-muted-foreground pt-2 border-t border-border/50",children:[F.windSpeed!==void 0&&e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(Ut,{className:"w-3 h-3"}),e.jsxs("span",{children:[F.windSpeed," km/h"]})]}),F.humidity!==void 0&&e.jsx("div",{children:e.jsxs("span",{children:["Luftfeuchtigkeit: ",F.humidity,"%"]})})]})]}):e.jsx("div",{className:"text-xs text-muted-foreground text-center py-2",children:"Keine Wetterdaten verfügbar"})]}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-sm font-semibold mb-2",children:"Termine & Events"}),x.length===0?e.jsx("p",{className:"text-sm text-muted-foreground text-center py-4 bg-muted/30 rounded-lg",children:"Keine Events an diesem Tag"}):e.jsx("div",{className:"space-y-2",children:x.map(f=>e.jsx(da,{className:"cursor-pointer hover:bg-muted/50 transition-colors",onClick:()=>{h(!1),Ee(f)},children:e.jsx(ua,{className:"p-3",children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("div",{className:z("w-3 h-3 rounded-full mt-1 flex-shrink-0",k(f.type))}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("p",{className:"font-medium text-sm truncate",children:f.title}),f.time&&e.jsx("p",{className:"text-xs text-muted-foreground mt-1",children:f.time}),f.personName&&e.jsx("p",{className:"text-xs text-muted-foreground mt-1",children:f.personName})]})]})})},f.id))})]}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-sm font-semibold mb-2",children:"Schnellaktionen"}),e.jsxs("div",{className:"grid grid-cols-2 gap-2",children:[e.jsxs(H,{variant:"outline",onClick:()=>{j(!0)},className:"h-auto py-3 flex flex-col items-center gap-2 rounded-xl",children:[e.jsx(pn,{className:"w-5 h-5"}),e.jsx("span",{className:"text-xs",children:"Termin erstellen"})]}),e.jsxs(H,{variant:"outline",onClick:()=>{P(!0)},className:"h-auto py-3 flex flex-col items-center gap-2 rounded-xl",children:[e.jsx(Ae,{className:"w-5 h-5"}),e.jsx("span",{className:"text-xs",children:"Finanz-Eintrag"})]})]})]})]}),e.jsxs(Ne,{className:"px-5 pb-3 pt-2 sticky bottom-0 bg-background border-t border-border",children:[e.jsx(H,{variant:"outline",onClick:()=>{try{h(!1),setTimeout(()=>{try{t("/calendar")}catch(f){console.error("Navigation error:",f),N.error("Fehler beim Navigieren zum Kalender")}},100)}catch(f){console.error("Dialog close error:",f),N.error("Fehler beim Schließen des Dialogs")}},className:"h-11 min-h-[44px] flex-1 rounded-xl text-sm font-medium",children:"Zum Kalender"}),e.jsx(H,{variant:"default",onClick:()=>h(!1),className:"h-11 min-h-[44px] flex-1 rounded-xl text-sm font-medium",children:"Schließen"})]})]})}),e.jsx(ve,{open:b,onOpenChange:f=>{j(f),f&&K(ce(d||new Date))},children:e.jsxs(we,{className:"!fixed !top-[50%] !left-[50%] !right-auto !bottom-auto !translate-x-[-50%] !translate-y-[-50%] !w-[85vw] !max-w-sm !max-h-fit !rounded-3xl !m-0 !overflow-visible !shadow-2xl",children:[e.jsxs(je,{className:"px-5 pt-5 pb-3",children:[e.jsx(De,{className:"text-lg font-semibold",children:"Termin erstellen"}),e.jsx(Se,{className:"sr-only",children:"Erstellen Sie einen neuen Termin mit Titel, Datum, Uhrzeit und optionalen Notizen"})]}),e.jsxs("div",{className:"px-5 pb-2 space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium mb-1 block",children:"Titel"}),e.jsx("input",{type:"text",id:"reminder-title",placeholder:"z.B. Arzttermin",className:"w-full px-3 py-2 border border-border rounded-lg text-sm",autoFocus:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium mb-1 block",children:"Datum"}),e.jsx("input",{type:"text",id:"reminder-date",placeholder:"DD.MM.YYYY",value:ee,onChange:f=>{const v=f.target.value;K(v)},onBlur:f=>{const v=He(f.target.value);v?K(ce(v)):f.target.value&&d&&K(ce(d))},className:"w-full px-3 py-2 border border-border rounded-lg text-sm"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium mb-1 block",children:"Uhrzeit (optional)"}),e.jsx("input",{type:"time",id:"reminder-time",className:"w-full px-3 py-2 border border-border rounded-lg text-sm"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium mb-1 block",children:"Notizen (optional)"}),e.jsx("textarea",{id:"reminder-notes",placeholder:"Weitere Details...",rows:3,className:"w-full px-3 py-2 border border-border rounded-lg text-sm resize-none"})]})]}),e.jsxs(Ne,{className:"px-5 pb-3 pt-2",children:[e.jsx(H,{variant:"outline",onClick:()=>j(!1),className:"h-11 min-h-[44px] flex-1 rounded-xl text-sm font-medium",children:"Abbrechen"}),e.jsx(H,{variant:"default",onClick:async()=>{try{const f=document.getElementById("reminder-title"),v=document.getElementById("reminder-date"),E=document.getElementById("reminder-time"),B=document.getElementById("reminder-notes");if(!f.value.trim()){N.error("Bitte gib einen Titel ein");return}const R=He(v.value);if(!R){N.error("Bitte gib ein gültiges Datum ein (DD.MM.YYYY)");return}const M=new Date(R);if(E.value){const[D,T]=E.value.split(":");M.setHours(parseInt(D),parseInt(T))}else M.setHours(12,0);await Qt({title:f.value.trim(),type:"termin",dueDate:M,isAllDay:!E.value,notes:B.value.trim()||null}),N.success("Termin erstellt"),j(!1),h(!1),Z()}catch(f){N.error(f.message||"Fehler beim Erstellen des Termins")}},className:"h-11 min-h-[44px] flex-1 rounded-xl text-sm font-medium",children:"Erstellen"})]})]})}),e.jsx(ve,{open:I,onOpenChange:f=>{P(f),f&&ne(ce(d||new Date))},children:e.jsxs(we,{className:"!fixed !top-[50%] !left-[50%] !right-auto !bottom-auto !translate-x-[-50%] !translate-y-[-50%] !w-[85vw] !max-w-sm !max-h-fit !rounded-3xl !m-0 !overflow-visible !shadow-2xl",children:[e.jsxs(je,{className:"px-5 pt-5 pb-3",children:[e.jsx(De,{className:"text-lg font-semibold",children:"Finanz-Eintrag erstellen"}),e.jsx(Se,{className:"sr-only",children:"Erstellen Sie einen neuen Finanz-Eintrag mit Beschreibung, Betrag, Typ und Datum"})]}),e.jsxs("div",{className:"px-5 pb-2 space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium mb-1 block",children:"Beschreibung"}),e.jsx("input",{type:"text",id:"finance-description",placeholder:"z.B. Einkauf, Gehalt",className:"w-full px-3 py-2 border border-border rounded-lg text-sm",autoFocus:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium mb-1 block",children:"Betrag (CHF)"}),e.jsx("input",{type:"number",id:"finance-amount",placeholder:"0.00",step:"0.01",className:"w-full px-3 py-2 border border-border rounded-lg text-sm"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium mb-1 block",children:"Typ"}),e.jsxs("select",{id:"finance-type",className:"w-full px-3 py-2 border border-border rounded-lg text-sm",children:[e.jsx("option",{value:"einnahme",children:"Einnahme"}),e.jsx("option",{value:"ausgabe",children:"Ausgabe"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium mb-1 block",children:"Datum"}),e.jsx("input",{type:"text",id:"finance-date",placeholder:"DD.MM.YYYY",value:J,onChange:f=>{const v=f.target.value;ne(v)},onBlur:f=>{const v=He(f.target.value);v?ne(ce(v)):f.target.value&&d&&ne(ce(d))},className:"w-full px-3 py-2 border border-border rounded-lg text-sm"})]})]}),e.jsxs(Ne,{className:"px-5 pb-3 pt-2",children:[e.jsx(H,{variant:"outline",onClick:()=>P(!1),className:"h-11 min-h-[44px] flex-1 rounded-xl text-sm font-medium",children:"Abbrechen"}),e.jsx(H,{variant:"default",onClick:async()=>{try{const f=document.getElementById("finance-description"),v=document.getElementById("finance-amount"),E=document.getElementById("finance-type"),B=document.getElementById("finance-date");if(!f.value.trim()){N.error("Bitte gib eine Beschreibung ein");return}const R=He(B.value);if(!R){N.error("Bitte gib ein gültiges Datum ein (DD.MM.YYYY)");return}if(!v.value||parseFloat(v.value)<=0){N.error("Bitte gib einen gültigen Betrag ein");return}await en({description:f.value.trim(),amount:Math.round(parseFloat(v.value)*100),type:E.value,date:new Date(R),category:"Sonstiges",currency:"CHF",isRecurring:!1}),N.success("Finanz-Eintrag erstellt"),P(!1),h(!1)}catch(f){N.error(f.message||"Fehler beim Erstellen des Finanz-Eintrags")}},className:"h-11 min-h-[44px] flex-1 rounded-xl text-sm font-medium",children:"Erstellen"})]})]})}),e.jsx(ve,{open:y,onOpenChange:a,children:e.jsxs(we,{className:"!fixed !top-[50%] !left-[50%] !right-auto !bottom-auto !translate-x-[-50%] !translate-y-[-50%] !w-[85vw] !max-w-sm !max-h-fit !rounded-3xl !m-0 !overflow-visible !shadow-2xl",children:[e.jsxs(je,{className:"px-5 pt-5 pb-3",children:[e.jsx(De,{className:"text-lg font-semibold",children:u?.title}),e.jsx(Se,{className:"sr-only",children:"Detaillierte Informationen zum ausgewählten Event"})]}),e.jsxs("div",{className:"space-y-3 px-5 pb-2",children:[u?.date&&e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-muted-foreground mb-1",children:"Datum"}),e.jsx("p",{className:"text-sm",children:new Date(u.date).toLocaleDateString("de-CH",{weekday:"long",day:"numeric",month:"long",year:"numeric"})})]}),u?.time&&e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-muted-foreground mb-1",children:"Uhrzeit"}),e.jsx("p",{className:"text-sm",children:u.time})]}),u?.description&&e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-muted-foreground mb-1",children:"Beschreibung"}),e.jsx("p",{className:"text-sm",children:u.description})]}),u?.personName&&e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-muted-foreground mb-1",children:"Person"}),e.jsx("p",{className:"text-sm",children:u.personName})]}),u?.amount&&e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-muted-foreground mb-1",children:"Betrag"}),e.jsxs("p",{className:"text-sm",children:["CHF ",u.amount.toFixed(2)]})]})]}),e.jsxs(Ne,{className:"px-5 pb-3 pt-2",children:[e.jsx(H,{variant:"outline",onClick:()=>{a(!1),t("/calendar")},className:"h-11 min-h-[44px] w-full rounded-xl text-sm font-medium",children:"Zum Kalender"}),e.jsx(H,{variant:"outline",onClick:()=>a(!1),className:"h-11 min-h-[44px] w-full rounded-xl text-sm font-medium",children:"Schließen"})]})]})})]})}const ga=[{path:"/",icon:xn,label:"Assistent"},{path:"/dashboard",icon:vt,label:"Dashboard"},{path:"/calendar",icon:wt,label:"Kalender"},{path:"/reminders",icon:lt,label:"Erinnerungen"},{path:"/finance",icon:Ae,label:"Finanzen"},{path:"/people",icon:it,label:"Personen"},{path:"/bills",icon:Ke,label:"Rechnungen"},{path:"/documents",icon:We,label:"Dokumente"},{path:"/shopping",icon:Ze,label:"Einkaufen"},{path:"/taxes",icon:Kt,label:"Steuern"},{path:"/settings",icon:ot,label:"Einstellungen"}];function pa({open:t,onClose:n,currentChatId:s,onSelectChat:r,onNewChat:o}){const[i]=Xe(),{user:l}=Ye(),{isEnabled:d}=nn(),p=()=>{if(l?.displayName){const u=l.displayName.split(" ");return u.length>=2?(u[0][0]+u[1][0]).toUpperCase():l.displayName.substring(0,2).toUpperCase()}return l?.email?l.email.substring(0,2).toUpperCase():"U"};return e.jsxs(e.Fragment,{children:[t&&e.jsx("div",{className:z("fixed inset-0 z-40 transition-opacity",d?"bg-black/5":"bg-black/50"),onClick:n}),e.jsx("aside",{className:z("fixed top-0 left-0 h-full w-full max-w-sm z-50 transform transition-transform duration-300 ease-in-out shadow-xl",t?"translate-x-0":"-translate-x-full",d?"bg-background/95 backdrop-blur-md":"bg-background"),"aria-label":"Hauptnavigation","aria-hidden":!t,children:e.jsxs("div",{className:"flex flex-col h-full",children:[e.jsx("div",{className:"p-4 border-b border-border",children:e.jsxs("div",{className:"flex items-center gap-3 mb-3",children:[e.jsx("button",{onClick:n,className:"p-2 hover:bg-muted rounded-lg transition-colors","aria-label":"Menü schließen",tabIndex:t?0:-1,children:e.jsx(Je,{className:"w-5 h-5"})}),e.jsx("h2",{className:"text-lg font-semibold flex-1",children:"Menü"})]})}),e.jsxs("div",{className:"flex-1 overflow-y-auto",children:[e.jsxs("div",{className:"p-4 border-b border-border",children:[e.jsx("h3",{className:"text-xs font-semibold text-muted-foreground uppercase tracking-wider mb-3",children:"Navigation"}),e.jsx("nav",{className:"space-y-1",children:ga.map(u=>{const g=u.icon,m=i===u.path;return e.jsx(Bn,{href:u.path,children:e.jsxs("button",{onClick:n,className:z("w-full flex items-center gap-3 px-3 py-2.5 rounded-lg transition-colors text-left min-h-[44px]",m?"bg-primary/10 text-primary font-medium":"text-foreground hover:bg-muted"),"aria-label":`Zu ${u.label} navigieren`,"aria-current":m?"page":void 0,"aria-pressed":m,type:"button",role:"menuitem",tabIndex:t?0:-1,children:[e.jsx(g,{className:"w-5 h-5 flex-shrink-0","aria-hidden":"true"}),e.jsx("span",{className:"text-sm",children:u.label})]})},u.path)})})]}),e.jsx(ha,{})]}),e.jsx("div",{className:"p-4 border-t border-border",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-10 h-10 rounded-full bg-primary text-primary-foreground flex items-center justify-center flex-shrink-0 text-sm font-medium",children:l?.photoURL?e.jsx("img",{src:l.photoURL,alt:l?.displayName||"Benutzerprofilbild",className:"w-10 h-10 rounded-full object-cover"}):e.jsx("span",{"aria-label":"Benutzerinitialen",children:p()})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("p",{className:"text-sm font-medium truncate",children:l?.displayName||"Benutzer"}),e.jsx("p",{className:"text-xs text-muted-foreground truncate",children:l?.email||"Nicht angemeldet"})]})]})})]})})]})}function rn(){return sa()}async function ft(t){try{if(t.id&&!t.id.startsWith("chat_"))await oa(t.id,{title:t.title,messages:t.messages});else{const n=await ia({title:t.title,messages:t.messages});t.id=n.id}}catch(n){throw n}}async function xa(){try{return{deletedCount:(await la()).deletedCount}}catch(t){throw t}}function ht(t,n){return n.find(s=>s.id===t)||null}function ba(t){return t.length<=50?t:t.substring(0,50)+"..."}function Lt(){const t=`chat_${Date.now()}_${Math.random().toString(36).substring(2,9)}`,n=new Date().toISOString();return{id:t,userId:"",title:"Neue Konversation",messages:[],createdAt:n,updatedAt:n}}function ya({title:t,showSidebar:n=!1,showQuickActions:s=!1,quickActions:r=[],currentChatId:o,onSelectChat:i,onNewChat:l,sidebarOpen:d,onSidebarToggle:p}){Xe();const[u,g]=w(!1),{isEnabled:m}=nn(),[h,y]=w(!1),[a,b]=w(!1),[j,I]=w(!1),{data:P,refetch:ee}=rn(),K=G(null),J=d!==void 0?d:u,ne=p||g;V(()=>{h&&ee()},[h,ee]),V(()=>{const A=S=>{K.current&&!K.current.contains(S.target)&&y(!1)};return document.addEventListener("mousedown",A),()=>document.removeEventListener("mousedown",A)},[]);const X=A=>{const S=typeof A=="string"?new Date(A):typeof A=="number"?new Date(A):A,W=new Date().getTime()-S.getTime(),te=Math.floor(W/(1e3*60*60*24));return te===0?"Heute":te===1?"Gestern":te<7?`${te} Tage`:S.toLocaleDateString("de-DE",{day:"2-digit",month:"2-digit"})},oe=async()=>{if(P.length===0){N.info("Keine Chats zum Löschen vorhanden");return}I(!0);try{const A=await xa();N.success(`${A.deletedCount} Chat${A.deletedCount!==1?"s":""} gelöscht`),b(!1),y(!1),await ee(),l&&l()}catch(A){console.error("Fehler beim Löschen aller Chats:",A),N.error("Fehler beim Löschen der Chats")}finally{I(!1)}};return e.jsxs(e.Fragment,{children:[n&&e.jsx(pa,{open:J,onClose:()=>ne(!1),currentChatId:o,onSelectChat:i,onNewChat:l}),e.jsx("header",{className:z("fixed top-0 left-0 right-0 z-40 border-b safe-top",m?"bg-background/95 backdrop-blur-md border-border/30":"bg-background border-border"),children:e.jsxs("div",{className:"px-4 h-14 flex items-center gap-3",children:[e.jsx("div",{className:"flex-1 flex items-center justify-center",children:e.jsx("h1",{className:"text-lg font-semibold text-center",children:t})}),l&&e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{onClick:()=>{l&&l()},className:"p-2 hover:bg-muted rounded-lg transition-colors","aria-label":"Neue Konversation",children:e.jsx(bn,{className:"w-5 h-5"})}),e.jsxs("div",{className:"relative",ref:K,children:[e.jsx("button",{onClick:()=>{y(!h),h||ee()},className:"p-2 hover:bg-muted rounded-lg transition-colors","aria-label":"Chat-Verlauf",children:e.jsx(yn,{className:"w-5 h-5"})}),h&&e.jsxs("div",{className:"absolute top-full right-0 mt-2 w-72 bg-background border border-border rounded-lg shadow-lg z-50 overflow-hidden max-h-[60vh] flex flex-col",children:[e.jsxs("div",{className:"p-3 border-b border-border flex items-center justify-between",children:[e.jsx("h3",{className:"text-sm font-semibold",children:"Chat-Verlauf"}),e.jsx("button",{onClick:()=>y(!1),className:"p-1 hover:bg-muted rounded transition-colors",children:e.jsx(Je,{className:"w-4 h-4"})})]}),e.jsx("div",{className:"overflow-y-auto",children:P.length===0?e.jsx("p",{className:"text-sm text-muted-foreground py-4 px-3 text-center",children:"Noch keine Konversationen"}):e.jsx("div",{className:"p-2",children:P.map(A=>{const S=o===A.id;return e.jsx("button",{onClick:()=>{i&&i(A.id),y(!1)},className:z("w-full flex items-center justify-between gap-2 px-3 py-2.5 rounded-lg transition-colors text-left",S?"bg-primary/10 text-primary":"hover:bg-muted"),children:e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("p",{className:z("text-sm truncate",S&&"font-medium"),children:A.title}),e.jsx("p",{className:"text-xs text-muted-foreground mt-0.5",children:X(A.updatedAt)})]})},A.id)})})}),P.length>0&&e.jsx("div",{className:"p-3 border-t border-border",children:e.jsxs("button",{onClick:()=>b(!0),className:"w-full flex items-center justify-center gap-2 px-3 py-2 rounded-lg bg-destructive/10 hover:bg-destructive/20 text-destructive transition-colors text-sm font-medium",disabled:j,children:[e.jsx(vn,{className:"w-4 h-4"}),e.jsx("span",{children:"Alle löschen"})]})})]})]})]})]})}),a&&e.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black/50 p-4",children:e.jsxs("div",{className:"bg-background border border-border rounded-lg shadow-lg max-w-sm w-full p-6",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[e.jsx("div",{className:"p-2 rounded-full bg-destructive/10",children:e.jsx(wn,{className:"w-5 h-5 text-destructive"})}),e.jsx("h3",{className:"text-lg font-semibold",children:"Alle Chats löschen?"})]}),e.jsxs("p",{className:"text-sm text-muted-foreground mb-6",children:["Diese Aktion kann nicht rückgängig gemacht werden. Alle ",P.length," Chat",P.length!==1?"s":""," werden permanent gelöscht."]}),e.jsxs("div",{className:"flex gap-3",children:[e.jsx("button",{onClick:()=>b(!1),className:"flex-1 px-4 py-2 rounded-lg border border-border hover:bg-muted transition-colors text-sm font-medium",disabled:j,children:"Abbrechen"}),e.jsx("button",{onClick:oe,className:"flex-1 px-4 py-2 rounded-lg bg-destructive text-destructive-foreground hover:bg-destructive/90 transition-colors text-sm font-medium",disabled:j,children:j?"Löschen...":"Ja, alle löschen"})]})]})})]})}function st(t){const n=G(t);n.current=t;const s=G(null);return s.current||(s.current=function(...r){return n.current.apply(this,r)}),s.current}function on(t={}){const{onKeyDown:n,onCompositionStart:s,onCompositionEnd:r}=t,o=G(!1),i=G(null),l=G(null),d=st(m=>{i.current&&(clearTimeout(i.current),i.current=null),l.current&&(clearTimeout(l.current),l.current=null),o.current=!0,s?.(m)}),p=st(m=>{i.current=setTimeout(()=>{l.current=setTimeout(()=>{o.current=!1})}),r?.(m)}),u=st(m=>{if(o.current&&(m.key==="Escape"||m.key==="Enter"&&!m.shiftKey)){m.stopPropagation();return}n?.(m)}),g=st(()=>o.current);return{onCompositionStart:d,onCompositionEnd:p,onKeyDown:u,isComposing:g}}function ye({className:t,type:n,onKeyDown:s,onCompositionStart:r,onCompositionEnd:o,...i}){const l=Dt(),{onCompositionStart:d,onCompositionEnd:p,onKeyDown:u}=on({onKeyDown:g=>{const m=g.nativeEvent.isComposing||l.justEndedComposing();g.key==="Enter"&&m||s?.(g)},onCompositionStart:g=>{l.setComposing(!0),r?.(g)},onCompositionEnd:g=>{l.markCompositionEnd(),setTimeout(()=>{l.setComposing(!1)},100),o?.(g)}});return e.jsx("input",{type:n,"data-slot":"input",className:z("file:text-foreground placeholder:text-muted-foreground selection:bg-primary selection:text-primary-foreground dark:bg-input/30 border-input h-9 w-full min-w-0 rounded-md border bg-transparent px-3 py-1 text-base shadow-xs transition-[color,box-shadow] outline-none file:inline-flex file:h-7 file:border-0 file:bg-transparent file:text-sm file:font-medium disabled:pointer-events-none disabled:cursor-not-allowed disabled:opacity-50 md:text-sm","focus-visible:border-ring focus-visible:ring-ring/50 focus-visible:ring-[3px]","aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive",t),onCompositionStart:d,onCompositionEnd:p,onKeyDown:u,...i})}function re({className:t,...n}){return e.jsx(qn,{"data-slot":"label",className:z("flex items-center gap-2 text-sm leading-none font-medium select-none group-data-[disabled=true]:pointer-events-none group-data-[disabled=true]:opacity-50 peer-disabled:cursor-not-allowed peer-disabled:opacity-50",t),...n})}function Oe({...t}){return e.jsx(Gn,{"data-slot":"select",...t})}function _e({...t}){return e.jsx(Jn,{"data-slot":"select-value",...t})}function Ue({className:t,size:n="default",children:s,...r}){return e.jsxs(Vn,{"data-slot":"select-trigger","data-size":n,className:z("border-input data-[placeholder]:text-muted-foreground [&_svg:not([class*='text-'])]:text-muted-foreground focus-visible:border-ring focus-visible:ring-ring/50 aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive dark:bg-input/30 dark:hover:bg-input/50 flex w-fit items-center justify-between gap-2 rounded-md border bg-transparent px-3 py-2 text-sm whitespace-nowrap shadow-xs transition-[color,box-shadow] outline-none focus-visible:ring-[3px] disabled:cursor-not-allowed disabled:opacity-50 data-[size=default]:h-9 data-[size=sm]:h-8 *:data-[slot=select-value]:line-clamp-1 *:data-[slot=select-value]:flex *:data-[slot=select-value]:items-center *:data-[slot=select-value]:gap-2 [&_svg]:pointer-events-none [&_svg]:shrink-0 [&_svg:not([class*='size-'])]:size-4",t),...r,children:[s,e.jsx(Zn,{asChild:!0,children:e.jsx(Wt,{className:"size-4 opacity-50"})})]})}function $e({className:t,children:n,position:s="popper",align:r="center",...o}){return e.jsx(Xn,{children:e.jsxs(Qn,{"data-slot":"select-content",className:z("bg-popover text-popover-foreground data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 relative z-50 max-h-(--radix-select-content-available-height) min-w-[8rem] origin-(--radix-select-content-transform-origin) overflow-x-hidden overflow-y-auto rounded-md border shadow-md",s==="popper"&&"data-[side=bottom]:translate-y-1 data-[side=left]:-translate-x-1 data-[side=right]:translate-x-1 data-[side=top]:-translate-y-1",t),position:s,align:r,...o,children:[e.jsx(va,{}),e.jsx(es,{className:z("p-1",s==="popper"&&"h-[var(--radix-select-trigger-height)] w-full min-w-[var(--radix-select-trigger-width)] scroll-my-1"),children:n}),e.jsx(wa,{})]})})}function le({className:t,children:n,...s}){return e.jsxs(ts,{"data-slot":"select-item",className:z("focus:bg-accent focus:text-accent-foreground [&_svg:not([class*='text-'])]:text-muted-foreground relative flex w-full cursor-default items-center gap-2 rounded-sm py-1.5 pr-8 pl-2 text-sm outline-hidden select-none data-[disabled]:pointer-events-none data-[disabled]:opacity-50 [&_svg]:pointer-events-none [&_svg]:shrink-0 [&_svg:not([class*='size-'])]:size-4 *:[span]:last:flex *:[span]:last:items-center *:[span]:last:gap-2",t),...s,children:[e.jsx("span",{className:"absolute right-2 flex size-3.5 items-center justify-center",children:e.jsx(ns,{children:e.jsx(Yt,{className:"size-4"})})}),e.jsx(ss,{children:n})]})}function va({className:t,...n}){return e.jsx(as,{"data-slot":"select-scroll-up-button",className:z("flex cursor-default items-center justify-center py-1",t),...n,children:e.jsx(jn,{className:"size-4"})})}function wa({className:t,...n}){return e.jsx(rs,{"data-slot":"select-scroll-down-button",className:z("flex cursor-default items-center justify-center py-1",t),...n,children:e.jsx(Wt,{className:"size-4"})})}function ja({className:t,...n}){return e.jsx(is,{"data-slot":"switch",className:z("peer data-[state=checked]:bg-primary data-[state=unchecked]:bg-input focus-visible:border-ring focus-visible:ring-ring/50 dark:data-[state=unchecked]:bg-input/80 inline-flex h-[1.15rem] w-8 shrink-0 items-center rounded-full border border-transparent shadow-xs transition-all outline-none focus-visible:ring-[3px] disabled:cursor-not-allowed disabled:opacity-50",t),...n,children:e.jsx(os,{"data-slot":"switch-thumb",className:z("bg-background dark:data-[state=unchecked]:bg-foreground dark:data-[state=checked]:bg-primary-foreground pointer-events-none block size-4 rounded-full ring-0 transition-transform data-[state=checked]:translate-x-[calc(100%-2px)] data-[state=unchecked]:translate-x-0")})})}const Na={light:10,medium:20,heavy:30,success:[50,50,50],error:[100,50,100],warning:[50,100,50],selection:5};function St(t="medium"){if(!navigator.vibrate)return;const n=Na[t];try{navigator.vibrate(n)}catch{}}function gt(){St("success")}function Da(){St("error")}function xr(){St("selection")}function Sa(t){const n=t,s=n?.data?.requestId||n?.requestId||null;if(n?.code==="unavailable"||n?.message?.includes("network")||n?.message?.includes("fetch"))return{title:"Verbindungsfehler",message:"Keine Internetverbindung. Bitte überprüfen Sie Ihre Netzwerkverbindung und versuchen Sie es erneut.",action:"Erneut versuchen",retryable:!0};if(n?.code==="deadline-exceeded"||n?.message?.includes("timeout"))return{title:"Zeitüberschreitung",message:"Die Anfrage hat zu lange gedauert. Bitte versuchen Sie es erneut.",action:"Erneut versuchen",retryable:!0};if(n?.code==="permission-denied"||n?.message?.includes("permission"))return{title:"Berechtigung verweigert",message:"Sie haben keine Berechtigung für diese Aktion. Bitte kontaktieren Sie den Administrator.",retryable:!1};if(n?.code==="unauthenticated"||n?.message?.includes("auth")||n?.message?.includes("login"))return{title:"Anmeldung erforderlich",message:"Bitte melden Sie sich an, um fortzufahren.",action:"Anmelden",retryable:!1};if(n?.code==="not-found"||n?.message?.includes("not found"))return{title:"Nicht gefunden",message:"Die angeforderte Ressource wurde nicht gefunden.",retryable:!1};if(n?.code==="invalid-argument"||n?.message?.includes("validation")||n?.message?.includes("invalid"))return{title:"Ungültige Eingabe",message:n?.message||"Bitte überprüfen Sie Ihre Eingabe und versuchen Sie es erneut.",retryable:!1};if(n?.code==="resource-exhausted"||n?.message?.includes("quota"))return{title:"Kontingent überschritten",message:"Das Tageslimit wurde erreicht. Bitte versuchen Sie es später erneut.",retryable:!1};if(n?.message?.includes("billing")||n?.message?.includes("Billing"))return{title:"Abrechnungsfehler",message:"Google Cloud Billing ist erforderlich. Bitte kontaktieren Sie den Administrator.",retryable:!1};if(n?.code?.startsWith("functions/"))return{title:"Server-Fehler",message:`Ein Fehler ist aufgetreten: ${n.code.replace("functions/","")}. Bitte versuchen Sie es später erneut.`,action:"Erneut versuchen",retryable:!0};let r=n?.message||n?.toString()||"Ein unbekannter Fehler ist aufgetreten.";return s&&(r+=`

Request ID: ${s.substring(0,8)}...`),{title:"Fehler",message:r.length>200?`${r.substring(0,200)}...`:r,action:"Erneut versuchen",retryable:!0,requestId:s||void 0}}function Ca(t){return Sa(t).message}function Ea({className:t,children:n,...s}){return e.jsxs(ls,{"data-slot":"scroll-area",className:z("relative",t),...s,children:[e.jsx(cs,{"data-slot":"scroll-area-viewport",className:"focus-visible:ring-ring/50 size-full rounded-[inherit] transition-[color,box-shadow] outline-none focus-visible:ring-[3px] focus-visible:outline-1",children:n}),e.jsx(ka,{}),e.jsx(ds,{})]})}function ka({className:t,orientation:n="vertical",...s}){return e.jsx(us,{"data-slot":"scroll-area-scrollbar",orientation:n,className:z("hidden opacity-0 w-0 h-0 invisible pointer-events-none",t),...s,children:e.jsx(ms,{"data-slot":"scroll-area-thumb",className:"hidden opacity-0 w-0 h-0"})})}const Aa={"layout-dashboard":vt,calendar:wt,bell:lt,wallet:Ae,users:it,"file-text":Kt,folder:We,"scan-line":We,"shopping-cart":Ze,receipt:Ke,"clipboard-list":Ke,settings:ot,check:Yt,plus:qt,search:Mn,edit:zn,trash:Rn,clock:Tn,euro:Fn,"trending-up":In,"trending-down":An,info:kn,"alert-circle":En},Ia={dashboard:{path:"/",icon:vt},calendar:{path:"/calendar",icon:wt},reminders:{path:"/reminders",icon:lt},finances:{path:"/finance",icon:Ae},finance:{path:"/finance",icon:Ae},finanzen:{path:"/finance",icon:Ae},people:{path:"/people",icon:it},personen:{path:"/people",icon:it},invoices:{path:"/bills",icon:Ke},bills:{path:"/bills",icon:Ke},rechnungen:{path:"/bills",icon:Ke},documents:{path:"/documents",icon:We},dokumente:{path:"/documents",icon:We},shopping:{path:"/shopping",icon:Ze},einkaufsliste:{path:"/shopping",icon:Ze},settings:{path:"/settings",icon:ot},einstellungen:{path:"/settings",icon:ot}};function Fa({content:t,onNavigate:n}){const s=xe(()=>{const r=[],o=t.length>1e4?t.substring(0,1e4)+"...":t;let i=0,l=0;const d=/\[(nav|icon):([a-zA-Z0-9_-]+)(?:[|｜]([^\]]+))?\]/g;let p;const u=[];for(;(p=d.exec(o))!==null;)u.push({index:p.index,type:p[1],key:p[2],label:p[3],endIndex:p.index+p[0].length});for(const g of u){if(g.index>i){const m=o.slice(i,g.index);r.push(e.jsx("span",{dangerouslySetInnerHTML:{__html:pt(m)}},`text-${l++}`))}if(g.type==="nav"&&g.label){const m=g.key,h=g.label,y=Ia[m];if(y&&n){const a=y.icon;r.push(e.jsxs("button",{onClick:b=>{b.preventDefault(),b.stopPropagation();try{n(y.path)}catch{}},className:"inline-flex items-center gap-1.5 px-2 py-1 mx-0.5 rounded-lg bg-primary/10 hover:bg-primary/20 text-primary font-medium text-sm transition-all duration-200 cursor-pointer border border-primary/20 hover:border-primary/40 hover:shadow-sm",title:`Zu ${h} navigieren`,children:[e.jsx(a,{className:"size-4"}),e.jsx("span",{className:"underline decoration-dotted underline-offset-2",children:at(h)})]},`nav-${l++}`))}else r.push(e.jsx("span",{className:"font-medium text-primary",children:at(h)},`nav-text-${l++}`))}else if(g.type==="icon"){const m=g.key,h=Aa[m];h?r.push(e.jsx(h,{className:"inline-block size-4 mx-0.5 align-text-bottom text-primary"},`icon-${l++}`)):r.push(e.jsxs("span",{children:["[",at(m),"]"]},`unknown-${l++}`))}i=g.endIndex}if(i<o.length){const g=o.slice(i);r.push(e.jsx("span",{dangerouslySetInnerHTML:{__html:pt(g)}},`text-${l++}`))}return r.length>0?r:[e.jsx("span",{dangerouslySetInnerHTML:{__html:pt(o)}},"full")]},[t,n]);return e.jsx("div",{className:"prose prose-sm max-w-none",children:s})}function at(t){const n=document.createElement("div");return n.textContent=t,n.innerHTML}function pt(t){let n=at(t);return n=n.replace(/\*\*(.+?)\*\*/g,"<strong>$1</strong>").replace(/__(.+?)__/g,"<strong>$1</strong>"),n=n.replace(new RegExp("(?<!\\*)\\*(?!\\*)(.+?)(?<!\\*)\\*(?!\\*)","g"),"<em>$1</em>"),n=n.replace(/`(.+?)`/g,'<code class="bg-muted px-1.5 py-0.5 rounded text-sm font-mono">$1</code>'),n=n.replace(/\n/g,"<br />"),n}function Ta({messages:t,onSendMessage:n,isLoading:s=!1,placeholder:r="Nachricht eingeben...",className:o,height:i="100%",emptyStateMessage:l="Beginne eine Unterhaltung mit dem Assistenten",suggestedPrompts:d}){const{t:p,i18n:u}=Jt(),[,g]=Xe(),[m,h]=w(""),y=G(null),a=G(null),b=G(null),j=G(null),I=G(null),P=G(null),[ee,K]=w(!1),[J,ne]=w(null),[X,oe]=w(!1),A=G(null),S=G(null),F=G(null),W=ie(async x=>{g(x);const{eventBus:k,Events:f}=await Is(async()=>{const{eventBus:v,Events:E}=await import("./eventBus-CWDWdm45.js");return{eventBus:v,Events:E}},[]);setTimeout(()=>{k.emit(f.CHAT_DIALOG_OPEN)},300)},[g]),te=xe(()=>t.filter(x=>x.role!=="system"),[t]),O=xe(()=>d?d.map(x=>typeof x=="string"?{text:x,icon:"tag"}:x):[],[d]),Z=ie(()=>{const x=y.current?.querySelector("[data-radix-scroll-area-viewport]");x&&requestAnimationFrame(()=>{x.scrollTo({top:x.scrollHeight,behavior:"smooth"})})},[]);V(()=>{te.length>0&&Z()},[te.length,Z]);const[ze,me]=w({bottom:0,left:0});V(()=>{if(X&&S.current){const x=S.current.getBoundingClientRect();me({bottom:window.innerHeight-x.top+8,left:x.left})}},[X]),V(()=>{const x=k=>{const f=k.target,v=F.current?.contains(f),E=S.current?.contains(f),B=A.current?.contains(f);!v&&!E&&!B&&oe(!1)};if(X)return document.addEventListener("mousedown",x),document.addEventListener("touchstart",x),()=>{document.removeEventListener("mousedown",x),document.removeEventListener("touchstart",x)}},[X]);const be=ie(x=>{x.preventDefault();const k=m.trim();if(!(!k||s)){if(k.length>1e4){N.error("Nachricht ist zu lang. Bitte kürze sie auf maximal 10.000 Zeichen.");return}if(s){N.info("Bitte warte auf die Antwort...");return}try{n(k),h(""),Z(),j.current?.focus()}catch{N.error("Fehler beim Senden der Nachricht. Bitte versuche es erneut.")}}},[m,s,n,Z]),Me=ie(x=>{x.key==="Enter"&&!x.shiftKey&&(x.preventDefault(),be(x))},[be]),se=ie(x=>{s||(n(x),Z())},[s,n,Z]),fe=ie(async x=>{if(x.size>10485760){N.error(`Datei ist zu groß. Maximal ${(10485760/1024/1024).toFixed(0)}MB erlaubt.`);return}if(!x.name||x.name.length>255){N.error("Ungültiger Dateiname.");return}const f=N.loading("Datei wird hochgeladen...");try{const v=await Promise.race([new Promise((M,D)=>{const T=new FileReader;T.onload=()=>{const $=T.result;if(!$||!$.includes(",")){D(new Error("Ungültiges Dateiformat"));return}M($.split(",")[1])},T.onerror=()=>D(new Error("Fehler beim Lesen der Datei")),T.readAsDataURL(x)}),new Promise((M,D)=>setTimeout(()=>D(new Error("Upload-Timeout")),3e4))]),E=_(U,"uploadAIChatFile"),B=await Promise.race([E({fileName:x.name,fileData:v,fileType:x.type}),new Promise((M,D)=>setTimeout(()=>D(new Error("Upload-Timeout")),6e4))]);if(!B?.data)throw new Error("Keine Antwort vom Server erhalten");const R=B.data;if(!R.fileUrl||!R.fileName)throw new Error("Ungültige Server-Antwort");N.dismiss(f),n(`[Datei: ${R.fileName}](${R.fileUrl})`),N.success("Datei erfolgreich hochgeladen")}catch(v){N.dismiss(f);const E=v.message||"Unbekannter Fehler";N.error(`Fehler beim Hochladen: ${E}`)}},[n]),Le=ie(async x=>{if(!x.type.startsWith("image/")){N.error("Bitte wähle ein Bild aus (JPG, PNG, GIF, etc.)");return}const k=5*1024*1024;if(x.size>k){N.error(`Bild ist zu groß. Maximal ${(k/1024/1024).toFixed(0)}MB erlaubt.`);return}if(!x.name||x.name.length>255){N.error("Ungültiger Dateiname.");return}const f=N.loading("Bild wird hochgeladen...");try{const v=await Promise.race([new Promise((M,D)=>{const T=new FileReader;T.onload=()=>{const $=T.result;if(!$||!$.includes(",")){D(new Error("Ungültiges Bildformat"));return}M($.split(",")[1])},T.onerror=()=>D(new Error("Fehler beim Lesen des Bildes")),T.readAsDataURL(x)}),new Promise((M,D)=>setTimeout(()=>D(new Error("Upload-Timeout")),3e4))]),E=_(U,"uploadAIChatImage"),B=await Promise.race([E({fileName:x.name,fileData:v,fileType:x.type}),new Promise((M,D)=>setTimeout(()=>D(new Error("Upload-Timeout")),6e4))]);if(!B?.data)throw new Error("Keine Antwort vom Server erhalten");const R=B.data;if(!R.imageUrl||!R.fileName)throw new Error("Ungültige Server-Antwort");N.dismiss(f),n(`![${R.fileName}](${R.imageUrl})`),N.success("Bild erfolgreich hochgeladen")}catch(v){N.dismiss(f);const E=v.message||"Unbekannter Fehler";N.error(`Fehler beim Hochladen: ${E}`)}},[n]),Pe=ie(async()=>{if(ee&&J){try{J.stop(),K(!1),N.info("Aufnahme wird verarbeitet...")}catch{K(!1),N.error("Fehler beim Stoppen der Aufnahme")}return}try{if(!navigator.mediaDevices||!navigator.mediaDevices.getUserMedia){N.error("Mikrofon-Zugriff wird von diesem Browser nicht unterstützt.");return}const x=await Promise.race([navigator.mediaDevices.getUserMedia({audio:!0}),new Promise((E,B)=>setTimeout(()=>B(new Error("Mikrofon-Zugriff-Timeout")),1e4))]),k=new MediaRecorder(x),f=[];let v=null;k.ondataavailable=E=>{E.data.size>0&&f.push(E.data)},k.onstop=async()=>{v&&clearTimeout(v);const E=new Blob(f,{type:"audio/webm"}),B=10*1024*1024;if(E.size>B){N.error("Audio-Aufnahme ist zu groß. Bitte kürze die Aufnahme."),x.getTracks().forEach(M=>M.stop());return}const R=N.loading("Audio wird transkribiert...");try{const M=await Promise.race([new Promise((L,Y)=>{const ae=new FileReader;ae.onload=()=>{const he=ae.result;if(!he||!he.includes(",")){Y(new Error("Ungültiges Audioformat"));return}L(he.split(",")[1])},ae.onerror=()=>Y(new Error("Fehler beim Lesen der Audio-Datei")),ae.readAsDataURL(E)}),new Promise((L,Y)=>setTimeout(()=>Y(new Error("Audio-Verarbeitung-Timeout")),3e4))]),D=_(U,"transcribeAIChatAudio"),T=await Promise.race([D({audioData:M,mimeType:"audio/webm"}),new Promise((L,Y)=>setTimeout(()=>Y(new Error("Transkription-Timeout")),6e4))]);if(!T?.data)throw new Error("Keine Antwort vom Server erhalten");const $=T.data;if($.transcription&&$.transcription.trim())h($.transcription.trim()),j.current?.focus(),N.dismiss(R),N.success("Spracheingabe erfolgreich");else throw new Error("Keine Transkription erhalten")}catch(M){N.dismiss(R);const D=M.message||"Unbekannter Fehler";N.error(`Fehler bei der Transkription: ${D}`)}finally{x.getTracks().forEach(M=>M.stop())}},k.onerror=E=>{N.error("Fehler bei der Aufnahme"),K(!1),x.getTracks().forEach(B=>B.stop())},v=setTimeout(()=>{k.state==="recording"&&(k.stop(),N.warning("Maximale Aufnahmezeit erreicht (5 Minuten)"))},300*1e3),k.start(),ne(k),K(!0),N.info("Aufnahme gestartet... (Klicke erneut zum Stoppen)")}catch(x){K(!1);const k=x.message||"Unbekannter Fehler";k.includes("permission")||k.includes("denied")?N.error("Mikrofon-Zugriff wurde verweigert. Bitte erlaube den Zugriff in den Browser-Einstellungen."):k.includes("not found")||k.includes("not available")?N.error("Kein Mikrofon gefunden. Bitte verbinde ein Mikrofon."):N.error(`Mikrofon-Fehler: ${k}`)}},[ee,J]);ie(()=>{const k=u.language==="de"?"en":"de";u.changeLanguage(k),localStorage.setItem("language",k),N.success(k==="de"?"Sprache auf Deutsch geändert":"Language changed to English")},[u]);const Ee=()=>e.jsxs("form",{ref:b,onSubmit:be,className:"w-full",children:[e.jsx("input",{ref:I,type:"file",className:"hidden",onChange:x=>{const k=x.target.files?.[0];k&&fe(k),x.target.value=""},accept:"*/*"}),e.jsx("input",{ref:P,type:"file",className:"hidden",onChange:x=>{const k=x.target.files?.[0];k&&(Le(k),oe(!1)),x.target.value=""},accept:"image/*"}),e.jsx("div",{className:"w-full max-w-full mx-auto",children:e.jsxs("div",{className:"flex items-center gap-2 px-2",style:{alignItems:"center"},children:[e.jsxs("div",{className:"flex-1 relative",children:[e.jsx("button",{ref:S,type:"button",onClick:()=>oe(!X),className:"absolute left-2 top-1/2 -translate-y-1/2 w-8 h-8 rounded-full bg-transparent hover:bg-muted/50 transition-colors flex items-center justify-center active:scale-95 z-10","aria-label":"Mehr Optionen",disabled:s,children:e.jsx(qt,{className:"w-4 h-4 text-muted-foreground"})}),e.jsx("textarea",{ref:j,value:m,onChange:x=>h(x.target.value),onKeyDown:Me,placeholder:r,rows:1,className:"w-full pl-10 pr-4 py-3 rounded-2xl bg-muted border-0 text-base text-foreground placeholder:text-muted-foreground focus:outline-none focus:ring-2 focus:ring-primary/20 transition-all resize-none overflow-y-auto min-h-[44px] max-h-[120px] leading-relaxed",style:{height:"auto",minHeight:"44px"},disabled:s,onInput:x=>{const k=x.target;k.style.height="auto",k.style.height=`${Math.min(k.scrollHeight,120)}px`}})]}),m.trim()?e.jsx("button",{type:"submit",disabled:s,className:"w-10 h-10 rounded-full bg-primary text-primary-foreground hover:bg-primary/90 transition-colors flex items-center justify-center active:scale-95 shadow-md self-center","aria-label":s?"Wird gesendet...":"Nachricht senden",children:s?e.jsx(Ct,{className:"w-5 h-5 animate-spin"}):e.jsx(Sn,{className:"w-5 h-5"})}):e.jsx("button",{type:"button",onClick:Pe,className:z("transition-colors flex items-center justify-center active:scale-95 self-center p-2",ee?"text-red-500 hover:text-red-600":"text-foreground hover:text-foreground/80"),"aria-label":"Spracheingabe",disabled:s,children:e.jsx(Cn,{className:z("w-7 h-7",ee?"text-red-500":"text-foreground")})})]})})]});return e.jsxs(e.Fragment,{children:[X&&e.jsxs("div",{ref:F,className:"fixed bg-background border border-border rounded-lg shadow-2xl z-[99999] min-w-[200px] overflow-hidden",style:{bottom:`${ze.bottom}px`,left:`${ze.left}px`},children:[e.jsxs("button",{type:"button",onClick:()=>{I.current?.click(),oe(!1)},className:"w-full flex items-center gap-3 px-4 py-3 hover:bg-muted transition-colors text-left",children:[e.jsx(Nn,{className:"w-5 h-5 text-muted-foreground"}),e.jsx("span",{className:"text-sm",children:"Datei anhängen"})]}),e.jsxs("button",{type:"button",onClick:()=>{P.current?.click(),oe(!1)},className:"w-full flex items-center gap-3 px-4 py-3 hover:bg-muted transition-colors text-left",children:[e.jsx(Dn,{className:"w-5 h-5 text-muted-foreground"}),e.jsx("span",{className:"text-sm",children:"Bild hinzufügen"})]})]}),e.jsx("div",{ref:a,className:z("flex flex-col bg-background text-foreground",o),style:{height:i},children:te.length===0?e.jsxs("div",{className:"flex flex-col h-full animate-in fade-in duration-300 pb-20",children:[e.jsx("div",{className:"flex-1 flex items-center justify-center px-4",children:e.jsx("div",{className:"w-full max-w-2xl"})}),O.length>0&&e.jsx("div",{className:"fixed bottom-24 left-0 right-0 px-4 pb-2 z-[1] pointer-events-none",children:e.jsx("div",{className:"w-full max-w-2xl mx-auto",children:e.jsx("div",{className:"overflow-x-auto scrollbar-hide -mx-4 px-4 pointer-events-auto",children:e.jsx("div",{className:"flex gap-3",style:{width:"max-content"},children:O.map((x,k)=>{const f=x.subtitle&&x.subtitle.trim().length>0;return e.jsxs("button",{onClick:()=>se(x.text),disabled:s,className:"flex-shrink-0 w-[calc(40vw-1rem)] min-w-[140px] max-w-[160px] rounded-xl bg-muted hover:bg-muted/80 active:bg-muted/70 px-2.5 py-2 text-left transition-all duration-200 disabled:cursor-not-allowed disabled:opacity-50 shadow-sm",type:"button",children:[e.jsx("p",{className:"font-medium text-xs text-foreground mb-0.5 line-clamp-2 leading-tight",children:x.text}),f&&e.jsx("p",{className:"text-[10px] text-muted-foreground line-clamp-2 leading-tight",children:x.subtitle})]},k)})})})})}),e.jsx("div",{className:"fixed bottom-0 left-0 right-0 w-full bg-background px-4 py-3 safe-bottom",style:{paddingBottom:"max(0.75rem, env(safe-area-inset-bottom))"},children:e.jsx("div",{className:"w-full max-w-2xl mx-auto",children:Ee()})})]}):e.jsxs(e.Fragment,{children:[e.jsx("div",{ref:y,className:"flex-1 overflow-hidden pb-32",children:e.jsx(Ea,{className:"h-full [&>div>div]:!overflow-y-auto [&>div>div]:[-ms-overflow-style:none] [&>div>div]:[scrollbar-width:none] [&>div>div::-webkit-scrollbar]:hidden",children:e.jsxs("div",{className:"flex flex-col p-4 space-y-4 pb-6",children:[te.map((x,k)=>e.jsx("div",{className:z("flex gap-3 animate-in fade-in slide-in-from-bottom-2 duration-300",x.role==="user"?"justify-end":"justify-start"),children:e.jsx("div",{className:z("max-w-[85%] select-text",x.role==="user"?"bg-primary text-primary-foreground rounded-2xl px-4 py-3 text-base":"text-foreground text-base"),onClick:f=>{f.target.closest("button, a")||f.stopPropagation()},onMouseDown:f=>{f.target.closest("button, a")||f.stopPropagation()},children:x.role==="assistant"?e.jsx(Fa,{content:x.content,onNavigate:W}):e.jsx("p",{className:"whitespace-pre-wrap leading-relaxed",children:x.content})})},k)),s&&e.jsx("div",{className:"flex items-start gap-4 justify-start animate-in fade-in duration-200",children:e.jsx("div",{className:"rounded-lg bg-muted px-4 py-3",children:e.jsx(Ct,{className:"size-4 animate-spin text-muted-foreground"})})})]})})}),O.length>0&&e.jsx("div",{className:"fixed bottom-24 left-0 right-0 px-4 pb-2 z-[1] pointer-events-none",children:e.jsx("div",{className:"w-full max-w-2xl mx-auto",children:e.jsx("div",{className:"overflow-x-auto scrollbar-hide -mx-4 px-4 pointer-events-auto",children:e.jsx("div",{className:"flex gap-3",style:{width:"max-content"},children:O.map((x,k)=>{const f=x.subtitle&&x.subtitle.trim().length>0;return e.jsxs("button",{onClick:()=>se(x.text),disabled:s,className:"flex-shrink-0 w-[calc(40vw-1rem)] min-w-[140px] max-w-[160px] rounded-xl bg-muted hover:bg-muted/80 active:bg-muted/70 px-2.5 py-2 text-left transition-all duration-200 disabled:cursor-not-allowed disabled:opacity-50 shadow-sm",type:"button",children:[e.jsx("p",{className:"font-medium text-xs text-foreground mb-0.5 line-clamp-2 leading-tight",children:x.text}),f&&e.jsx("p",{className:"text-[10px] text-muted-foreground line-clamp-2 leading-tight",children:x.subtitle})]},k)})})})})}),e.jsx("div",{className:"fixed bottom-0 left-0 right-0 w-full bg-background/95 backdrop-blur-sm px-4 py-3 safe-bottom flex-shrink-0 z-30",style:{paddingBottom:"max(0.75rem, env(safe-area-inset-bottom))"},children:e.jsx("div",{className:"w-full max-w-2xl mx-auto",children:Ee()})})]})})]})}function Pt({className:t,onKeyDown:n,onCompositionStart:s,onCompositionEnd:r,...o}){const i=Dt(),{onCompositionStart:l,onCompositionEnd:d,onKeyDown:p}=on({onKeyDown:u=>{const g=u.nativeEvent.isComposing||i.justEndedComposing();u.key==="Enter"&&!u.shiftKey&&g||n?.(u)},onCompositionStart:u=>{i.setComposing(!0),s?.(u)},onCompositionEnd:u=>{i.markCompositionEnd(),setTimeout(()=>{i.setComposing(!1)},100),r?.(u)}});return e.jsx("textarea",{"data-slot":"textarea",className:z("border-input placeholder:text-muted-foreground focus-visible:border-ring focus-visible:ring-ring/50 aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive dark:bg-input/30 flex field-sizing-content min-h-16 w-full rounded-md border bg-transparent px-3 py-2 text-base shadow-xs transition-[color,box-shadow] outline-none focus-visible:ring-[3px] disabled:cursor-not-allowed disabled:opacity-50 md:text-sm",t),onCompositionStart:l,onCompositionEnd:d,onKeyDown:p,...o})}const Ve={role:"system",content:"Du bist ein hilfreicher Assistent für die Nexo-Anwendung. Du hilfst Benutzern bei Fragen zu Finanzen, Rechnungen, Terminen und anderen Funktionen der App."};function br(){const{t}=Jt();Xe();const{data:n,isLoading:s,refetch:r}=rn(),[o,i]=w(null),[l,d]=w(!1),[p,u]=w(!1),[g,m]=w(!1),[h,y]=w(!1),[a,b]=w(!1),[j,I]=w(!1),[P,ee]=w(!1),[K,J]=w(null),ne=G(null),X=G(null),oe=G(null),A=G(null),[S,F]=w({title:"",type:"termin",dueDate:"",isAllDay:!1,amount:"",currency:"CHF",notes:""}),[W,te]=w(!1),[O,Z]=w({type:"ausgabe",amount:"",category:"",description:"",date:ue(new Date),paymentMethod:"Karte"}),[ze,me]=w(ce(new Date)),[be,Me]=w(!1),[se,fe]=w({name:"",quantity:"1",category:"Lebensmittel",store:""}),[Le,Pe]=w(!1),Ee=["Lebensmittel","Getränke","Haushalt","Hygiene","Tierbedarf","Sonstiges"],x=async()=>{if(!se.name){N.error("Bitte Artikelname eingeben");return}Pe(!0);try{await na({item:se.name,quantity:parseInt(se.quantity)||1,category:se.category,estimatedPrice:0,currency:"EUR",unit:null}),N.success("Artikel zur Einkaufsliste hinzugefügt"),b(!1),fe({name:"",quantity:"1",category:"Lebensmittel",store:""})}catch(c){N.error("Fehler beim Hinzufügen des Artikels"),console.error(c)}finally{Pe(!1)}},k={income:["Gehalt","Freelance","Investitionen","Geschenk","Sonstiges"],expense:["Lebensmittel","Transport","Wohnen","Unterhaltung","Gesundheit","Kleidung","Bildung","Rechnung","Sonstiges"]},f=async()=>{if(!O.amount||!O.category){N.error("Bitte Betrag und Kategorie eingeben");return}Me(!0);try{await en({type:O.type,category:O.category,amount:Math.round(parseFloat(O.amount)*100),currency:"CHF",date:new Date(O.date),paymentMethod:O.paymentMethod,notes:O.description||"",status:O.type==="ausgabe"?"open":void 0}),N.success(O.type==="einnahme"?"Einnahme hinzugefügt":"Ausgabe hinzugefügt");const c=ue(new Date);y(!1),Z({type:"ausgabe",amount:"",category:"",description:"",date:c,paymentMethod:"Karte"}),me(ce(c))}catch(c){N.error("Fehler beim Erstellen des Eintrags"),console.error(c)}finally{Me(!1)}};V(()=>{!s&&n.length>0&&!o&&i(n[0].id)},[s,n,o]);const[v,E]=w([Ve]),B=G(null),R=G(!1);V(()=>{if(o&&o!==B.current)if(B.current=o,n.length>0){const c=ht(o,n);c&&c.messages.length>0?E(c.messages):E([Ve])}else E([Ve])},[o,n]),V(()=>{if(!R.current&&o&&v.length>1){const c=setTimeout(async()=>{R.current=!0;try{const C=ht(o,n);if(C){const q=v.find(ge=>ge.role==="user");q&&C.title==="Neue Konversation"&&(C.title=ba(q.content)),C.messages=v,C.updatedAt=new Date().toISOString(),await ft(C)}}catch{}finally{R.current=!1}},1e3);return()=>clearTimeout(c)}},[v,o,n]);const M=ie(async()=>{try{const c=Lt();await ft(c),i(c.id),E([Ve]),await r(),N.success("Neue Konversation gestartet")}catch(c){console.error("Error creating new chat:",c);let C="Fehler beim Erstellen der neuen Konversation";c?.code==="unauthenticated"||c?.message?.includes("unauthenticated")?C="Bitte melde dich an, um eine neue Konversation zu erstellen":c?.code==="permission-denied"||c?.message?.includes("permission")?C="Keine Berechtigung zum Erstellen einer Konversation":c?.message?C=`Fehler: ${c.message}`:typeof c=="string"&&(C=`Fehler: ${c}`),N.error(C)}},[r]),D=ie(c=>{i(c);const C=ht(c,n);C&&C.messages.length>0?E(C.messages):E([Ve])},[n]),T=Vs.ai.chat.useMutation({onSuccess:c=>{const C={role:"assistant",content:c.content};E(q=>[...q,C])},onError:c=>{let C="Ein unbekannter Fehler ist aufgetreten.";c.message.includes("<!doctype")||c.message.includes("Unexpected token")||c.message.includes("Failed to fetch")?C="Der Server ist nicht erreichbar oder gibt eine ungültige Antwort zurück. Bitte stelle sicher, dass der Server läuft und du eine Internetverbindung hast.":c.message.includes("Unable to transform")||c.message.includes("NetworkError")?C="Fehler bei der Datenübertragung. Bitte überprüfe deine Internetverbindung und versuche es erneut.":c.data?.code==="UNAUTHORIZED"||c.message.includes("unauthenticated")?C="Du bist nicht angemeldet. Bitte melde dich an.":c.data?.code==="INTERNAL_SERVER_ERROR"||c.message.includes("500")?C="Ein Serverfehler ist aufgetreten. Bitte versuche es später erneut.":c.message.includes("timeout")||c.message.includes("Timeout")?C="Die Anfrage hat zu lange gedauert. Bitte versuche es erneut.":c.message.includes("rate limit")||c.message.includes("429")?C="Zu viele Anfragen. Bitte warte einen Moment und versuche es erneut.":C=c.message||"Ein Fehler ist aufgetreten.";const q={role:"assistant",content:`**Fehler aufgetreten**

${C}

Bitte versuche es erneut oder starte eine neue Konversation.`};E(ge=>[...ge,q]),N.error("Fehler beim Senden der Nachricht")}}),$=ie(async c=>{if(c.length>1e4){N.error("Nachricht ist zu lang. Bitte kürze sie auf maximal 10.000 Zeichen.");return}if(!o)try{const q=Lt();await ft(q),i(q.id),await r()}catch{N.error("Fehler beim Erstellen der Konversation");return}if(v.filter(q=>q.role==="user").length>=50){N.warning("Zu viele Nachrichten in dieser Konversation. Bitte starte eine neue Konversation.");return}try{const q={role:"user",content:c},ge=[...v,q];E(ge),T.mutate({messages:ge})}catch{N.error("Fehler beim Senden der Nachricht. Bitte versuche es erneut.")}},[v,T,o,r]),L=xe(()=>[{text:"Wie funktioniert die Rechnungsverwaltung?",subtitle:"Lerne die Rechnungsverwaltung kennen",icon:"receipt"},{text:"Wie erstelle ich eine Erinnerung?",subtitle:"Erstelle Termine und Erinnerungen",icon:"bell"},{text:"Wie verwalte ich meine Finanzen?",subtitle:"Verwalte Einnahmen und Ausgaben",icon:"wallet"},{text:"Was kann ich mit der Einkaufsliste machen?",subtitle:"Verwalte deine Einkaufsliste",icon:"shoppingCart"},{text:"Wie funktioniert das Raten-System?",subtitle:"Lerne Ratenzahlungen zu verwalten",icon:"calendar"},{text:"Wie scanne ich eine Rechnung?",subtitle:"Erfasse Rechnungen automatisch",icon:"scan"}],[]),Y=v.some(c=>c.role==="user"),ae=()=>o&&n.length>0&&n.find(C=>C.id===o)?.title||"Assistent",he=xe(()=>[{id:"reminder",label:"Erinnerung erstellen",path:"#",icon:lt,onClick:()=>u(!0)},{id:"scan",label:"Rechnung scannen",path:"#",icon:We,onClick:()=>{m(!0),J(null)}},{id:"finance",label:"Finanzübersicht",path:"#",icon:Ae,onClick:()=>y(!0)},{id:"shopping",label:"Einkaufsliste",path:"#",icon:Ze,onClick:()=>b(!0)}],[]),dt=async()=>{if(!S.title||!S.dueDate){N.error("Bitte füllen Sie Titel und Datum aus");return}te(!0);try{const c=S.amount?Math.round(parseFloat(S.amount)*100):void 0;await Qt({title:S.title,type:S.type,dueDate:new Date(S.dueDate),isAllDay:S.isAllDay,amount:c,currency:S.currency,notes:S.notes||""}),N.success("Erinnerung erstellt"),u(!1),F({title:"",type:"termin",dueDate:"",isAllDay:!1,amount:"",currency:"CHF",notes:""})}catch(c){N.error("Fehler beim Erstellen der Erinnerung"),console.error(c)}finally{te(!1)}},ut=async()=>{try{const c=await navigator.mediaDevices.getUserMedia({video:{facingMode:"environment"}});A.current=c,ne.current&&(ne.current.srcObject=c),I(!0),gt()}catch(c){N.error(Ca(c)),Da()}},Q=()=>{A.current&&(A.current.getTracks().forEach(c=>c.stop()),A.current=null),I(!1)},ln=()=>{if(ne.current&&X.current){const c=ne.current,C=X.current;C.width=c.videoWidth,C.height=c.videoHeight;const q=C.getContext("2d");if(q){q.drawImage(c,0,0);const ge=C.toDataURL("image/jpeg");J(ge),Q(),gt()}}},cn=c=>{const C=c.target.files?.[0];if(C){const q=new FileReader;q.onload=ge=>{const un=ge.target?.result;J(un),gt()},q.readAsDataURL(C)}},dn=async()=>{if(K){const c={role:"user",content:`![Gescanntes Bild](${K})`};E(C=>[...C,c]),J(null),m(!1),N.success("Scan zum Chat hinzugefügt");try{T.mutate({messages:[...v,c]})}catch(C){console.error("Error sending scan to chat:",C)}}};return V(()=>()=>{g||Q()},[g]),e.jsxs("div",{className:"min-h-screen bg-background flex flex-col safe-area-inset",children:[e.jsx(ya,{title:ae(),showSidebar:!0,showQuickActions:!0,quickActions:he,currentChatId:o||void 0,onSelectChat:D,onNewChat:M,sidebarOpen:l,onSidebarToggle:d}),he.length>0&&e.jsxs("div",{className:"fixed top-14 left-0 right-0 z-30 px-4 py-3 flex flex-row gap-3 justify-center safe-top",style:{paddingTop:"max(0.75rem, env(safe-area-inset-top))"},children:[e.jsx("button",{onClick:()=>d(!0),className:"w-12 h-12 rounded-full bg-background hover:bg-muted border border-border transition-colors flex items-center justify-center active:scale-95 shadow-sm","aria-label":"Menü öffnen","aria-expanded":l,"aria-controls":"sidebar-menu",title:"Menü öffnen",children:e.jsx(Ln,{className:"w-5 h-5 text-foreground"})}),he.map(c=>{const C=c.icon;return e.jsx("button",{onClick:c.onClick,className:"w-12 h-12 rounded-full bg-background hover:bg-muted border border-border transition-colors flex items-center justify-center active:scale-95 shadow-sm","aria-label":c.label,title:c.label,children:C&&e.jsx(C,{className:"w-5 h-5 text-foreground"})},c.id)})]}),e.jsx("div",{className:"flex-1 overflow-hidden flex flex-col bg-background",style:{paddingTop:he.length>0?"7rem":"3.5rem"},children:e.jsx("div",{className:"flex-1 flex flex-col w-full overflow-hidden min-h-0",children:e.jsx(Ta,{messages:v,onSendMessage:$,isLoading:T.isPending,placeholder:t("common.typeMessage","Nachricht eingeben..."),height:"100%",emptyStateMessage:"Wähle eine Frage oder stelle deine eigene",suggestedPrompts:Y?[]:L})})}),e.jsx(ve,{open:p,onOpenChange:c=>{u(c),c||F({title:"",type:"termin",dueDate:"",isAllDay:!1,amount:"",currency:"CHF",notes:""})},children:e.jsxs(we,{className:"!fixed !top-[50%] !left-[50%] !right-auto !bottom-auto !translate-x-[-50%] !translate-y-[-50%] !w-[85vw] !max-w-sm !max-h-fit !rounded-3xl !m-0 !overflow-visible !shadow-2xl",children:[e.jsxs(je,{className:"px-5 pt-5 pb-3",children:[e.jsx(De,{className:"text-lg font-semibold",children:"Erinnerung erstellen"}),e.jsx(Se,{className:"sr-only",children:"Erstellen Sie eine neue Erinnerung basierend auf der Chat-Konversation"})]}),e.jsxs("div",{className:"space-y-3 px-5 pb-2",children:[e.jsxs("div",{className:"w-full",children:[e.jsx(re,{className:"text-sm font-medium",children:"Titel *"}),e.jsx(ye,{value:S.title,onChange:c=>F({...S,title:c.target.value}),placeholder:"Titel",className:"h-11 min-h-[44px] mt-1.5 rounded-xl w-full"})]}),e.jsxs("div",{className:"w-full",children:[e.jsx(re,{className:"text-sm font-medium",children:"Typ *"}),e.jsxs(Oe,{value:S.type,onValueChange:c=>F({...S,type:c}),children:[e.jsx(Ue,{className:"h-11 min-h-[44px] mt-1.5 rounded-xl w-full",children:e.jsx(_e,{})}),e.jsxs($e,{children:[e.jsx(le,{value:"termin",children:"Termin"}),e.jsx(le,{value:"zahlung",children:"Zahlung"}),e.jsx(le,{value:"aufgabe",children:"Aufgabe"})]})]})]}),e.jsxs("div",{className:"w-full",children:[e.jsx(re,{className:"text-sm font-medium",children:"Datum & Uhrzeit *"}),e.jsx("div",{className:"relative w-full mt-1.5",children:e.jsx(ye,{type:"datetime-local",placeholder:"Datum & Uhrzeit auswählen",value:S.dueDate,onChange:c=>{F({...S,dueDate:c.target.value})},className:"h-11 min-h-[44px] rounded-xl w-full",style:{boxSizing:"border-box",fontSize:"16px",height:"44px",minHeight:"44px",maxHeight:"44px",padding:"0.5rem 0.75rem",lineHeight:"1.5rem",appearance:"none",WebkitAppearance:"none",MozAppearance:"textfield"}})})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(ja,{checked:S.isAllDay,onCheckedChange:c=>F({...S,isAllDay:c})}),e.jsx(re,{className:"text-sm font-medium",children:"Ganztägig"})]}),S.type==="zahlung"&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"w-full",children:[e.jsx(re,{className:"text-sm font-medium",children:"Betrag"}),e.jsx(ye,{type:"number",step:"0.01",value:S.amount,onChange:c=>F({...S,amount:c.target.value}),placeholder:"0.00",className:"h-11 min-h-[44px] mt-1.5 rounded-xl w-full"})]}),e.jsxs("div",{className:"w-full",children:[e.jsx(re,{className:"text-sm font-medium",children:"Währung"}),e.jsxs(Oe,{value:S.currency,onValueChange:c=>F({...S,currency:c}),children:[e.jsx(Ue,{className:"h-11 min-h-[44px] mt-1.5 rounded-xl w-full",children:e.jsx(_e,{})}),e.jsxs($e,{children:[e.jsx(le,{value:"CHF",children:"CHF"}),e.jsx(le,{value:"EUR",children:"EUR"}),e.jsx(le,{value:"USD",children:"USD"})]})]})]})]}),e.jsxs("div",{className:"w-full",children:[e.jsx(re,{className:"text-sm font-medium",children:"Notizen"}),e.jsx(Pt,{value:S.notes,onChange:c=>F({...S,notes:c.target.value}),placeholder:"Notizen...",className:"mt-1.5 min-h-[80px] rounded-xl w-full"})]})]}),e.jsxs(Ne,{className:"px-5 pb-3 pt-2 gap-2.5",children:[e.jsx(H,{variant:"outline",onClick:()=>u(!1),className:"h-11 min-h-[44px] flex-1 rounded-xl text-sm font-medium",children:"Abbrechen"}),e.jsx(H,{onClick:dt,disabled:W,className:"h-11 min-h-[44px] flex-1 rounded-xl text-sm font-medium",children:W?"Speichert...":"Erstellen"})]})]})}),e.jsx(ve,{open:g,onOpenChange:c=>{m(c),c||(Q(),J(null))},children:e.jsxs(we,{className:"!fixed !top-[50%] !left-[50%] !right-auto !bottom-auto !translate-x-[-50%] !translate-y-[-50%] !w-[85vw] !max-w-sm !max-h-fit !rounded-3xl !m-0 !overflow-visible !shadow-2xl",children:[e.jsxs(je,{className:"px-5 pt-5 pb-3",children:[e.jsx(De,{className:"text-lg font-semibold",children:"Rechnung scannen"}),e.jsx(Se,{className:"sr-only",children:"Scannen Sie eine Rechnung mit der Kamera oder laden Sie ein Bild hoch"})]}),e.jsxs("div",{className:"space-y-3 px-5 pb-2",children:[!j&&!K&&e.jsxs("div",{className:"space-y-2.5",children:[e.jsxs(H,{onClick:ut,className:"w-full h-11 flex items-center justify-center gap-2 rounded-xl text-sm font-medium",children:[e.jsx(Et,{className:"w-4 h-4"}),"Kamera öffnen"]}),e.jsxs("div",{className:"relative",children:[e.jsx("input",{ref:oe,type:"file",accept:"image/*",onChange:cn,className:"hidden"}),e.jsxs(H,{variant:"outline",onClick:()=>oe.current?.click(),className:"w-full h-11 flex items-center justify-center gap-2 rounded-xl text-sm font-medium",children:[e.jsx(Pn,{className:"w-4 h-4"}),"Bild hochladen"]})]})]}),j&&e.jsxs("div",{className:"space-y-2.5",children:[e.jsxs("div",{className:"relative bg-black rounded-xl overflow-hidden aspect-video",children:[e.jsx("video",{ref:ne,autoPlay:!0,playsInline:!0,className:"w-full h-full object-cover"}),e.jsx("canvas",{ref:X,className:"hidden"})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(H,{variant:"outline",onClick:Q,className:"flex-1 h-11 rounded-xl text-sm font-medium",children:[e.jsx(Je,{className:"w-4 h-4 mr-2"}),"Abbrechen"]}),e.jsxs(H,{onClick:ln,className:"flex-1 h-11 rounded-xl text-sm font-medium",children:[e.jsx(Et,{className:"w-4 h-4 mr-2"}),"Aufnehmen"]})]})]}),K&&e.jsxs("div",{className:"space-y-2.5",children:[e.jsx("div",{className:"relative bg-black rounded-xl overflow-hidden",children:e.jsx("img",{src:K,alt:"Gescanntes Bild",className:"w-full h-auto"})}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(H,{variant:"outline",onClick:()=>{J(null),I(!1)},className:"flex-1 h-11 rounded-xl text-sm font-medium",children:"Neu scannen"}),e.jsx(H,{onClick:dn,className:"flex-1 h-11 rounded-xl text-sm font-medium",children:"Zum Chat hinzufügen"})]})]})]}),e.jsx(Ne,{className:"px-5 pb-3 pt-2",children:e.jsx(H,{variant:"outline",onClick:()=>{m(!1),Q(),J(null)},className:"h-11 min-h-[44px] w-full rounded-xl text-sm font-medium",children:"Schließen"})})]})}),e.jsx(ve,{open:h,onOpenChange:c=>{if(y(c),c){const C=ue(new Date);Z(q=>({...q,date:C})),me(ce(C))}else{const C=ue(new Date);Z({type:"ausgabe",amount:"",category:"",description:"",date:C,paymentMethod:"Karte"}),me(ce(C))}},children:e.jsxs(we,{className:"!fixed !top-[50%] !left-[50%] !right-auto !bottom-auto !translate-x-[-50%] !translate-y-[-50%] !w-[85vw] !max-w-sm !max-h-fit !rounded-3xl !m-0 !overflow-visible !shadow-2xl",children:[e.jsxs(je,{className:"px-5 pt-5 pb-3",children:[e.jsx(De,{className:"text-lg font-semibold",children:"Einnahme / Ausgabe"}),e.jsx(Se,{className:"sr-only",children:"Erstellen Sie einen neuen Finanz-Eintrag für Einnahmen oder Ausgaben"})]}),e.jsxs("div",{className:"space-y-3 px-5 pb-2",children:[e.jsxs("div",{children:[e.jsx(re,{className:"text-sm font-medium",children:"Typ *"}),e.jsxs(Oe,{value:O.type,onValueChange:c=>{Z({...O,type:c,category:""})},children:[e.jsx(Ue,{className:"h-11 min-h-[44px] mt-1.5 rounded-xl",children:e.jsx(_e,{})}),e.jsxs($e,{children:[e.jsx(le,{value:"einnahme",children:"Einnahme"}),e.jsx(le,{value:"ausgabe",children:"Ausgabe"})]})]})]}),e.jsxs("div",{children:[e.jsx(re,{children:"Betrag *"}),e.jsx(ye,{type:"number",step:"0.01",value:O.amount,onChange:c=>Z({...O,amount:c.target.value}),placeholder:"0.00",className:"h-11 min-h-[44px] mt-1.5 rounded-xl"})]}),e.jsxs("div",{children:[e.jsx(re,{className:"text-sm font-medium",children:"Kategorie *"}),e.jsxs(Oe,{value:O.category,onValueChange:c=>Z({...O,category:c}),children:[e.jsx(Ue,{className:"h-11 min-h-[44px] mt-1.5 rounded-xl",children:e.jsx(_e,{placeholder:"Kategorie wählen"})}),e.jsx($e,{children:(O.type==="einnahme"?k.income:k.expense).map(c=>e.jsx(le,{value:c,children:c},c))})]})]}),e.jsxs("div",{children:[e.jsx(re,{className:"text-sm font-medium",children:"Datum *"}),e.jsx(ye,{type:"text",placeholder:"DD.MM.YYYY",value:ze,onChange:c=>{const C=c.target.value;me(C);const q=He(C);q&&Z({...O,date:q})},onBlur:c=>{const C=He(c.target.value);C?(Z({...O,date:C}),me(ce(C))):c.target.value&&me(ce(O.date))},className:"h-11 min-h-[44px] mt-1.5 rounded-xl"})]}),e.jsxs("div",{children:[e.jsx(re,{children:"Zahlungsmethode"}),e.jsxs(Oe,{value:O.paymentMethod,onValueChange:c=>Z({...O,paymentMethod:c}),children:[e.jsx(Ue,{className:"h-11 min-h-[44px] mt-1.5 rounded-xl",children:e.jsx(_e,{})}),e.jsxs($e,{children:[e.jsx(le,{value:"Karte",children:"Karte"}),e.jsx(le,{value:"Bar",children:"Bar"}),e.jsx(le,{value:"Überweisung",children:"Überweisung"}),e.jsx(le,{value:"Andere",children:"Andere"})]})]})]}),e.jsxs("div",{children:[e.jsx(re,{children:"Beschreibung"}),e.jsx(Pt,{value:O.description,onChange:c=>Z({...O,description:c.target.value}),placeholder:"Beschreibung...",className:"mt-1 min-h-[80px]"})]})]}),e.jsxs(Ne,{className:"px-5 pb-3 pt-2 gap-2.5",children:[e.jsx(H,{variant:"outline",onClick:()=>y(!1),className:"h-11 min-h-[44px] flex-1 rounded-xl text-sm font-medium",children:"Abbrechen"}),e.jsx(H,{onClick:f,disabled:be,className:"h-11 min-h-[44px] flex-1 rounded-xl text-sm font-medium",children:be?"Speichert...":"Erstellen"})]})]})}),e.jsx(ve,{open:a,onOpenChange:c=>{b(c),c||fe({name:"",quantity:"1",category:"Lebensmittel",store:""})},children:e.jsxs(we,{className:"!fixed !top-[50%] !left-[50%] !right-auto !bottom-auto !translate-x-[-50%] !translate-y-[-50%] !w-[85vw] !max-w-sm !max-h-fit !rounded-3xl !m-0 !overflow-visible !shadow-2xl",children:[e.jsxs(je,{className:"px-5 pt-5 pb-3",children:[e.jsx(De,{className:"text-lg font-semibold",children:"Artikel zur Einkaufsliste hinzufügen"}),e.jsx(Se,{className:"sr-only",children:"Fügen Sie einen neuen Artikel zur Einkaufsliste hinzu"})]}),e.jsxs("div",{className:"space-y-3 px-5 pb-2",children:[e.jsxs("div",{children:[e.jsx(re,{className:"text-sm font-medium",children:"Artikelname *"}),e.jsx(ye,{value:se.name,onChange:c=>fe({...se,name:c.target.value}),placeholder:"z.B. Milch",className:"h-11 min-h-[44px] mt-1.5 rounded-xl"})]}),e.jsxs("div",{children:[e.jsx(re,{className:"text-sm font-medium",children:"Menge"}),e.jsx(ye,{type:"number",min:"1",value:se.quantity,onChange:c=>fe({...se,quantity:c.target.value}),placeholder:"1",className:"h-11 min-h-[44px] mt-1.5 rounded-xl"})]}),e.jsxs("div",{children:[e.jsx(re,{className:"text-sm font-medium",children:"Kategorie"}),e.jsxs(Oe,{value:se.category,onValueChange:c=>fe({...se,category:c}),children:[e.jsx(Ue,{className:"h-11 min-h-[44px] mt-1.5 rounded-xl",children:e.jsx(_e,{})}),e.jsx($e,{children:Ee.map(c=>e.jsx(le,{value:c,children:c},c))})]})]}),e.jsxs("div",{children:[e.jsx(re,{className:"text-sm font-medium",children:"Geschäft (optional)"}),e.jsx(ye,{value:se.store,onChange:c=>fe({...se,store:c.target.value}),placeholder:"z.B. Migros",className:"h-11 min-h-[44px] mt-1.5 rounded-xl"})]})]}),e.jsxs(Ne,{className:"px-5 pb-3 pt-2 gap-2.5",children:[e.jsx(H,{variant:"outline",onClick:()=>b(!1),className:"h-11 min-h-[44px] flex-1 rounded-xl text-sm font-medium",children:"Abbrechen"}),e.jsx(H,{onClick:x,disabled:Le,className:"h-11 min-h-[44px] flex-1 rounded-xl text-sm font-medium",children:Le?"Speichert...":"Hinzufügen"})]})]})})]})}export{ur as $,Ue as A,H as B,pa as C,ve as D,_e as E,$e as F,le as G,ja as H,ye as I,na as J,gt as K,re as L,Ca as M,Da as N,ar as O,ya as P,ir as Q,rr as R,Oe as S,cr as T,or as U,xr as V,lr as W,$a as X,Ha as Y,Ka as Z,dr as _,Ga as a,mr as a0,Va as a1,Ya as a2,Ye as a3,nn as a4,nt as a5,gr as a6,hr as a7,pr as a8,Pt as a9,fr as aa,qa as ab,Qa as ac,er as ad,tr as ae,Za as af,Ja as ag,Wa as ah,br as ai,Is as aj,Vs as ak,Xa as b,z as c,Nt as d,tn as e,ce as f,U as g,Be as h,ue as i,e as j,zt as k,da as l,ua as m,Mt as n,we as o,je as p,De as q,Se as r,Ne as s,He as t,ta as u,Qt as v,en as w,Jt as x,nr as y,sr as z};
