const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["backgroundTaskManager-DuxFkiIE.js","eventBus-CWDWdm45.js","workflowOrchestrator-BZtQc-WZ.js"])))=>i.map(i=>d[i]);
import{Z as Yt,j as e,d as Ze,l as Re,_ as _t,$ as Xt,a0 as Jt,m as Pe,B as O,x as De,a as At,u as ut,z as es,i as ze,A as _,Q as X,L as I,S as ee,K as te,M as se,N as ne,O as P,I as le,f as qe,t as We,R as Rt,a1 as ts,w as ss,G as Se,H as re,a2 as nt,v as Pt,a3 as Be,a4 as ns,a5 as Ke,a6 as at,a7 as tt,a8 as Ue,a9 as as,D as pe,o as fe,p as be,q as je,r as ye,aa as ht,ab as rt,s as ve,ac as rs,ad as is,c as Le,b as Ft,ae as ls,af as os,g as He,ag as cs,ah as ds,ai as us,aj as xt,ak as st,al as Bt,h as ms}from"./page-aichat-Cjc3JURy.js";import{i as hs}from"./vendor-i18n-CxwOOByA.js";import{createRoot as xs}from"react-dom/client";import{T as Ye,h as gs,Q as ps}from"./vendor-api-DUnF1PDn.js";import{u as Ie,L as Te,S as fs,R as ie}from"./vendor-router-CqlaLFHO.js";import{bw as bs,v as It,bx as Tt,by as zt,A as it,y as lt,x as gt,bz as ot,B as ct,k as pt,g as Lt,e as xe,F as _e,J as Xe,X as Ee,bA as js,bB as vs,bC as dt,bD as ft,t as Fe,N as ys,O as Mt,p as ge,z as Ge,j as Ns,bE as Ot,bF as ws,bG as bt,S as jt,bH as Ds,bI as ks,bJ as Ss,bK as Cs,bL as Es,bM as As,bN as Rs,bO as Ps,bP as vt,bQ as Ut,T as Je,bR as Fs,a1 as Bs,h as Is,U as yt,bS as Ts,bT as zs,bU as Ls,bV as Ht,r as Ms,bW as Os,bX as Us,bY as Hs,bZ as Vs,G as Ks,b_ as $s}from"./vendor-misc-CNnXDEWF.js";import{T as qs,t as h}from"./vendor-toast-CdQ6zwVl.js";import{createContext as Ws,useState as x,useEffect as oe,useContext as Gs,Component as Qs,useMemo as J,useRef as Ne,useCallback as Zs}from"react";import{n as Vt,p as $e,r as Nt,j as Ve}from"./vendor-firebase-BWqYINcm.js";import{M as we,S as Q,B as ke,a as Ys}from"./page-calendar-B_vrBQ9w.js";import{R as wt,B as _s,C as Xs,X as Js,Y as en,T as Dt,L as tn,a as kt,P as sn,b as nn,c as an}from"./vendor-charts-DCDgDKH3.js";import{M as rn}from"./page-shopping-CaV_373E.js";import{t as ln,L as on,u as cn,v as dn,w as un,x as mn}from"./vendor-ui-DFoAMWof.js";import{f as hn,d as xn}from"./vendor-dates-gcsEV1c3.js";import"./vendor-utils-BNe0Xlio.js";import"react-dom";(function(){const s=document.createElement("link").relList;if(s&&s.supports&&s.supports("modulepreload"))return;for(const r of document.querySelectorAll('link[rel="modulepreload"]'))a(r);new MutationObserver(r=>{for(const d of r)if(d.type==="childList")for(const v of d.addedNodes)v.tagName==="LINK"&&v.rel==="modulepreload"&&a(v)}).observe(document,{childList:!0,subtree:!0});function c(r){const d={};return r.integrity&&(d.integrity=r.integrity),r.referrerPolicy&&(d.referrerPolicy=r.referrerPolicy),r.crossOrigin==="use-credentials"?d.credentials="include":r.crossOrigin==="anonymous"?d.credentials="omit":d.credentials="same-origin",d}function a(r){if(r.ep)return;r.ep=!0;const d=c(r);fetch(r.href,d)}})();const gn={de:{translation:{nav:{dashboard:"Dashboard",reminders:"Erinnerungen",finance:"Finanzen",bills:"Rechnungen",shopping:"Einkaufsliste",taxes:"Steuern",settings:"Einstellungen",logout:"Abmelden"},auth:{login:"Anmelden",logout:"Abmelden"},dashboard:{title:"Dashboard",upcomingEvents:"Anstehende Termine & Zahlungen",upcomingReminders:"Anstehende Termine & Zahlungen",appointments:"Termine & Aufgaben",pendingBills:"Offene Rechnungen",noAppointments:"Keine anstehenden Termine",noBills:"Keine offenen Rechnungen",viewAll:"Alle anzeigen",financeOverview:"Finanzübersicht (aktueller Monat)",taxStatus:"Steuer-Status",quickActions:"Schnellaktionen",noEvents:"Keine anstehenden Ereignisse",noReminders:"Keine anstehenden Erinnerungen",addReminder:"Erinnerung hinzufügen",addExpense:"Ausgabe hinzufügen",addEntry:"Eintrag hinzufügen",viewFinances:"Finanzen anzeigen",viewTaxProfile:"Steuerprofil anzeigen"},bills:{title:"Rechnungen",description:"Verwalten Sie Ihre Rechnungen und Zahlungserinnerungen",add:"Rechnung hinzufügen",edit:"Rechnung bearbeiten",scan:"Scannen",scanInvoice:"Rechnung scannen",total:"Gesamt",open:"Offen",overdue:"Überfällig",paid:"Bezahlt",pending:"Ausstehend",paidTab:"Bezahlt",noPending:"Keine ausstehenden Rechnungen",noPaid:"Noch keine bezahlten Rechnungen",addFirst:"Erste Rechnung hinzufügen",pendingPayments:"Offene Zahlungen",search:"Suchen...",filterStatus:"Status",titleField:"Titel / Beschreibung",titlePlaceholder:"z.B. Stromrechnung März",amount:"Betrag",currency:"Währung",dueDate:"Fälligkeitsdatum",paymentDetails:"Zahlungsdetails",creditor:"Empfänger",reference:"Referenz / Mitteilung",recurrence:"Wiederholung",noRecurrence:"Keine Wiederholung",quarterly:"Vierteljährlich",notes:"Notizen",notesPlaceholder:"Optionale Notizen...",dialogDescription:"Erfassen Sie die Rechnungsdetails",markAsPaid:"Als bezahlt markieren",markedAsPaid:"Als bezahlt markiert und Ausgabe erstellt",created:"Rechnung erstellt",updated:"Rechnung aktualisiert",deleted:"Rechnung gelöscht",confirmDelete:"Möchten Sie diese Rechnung wirklich löschen?",dataImported:"Rechnungsdaten übernommen",status:{paid:"Bezahlt",overdue:"Überfällig",dueSoon:"Bald fällig",pending:"Offen"},errors:{required:"Bitte füllen Sie alle Pflichtfelder aus."}},finance:{title:"Finanzen",add:"Eintrag hinzufügen",pageTitle:"Finanzen",pageDescription:"Verwalten Sie Ihre Einnahmen und Ausgaben",overview:"Übersicht",income:"Einnahmen",expenses:"Ausgaben",people:"Rechnungen",shoppingList:"Einkaufsliste",totalIncome:"Gesamteinnahmen",totalExpenses:"Gesamtausgaben",balance:"Saldo",allEntries:"Alle Einträge",noEntries:"Noch keine Einträge erfasst",noExpenses:"Keine Ausgaben",addEntry:"Eintrag hinzufügen",addIncome:"Einnahme hinzufügen",addExpense:"Ausgabe hinzufügen",category:"Kategorie",amount:"Betrag",date:"Datum",description:"Beschreibung",status:"Status",open:"Offen",paid:"Bezahlt",person:"Person",addPerson:"Person hinzufügen",personName:"Name",personAdded:"Person erfolgreich hinzugefügt",namePlaceholder:"Name eingeben",phone:"Telefon",noPeople:"Noch keine Personen erfasst",openAmount:"Offener Betrag",viewDetails:"Details anzeigen",notes:"Notizen",paymentMethod:"Zahlungsmethode",personDeleted:"Person erfolgreich gelöscht",invoices:"Rechnungen",addInvoice:"Rechnung hinzufügen",editInvoice:"Rechnung bearbeiten",deleteInvoice:"Rechnung löschen",invoiceAmount:"Betrag",invoiceDescription:"Beschreibung",invoiceDate:"Datum",invoiceStatus:"Status",invoiceAdded:"Rechnung erfolgreich hinzugefügt",invoiceUpdated:"Rechnung erfolgreich aktualisiert",invoiceDeleted:"Rechnung erfolgreich gelöscht",statusUpdated:"Status erfolgreich aktualisiert",noInvoices:"Noch keine Rechnungen erfasst",postponed:"Verschoben",confirmDelete:"Möchten Sie diese Rechnung wirklich löschen?",confirmDeletePerson:"Möchten Sie diese Person und alle zugehörigen Rechnungen wirklich löschen?",totalInvoices:"Rechnungen gesamt",openInvoices:"Offene Rechnungen",errors:{nameRequired:"Name ist erforderlich",amountRequired:"Betrag ist erforderlich",descriptionRequired:"Beschreibung ist erforderlich"},filterByCategory:"Nach Kategorie filtern",allCategories:"Alle Kategorien",showingCategory:"Zeigt",noIncome:"Keine Einnahmen vorhanden",monthlyOverview:"Monatsübersicht",last6Months:"Einnahmen vs. Ausgaben der letzten 6 Monate",exportSuccess:"Export erfolgreich",exportError:"Export fehlgeschlagen",recurring:"Wiederkehrend",recurrenceRule:"Wiederholungsregel",daily:"Täglich",weekly:"Wöchentlich",monthly:"Monatlich",yearly:"Jährlich",recurringHint:"Dieser Eintrag wird automatisch wiederholt erstellt.",budget:"Budget",budgets:"Budgets",setBudget:"Budget festlegen",budgetAmount:"Budget-Betrag",budgetUsed:"Verbraucht",budgetRemaining:"Verbleibend",budgetExceeded:"Budget überschritten",noBudgets:"Noch keine Budgets festgelegt",addBudget:"Budget hinzufügen",editBudget:"Budget bearbeiten",deleteBudget:"Budget löschen",budgetPeriod:"Zeitraum",categoryBreakdown:"Ausgaben nach Kategorie"},invoice:{scanTitle:"Rechnung scannen",scanDescription:"Laden Sie ein Bild der Rechnung hoch oder scannen Sie den QR-Code.",upload:"Hochladen",camera:"Kamera",manual:"Manuell",dropOrClick:"Bild hier ablegen oder klicken",supportedFormats:"JPG, PNG oder PDF",clickToChange:"Klicken um ein anderes Bild zu wählen",processing:"Verarbeite...",startCamera:"Kamera starten",capture:"Aufnehmen",qrCodeData:"QR-Code Daten",pasteQrData:"QR-Code Daten hier einfügen...",parseQr:"QR-Code parsen",dataExtracted:"Daten extrahiert",amount:"Betrag",creditor:"Empfänger",reference:"Referenz",message:"Mitteilung",useData:"Daten übernehmen",scan:"Scannen",scanInvoice:"Rechnung scannen",paymentDetails:"Zahlungsdetails",dataImported:"Daten wurden übernommen",qrDetected:"QR-Code erkannt!",qrNotSwiss:"QR-Code erkannt, aber kein Schweizer Zahlungs-QR.",noQrFound:"Kein QR-Code gefunden. Sie können die Daten manuell eingeben.",manualEntry:"QR-Code-Erkennung nicht verfügbar. Bitte geben Sie die Daten manuell ein.",qrParsed:"QR-Code-Daten erfolgreich geparst!",invalidQr:"Ungültige QR-Code-Daten.",invalidFileType:"Ungültiger Dateityp. Bitte laden Sie ein Bild oder PDF hoch.",processingError:"Fehler bei der Bildverarbeitung.",cameraError:"Kamera konnte nicht gestartet werden.",enterQrData:"Bitte geben Sie die QR-Code-Daten ein.",browserNotSupported:"QR-Code-Erkennung wird in diesem Browser nicht unterstützt. Bitte verwenden Sie Chrome oder Edge.",autoScanning:"Automatische Erkennung aktiv...",cameraInactive:"Kamera nicht aktiv",autoScanHint:"Der QR-Code wird automatisch erkannt, sobald er im Kamerabild erscheint."},shopping:{title:"Einkaufsliste",short:"Einkaufsliste",description:"Verwalten Sie Ihre Einkäufe und Budget",addItem:"Artikel hinzufügen",item:"Artikel",quantity:"Menge",estimatedPrice:"Geschätzter Preis",actualPrice:"Tatsächlicher Preis",category:"Kategorie",notBought:"Nicht eingekauft",bought:"Eingekauft",totalBudget:"Gesamtbudget",spent:"Ausgegeben",remaining:"Verbleibend",noItems:"Keine Artikel in der Liste",markAsBought:"Als eingekauft markieren",createExpense:"Ausgabe erstellen"},reminders:{title:"Erinnerungen",add:"Erinnerung hinzufügen",edit:"Erinnerung bearbeiten",description:"Verwalten Sie Ihre Termine, Zahlungen und Aufgaben",pageDescription:"Verwalten Sie Ihre Termine und Aufgaben",dialogDescription:"Erstellen Sie eine neue Erinnerung für Termine, Zahlungen oder Aufgaben",reminderTitle:"Titel",titleField:"Titel",titlePlaceholder:"z.B. Zahnarzttermin",addReminder:"Erinnerung hinzufügen",type:"Typ",types:{termin:"Termin",zahlung:"Zahlung",aufgabe:"Aufgabe"},appointment:"Termin",payment:"Zahlung",task:"Aufgabe",dueDate:"Fälligkeitsdatum",allDay:"Ganztägig",status:{label:"Status",offen:"Offen",erledigt:"Erledigt",überfällig:"Überfällig",open:"Offen",done:"Erledigt",overdue:"Überfällig"},open:"Offen",completed:"Erledigt",overdue:"Überfällig",amount:"Betrag",currency:"Währung",notes:"Notizen",notesPlaceholder:"Optionale Notizen...",recurrence:"Wiederholung",noRecurrence:"Keine Wiederholung",noReminders:"Keine Erinnerungen vorhanden",total:"Gesamt",pendingPayments:"Offene Zahlungen",search:"Suchen...",filterType:"Typ",filterStatus:"Status",upcoming:"Anstehend",past:"Vergangen",noUpcoming:"Keine anstehenden Erinnerungen",noPast:"Keine vergangenen Erinnerungen",addFirst:"Erste Erinnerung erstellen",markDone:"Als erledigt markieren",markOpen:"Wieder öffnen",confirmDelete:"Möchten Sie diese Erinnerung wirklich löschen?",created:"Erinnerung erstellt",updated:"Erinnerung aktualisiert",deleted:"Erinnerung gelöscht",statusUpdated:"Status aktualisiert",errors:{required:"Bitte füllen Sie alle Pflichtfelder aus."}},taxes:{title:"Steuern",description:"Verwalten Sie Ihre Steuerprofile für verschiedene Jahre",year:"Steuerjahr",canton:"Kanton",selectCanton:"Kanton wählen",noCanton:"Kein Kanton ausgewählt",status:{unvollständig:"Unvollständig",vollständig:"Vollständig",eingereicht:"Eingereicht",draft:"Entwurf",submitted:"Eingereicht",completed:"Abgeschlossen"},addProfile:"Neues Steuerprofil",newProfile:"Neues Steuerprofil",editProfile:"Steuerprofil bearbeiten",noProfiles:"Keine Steuerprofile vorhanden",createFirst:"Erstellen Sie Ihr erstes Steuerprofil, um zu beginnen.",profileDescription:"Erfassen Sie Ihre Steuerdaten für das gewählte Jahr",profileCreated:"Steuerprofil erfolgreich erstellt",profileUpdated:"Steuerprofil erfolgreich aktualisiert",profileDeleted:"Steuerprofil erfolgreich gelöscht",statusUpdated:"Status erfolgreich aktualisiert",errorCreating:"Fehler beim Erstellen des Profils",errorUpdating:"Fehler beim Aktualisieren des Profils",errorDeleting:"Fehler beim Löschen des Profils",confirmDelete:"Steuerprofil löschen?",confirmDeleteDescription:"Möchten Sie dieses Steuerprofil wirklich löschen? Diese Aktion kann nicht rückgängig gemacht werden.",personalInfo:"Persönliches",maritalStatus:"Zivilstand",selectMaritalStatus:"Wählen",single:"Ledig",married:"Verheiratet",divorced:"Geschieden",widowed:"Verwitwet",registeredPartnership:"Eingetragene Partnerschaft",children:"Kinder",incomeSection:"Einkommen",grossIncome:"Bruttoeinkommen",otherIncome:"Andere Einkünfte",other:"andere",deductionsSection:"Abzüge",deductions:"Abzüge",totalDeductions:"Gesamtabzüge (CHF)",taxableIncome:"Steuerbares Einkommen",notes:"Notizen",notesPlaceholder:"Zusätzliche Informationen..."},settings:{title:"Einstellungen",description:"Verwalten Sie Ihre Kontoeinstellungen",profile:"Profil",profileDescription:"Verwalten Sie Ihre persönlichen Informationen",name:"Name",namePlaceholder:"Ihr Name",email:"E-Mail",emailHint:"E-Mail kann nicht geändert werden",preferences:"Präferenzen",preferencesDescription:"Passen Sie Ihre App-Einstellungen an",language:"Sprache",currency:"Währung",canton:"Kanton",selectCanton:"Wählen Sie Ihren Kanton",cantonHint:"Wird für Steuerberechnungen verwendet",appearance:"Darstellung",appearanceDescription:"Passen Sie das Erscheinungsbild der App an",darkMode:"Dunkler Modus",darkModeDescription:"Dunkles Farbschema aktivieren",theme:"Design",notifications:"Benachrichtigungen",notificationsDescription:"Verwalten Sie Ihre Benachrichtigungseinstellungen",enableNotifications:"Benachrichtigungen aktivieren",notificationsHint:"Erhalten Sie Erinnerungen für anstehende Termine und Zahlungen",save:"Speichern",saved:"Einstellungen gespeichert",errorSaving:"Fehler beim Speichern",reset:"Zurücksetzen"},common:{add:"Hinzufügen",edit:"Bearbeiten",delete:"Löschen",cancel:"Abbrechen",save:"Speichern",close:"Schliessen",search:"Suchen",filter:"Filtern",sort:"Sortieren",loading:"Wird geladen...",error:"Fehler",success:"Erfolg",confirm:"Bestätigen",yes:"Ja",no:"Nein"}}},en:{translation:{nav:{dashboard:"Dashboard",reminders:"Reminders",finance:"Finance",bills:"Bills",shopping:"Shopping List",taxes:"Taxes",settings:"Settings",logout:"Logout"},auth:{login:"Login",logout:"Logout"},dashboard:{title:"Dashboard",upcomingEvents:"Upcoming Appointments & Payments",appointments:"Appointments & Tasks",pendingBills:"Pending Bills",noAppointments:"No upcoming appointments",noBills:"No pending bills",viewAll:"View all",financeOverview:"Finance Overview (Current Month)",taxStatus:"Tax Status",quickActions:"Quick Actions",noEvents:"No upcoming events",addReminder:"Add Reminder",addExpense:"Add Expense",viewFinances:"View Finances"},bills:{title:"Bills",description:"Manage your bills and payment reminders",add:"Add Bill",edit:"Edit Bill",scan:"Scan",scanInvoice:"Scan Invoice",total:"Total",open:"Open",overdue:"Overdue",paid:"Paid",pending:"Pending",paidTab:"Paid",noPending:"No pending bills",noPaid:"No paid bills yet",addFirst:"Add first bill",pendingPayments:"Pending Payments",search:"Search...",filterStatus:"Status",titleField:"Title / Description",titlePlaceholder:"e.g. Electricity bill March",amount:"Amount",currency:"Currency",dueDate:"Due Date",paymentDetails:"Payment Details",creditor:"Creditor",reference:"Reference / Message",recurrence:"Recurrence",noRecurrence:"No recurrence",quarterly:"Quarterly",notes:"Notes",notesPlaceholder:"Optional notes...",dialogDescription:"Enter the bill details",markAsPaid:"Mark as paid",markedAsPaid:"Marked as paid and expense created",created:"Bill created",updated:"Bill updated",deleted:"Bill deleted",confirmDelete:"Are you sure you want to delete this bill?",dataImported:"Bill data imported",status:{paid:"Paid",overdue:"Overdue",dueSoon:"Due Soon",pending:"Open"},errors:{required:"Please fill in all required fields."}},finance:{pageTitle:"Finance",pageDescription:"Manage your income and expenses",overview:"Overview",income:"Income",expenses:"Expenses",people:"Invoices",shoppingList:"Shopping List",totalIncome:"Total Income",totalExpenses:"Total Expenses",balance:"Balance",noEntries:"No entries yet",addEntry:"Add Entry",addIncome:"Add Income",addExpense:"Add Expense",category:"Category",amount:"Amount",date:"Date",description:"Description",status:"Status",open:"Open",paid:"Paid",person:"Person",addPerson:"Add Person",personName:"Name",personAdded:"Person added successfully",namePlaceholder:"Enter name",phone:"Phone",noPeople:"No people added yet",openAmount:"Open Amount",viewDetails:"View Details",notes:"Notes",paymentMethod:"Payment Method",personDeleted:"Person deleted successfully",invoices:"Invoices",addInvoice:"Add Invoice",editInvoice:"Edit Invoice",deleteInvoice:"Delete Invoice",invoiceAmount:"Amount",invoiceDescription:"Description",invoiceDate:"Date",invoiceStatus:"Status",invoiceAdded:"Invoice added successfully",invoiceUpdated:"Invoice updated successfully",invoiceDeleted:"Invoice deleted successfully",statusUpdated:"Status updated successfully",noInvoices:"No invoices yet",postponed:"Postponed",confirmDelete:"Are you sure you want to delete this invoice?",confirmDeletePerson:"Are you sure you want to delete this person and all associated invoices?",totalInvoices:"Total Invoices",openInvoices:"Open Invoices",errors:{nameRequired:"Name is required",amountRequired:"Amount is required",descriptionRequired:"Description is required"},filterByCategory:"Filter by category",allCategories:"All categories",showingCategory:"Showing",noIncome:"No income entries",monthlyOverview:"Monthly Overview",last6Months:"Income vs. Expenses over the last 6 months",exportSuccess:"Export successful",exportError:"Export failed",recurring:"Recurring",recurrenceRule:"Recurrence Rule",daily:"Daily",weekly:"Weekly",monthly:"Monthly",yearly:"Yearly",recurringHint:"This entry will be automatically recreated.",budget:"Budget",budgets:"Budgets",setBudget:"Set Budget",budgetAmount:"Budget Amount",budgetUsed:"Used",budgetRemaining:"Remaining",budgetExceeded:"Budget exceeded",noBudgets:"No budgets set yet",addBudget:"Add Budget",editBudget:"Edit Budget",deleteBudget:"Delete Budget",budgetPeriod:"Period",categoryBreakdown:"Expenses by Category"},invoice:{scanTitle:"Scan Invoice",scanDescription:"Upload an image of the invoice or scan the QR code.",upload:"Upload",camera:"Camera",manual:"Manual",dropOrClick:"Drop image here or click",supportedFormats:"JPG, PNG or PDF",clickToChange:"Click to choose another image",processing:"Processing...",startCamera:"Start Camera",capture:"Capture",qrCodeData:"QR Code Data",pasteQrData:"Paste QR code data here...",parseQr:"Parse QR Code",dataExtracted:"Data extracted",amount:"Amount",creditor:"Recipient",reference:"Reference",message:"Message",useData:"Use Data",scan:"Scan",scanInvoice:"Scan Invoice",paymentDetails:"Payment Details",dataImported:"Data has been imported",qrDetected:"QR code detected!",qrNotSwiss:"QR code detected, but not a Swiss payment QR.",noQrFound:"No QR code found. You can enter the data manually.",manualEntry:"QR code detection not available. Please enter the data manually.",qrParsed:"QR code data successfully parsed!",invalidQr:"Invalid QR code data.",invalidFileType:"Invalid file type. Please upload an image or PDF.",processingError:"Error processing image.",cameraError:"Could not start camera.",enterQrData:"Please enter the QR code data.",browserNotSupported:"QR code detection is not supported in this browser. Please use Chrome or Edge.",autoScanning:"Auto-detection active...",cameraInactive:"Camera not active",autoScanHint:"The QR code will be automatically detected once it appears in the camera view."},shopping:{title:"Shopping List",description:"Manage your shopping and budget",addItem:"Add Item",item:"Item",quantity:"Quantity",estimatedPrice:"Estimated Price",actualPrice:"Actual Price",category:"Category",notBought:"Not Bought",bought:"Bought",totalBudget:"Total Budget",spent:"Spent",remaining:"Remaining",noItems:"No items in the list",markAsBought:"Mark as Bought",createExpense:"Create Expense"},reminders:{title:"Reminders",add:"Add Reminder",edit:"Edit Reminder",description:"Manage your appointments, payments and tasks",pageTitle:"Reminders",pageDescription:"Manage your appointments and tasks",dialogDescription:"Create a new reminder for appointments, payments or tasks",reminderTitle:"Title",titleField:"Title",titlePlaceholder:"e.g. Dentist appointment",addReminder:"Add Reminder",type:"Type",types:{termin:"Appointment",zahlung:"Payment",aufgabe:"Task"},appointment:"Appointment",payment:"Payment",task:"Task",dueDate:"Due Date",allDay:"All Day",status:{label:"Status",offen:"Open",erledigt:"Completed",überfällig:"Overdue",open:"Open",done:"Completed",overdue:"Overdue"},open:"Open",completed:"Completed",overdue:"Overdue",amount:"Amount",currency:"Currency",notes:"Notes",notesPlaceholder:"Optional notes...",recurrence:"Recurrence",noRecurrence:"No recurrence",noReminders:"No reminders",total:"Total",pendingPayments:"Pending Payments",search:"Search...",filterType:"Type",filterStatus:"Status",upcoming:"Upcoming",past:"Past",noUpcoming:"No upcoming reminders",noPast:"No past reminders",addFirst:"Create first reminder",markDone:"Mark as completed",markOpen:"Reopen",confirmDelete:"Are you sure you want to delete this reminder?",created:"Reminder created",updated:"Reminder updated",deleted:"Reminder deleted",statusUpdated:"Status updated",errors:{required:"Please fill in all required fields."}},taxes:{title:"Taxes",description:"Manage your tax profiles for different years",year:"Tax Year",canton:"Canton",selectCanton:"Select Canton",noCanton:"No canton selected",status:{unvollständig:"Incomplete",vollständig:"Complete",eingereicht:"Submitted",draft:"Draft",submitted:"Submitted",completed:"Completed"},addProfile:"New Tax Profile",newProfile:"New Tax Profile",editProfile:"Edit Tax Profile",noProfiles:"No tax profiles",createFirst:"Create your first tax profile to get started.",profileDescription:"Enter your tax data for the selected year",profileCreated:"Tax profile created successfully",profileUpdated:"Tax profile updated successfully",profileDeleted:"Tax profile deleted successfully",statusUpdated:"Status updated successfully",errorCreating:"Error creating profile",errorUpdating:"Error updating profile",errorDeleting:"Error deleting profile",confirmDelete:"Delete tax profile?",confirmDeleteDescription:"Are you sure you want to delete this tax profile? This action cannot be undone.",personalInfo:"Personal Info",maritalStatus:"Marital Status",selectMaritalStatus:"Select",single:"Single",married:"Married",divorced:"Divorced",widowed:"Widowed",registeredPartnership:"Registered Partnership",children:"Children",incomeSection:"Income",grossIncome:"Gross Income",otherIncome:"Other Income",other:"other",deductionsSection:"Deductions",deductions:"Deductions",totalDeductions:"Total Deductions (CHF)",taxableIncome:"Taxable Income",notes:"Notes",notesPlaceholder:"Additional information..."},settings:{title:"Settings",description:"Manage your account settings",profile:"Profile",profileDescription:"Manage your personal information",name:"Name",namePlaceholder:"Your name",email:"Email",emailHint:"Email cannot be changed",preferences:"Preferences",preferencesDescription:"Customize your app settings",language:"Language",currency:"Currency",canton:"Canton",selectCanton:"Select your canton",cantonHint:"Used for tax calculations",appearance:"Appearance",appearanceDescription:"Customize the look and feel of the app",darkMode:"Dark Mode",darkModeDescription:"Enable dark color scheme",theme:"Theme",notifications:"Notifications",notificationsDescription:"Manage your notification settings",enableNotifications:"Enable notifications",notificationsHint:"Receive reminders for upcoming appointments and payments",save:"Save",saved:"Settings saved",errorSaving:"Error saving settings",reset:"Reset"},common:{add:"Add",edit:"Edit",delete:"Delete",cancel:"Cancel",save:"Save",close:"Close",search:"Search",filter:"Filter",sort:"Sort",loading:"Loading...",error:"Error",success:"Success",confirm:"Confirm",yes:"Yes",no:"No"}}}};hs.use(Yt).init({resources:gn,lng:"de",fallbackLng:"de",interpolation:{escapeValue:!1}});const pn=({...t})=>{const{theme:s="system"}=bs();return e.jsx(qs,{theme:s,className:"toaster group",style:{"--normal-bg":"var(--popover)","--normal-text":"var(--popover-foreground)","--normal-border":"var(--border)"},...t})},Kt=Ws(void 0);function fn({children:t,defaultTheme:s="light",switchable:c=!1}){const{settings:a,updateSettings:r}=Ze(),[d,v]=x(()=>{if(c){const g=a?.theme;if(g&&(g==="light"||g==="dark"))return g;const k=localStorage.getItem("theme");return k&&(k==="light"||k==="dark")?k:(k&&r&&(r({theme:k}).catch(console.error),localStorage.removeItem("theme")),s)}return s});oe(()=>{c&&a?.theme&&(a.theme==="light"||a.theme==="dark")&&v(a.theme)},[a?.theme,c]),oe(()=>{const g=document.documentElement;d==="dark"?g.classList.add("dark"):g.classList.remove("dark"),c&&r&&(r({theme:d}).catch(console.error),localStorage.setItem("theme",d))},[d,c,r]);const j=c?()=>{v(g=>g==="light"?"dark":"light")}:void 0;return e.jsx(Kt.Provider,{value:{theme:d,toggleTheme:j,switchable:c},children:t})}function bn(){const t=Gs(Kt);if(!t)throw new Error("useTheme must be used within ThemeProvider");return t}function jn(t,s){const c={...s,timestamp:new Date().toISOString(),userAgent:typeof window<"u"?window.navigator.userAgent:void 0,url:typeof window<"u"?window.location.href:void 0};console.error("Error:",{message:t.message,stack:t.stack,...c})}class vn extends Qs{constructor(s){super(s),this.state={hasError:!1,error:null,errorInfo:null}}static getDerivedStateFromError(s){return{hasError:!0,error:s,errorInfo:null}}componentDidCatch(s,c){jn(s,{componentStack:c.componentStack,errorBoundary:!0}),this.setState({error:s,errorInfo:c})}handleReset=()=>{this.setState({hasError:!1,error:null,errorInfo:null})};render(){return this.state.hasError?this.props.fallback?this.props.fallback:e.jsx(yn,{error:this.state.error,errorInfo:this.state.errorInfo,onReset:this.handleReset}):this.props.children}}function yn({error:t,errorInfo:s,onReset:c}){const[,a]=Ie();return e.jsx("div",{className:"min-h-screen bg-background flex items-center justify-center p-4",children:e.jsxs(Re,{className:"w-full max-w-md",children:[e.jsxs(_t,{children:[e.jsxs("div",{className:"flex items-center gap-3 mb-2",children:[e.jsx(It,{className:"w-8 h-8 text-destructive"}),e.jsx(Xt,{children:"Ein Fehler ist aufgetreten"})]}),e.jsx(Jt,{children:"Die Anwendung ist auf einen unerwarteten Fehler gestossen. Bitte versuchen Sie es erneut."})]}),e.jsxs(Pe,{className:"space-y-4",children:[!1,e.jsxs("div",{className:"flex flex-col gap-2",children:[e.jsxs(O,{onClick:c,className:"w-full h-10 min-h-[44px]",variant:"default",children:[e.jsx(Tt,{className:"w-4 h-4 mr-2"}),"Erneut versuchen"]}),e.jsxs(O,{onClick:()=>{a("/"),c()},className:"w-full h-10 min-h-[44px]",variant:"outline",children:[e.jsx(zt,{className:"w-4 h-4 mr-2"}),"Zur Startseite"]})]})]})]})})}function Nn(){const{t}=De(),{data:s=[],isLoading:c}=At(),{data:a=[],isLoading:r}=ut({status:"offen"}),{data:d=[],isLoading:v}=es(),{totalIncome:j,totalExpenses:g,balance:k,monthlyTrend:p}=J(()=>{const i=new Date,m=i.getMonth(),z=i.getFullYear(),H=m===0?11:m-1,w=m===0?z-1:z,U=s.filter(R=>{const L=R.date?.toDate?R.date.toDate():new Date(R.date);return R.type==="einnahme"&&L.getMonth()===m&&L.getFullYear()===z}).reduce((R,L)=>R+L.amount,0)/100,ae=s.filter(R=>{const L=R.date?.toDate?R.date.toDate():new Date(R.date);return R.type==="ausgabe"&&R.status==="paid"&&L.getMonth()===m&&L.getFullYear()===z}).reduce((R,L)=>R+L.amount,0)/100,F=s.filter(R=>{const L=R.date?.toDate?R.date.toDate():new Date(R.date);return R.type==="einnahme"&&L.getMonth()===H&&L.getFullYear()===w}).reduce((R,L)=>R+L.amount,0)/100,K=s.filter(R=>{const L=R.date?.toDate?R.date.toDate():new Date(R.date);return R.type==="ausgabe"&&R.status==="paid"&&L.getMonth()===H&&L.getFullYear()===w}).reduce((R,L)=>R+L.amount,0)/100,A=s.filter(R=>R.type==="einnahme").reduce((R,L)=>R+L.amount,0)/100,D=s.filter(R=>R.type==="ausgabe"&&R.status==="paid").reduce((R,L)=>R+L.amount,0)/100,$=F>0?(U-F)/F*100:0,M=K>0?(ae-K)/K*100:0;return{totalIncome:A,totalExpenses:D,balance:A-D,monthlyTrend:{income:$,expenses:M,currentMonthIncome:U,currentMonthExpenses:ae}}},[s]),y=a.filter(i=>i.status==="offen").length,C=d.filter(i=>!i.bought).length,E=i=>`CHF ${i.toFixed(2)}`,T=c||r||v;return e.jsx(we,{title:"Übersicht",showSidebar:!0,children:T?e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"mobile-card mb-4 bg-primary text-primary-foreground",children:[e.jsx(Q,{className:"h-4 w-20 mb-2 bg-primary-foreground/20"}),e.jsx(Q,{className:"h-9 w-32 mb-4 bg-primary-foreground/20"}),e.jsxs("div",{className:"flex gap-6 mt-4 pt-4 border-t border-primary-foreground/20",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx(Q,{className:"h-3 w-16 mb-1 bg-primary-foreground/20"}),e.jsx(Q,{className:"h-6 w-24 bg-primary-foreground/20"})]}),e.jsxs("div",{className:"flex-1",children:[e.jsx(Q,{className:"h-3 w-16 mb-1 bg-primary-foreground/20"}),e.jsx(Q,{className:"h-6 w-24 bg-primary-foreground/20"})]})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-3 mb-6",children:[e.jsx(Q,{className:"h-20 w-full rounded-lg"}),e.jsx(Q,{className:"h-20 w-full rounded-lg"})]}),e.jsx(Q,{className:"h-4 w-24 mb-4"}),e.jsxs("div",{className:"flex flex-col gap-6",children:[e.jsx(Q,{className:"h-16 w-full rounded-lg"}),e.jsx(Q,{className:"h-16 w-full rounded-lg"}),e.jsx(Q,{className:"h-16 w-full rounded-lg"})]})]}):e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"mobile-card mb-4 bg-primary text-primary-foreground",children:[e.jsx("p",{className:"text-sm opacity-70 mb-2",children:t("finance.balance","Saldo")}),e.jsx("p",{className:"text-3xl font-semibold mb-4",children:E(k)}),e.jsxs("div",{className:"flex gap-6 mt-4 pt-4 border-t border-primary-foreground/20",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("p",{className:"text-xs opacity-60 mb-1",children:t("finance.income","Einnahmen")}),e.jsxs("p",{className:"text-lg font-medium flex items-center gap-1.5",children:[e.jsx(it,{className:"w-5 h-5 opacity-70"}),E(j)]}),p.income!==0&&e.jsxs("p",{className:`text-xs mt-1 flex items-center gap-1 ${p.income>0?"text-green-300":"text-red-300"}`,children:[p.income>0?e.jsx(lt,{className:"w-3 h-3"}):e.jsx(gt,{className:"w-3 h-3"}),Math.abs(p.income).toFixed(1),"% vs. Vormonat"]})]}),e.jsxs("div",{className:"flex-1",children:[e.jsx("p",{className:"text-xs opacity-60 mb-1",children:t("finance.expenses","Ausgaben")}),e.jsxs("p",{className:"text-lg font-medium flex items-center gap-1.5",children:[e.jsx(ot,{className:"w-5 h-5 opacity-70"}),E(g)]}),p.expenses!==0&&e.jsxs("p",{className:`text-xs mt-1 flex items-center gap-1 ${p.expenses<0?"text-green-300":"text-red-300"}`,children:[p.expenses<0?e.jsx(gt,{className:"w-3 h-3"}):e.jsx(lt,{className:"w-3 h-3"}),Math.abs(p.expenses).toFixed(1),"% vs. Vormonat"]})]})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-3 mb-6",children:[e.jsx(Te,{href:"/reminders",children:e.jsxs("div",{className:"mobile-card flex items-center gap-3 active:opacity-80 transition-opacity",children:[e.jsx("div",{className:"w-10 h-10 rounded-lg bg-status-warning flex items-center justify-center",children:e.jsx(ct,{className:"w-5 h-5 status-warning"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-2xl font-semibold",children:y}),e.jsx("p",{className:"text-xs text-muted-foreground",children:t("reminders.open","Offen")})]})]})}),e.jsx(Te,{href:"/shopping",children:e.jsxs("div",{className:"mobile-card flex items-center gap-3 active:opacity-80 transition-opacity",children:[e.jsx("div",{className:"w-10 h-10 rounded-lg bg-status-success flex items-center justify-center",children:e.jsx(pt,{className:"w-5 h-5 status-success"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-2xl font-semibold",children:C}),e.jsx("p",{className:"text-xs text-muted-foreground",children:t("shopping.items","Artikel")})]})]})})]}),e.jsx("p",{className:"text-xs font-medium text-muted-foreground mb-4 uppercase tracking-wider",children:t("dashboard.quickActions","Schnellzugriff")}),e.jsxs("div",{className:"flex flex-col gap-6",children:[e.jsx(Te,{href:"/finance",className:"block",children:e.jsxs("div",{className:"mobile-card flex items-center justify-between active:opacity-80 transition-opacity py-4",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:"w-12 h-12 rounded-lg bg-muted flex items-center justify-center flex-shrink-0",children:e.jsx(Lt,{className:"w-6 h-6 text-foreground"})}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-base",children:t("nav.finance","Finanzen")}),e.jsxs("p",{className:"text-xs text-muted-foreground mt-0.5",children:[s.length," ",t("finance.entries","Einträge")]})]})]}),e.jsx(xe,{className:"w-5 h-5 text-muted-foreground flex-shrink-0 ml-2"})]})}),e.jsx(Te,{href:"/bills",className:"block",children:e.jsxs("div",{className:"mobile-card flex items-center justify-between active:opacity-80 transition-opacity py-4",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:"w-12 h-12 rounded-lg bg-muted flex items-center justify-center flex-shrink-0",children:e.jsx(_e,{className:"w-6 h-6 text-foreground"})}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-base",children:t("nav.bills","Rechnungen")}),e.jsx("p",{className:"text-xs text-muted-foreground mt-0.5",children:t("bills.manage","Verwalten")})]})]}),e.jsx(xe,{className:"w-5 h-5 text-muted-foreground flex-shrink-0 ml-2"})]})}),e.jsx(Te,{href:"/shopping",className:"block",children:e.jsxs("div",{className:"mobile-card flex items-center justify-between active:opacity-80 transition-opacity py-4",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:"w-12 h-12 rounded-lg bg-muted flex items-center justify-center flex-shrink-0",children:e.jsx(pt,{className:"w-6 h-6 text-foreground"})}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-base",children:t("nav.shopping","Einkaufsliste")}),e.jsxs("p",{className:"text-xs text-muted-foreground mt-0.5",children:[C," ",t("shopping.itemsOpen","offen")]})]})]}),e.jsx(xe,{className:"w-5 h-5 text-muted-foreground flex-shrink-0 ml-2"})]})})]})]})})}function wn({onRefresh:t,threshold:s=80,disabled:c=!1}){const[a,r]=x({isRefreshing:!1,pullDistance:0,canRefresh:!1}),d=Ne(0),v=Ne(0),j=Ne(!1),g=Ne(null);oe(()=>{if(c)return;const y=g.current;if(!y)return;const C=i=>{y.scrollTop===0&&(d.current=i.touches[0].clientY,j.current=!0)},E=i=>{if(!j.current)return;v.current=i.touches[0].clientY;const m=Math.max(0,v.current-d.current);m>0&&(i.preventDefault(),r({isRefreshing:!1,pullDistance:m,canRefresh:m>=s}))},T=async()=>{if(j.current)if(j.current=!1,a.canRefresh&&!a.isRefreshing){r({isRefreshing:!0,pullDistance:s,canRefresh:!0});try{await t()}catch(i){console.error("[PullToRefresh] Error:",i)}finally{r({isRefreshing:!1,pullDistance:0,canRefresh:!1})}}else r({isRefreshing:!1,pullDistance:0,canRefresh:!1})};return y.addEventListener("touchstart",C,{passive:!1}),y.addEventListener("touchmove",E,{passive:!1}),y.addEventListener("touchend",T),()=>{y.removeEventListener("touchstart",C),y.removeEventListener("touchmove",E),y.removeEventListener("touchend",T)}},[c,t,s,a.canRefresh,a.isRefreshing]);const k=Math.min(a.pullDistance/s,1),p=a.pullDistance>0||a.isRefreshing;return{containerRef:g,isRefreshing:a.isRefreshing,pullProgress:k,shouldShowIndicator:p,pullDistance:a.pullDistance}}function $t(t,s){const{headers:c,rows:a,title:r}=t,d=[];r&&(d.push(r),d.push("")),d.push(c.join(",")),a.forEach(p=>{const y=p.map(C=>{const E=String(C);return E.includes(",")||E.includes('"')||E.includes(`
`)?`"${E.replace(/"/g,'""')}"`:E});d.push(y.join(","))});const v="\uFEFF"+d.join(`
`),j=new Blob([v],{type:"text/csv;charset=utf-8;"}),g=URL.createObjectURL(j),k=document.createElement("a");k.href=g,k.download=s||`export_${new Date().toISOString().split("T")[0]}.csv`,k.click(),URL.revokeObjectURL(g)}function Dn(t,s){const{headers:c,rows:a,title:r}=t;let d=`
    <!DOCTYPE html>
    <html lang="de">
    <head>
      <meta charset="UTF-8">
      <title>${r||"Export"}</title>
      <style>
        @media print {
          @page {
            margin: 1cm;
          }
        }
        body {
          font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
          padding: 20px;
          color: #333;
        }
        h1 {
          margin-bottom: 20px;
          font-size: 24px;
        }
        table {
          width: 100%;
          border-collapse: collapse;
          margin-top: 20px;
        }
        th, td {
          border: 1px solid #ddd;
          padding: 8px 12px;
          text-align: left;
        }
        th {
          background-color: #f5f5f5;
          font-weight: 600;
        }
        tr:nth-child(even) {
          background-color: #f9f9f9;
        }
        .footer {
          margin-top: 30px;
          text-align: center;
          font-size: 12px;
          color: #666;
        }
      </style>
    </head>
    <body>
      ${r?`<h1>${r}</h1>`:""}
      <table>
        <thead>
          <tr>
            ${c.map(k=>`<th>${k}</th>`).join("")}
          </tr>
        </thead>
        <tbody>
          ${a.map(k=>`
            <tr>
              ${k.map(p=>`<td>${String(p)}</td>`).join("")}
            </tr>
          `).join("")}
        </tbody>
      </table>
      <div class="footer">
        <p>Exportiert am ${new Date().toLocaleDateString("de-CH",{day:"2-digit",month:"long",year:"numeric",hour:"2-digit",minute:"2-digit"})}</p>
      </div>
    </body>
    </html>
  `;const v=new Blob([d],{type:"text/html;charset=utf-8"}),j=URL.createObjectURL(v),g=window.open(j,"_blank");if(!g)throw new Error("Pop-up blockiert. Bitte erlauben Sie Pop-ups für diese Website.");g.onload=()=>{setTimeout(()=>{g.print(),setTimeout(()=>URL.revokeObjectURL(j),1e3)},250)}}function kn(t){const s=["Datum","Typ","Kategorie","Betrag (CHF)","Zahlungsmethode","Status","Notizen"],c=t.map(a=>{const d=(a.date?.toDate?a.date.toDate():new Date(a.date)).toLocaleDateString("de-CH"),v=a.type==="einnahme"?"Einnahme":"Ausgabe",j=(a.amount/100).toFixed(2),g=a.status==="paid"?"Bezahlt":a.type==="einnahme"?"-":"Offen";return[d,v,a.category||"",j,a.paymentMethod||"",g,a.notes||""]});$t({headers:s,rows:c,title:"Finanzübersicht"},`finanzen_${new Date().toISOString().split("T")[0]}.csv`)}function Sn(t,s){const c=["Datum","Typ","Kategorie","Betrag (CHF)","Status"],a=t.map(r=>{const v=(r.date?.toDate?r.date.toDate():new Date(r.date)).toLocaleDateString("de-CH"),j=r.type==="einnahme"?"Einnahme":"Ausgabe",g=(r.amount/100).toFixed(2),k=r.status==="paid"?"Bezahlt":r.type==="einnahme"?"-":"Offen";return[v,j,r.category||"",g,k]});s&&(a.push(["","","ZUSAMMENFASSUNG","",""]),a.push(["","","Einnahmen",`CHF ${s.income.toFixed(2)}`,""]),a.push(["","","Ausgaben",`CHF ${s.expenses.toFixed(2)}`,""]),a.push(["","","Saldo",`CHF ${s.balance.toFixed(2)}`,""])),Dn({headers:c,rows:a,title:"Finanzübersicht"})}function Cn(t){const s=["Titel","Typ","Fälligkeitsdatum","Betrag (CHF)","Status","Notizen"],c=t.map(a=>{const d=(a.dueDate instanceof Date?a.dueDate:new Date(a.dueDate)).toLocaleDateString("de-CH",{day:"2-digit",month:"2-digit",year:"numeric"}),v=a.amount?(a.amount/100).toFixed(2):"",j={termin:"Termin",zahlung:"Zahlung",aufgabe:"Aufgabe"};return[a.title,j[a.type]||a.type,d,v,a.status==="erledigt"?"Erledigt":a.status==="überfällig"?"Überfällig":"Offen",a.notes||""]});$t({headers:s,rows:c,title:"Erinnerungen"},`erinnerungen_${new Date().toISOString().split("T")[0]}.csv`)}const St={income:["Gehalt","Freelance","Investitionen","Geschenk","Sonstiges"],expense:["Lebensmittel","Transport","Wohnen","Unterhaltung","Gesundheit","Kleidung","Bildung","Rechnung","Sonstiges"]};function En(){const{t}=De(),{data:s=[],isLoading:c,refetch:a}=At(),[r,d]=x("all"),[v,j]=x(!1),[g,k]=x("ausgabe"),[p,y]=x(""),[C,E]=x("all"),[T,i]=x("all"),[m,z]=x(!1),{containerRef:H,isRefreshing:w,pullProgress:U,shouldShowIndicator:ae}=wn({onRefresh:async()=>{await a()},disabled:c}),[F,K]=x({category:"",amount:"",date:ze(new Date),notes:"",paymentMethod:"Karte",isRecurring:!1,recurrenceRule:"monthly"}),A=J(()=>s.filter(l=>l.type==="einnahme"),[s]),D=J(()=>s.filter(l=>l.type==="ausgabe"),[s]),$=J(()=>A.reduce((l,N)=>l+N.amount,0)/100,[A]),M=J(()=>D.filter(l=>l.status==="paid").reduce((l,N)=>l+N.amount,0)/100,[D]),R=$-M,L=J(()=>{const l={},N=new Date;for(let b=5;b>=0;b--){const W=new Date(N.getFullYear(),N.getMonth()-b,1),ue=`${W.getFullYear()}-${String(W.getMonth()+1).padStart(2,"0")}`;l[ue]={income:0,expenses:0}}return s.forEach(b=>{const W=b.date&&typeof b.date=="object"&&"toDate"in b.date?b.date.toDate():new Date(b.date),ue=`${W.getFullYear()}-${String(W.getMonth()+1).padStart(2,"0")}`;if(l[ue]){const Ae=b.amount/100;b.type==="einnahme"?l[ue].income+=Ae:b.type==="ausgabe"&&b.status==="paid"&&(l[ue].expenses+=Ae)}}),Object.entries(l).map(([b,W])=>{const[ue,Ae]=b.split("-");return{month:new Date(parseInt(ue),parseInt(Ae)-1).toLocaleDateString("de-CH",{month:"short",year:"2-digit"}),income:Math.round(W.income*100)/100,expenses:Math.round(W.expenses*100)/100}})},[s]),ce=J(()=>{const l={};return D.filter(N=>N.status==="paid").forEach(N=>{const b=N.amount/100;l[N.category]=(l[N.category]||0)+b}),Object.entries(l).map(([N,b])=>({name:N,value:Math.round(b*100)/100})).sort((N,b)=>b.value-N.value).slice(0,8)},[D]),f=["#ef4444","#f97316","#eab308","#22c55e","#3b82f6","#8b5cf6","#ec4899","#06b6d4"],B=J(()=>{const l=new Set;return s.forEach(N=>{N.category&&l.add(N.category)}),Array.from(l).sort()},[s]),o=J(()=>{let l=s;switch(r){case"income":l=A;break;case"expenses":l=D;break;default:l=s}if(C!=="all"&&(l=l.filter(N=>N.category===C)),T!=="all"){const N=new Date,b=new Date;switch(T){case"week":b.setDate(N.getDate()-7);break;case"month":b.setMonth(N.getMonth()-1);break;case"year":b.setFullYear(N.getFullYear()-1);break}l=l.filter(W=>(W.date&&typeof W.date=="object"&&"toDate"in W.date?W.date.toDate():new Date(W.date))>=b)}if(p.trim()){const N=p.toLowerCase();l=l.filter(b=>b.category?.toLowerCase().includes(N)||b.notes?.toLowerCase().includes(N)||b.paymentMethod?.toLowerCase().includes(N))}return l.sort((N,b)=>{const W=N.date&&typeof N.date=="object"&&"toDate"in N.date?N.date.toDate():new Date(N.date);return(b.date&&typeof b.date=="object"&&"toDate"in b.date?b.date.toDate():new Date(b.date)).getTime()-W.getTime()})},[r,s,A,D,C,T,p]),n=l=>`CHF ${(l/100).toFixed(2)}`,S=l=>{try{return(l?.toDate?l.toDate():new Date(l)).toLocaleDateString("de-CH",{day:"2-digit",month:"2-digit",year:"numeric"})}catch{return"N/A"}},q=async(l,N)=>{try{await ts(l,{status:N}),h.success(N==="paid"?"Als bezahlt markiert":"Status geändert"),await a()}catch(b){h.error("Fehler: "+b.message)}},Z=async()=>{if(!F.category||!F.amount){h.error("Bitte Kategorie und Betrag eingeben");return}try{await ss({type:g,category:F.category,amount:Math.round(parseFloat(F.amount)*100),currency:"CHF",date:new Date(F.date),paymentMethod:F.paymentMethod,notes:F.notes,status:g==="ausgabe"?"open":void 0,isRecurring:F.isRecurring,recurrenceRule:F.isRecurring?F.recurrenceRule:void 0}),h.success(g==="einnahme"?"Einnahme hinzugefügt":"Ausgabe hinzugefügt"),le(),j(!1),K({category:"",amount:"",date:ze(new Date),notes:"",paymentMethod:"Karte",isRecurring:!1,recurrenceRule:"monthly"}),await a()}catch(l){h.error(Se(l)),re()}},de=l=>{k(l),K({category:"",amount:"",date:ze(new Date),notes:"",paymentMethod:"Karte",isRecurring:!1,recurrenceRule:"monthly"}),j(!0)};return e.jsxs(we,{title:t("nav.finance","Finanzen"),showSidebar:!0,children:[ae&&e.jsx("div",{className:"fixed top-16 left-0 right-0 flex items-center justify-center z-40 transition-all duration-200 pointer-events-none",style:{transform:`translateY(${Math.max(-60,U*60-60)}px)`,opacity:Math.min(U*1.5,1)},children:e.jsxs("div",{className:"bg-background border border-border shadow-lg rounded-lg px-4 py-2 flex items-center gap-2",children:[e.jsx(Tt,{className:`w-5 h-5 text-primary transition-transform ${w?"animate-spin":""}`,style:{transform:`rotate(${U*180}deg)`}}),e.jsx("span",{className:"text-sm font-medium",children:w?"Aktualisiere...":U>=1?"Loslassen zum Aktualisieren":"Ziehen zum Aktualisieren"})]})}),e.jsxs("div",{ref:H,className:"h-full overflow-y-auto",children:[e.jsxs("div",{className:"grid grid-cols-3 gap-3 mb-4",children:[e.jsxs("div",{className:"mobile-card text-center py-4",children:[e.jsx("p",{className:"text-xs text-muted-foreground mb-1.5",children:t("finance.income","Einnahmen")}),e.jsx("p",{className:"text-lg font-semibold status-success",children:$.toFixed(0)})]}),e.jsxs("div",{className:"mobile-card text-center py-4",children:[e.jsx("p",{className:"text-xs text-muted-foreground mb-1.5",children:t("finance.expenses","Ausgaben")}),e.jsx("p",{className:"text-lg font-semibold status-error",children:M.toFixed(0)})]}),e.jsxs("div",{className:"mobile-card text-center py-4",children:[e.jsx("p",{className:"text-xs text-muted-foreground mb-1.5",children:t("finance.balance","Saldo")}),e.jsx("p",{className:`text-lg font-semibold ${R>=0?"status-success":"status-error"}`,children:R.toFixed(0)})]})]}),e.jsxs("div",{className:"flex gap-3 mb-4",children:[e.jsxs("button",{onClick:()=>{_(),de("einnahme")},className:"flex-1 mobile-card flex items-center justify-center gap-2 py-4 border-l-2 border-l-green-600 active:opacity-80 transition-opacity min-h-[56px]",children:[e.jsx(it,{className:"w-5 h-5 status-success"}),e.jsx("span",{className:"font-medium text-sm",children:"Einnahme"})]}),e.jsxs("button",{onClick:()=>{_(),de("ausgabe")},className:"flex-1 mobile-card flex items-center justify-center gap-2 py-4 border-l-2 border-l-red-600 active:opacity-80 transition-opacity min-h-[56px]",children:[e.jsx(ot,{className:"w-5 h-5 status-error"}),e.jsx("span",{className:"font-medium text-sm",children:"Ausgabe"})]})]}),e.jsxs("div",{className:"mb-4 space-y-3",children:[e.jsxs("div",{className:"relative",children:[e.jsx(Xe,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-5 h-5 text-muted-foreground"}),e.jsx(X,{type:"text",placeholder:"Suchen nach Kategorie, Notizen...",value:p,onChange:l=>y(l.target.value),className:"pl-10 pr-10 mobile-input"}),p&&e.jsx("button",{onClick:()=>y(""),className:"absolute right-3 top-1/2 -translate-y-1/2 p-1 rounded-full hover:bg-muted transition-colors","aria-label":"Suche löschen",children:e.jsx(Ee,{className:"w-4 h-4 text-muted-foreground"})})]}),e.jsxs("button",{onClick:()=>{_(),z(!m)},className:"w-full mobile-card flex items-center justify-between py-3 active:opacity-80 transition-opacity",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(js,{className:"w-5 h-5 text-muted-foreground"}),e.jsx("span",{className:"font-medium text-sm",children:"Filter"}),(C!=="all"||T!=="all")&&e.jsx("span",{className:"w-2 h-2 rounded-full bg-primary"})]}),e.jsx(xe,{className:`w-5 h-5 text-muted-foreground transition-transform ${m?"rotate-90":""}`})]}),m&&e.jsxs("div",{className:"mobile-card p-4 space-y-4 animate-in slide-in-from-top-2",children:[e.jsxs("div",{children:[e.jsx(I,{className:"text-sm text-muted-foreground mb-2 block",children:"Kategorie"}),e.jsxs(ee,{value:C,onValueChange:E,children:[e.jsx(te,{className:"mobile-input",children:e.jsx(se,{})}),e.jsxs(ne,{children:[e.jsx(P,{value:"all",children:"Alle Kategorien"}),B.map(l=>e.jsx(P,{value:l,children:l},l))]})]})]}),e.jsxs("div",{children:[e.jsx(I,{className:"text-sm text-muted-foreground mb-2 block",children:"Zeitraum"}),e.jsxs(ee,{value:T,onValueChange:l=>i(l),children:[e.jsx(te,{className:"mobile-input",children:e.jsx(se,{})}),e.jsxs(ne,{children:[e.jsx(P,{value:"all",children:"Alle Zeit"}),e.jsx(P,{value:"week",children:"Letzte 7 Tage"}),e.jsx(P,{value:"month",children:"Letzter Monat"}),e.jsx(P,{value:"year",children:"Letztes Jahr"})]})]})]}),(C!=="all"||T!=="all")&&e.jsx("button",{onClick:()=>{_(),E("all"),i("all")},className:"w-full py-2 px-4 rounded-lg bg-muted text-foreground font-medium active:opacity-80 transition-opacity",children:"Filter zurücksetzen"})]})]}),e.jsx("div",{className:"flex gap-3 mb-4 overflow-x-auto hide-scrollbar",children:[{key:"all",label:t("finance.all","Alle")},{key:"income",label:t("finance.income","Einnahmen")},{key:"expenses",label:t("finance.expenses","Ausgaben")}].map(l=>e.jsx("button",{onClick:()=>{_(),d(l.key)},className:`px-4 py-2 rounded-lg text-sm font-medium whitespace-nowrap transition-colors ${r===l.key?"bg-primary text-primary-foreground":"bg-muted text-muted-foreground"}`,children:l.label},l.key))}),L.length>0&&e.jsxs("div",{className:"mobile-card mb-4 p-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(vs,{className:"w-5 h-5 text-muted-foreground"}),e.jsx("h3",{className:"font-semibold text-base",children:t("finance.monthlyOverview","Monatsübersicht")})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:()=>{_(),kn(o),le()},className:"p-2 rounded-lg bg-muted hover:bg-muted/80 transition-colors","aria-label":"Als CSV exportieren",children:e.jsx(dt,{className:"w-4 h-4"})}),e.jsx("button",{onClick:()=>{_(),Sn(o,{income:$,expenses:M,balance:R}),le()},className:"p-2 rounded-lg bg-muted hover:bg-muted/80 transition-colors","aria-label":"Als PDF exportieren",children:e.jsx(dt,{className:"w-4 h-4"})})]})]}),e.jsx("div",{className:"h-[250px] w-full",children:e.jsx(wt,{width:"100%",height:"100%",children:e.jsxs(_s,{data:L,margin:{top:10,right:10,left:-20,bottom:5},children:[e.jsx(Xs,{strokeDasharray:"3 3",stroke:"hsl(var(--border))",opacity:.3}),e.jsx(Js,{dataKey:"month",fontSize:11,tickLine:!1,axisLine:!1,tick:{fill:"hsl(var(--muted-foreground))"}}),e.jsx(en,{fontSize:11,tickLine:!1,axisLine:!1,tick:{fill:"hsl(var(--muted-foreground))"},tickFormatter:l=>`${l}`}),e.jsx(Dt,{formatter:l=>[`CHF ${l.toFixed(2)}`,""],contentStyle:{backgroundColor:"hsl(var(--background))",border:"1px solid hsl(var(--border))",borderRadius:"8px",boxShadow:"0 4px 6px rgba(0,0,0,0.1)",fontSize:"12px"},labelStyle:{color:"hsl(var(--foreground))",fontWeight:600}}),e.jsx(tn,{wrapperStyle:{fontSize:"12px",paddingTop:"10px"},iconType:"circle"}),e.jsx(kt,{dataKey:"income",name:t("finance.income","Einnahmen"),fill:"#22c55e",radius:[4,4,0,0],isAnimationActive:!0}),e.jsx(kt,{dataKey:"expenses",name:t("finance.expenses","Ausgaben"),fill:"#ef4444",radius:[4,4,0,0],isAnimationActive:!0})]})})})]}),ce.length>0&&r==="expenses"&&e.jsxs("div",{className:"mobile-card mb-4 p-4",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-4",children:[e.jsx(lt,{className:"w-5 h-5 text-muted-foreground"}),e.jsx("h3",{className:"font-semibold text-base",children:t("finance.categoryBreakdown","Ausgaben nach Kategorie")})]}),e.jsxs("div",{className:"flex flex-col gap-4",children:[e.jsx("div",{className:"h-[200px] w-full",children:e.jsx(wt,{width:"100%",height:"100%",children:e.jsxs(sn,{children:[e.jsx(nn,{data:ce,cx:"50%",cy:"50%",innerRadius:40,outerRadius:80,paddingAngle:2,dataKey:"value",isAnimationActive:!0,children:ce.map((l,N)=>e.jsx(an,{fill:f[N%f.length]},`cell-${N}`))}),e.jsx(Dt,{formatter:l=>[`CHF ${l.toFixed(2)}`,""],contentStyle:{backgroundColor:"hsl(var(--background))",border:"1px solid hsl(var(--border))",borderRadius:"8px",boxShadow:"0 4px 6px rgba(0,0,0,0.1)",fontSize:"12px"}})]})})}),e.jsx("div",{className:"space-y-2",children:ce.slice(0,6).map((l,N)=>{const b=M>0?l.value/M*100:0;return e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-3 h-3 rounded-full shrink-0",style:{backgroundColor:f[N%f.length]}}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-sm font-medium truncate",children:l.name}),e.jsxs("span",{className:"text-sm text-muted-foreground ml-2",children:[b.toFixed(1),"%"]})]}),e.jsxs("div",{className:"flex items-center gap-2 mt-1",children:[e.jsx("div",{className:"flex-1 h-2 bg-muted rounded-full overflow-hidden",children:e.jsx("div",{className:"h-full rounded-full",style:{width:`${b}%`,backgroundColor:f[N%f.length]}})}),e.jsxs("span",{className:"text-xs font-medium text-foreground min-w-[60px] text-right",children:["CHF ",l.value.toFixed(2)]})]})]})]},l.name)})})]})]}),c?e.jsx("div",{className:"text-center py-8 text-muted-foreground",children:t("common.loading","Laden...")}):o.length===0?e.jsx("div",{className:"text-center py-8 text-muted-foreground",children:t("finance.noEntries","Keine Einträge")}):e.jsx("div",{className:"space-y-3",children:o.map(l=>{const N=l.type==="einnahme",b=l.status==="paid";return e.jsxs("div",{className:`mobile-card flex items-center justify-between py-3 ${N?"border-l-2 border-l-green-600":"border-l-2 border-l-red-600"}`,children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:`w-10 h-10 rounded-lg flex items-center justify-center ${N?"bg-status-success":"bg-status-error"}`,children:N?e.jsx(it,{className:"w-5 h-5 status-success"}):e.jsx(ot,{className:"w-5 h-5 status-error"})}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("p",{className:"font-medium",children:l.category}),l.isRecurring&&e.jsx(ft,{className:"w-3 h-3 text-muted-foreground","aria-label":"Wiederkehrend"})]}),e.jsx("p",{className:"text-xs text-muted-foreground",children:S(l.date)}),l.isRecurring&&e.jsxs("p",{className:"text-xs text-muted-foreground mt-0.5",children:["Wiederholt: ",l.recurrenceRule==="daily"?"Täglich":l.recurrenceRule==="weekly"?"Wöchentlich":l.recurrenceRule==="monthly"?"Monatlich":l.recurrenceRule==="yearly"?"Jährlich":""]})]})]}),e.jsxs("div",{className:"text-right",children:[e.jsxs("p",{className:`font-semibold ${N?"status-success":"status-error"}`,children:[N?"+":"-",n(l.amount)]}),!N&&e.jsx("button",{onClick:()=>{_(),q(l.id,b?"open":"paid")},className:`text-xs px-2 py-0.5 rounded mt-1 ${b?"bg-status-success status-success":"bg-status-warning status-warning"}`,"aria-label":`Status für ${l.category} ändern`,"aria-pressed":b,children:b?t("finance.paid","Bezahlt"):t("finance.open","Offen")})]})]},l.id)})}),v&&e.jsx("div",{className:"fixed inset-0 z-50 bg-black/50 flex items-end",children:e.jsxs("div",{className:"bg-background w-full rounded-t-2xl p-6 safe-bottom animate-in slide-in-from-bottom",children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsx("h2",{className:"text-lg font-semibold",children:g==="einnahme"?"Neue Einnahme":"Neue Ausgabe"}),e.jsx("button",{onClick:()=>j(!1),className:"w-10 h-10 rounded-lg bg-muted flex items-center justify-center",children:e.jsx(Ee,{className:"w-5 h-5"})})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx(I,{className:"text-sm text-muted-foreground",children:"Kategorie"}),e.jsxs(ee,{value:F.category,onValueChange:l=>K({...F,category:l}),children:[e.jsx(te,{className:"mobile-input mt-1",children:e.jsx(se,{placeholder:"Kategorie wählen"})}),e.jsx(ne,{children:(g==="einnahme"?St.income:St.expense).map(l=>e.jsx(P,{value:l,children:l},l))})]})]}),e.jsxs("div",{children:[e.jsx(I,{className:"text-sm text-muted-foreground",children:"Betrag (CHF)"}),e.jsx(X,{type:"number",value:F.amount,onChange:l=>K({...F,amount:l.target.value}),placeholder:"0.00",className:"mobile-input mt-1",step:"0.01"})]}),e.jsxs("div",{children:[e.jsx(I,{className:"text-sm text-muted-foreground",children:"Datum"}),e.jsx(X,{type:"text",placeholder:"DD.MM.YYYY",value:qe(F.date),onChange:l=>{const N=We(l.target.value);N&&K({...F,date:N})},onBlur:l=>{!We(l.target.value)&&F.date&&(l.target.value=qe(F.date))},className:"mobile-input mt-1"})]}),e.jsxs("div",{children:[e.jsx(I,{className:"text-sm text-muted-foreground",children:"Zahlungsmethode"}),e.jsxs(ee,{value:F.paymentMethod,onValueChange:l=>K({...F,paymentMethod:l}),children:[e.jsx(te,{className:"mobile-input mt-1",children:e.jsx(se,{})}),e.jsxs(ne,{children:[e.jsx(P,{value:"Karte",children:"Karte"}),e.jsx(P,{value:"Bar",children:"Bar"}),e.jsx(P,{value:"Überweisung",children:"Überweisung"}),e.jsx(P,{value:"Twint",children:"Twint"})]})]})]}),e.jsxs("div",{children:[e.jsx(I,{className:"text-sm text-muted-foreground",children:"Notizen (optional)"}),e.jsx(X,{value:F.notes,onChange:l=>K({...F,notes:l.target.value}),placeholder:"Zusätzliche Infos...",className:"mobile-input mt-1"})]}),e.jsxs("div",{className:"flex items-center justify-between p-3 bg-muted/50 rounded-lg",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(ft,{className:"w-5 h-5 text-muted-foreground"}),e.jsxs("div",{children:[e.jsx(I,{className:"text-sm font-medium",children:"Wiederkehrend"}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Automatisch wiederholen"})]})]}),e.jsx(Rt,{checked:F.isRecurring,onCheckedChange:l=>K({...F,isRecurring:l})})]}),F.isRecurring&&e.jsxs("div",{children:[e.jsx(I,{className:"text-sm text-muted-foreground",children:"Wiederholung"}),e.jsxs(ee,{value:F.recurrenceRule,onValueChange:l=>K({...F,recurrenceRule:l}),children:[e.jsx(te,{className:"mobile-input mt-1",children:e.jsx(se,{})}),e.jsxs(ne,{children:[e.jsx(P,{value:"daily",children:"Täglich"}),e.jsx(P,{value:"weekly",children:"Wöchentlich"}),e.jsx(P,{value:"monthly",children:"Monatlich"}),e.jsx(P,{value:"yearly",children:"Jährlich"})]})]})]}),e.jsx(O,{onClick:Z,className:`w-auto mx-auto mobile-btn mt-4 ${g==="einnahme"?"bg-green-600 hover:bg-green-700 text-white":"bg-red-600 hover:bg-red-700 text-white"}`,children:g==="einnahme"?"Einnahme hinzufügen":"Ausgabe hinzufügen"})]})]})}),!v&&e.jsx("button",{onClick:()=>{_(),de("ausgabe")},className:"fixed right-4 bottom-20 w-14 h-14 rounded-full bg-primary text-primary-foreground shadow-lg flex items-center justify-center active:opacity-80 transition-opacity safe-bottom",children:e.jsx(Fe,{className:"w-6 h-6"})})]})]})}function An(){const{t}=De(),{data:s=[],isLoading:c,refetch:a}=ut({}),[r,d]=x(!1),[v,j]=x(!1),[g,k]=x(!1),[p,y]=x({title:"",amount:"",dueDate:ze(new Date),iban:"",reference:""}),C=Ne(null),E=Ne(null),T=Ne(null),i=Ne(null),m=J(()=>s.filter(f=>f.type==="zahlung"),[s]),z=m.filter(f=>f.status==="offen"),H=m.filter(f=>f.status==="erledigt"),w=z.reduce((f,B)=>f+(B.amount||0),0)/100,U=f=>`CHF ${(f/100).toFixed(2)}`,ae=f=>{try{return(f?.toDate?f.toDate():new Date(f)).toLocaleDateString("de-CH",{day:"2-digit",month:"2-digit"})}catch{return"N/A"}},F=async f=>{try{await nt(f,{status:"erledigt"}),h.success("Als bezahlt markiert"),le(),await a()}catch(B){h.error(Se(B)),re()}},K=f=>{try{return(f?.toDate?f.toDate():new Date(f))<new Date}catch{return!1}},A=async()=>{if(!p.title||!p.amount){h.error("Bitte Titel und Betrag eingeben"),re();return}try{await Pt({title:p.title,type:"zahlung",status:"offen",amount:Math.round(parseFloat(p.amount)*100),dueDate:p.dueDate?new Date(p.dueDate):new Date,description:p.iban?`IBAN: ${p.iban}`:""}),h.success("Rechnung hinzugefügt"),le(),d(!1),y({title:"",amount:"",dueDate:ze(new Date),iban:"",reference:""}),await a()}catch(f){h.error(Se(f)),re()}},D=async()=>{try{const f=await navigator.mediaDevices.getUserMedia({video:{facingMode:"environment"}});i.current=f,C.current&&(C.current.srcObject=f),j(!0),le()}catch(f){h.error(Se(f)),re()}},$=()=>{i.current&&(i.current.getTracks().forEach(f=>f.stop()),i.current=null),j(!1)},M=()=>{if(C.current&&E.current){const f=C.current,B=E.current;B.width=f.videoWidth,B.height=f.videoHeight;const o=B.getContext("2d");o&&(o.drawImage(f,0,0),L(B))}},R=f=>{const B=f.target.files?.[0];if(B){const o=new FileReader;o.onload=n=>{const S=new Image;S.onload=()=>{if(E.current){const q=E.current;q.width=S.width,q.height=S.height;const Z=q.getContext("2d");Z&&(Z.drawImage(S,0,0),L(q))}},S.src=n.target?.result},o.readAsDataURL(B)}},L=async f=>{k(!0);try{if("BarcodeDetector"in window){const o=await new window.BarcodeDetector({formats:["qr_code"]}).detect(f);if(o.length>0){const n=o[0].rawValue;ce(n),h.success("QR-Code erkannt"),$()}else h.error("Kein QR-Code gefunden")}else h.error("QR-Code Erkennung nicht unterstützt")}catch{h.error("Fehler beim Scannen")}finally{k(!1)}},ce=f=>{try{const B=f.split(`
`);if(B.length>10){const o=B[3]||"",n=B[18]||"",S=B[28]||"";y(q=>({...q,iban:o,amount:n,reference:S,title:"Gescannte Rechnung"})),d(!0)}}catch{}};return e.jsxs(we,{title:t("nav.bills","Rechnungen"),showSidebar:!0,children:[e.jsxs("div",{className:"mobile-card mb-4 bg-primary text-primary-foreground",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-3",children:[e.jsx(_e,{className:"w-6 h-6 opacity-70"}),e.jsx("p",{className:"text-sm opacity-70 font-medium",children:t("bills.openAmount","Offene Rechnungen")})]}),e.jsxs("p",{className:"text-3xl font-semibold mb-2",children:["CHF ",w.toFixed(2)]}),e.jsxs("p",{className:"text-sm opacity-60",children:[z.length," ",t("bills.bills","Rechnungen")]})]}),e.jsxs("div",{className:"flex gap-3 mb-4",children:[e.jsxs("button",{onClick:()=>{_(),d(!0)},className:"flex-1 mobile-card flex items-center justify-center gap-2 py-4 active:opacity-80 transition-opacity min-h-[56px]","aria-label":"Rechnung manuell hinzufügen",children:[e.jsx(Fe,{className:"w-5 h-5"}),e.jsx("span",{className:"font-medium text-sm",children:"Manuell"})]}),e.jsxs("button",{onClick:()=>{_(),D()},className:"flex-1 mobile-card flex items-center justify-center gap-2 py-4 active:opacity-80 transition-opacity min-h-[56px]","aria-label":"QR-Code scannen",children:[e.jsx(ys,{className:"w-5 h-5"}),e.jsx("span",{className:"font-medium text-sm",children:"Scannen"})]}),e.jsxs("button",{onClick:()=>{_(),T.current?.click()},className:"flex-1 mobile-card flex items-center justify-center gap-2 py-4 active:opacity-80 transition-opacity min-h-[56px]","aria-label":"Bild hochladen",children:[e.jsx(Mt,{className:"w-5 h-5"}),e.jsx("span",{className:"font-medium text-sm",children:"Bild"})]}),e.jsx("input",{ref:T,type:"file",accept:"image/*",className:"hidden",onChange:R})]}),c?e.jsx("div",{className:"space-y-3",children:[1,2,3].map(f=>e.jsx("div",{className:"mobile-card p-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex-1 space-y-2",children:[e.jsx(Q,{className:"h-4 w-3/4"}),e.jsx(Q,{className:"h-3 w-1/2"})]}),e.jsx(Q,{className:"h-8 w-20 ml-4"})]})},f))}):z.length===0?e.jsxs("div",{className:"mobile-card text-center py-8",children:[e.jsx(ge,{className:"w-10 h-10 mx-auto status-success mb-2"}),e.jsx("p",{className:"text-muted-foreground",children:t("bills.allPaid","Alle Rechnungen bezahlt")})]}):e.jsx("div",{className:"space-y-3 mb-4",children:z.map(f=>{const B=K(f.dueDate);return e.jsxs("div",{className:`mobile-card flex items-center justify-between py-3 ${B?"border-l-2 border-l-red-500":""}`,children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:`w-10 h-10 rounded-lg flex items-center justify-center ${B?"bg-status-error":"bg-status-warning"}`,children:B?e.jsx(It,{className:"w-5 h-5 status-error"}):e.jsx(Ge,{className:"w-5 h-5 status-warning"})}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium",children:f.title}),e.jsxs("p",{className:`text-xs ${B?"status-error":"text-muted-foreground"}`,children:[B?"Überfällig • ":"",ae(f.dueDate)]})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("p",{className:"font-semibold",children:U(f.amount||0)}),e.jsx("button",{onClick:()=>{_(),F(f.id)},className:"w-10 h-10 rounded-lg bg-status-success flex items-center justify-center status-success active:opacity-80 transition-opacity","aria-label":`${f.title} als bezahlt markieren`,children:e.jsx(ge,{className:"w-5 h-5"})})]})]},f.id)})}),H.length>0&&e.jsxs(e.Fragment,{children:[e.jsxs("p",{className:"text-xs font-medium text-muted-foreground mb-2 uppercase tracking-wider",children:[t("bills.paid","Bezahlt")," (",H.length,")"]}),e.jsx("div",{className:"space-y-3 opacity-60",children:H.slice(0,5).map(f=>e.jsxs("div",{className:"mobile-card flex items-center justify-between py-3",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:"w-10 h-10 rounded-lg bg-status-success flex items-center justify-center",children:e.jsx(ge,{className:"w-5 h-5 status-success"})}),e.jsx("p",{className:"font-medium line-through",children:f.title})]}),e.jsx("p",{className:"text-muted-foreground",children:U(f.amount||0)})]},f.id))})]}),e.jsx("canvas",{ref:E,className:"hidden"}),r&&e.jsx("div",{className:"fixed inset-0 z-50 bg-black/50 flex items-end",children:e.jsxs("div",{className:"bg-background w-full rounded-t-2xl p-6 safe-bottom animate-in slide-in-from-bottom",children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsx("h2",{className:"text-lg font-semibold",children:"Neue Rechnung"}),e.jsx("button",{onClick:()=>d(!1),className:"w-10 h-10 rounded-lg bg-muted flex items-center justify-center",children:e.jsx(Ee,{className:"w-5 h-5"})})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx(I,{className:"text-sm text-muted-foreground",children:"Titel"}),e.jsx(X,{value:p.title,onChange:f=>y({...p,title:f.target.value}),placeholder:"z.B. Stromrechnung",className:"mobile-input mt-1"})]}),e.jsxs("div",{children:[e.jsx(I,{className:"text-sm text-muted-foreground",children:"Betrag (CHF)"}),e.jsx(X,{type:"number",value:p.amount,onChange:f=>y({...p,amount:f.target.value}),placeholder:"0.00",className:"mobile-input mt-1",step:"0.01"})]}),e.jsxs("div",{children:[e.jsx(I,{className:"text-sm text-muted-foreground",children:"Fälligkeitsdatum"}),e.jsx(X,{type:"text",placeholder:"DD.MM.YYYY",value:qe(p.dueDate),onChange:f=>{const B=We(f.target.value);B&&y({...p,dueDate:B})},onBlur:f=>{!We(f.target.value)&&p.dueDate&&(f.target.value=qe(p.dueDate))},className:"mobile-input mt-1"})]}),e.jsxs("div",{children:[e.jsx(I,{className:"text-sm text-muted-foreground",children:"IBAN (optional)"}),e.jsx(X,{value:p.iban,onChange:f=>y({...p,iban:f.target.value}),placeholder:"CH...",className:"mobile-input mt-1"})]}),e.jsx(O,{onClick:A,className:"w-auto mx-auto mobile-btn bg-primary text-primary-foreground mt-4",children:"Rechnung hinzufügen"})]})]})}),v&&e.jsxs("div",{className:"fixed inset-0 z-50 bg-black flex flex-col",children:[e.jsxs("div",{className:"flex items-center justify-between p-4",children:[e.jsx("h2",{className:"text-white font-medium",children:"QR-Code scannen"}),e.jsx("button",{onClick:$,className:"w-10 h-10 rounded-lg bg-white/10 flex items-center justify-center",children:e.jsx(Ee,{className:"w-5 h-5 text-white"})})]}),e.jsxs("div",{className:"flex-1 relative",children:[e.jsx("video",{ref:C,autoPlay:!0,playsInline:!0,className:"w-full h-full object-cover"}),e.jsx("div",{className:"absolute inset-0 flex items-center justify-center",children:e.jsx("div",{className:"w-64 h-64 border-2 border-white/50 rounded-lg relative",children:g&&e.jsx("div",{className:"absolute inset-0 flex items-center justify-center bg-black/50 rounded-lg",children:e.jsx("div",{className:"w-8 h-8 border-2 border-white border-t-transparent rounded-full animate-spin"})})})})]}),e.jsx("div",{className:"p-6 flex justify-center safe-bottom",children:e.jsx("button",{onClick:M,disabled:g,className:"w-16 h-16 rounded-full bg-white flex items-center justify-center active:opacity-80 transition-opacity",children:e.jsx(Ns,{className:"w-8 h-8 text-black"})})})]}),!r&&!v&&e.jsx("button",{onClick:()=>d(!0),className:"fixed right-4 bottom-20 w-14 h-14 rounded-full bg-primary text-primary-foreground shadow-lg flex items-center justify-center active:opacity-80 transition-opacity safe-bottom",children:e.jsx(Fe,{className:"w-6 h-6"})})]})}async function Rn(){return"Notification"in window?Notification.permission==="granted"?"granted":Notification.permission!=="denied"?await Notification.requestPermission():"denied":(console.warn("This browser does not support notifications"),"denied")}function Pn(){return"Notification"in window&&"serviceWorker"in navigator}function Fn(){return"Notification"in window?Notification.permission:"denied"}async function qt(){if(!("serviceWorker"in navigator))return console.warn("Service Workers not supported"),null;try{const t=await navigator.serviceWorker.register("/sw.js",{scope:"/"});return console.log("[Notifications] Service Worker registered:",t.scope),t.addEventListener("updatefound",()=>{const s=t.installing;s&&s.addEventListener("statechange",()=>{s.state==="installed"&&navigator.serviceWorker.controller&&console.log("[Notifications] New service worker available")})}),t}catch(t){return console.error("[Notifications] Service Worker registration failed:",t),null}}function mt(){return typeof window<"u"&&"PublicKeyCredential"in window&&typeof PublicKeyCredential.isUserVerifyingPlatformAuthenticatorAvailable=="function"}async function Wt(){if(!mt())return!1;try{return await PublicKeyCredential.isUserVerifyingPlatformAuthenticatorAvailable()}catch(t){return console.error("[Biometric] Error checking availability:",t),!1}}async function Bn(t,s){if(!mt())return{success:!1,error:"Biometric authentication is not supported on this device"};if(!await Wt())return{success:!1,error:"No biometric authenticator available on this device"};try{const a={challenge:Uint8Array.from(crypto.getRandomValues(new Uint8Array(32))),rp:{name:"Nexo",id:window.location.hostname},user:{id:Uint8Array.from(t,v=>v.charCodeAt(0)),name:s,displayName:s},pubKeyCredParams:[{alg:-7,type:"public-key"}],authenticatorSelection:{authenticatorAttachment:"platform",userVerification:"required"},timeout:6e4,attestation:"direct"},r=await navigator.credentials.create({publicKey:a});return r?{success:!0,credentialId:Buffer.from(r.rawId).toString("base64")}:{success:!1,error:"Failed to create credential"}}catch(a){console.error("[Biometric] Registration error:",a);let r="Biometric registration failed";return a.name==="NotAllowedError"?r="Biometric registration was cancelled or denied":a.name==="InvalidStateError"?r="Biometric credential already exists":a.name==="NotSupportedError"&&(r="Biometric authentication is not supported"),{success:!1,error:r}}}function In(){const{settings:t,updateSettings:s,isLoading:c}=Ze(),[a,r]=x(()=>t?.biometricEnabled!==void 0?t.biometricEnabled:localStorage.getItem("biometricEnabled")==="true");return oe(()=>{if(!c&&t?.biometricEnabled!==void 0)r(t.biometricEnabled);else if(!c&&!t?.biometricEnabled){const j=localStorage.getItem("biometricEnabled");if(j!==null){const g=j==="true";s({biometricEnabled:g}).then(()=>{localStorage.removeItem("biometricEnabled")}).catch(console.error),r(g)}}},[t?.biometricEnabled,c,s]),{isEnabled:a,enable:async()=>{r(!0),await s({biometricEnabled:!0}),localStorage.setItem("biometricEnabled","true")},disable:async()=>{r(!1),await s({biometricEnabled:!1}),localStorage.setItem("biometricEnabled","false")}}}function Tn(){const{t}=De(),[s,c]=x("default"),[a,r]=x(!1),[d,v]=x(!1);oe(()=>{r(Pn()),c(Fn())},[]);const j=async()=>{v(!0);try{_(),await qt();const p=await Rn();c(p),p==="granted"?(h.success("Benachrichtigungen aktiviert"),le()):p==="denied"?(h.error("Benachrichtigungen wurden blockiert. Bitte in den Browser-Einstellungen aktivieren."),re()):h.info("Berechtigung erforderlich")}catch{h.error("Fehler beim Aktivieren der Benachrichtigungen"),re()}finally{v(!1)}};if(!a)return e.jsx("div",{className:"mobile-card w-full flex items-center justify-between py-4 opacity-50",children:e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:"w-10 h-10 rounded-lg bg-muted flex items-center justify-center",children:e.jsx(ct,{className:"w-5 h-5 text-foreground"})}),e.jsxs("div",{className:"text-left",children:[e.jsx("p",{className:"font-medium",children:t("settings.notifications","Benachrichtigungen")}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Nicht unterstützt"})]})]})});const g=s==="granted",k=s==="denied";return e.jsxs("div",{className:"mobile-card w-full py-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:"w-10 h-10 rounded-lg bg-muted flex items-center justify-center",children:e.jsx(ct,{className:"w-5 h-5 text-foreground"})}),e.jsxs("div",{className:"text-left",children:[e.jsx("p",{className:"font-medium",children:t("settings.notifications","Benachrichtigungen")}),e.jsx("p",{className:"text-xs text-muted-foreground",children:g?"Aktiviert":k?"Blockiert":"Nicht aktiviert"})]})]}),g?e.jsx("div",{className:"w-6 h-6 rounded-full bg-green-500 flex items-center justify-center",children:e.jsx(ge,{className:"w-4 h-4 text-white"})}):e.jsx("div",{className:"w-6 h-6 rounded-full bg-gray-400 flex items-center justify-center",children:e.jsx(Ee,{className:"w-4 h-4 text-white"})})]}),!g&&e.jsx("button",{onClick:j,disabled:d||k,className:"w-full py-2 px-4 rounded-lg bg-primary text-primary-foreground font-medium active:opacity-80 transition-opacity disabled:opacity-50 disabled:cursor-not-allowed min-h-[44px]",children:d?"Aktiviere...":k?"In Browser-Einstellungen aktivieren":"Benachrichtigungen aktivieren"}),k&&e.jsx("p",{className:"text-xs text-muted-foreground mt-2",children:"Bitte öffnen Sie die Browser-Einstellungen und erlauben Sie Benachrichtigungen für diese Website."})]})}function zn(){const{user:t}=Be(),{isEnabled:s,enable:c,disable:a}=In(),[r,d]=x(!1),[v,j]=x(!1),[g,k]=x(!1),[p,y]=x(!1);oe(()=>{(async()=>{const T=mt();if(d(T),T){const i=await Wt();j(i)}})()},[]);const C=async()=>{if(s){await a(),h.success("Biometrische Authentifizierung deaktiviert"),le();return}if(!v){h.error("Biometrische Authentifizierung ist auf diesem Gerät nicht verfügbar"),re();return}y(!0);try{if(_(),!t){h.error("Bitte melden Sie sich zuerst an"),re();return}const E=await Bn(t.uid,t.displayName||t.email||"User");E.success?(await c(),h.success("Biometrische Authentifizierung aktiviert"),le()):(h.error(E.error||"Aktivierung fehlgeschlagen"),re())}catch{h.error("Fehler beim Aktivieren der biometrischen Authentifizierung"),re()}finally{y(!1)}};return r?e.jsxs("div",{className:"mobile-card w-full py-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:"w-10 h-10 rounded-lg bg-muted flex items-center justify-center",children:e.jsx(Rs,{className:"w-5 h-5 text-foreground"})}),e.jsxs("div",{className:"text-left",children:[e.jsx("p",{className:"font-medium",children:"Biometrische Authentifizierung"}),e.jsx("p",{className:"text-xs text-muted-foreground",children:s?"Aktiviert":v?"Verfügbar":"Nicht verfügbar"})]})]}),s?e.jsx("div",{className:"w-6 h-6 rounded-full bg-green-500 flex items-center justify-center",children:e.jsx(ge,{className:"w-4 h-4 text-white"})}):e.jsx("div",{className:"w-6 h-6 rounded-full bg-gray-400 flex items-center justify-center",children:e.jsx(Ee,{className:"w-4 h-4 text-white"})})]}),v&&e.jsx("button",{onClick:C,disabled:p||g,className:"w-full py-2 px-4 rounded-lg bg-primary text-primary-foreground font-medium active:opacity-80 transition-opacity disabled:opacity-50 disabled:cursor-not-allowed min-h-[44px]",children:p?"Registriere...":g?"Lädt...":s?"Biometrische Authentifizierung deaktivieren":"Biometrische Authentifizierung aktivieren"}),!v&&r&&e.jsx("p",{className:"text-xs text-muted-foreground",children:"Kein biometrischer Sensor auf diesem Gerät gefunden."})]}):null}function Ln(){const{settings:t,updateSettings:s,isLoading:c}=Ze(),[a,r]=x(!1),[d,v]=x(""),[j,g]=x(!1);oe(()=>{t?.weatherLocation&&v(t.weatherLocation)},[t]);const k=async()=>{if(!d.trim()){h.error("Bitte geben Sie einen Ort ein"),re();return}g(!0);try{_(),await s({weatherLocation:d.trim()}),r(!1),h.success("Standort gespeichert"),le()}catch{h.error("Fehler beim Speichern des Standorts"),re()}finally{g(!1)}};return e.jsxs(e.Fragment,{children:[e.jsxs("button",{onClick:()=>r(!0),className:"mobile-card w-full flex items-center justify-between active:opacity-80 transition-opacity py-4",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:"w-10 h-10 rounded-lg bg-muted flex items-center justify-center",children:e.jsx(Ps,{className:"w-5 h-5 text-foreground"})}),e.jsxs("div",{className:"text-left",children:[e.jsx("p",{className:"font-medium",children:"Wetter-Standort"}),e.jsx("p",{className:"text-xs text-muted-foreground truncate max-w-[200px]",children:t?.weatherLocation||"Zurich, CH"})]})]}),e.jsx(xe,{className:"w-5 h-5 text-muted-foreground"})]}),a&&e.jsx("div",{className:"fixed inset-0 z-50 bg-black/50 flex items-end",onClick:()=>r(!1),children:e.jsxs("div",{className:"bg-background w-full rounded-t-2xl p-6 safe-bottom animate-in slide-in-from-bottom",onClick:p=>p.stopPropagation(),children:[e.jsx("h2",{className:"text-lg font-semibold mb-4",children:"Wetter-Standort"}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium mb-2 block",children:'Ort (z.B. "Zurich, CH" oder "Berlin, DE")'}),e.jsx("input",{type:"text",value:d,onChange:p=>v(p.target.value),placeholder:"Zurich, CH",className:"w-full px-4 py-3 rounded-lg bg-muted border border-border focus:outline-none focus:ring-2 focus:ring-primary",disabled:j||c}),e.jsx("p",{className:"text-xs text-muted-foreground mt-2",children:'Format: Stadt, Ländercode (z.B. "Zurich, CH", "Berlin, DE", "New York, US")'})]}),e.jsxs("div",{className:"flex gap-3",children:[e.jsx("button",{onClick:k,disabled:j||c||!d.trim(),className:"flex-1 py-3 rounded-lg bg-primary text-primary-foreground font-medium active:opacity-80 transition-opacity disabled:opacity-50 disabled:cursor-not-allowed min-h-[44px]",children:j?"Speichere...":"Speichern"}),e.jsx("button",{onClick:()=>r(!1),className:"px-6 py-3 rounded-lg bg-muted text-foreground font-medium active:opacity-80 transition-opacity min-h-[44px]",children:"Abbrechen"})]})]})]})})]})}function Mn(){const{t,i18n:s}=De(),[,c]=Ie(),{user:a,logout:r}=Be(),{theme:d,toggleTheme:v}=bn(),{isEnabled:j,toggle:g}=ns(),[k,p]=x(!1),[y,C]=x(!1),{settings:E,updateSettings:T}=Ze(),i=async U=>{s.changeLanguage(U),await T({language:U}),p(!1),h.success(U==="de"?"Sprache geändert":"Language changed")};oe(()=>{if(E?.language)s.changeLanguage(E.language);else{const U=localStorage.getItem("language");U&&(T({language:U}).then(()=>{localStorage.removeItem("language")}).catch(console.error),s.changeLanguage(U))}},[E?.language,T,s]);const m=()=>{v&&(v(),h.success(d==="dark"?"Helles Design aktiviert":"Dunkles Design aktiviert")),C(!1)},z=async()=>{try{r&&await r(),h.success("Abgemeldet"),c("/login")}catch{h.error("Fehler beim Abmelden")}},H=()=>{c("/login")},w=async()=>{await T({preferDesktop:!0}),window.location.href="https://nexo-jtsky100.web.app"};return e.jsxs(we,{title:t("nav.settings","Einstellungen"),showSidebar:!0,children:[e.jsxs("div",{className:"mobile-card mb-4 flex items-center gap-4",children:[e.jsx("div",{className:"w-14 h-14 rounded-lg bg-muted flex items-center justify-center overflow-hidden",children:a?.photoURL?e.jsx("img",{src:a.photoURL,alt:"",className:"w-14 h-14 object-cover"}):e.jsx(Ot,{className:"w-7 h-7 text-muted-foreground"})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("p",{className:"font-semibold truncate",children:a?.displayName||"Benutzer"}),e.jsx("p",{className:"text-sm text-muted-foreground truncate",children:a?.email||"Nicht angemeldet"})]})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("button",{onClick:()=>p(!0),className:"mobile-card w-full flex items-center justify-between active:opacity-80 transition-opacity py-4",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:"w-10 h-10 rounded-lg bg-muted flex items-center justify-center",children:e.jsx(ws,{className:"w-5 h-5 text-foreground"})}),e.jsxs("div",{className:"text-left",children:[e.jsx("p",{className:"font-medium",children:t("settings.language","Sprache")}),e.jsx("p",{className:"text-xs text-muted-foreground",children:s.language==="de"?"Deutsch":"English"})]})]}),e.jsx(xe,{className:"w-5 h-5 text-muted-foreground"})]}),e.jsxs("button",{onClick:()=>C(!0),className:"mobile-card w-full flex items-center justify-between active:opacity-80 transition-opacity py-4",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:"w-10 h-10 rounded-lg bg-muted flex items-center justify-center",children:d==="dark"?e.jsx(bt,{className:"w-5 h-5 text-foreground"}):e.jsx(jt,{className:"w-5 h-5 text-foreground"})}),e.jsxs("div",{className:"text-left",children:[e.jsx("p",{className:"font-medium",children:t("settings.theme","Design")}),e.jsx("p",{className:"text-xs text-muted-foreground",children:d==="dark"?t("settings.dark","Dunkel"):t("settings.light","Hell")})]})]}),e.jsx(xe,{className:"w-5 h-5 text-muted-foreground"})]}),e.jsxs("button",{onClick:w,className:"mobile-card w-full flex items-center justify-between active:opacity-80 transition-opacity py-4",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:"w-10 h-10 rounded-lg bg-muted flex items-center justify-center",children:e.jsx(Ds,{className:"w-5 h-5 text-foreground"})}),e.jsxs("div",{className:"text-left",children:[e.jsx("p",{className:"font-medium",children:"Desktop Version"}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Zur vollständigen Ansicht"})]})]}),e.jsx(xe,{className:"w-5 h-5 text-muted-foreground"})]}),e.jsx(Tn,{}),e.jsx(zn,{}),e.jsx(Ln,{}),e.jsxs("div",{className:"mobile-card w-full py-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:"w-10 h-10 rounded-lg bg-muted flex items-center justify-center",children:e.jsx(ks,{className:"w-5 h-5 text-foreground"})}),e.jsxs("div",{className:"text-left",children:[e.jsx("p",{className:"font-medium",children:"Glass-Effekt"}),e.jsx("p",{className:"text-xs text-muted-foreground",children:j?"Aktiviert":"Deaktiviert"})]})]}),j?e.jsx("div",{className:"w-6 h-6 rounded-full bg-green-500 flex items-center justify-center",children:e.jsx(ge,{className:"w-4 h-4 text-white"})}):e.jsx("div",{className:"w-6 h-6 rounded-full bg-gray-400 flex items-center justify-center",children:e.jsx(Ee,{className:"w-4 h-4 text-white"})})]}),e.jsx("button",{onClick:()=>{g(),_(),h.success(j?"Glass-Effekt deaktiviert":"Glass-Effekt aktiviert")},className:"w-full py-2 px-4 rounded-lg bg-primary text-primary-foreground font-medium active:opacity-80 transition-opacity min-h-[44px]",children:j?"Glass-Effekt deaktivieren":"Glass-Effekt aktivieren"})]}),e.jsxs("button",{onClick:()=>h.info("Kommt in einer zukünftigen Version"),className:"mobile-card w-full flex items-center justify-between active:opacity-80 transition-opacity py-4",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:"w-10 h-10 rounded-lg bg-muted flex items-center justify-center",children:e.jsx(Ss,{className:"w-5 h-5 text-foreground"})}),e.jsx("div",{className:"text-left",children:e.jsx("p",{className:"font-medium",children:t("settings.privacy","Datenschutz")})})]}),e.jsx(xe,{className:"w-5 h-5 text-muted-foreground"})]}),e.jsxs("button",{onClick:()=>h.info("Kommt in einer zukünftigen Version"),className:"mobile-card w-full flex items-center justify-between active:opacity-80 transition-opacity py-4",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:"w-10 h-10 rounded-lg bg-muted flex items-center justify-center",children:e.jsx(Cs,{className:"w-5 h-5 text-foreground"})}),e.jsx("div",{className:"text-left",children:e.jsx("p",{className:"font-medium",children:t("settings.help","Hilfe")})})]}),e.jsx(xe,{className:"w-5 h-5 text-muted-foreground"})]})]}),e.jsxs("button",{onClick:a?z:H,className:"mobile-card w-full flex items-center gap-3 mt-6 active:opacity-80 transition-opacity",children:[e.jsx("div",{className:`w-10 h-10 rounded-lg flex items-center justify-center ${a?"bg-status-error":"bg-primary"}`,children:a?e.jsx(Es,{className:"w-5 h-5 status-error"}):e.jsx(As,{className:"w-5 h-5 text-primary-foreground"})}),e.jsx("p",{className:`font-medium ${a?"status-error":"text-primary"}`,children:a?t("auth.logout","Abmelden"):t("auth.login","Anmelden")})]}),e.jsx("p",{className:"text-center text-xs text-muted-foreground mt-6",children:"Nexo Mobile v1.0.0"}),k&&e.jsx("div",{className:"fixed inset-0 z-50 bg-black/50 flex items-end",onClick:()=>p(!1),children:e.jsxs("div",{className:"bg-background w-full rounded-t-2xl p-6 safe-bottom animate-in slide-in-from-bottom",onClick:U=>U.stopPropagation(),children:[e.jsx("h2",{className:"text-lg font-semibold mb-4",children:t("settings.language","Sprache")}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("button",{onClick:()=>i("de"),className:`w-full mobile-card flex items-center justify-between ${s.language==="de"?"border-primary":""}`,children:[e.jsx("span",{className:"font-medium",children:"Deutsch"}),s.language==="de"&&e.jsx(ge,{className:"w-5 h-5"})]}),e.jsxs("button",{onClick:()=>i("en"),className:`w-full mobile-card flex items-center justify-between ${s.language==="en"?"border-primary":""}`,children:[e.jsx("span",{className:"font-medium",children:"English"}),s.language==="en"&&e.jsx(ge,{className:"w-5 h-5"})]})]}),e.jsx("button",{onClick:()=>p(!1),className:"w-full mt-4 py-3 text-muted-foreground font-medium",children:t("common.cancel","Abbrechen")})]})}),y&&e.jsx("div",{className:"fixed inset-0 z-50 bg-black/50 flex items-end",onClick:()=>C(!1),children:e.jsxs("div",{className:"bg-background w-full rounded-t-2xl p-6 safe-bottom animate-in slide-in-from-bottom",onClick:U=>U.stopPropagation(),children:[e.jsx("h2",{className:"text-lg font-semibold mb-4",children:t("settings.theme","Design")}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("button",{onClick:()=>{d==="dark"?m():C(!1)},className:`w-full mobile-card flex items-center justify-between ${d==="light"?"border-primary":""}`,children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(jt,{className:"w-5 h-5"}),e.jsx("span",{className:"font-medium",children:t("settings.light","Hell")})]}),d==="light"&&e.jsx(ge,{className:"w-5 h-5"})]}),e.jsxs("button",{onClick:()=>{d==="light"?m():C(!1)},className:`w-full mobile-card flex items-center justify-between ${d==="dark"?"border-primary":""}`,children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(bt,{className:"w-5 h-5"}),e.jsx("span",{className:"font-medium",children:t("settings.dark","Dunkel")})]}),d==="dark"&&e.jsx(ge,{className:"w-5 h-5"})]})]}),e.jsx("button",{onClick:()=>C(!1),className:"w-full mt-4 py-3 text-muted-foreground font-medium",children:t("common.cancel","Abbrechen")})]})})]})}function Gt(t){return!t||t.trim()===""?{valid:!1,error:"E-Mail-Adresse ist erforderlich"}:/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(t)?{valid:!0}:{valid:!1,error:"Ungültige E-Mail-Adresse"}}function Qt(t,s=6){return!t||t.length===0?{valid:!1,error:"Passwort ist erforderlich"}:t.length<s?{valid:!1,error:`Passwort muss mindestens ${s} Zeichen lang sein`}:{valid:!0}}function On(){const[,t]=Ie(),{loginWithGoogle:s,loginWithEmail:c}=Be(),[a,r]=x(""),[d,v]=x(""),[j,g]=x(!1),k=async()=>{if(!j){g(!0);try{await s(),t("/")}catch(y){h.error(y.message||"Login fehlgeschlagen")}finally{g(!1)}}},p=async y=>{y.preventDefault();const C=Gt(a);if(!C.valid){h.error(C.error||"Ungültige E-Mail-Adresse");return}const E=Qt(d);if(!E.valid){h.error(E.error||"Ungültiges Passwort");return}if(!j){g(!0);try{await c(a,d),t("/")}catch(T){h.error(T.message||"Login fehlgeschlagen")}finally{g(!1)}}};return e.jsxs("div",{className:"min-h-screen bg-background flex flex-col items-center justify-center p-6",children:[e.jsx("div",{className:"w-20 h-20 rounded-2xl bg-primary flex items-center justify-center mb-6",children:e.jsx("span",{className:"text-3xl font-bold text-primary-foreground",children:"N"})}),e.jsx("h1",{className:"text-2xl font-bold mb-2",children:"Nexo"}),e.jsx("p",{className:"text-muted-foreground mb-8 text-center",children:"Melden Sie sich an, um fortzufahren"}),e.jsxs("button",{type:"button",onClick:k,disabled:j,className:"w-full h-12 px-6 rounded-lg font-medium text-base border border-border bg-background flex items-center justify-center gap-3 active:bg-muted disabled:opacity-50 mb-4",children:[e.jsxs("svg",{className:"w-5 h-5",viewBox:"0 0 24 24",children:[e.jsx("path",{fill:"#4285F4",d:"M22.56 12.25c0-.78-.07-1.53-.2-2.25H12v4.26h5.92c-.26 1.37-1.04 2.53-2.21 3.31v2.77h3.57c2.08-1.92 3.28-4.74 3.28-8.09z"}),e.jsx("path",{fill:"#34A853",d:"M12 23c2.97 0 5.46-.98 7.28-2.66l-3.57-2.77c-.98.66-2.23 1.06-3.71 1.06-2.86 0-5.29-1.93-6.16-4.53H2.18v2.84C3.99 20.53 7.7 23 12 23z"}),e.jsx("path",{fill:"#FBBC05",d:"M5.84 14.09c-.22-.66-.35-1.36-.35-2.09s.13-1.43.35-2.09V7.07H2.18C1.43 8.55 1 10.22 1 12s.43 3.45 1.18 4.93l2.85-2.22.81-.62z"}),e.jsx("path",{fill:"#EA4335",d:"M12 5.38c1.62 0 3.06.56 4.21 1.64l3.15-3.15C17.45 2.09 14.97 1 12 1 7.7 1 3.99 3.47 2.18 7.07l3.66 2.84c.87-2.6 3.3-4.53 6.16-4.53z"})]}),j?"Laden...":"Mit Google anmelden"]}),e.jsxs("div",{className:"flex items-center gap-4 w-full mb-4",children:[e.jsx("div",{className:"flex-1 h-px bg-border"}),e.jsx("span",{className:"text-xs text-muted-foreground",children:"oder"}),e.jsx("div",{className:"flex-1 h-px bg-border"})]}),e.jsxs("form",{onSubmit:p,className:"w-full space-y-3",children:[e.jsx("input",{type:"email",placeholder:"E-Mail",value:a,onChange:y=>r(y.target.value),className:"w-full h-12 px-4 rounded-lg text-base bg-background border border-border outline-none focus:border-primary"}),e.jsx("input",{type:"password",placeholder:"Passwort",value:d,onChange:y=>v(y.target.value),className:"w-full h-12 px-4 rounded-lg text-base bg-background border border-border outline-none focus:border-primary"}),e.jsx("button",{type:"submit",disabled:j,className:"w-full h-12 px-6 rounded-lg font-medium text-base bg-primary text-primary-foreground active:opacity-80 disabled:opacity-50",children:j?"Laden...":"Anmelden"})]}),e.jsxs("p",{className:"text-sm text-muted-foreground mt-6 text-center",children:["Noch kein Konto?"," ",e.jsx("button",{type:"button",onClick:()=>t("/register"),className:"text-primary underline font-medium",children:"Jetzt registrieren"})]}),e.jsx("p",{className:"text-xs text-muted-foreground mt-4 text-center",children:e.jsx("a",{href:"https://nexo-jtsky100.web.app",className:"text-primary underline",children:"Desktop-Version öffnen"})})]})}function Un(){const[,t]=Ie(),{signUp:s,signInWithGoogle:c}=Be(),[a,r]=x(""),[d,v]=x(""),[j,g]=x(""),[k,p]=x(""),[y,C]=x(!1),E=async i=>{if(i.preventDefault(),!a.trim()){h.error("Bitte geben Sie Ihren Namen ein");return}const m=Gt(d);if(!m.valid){h.error(m.error||"Ungültige E-Mail-Adresse");return}const z=Qt(j);if(!z.valid){h.error(z.error||"Ungültiges Passwort");return}if(j!==k){h.error("Passwörter stimmen nicht überein");return}if(!y){C(!0);try{await s(d,j,a.trim()),h.success("Konto erfolgreich erstellt"),t("/onboarding")}catch(H){h.error(H.message||"Registrierung fehlgeschlagen")}finally{C(!1)}}},T=async()=>{if(!y){C(!0);try{await c(),h.success("Erfolgreich mit Google registriert"),t("/onboarding")}catch(i){h.error(i.message||"Google-Registrierung fehlgeschlagen")}finally{C(!1)}}};return e.jsxs("div",{className:"min-h-screen bg-background flex flex-col items-center justify-center p-6",children:[e.jsx("div",{className:"w-20 h-20 rounded-2xl bg-primary flex items-center justify-center mb-6",children:e.jsx("span",{className:"text-3xl font-bold text-primary-foreground",children:"N"})}),e.jsx("h1",{className:"text-2xl font-bold mb-2",children:"Registrieren"}),e.jsx("p",{className:"text-muted-foreground mb-8 text-center",children:"Erstellen Sie ein neues Nexo-Konto"}),e.jsxs("button",{type:"button",onClick:T,disabled:y,className:"w-full h-12 px-6 rounded-lg font-medium text-base border border-border bg-background flex items-center justify-center gap-3 active:bg-muted disabled:opacity-50 mb-4",children:[e.jsxs("svg",{className:"w-5 h-5",viewBox:"0 0 24 24",children:[e.jsx("path",{fill:"#4285F4",d:"M22.56 12.25c0-.78-.07-1.53-.2-2.25H12v4.26h5.92c-.26 1.37-1.04 2.53-2.21 3.31v2.77h3.57c2.08-1.92 3.28-4.74 3.28-8.09z"}),e.jsx("path",{fill:"#34A853",d:"M12 23c2.97 0 5.46-.98 7.28-2.66l-3.57-2.77c-.98.66-2.23 1.06-3.71 1.06-2.86 0-5.29-1.93-6.16-4.53H2.18v2.84C3.99 20.53 7.7 23 12 23z"}),e.jsx("path",{fill:"#FBBC05",d:"M5.84 14.09c-.22-.66-.35-1.36-.35-2.09s.13-1.43.35-2.09V7.07H2.18C1.43 8.55 1 10.22 1 12s.43 3.45 1.18 4.93l2.85-2.22.81-.62z"}),e.jsx("path",{fill:"#EA4335",d:"M12 5.38c1.62 0 3.06.56 4.21 1.64l3.15-3.15C17.45 2.09 14.97 1 12 1 7.7 1 3.99 3.47 2.18 7.07l3.66 2.84c.87-2.6 3.3-4.53 6.16-4.53z"})]}),y?"Laden...":"Mit Google registrieren"]}),e.jsxs("div",{className:"flex items-center gap-4 w-full mb-4",children:[e.jsx("div",{className:"flex-1 h-px bg-border"}),e.jsx("span",{className:"text-xs text-muted-foreground",children:"oder"}),e.jsx("div",{className:"flex-1 h-px bg-border"})]}),e.jsxs("form",{onSubmit:E,className:"w-full space-y-3",children:[e.jsx("input",{type:"text",placeholder:"Name",value:a,onChange:i=>r(i.target.value),className:"w-full h-12 px-4 rounded-lg text-base bg-background border border-border outline-none focus:border-primary",required:!0}),e.jsx("input",{type:"email",placeholder:"E-Mail",value:d,onChange:i=>v(i.target.value),className:"w-full h-12 px-4 rounded-lg text-base bg-background border border-border outline-none focus:border-primary",required:!0}),e.jsx("input",{type:"password",placeholder:"Passwort",value:j,onChange:i=>g(i.target.value),className:"w-full h-12 px-4 rounded-lg text-base bg-background border border-border outline-none focus:border-primary",required:!0}),e.jsx("input",{type:"password",placeholder:"Passwort bestätigen",value:k,onChange:i=>p(i.target.value),className:"w-full h-12 px-4 rounded-lg text-base bg-background border border-border outline-none focus:border-primary",required:!0}),e.jsx("button",{type:"submit",disabled:y,className:"w-full h-12 px-6 rounded-lg font-medium text-base bg-primary text-primary-foreground active:opacity-80 disabled:opacity-50",children:y?"Wird erstellt...":"Konto erstellen"})]}),e.jsxs("p",{className:"text-sm text-muted-foreground mt-6 text-center",children:["Bereits ein Konto?"," ",e.jsx("button",{type:"button",onClick:()=>t("/login"),className:"text-primary underline font-medium",children:"Jetzt anmelden"})]}),e.jsx("p",{className:"text-xs text-muted-foreground mt-4 text-center",children:e.jsx("a",{href:"https://nexo-jtsky100.web.app",className:"text-primary underline",children:"Desktop-Version öffnen"})})]})}function Hn(){const[,t]=Ie(),{user:s}=Be(),[c,a]=x(1),[r,d]=x(!1),[v,j]=x(!0),[g,k]=x(""),[p,y]=x("CHF"),[C,E]=x(0),[T,i]=x([]),[m,z]=x(0),[H,w]=x([]);oe(()=>{(async()=>{if(!s){t("/login");return}try{const D=await Vt($e(Ke,"users",s.uid));if(D.exists()&&D.data().onboardingCompleted){t("/");return}s.displayName&&k(s.displayName)}catch(D){console.error("Error checking onboarding status:",D)}finally{j(!1)}})()},[s,t]),oe(()=>{C>0?i(A=>{const D=[...A];for(;D.length<C;)D.push({name:""});for(;D.length>C;)D.pop();return D}):i([])},[C]),oe(()=>{m>0?w(A=>{const D=[...A];for(;D.length<m;)D.push({name:"",email:"",phone:""});for(;D.length>m;)D.pop();return D}):w([])},[m]);const U=()=>{if(c===1){if(!g.trim()){h.error("Bitte geben Sie Ihren Namen ein");return}a(2)}else if(c===2){if(C>0&&T.filter(D=>!D.name.trim()).length>0){h.error("Bitte geben Sie für alle Kinder einen Namen ein");return}a(3)}},ae=()=>{c>1&&a(c-1)},F=async()=>{if(s)try{d(!0),await Nt($e(Ke,"users",s.uid),{onboardingCompleted:!0,name:g.trim()||s.displayName||s.email?.split("@")[0]||"User",currency:p,createdAt:new Date,updatedAt:new Date},{merge:!0}),h.success("Onboarding abgeschlossen"),t("/")}catch(A){h.error("Fehler beim Speichern: "+A.message)}finally{d(!1)}},K=async()=>{if(s)try{if(d(!0),m>0&&H.filter(D=>!D.name.trim()).length>0){h.error("Bitte geben Sie für alle Haushaltsmitglieder einen Namen ein"),d(!1);return}if(await Nt($e(Ke,"users",s.uid),{onboardingCompleted:!0,name:g.trim()||s.displayName||s.email?.split("@")[0]||"User",currency:p,createdAt:new Date,updatedAt:new Date},{merge:!0}),C>0){const A=T.filter(D=>D.name.trim()).map(D=>at({name:D.name.trim(),type:"child",currency:p,notes:D.birthDate?`Geburtsdatum: ${D.birthDate}`:null}));await Promise.all(A)}if(m>0){const A=H.filter(D=>D.name.trim()).map(D=>at({name:D.name.trim(),email:D.email?.trim()||null,phone:D.phone?.trim()||null,type:"household",currency:p}));await Promise.all(A)}h.success("Onboarding erfolgreich abgeschlossen"),t("/")}catch(A){h.error("Fehler beim Speichern: "+A.message),console.error("Onboarding error:",A)}finally{d(!1)}};return v?e.jsx("div",{className:"min-h-screen flex items-center justify-center bg-background",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-primary mx-auto"}),e.jsx("p",{className:"mt-4 text-muted-foreground",children:"Lade..."})]})}):e.jsxs("div",{className:"min-h-screen bg-background flex flex-col p-6",children:[e.jsxs("div",{className:"mb-6",children:[e.jsx("h1",{className:"text-2xl font-bold mb-2",children:"Willkommen bei Nexo"}),e.jsxs("p",{className:"text-muted-foreground text-sm",children:["Schritt ",c," von 3: Richten Sie Ihr Konto ein"]}),e.jsx("div",{className:"mt-4 w-full bg-muted rounded-full h-2",children:e.jsx("div",{className:"bg-primary h-2 rounded-full transition-all duration-300",style:{width:`${c/3*100}%`}})})]}),c===1&&e.jsxs("div",{className:"flex-1 space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-2",children:"Ihr Name"}),e.jsx("input",{type:"text",value:g,onChange:A=>k(A.target.value),placeholder:"Max Mustermann",className:"w-full h-12 px-4 rounded-lg text-base bg-background border border-border outline-none focus:border-primary",required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-2",children:"Währung"}),e.jsxs("select",{value:p,onChange:A=>y(A.target.value),className:"w-full h-12 px-4 rounded-lg text-base bg-background border border-border outline-none focus:border-primary",children:[e.jsx("option",{value:"CHF",children:"CHF (Schweizer Franken)"}),e.jsx("option",{value:"EUR",children:"EUR (Euro)"}),e.jsx("option",{value:"USD",children:"USD (US-Dollar)"})]})]})]}),c===2&&e.jsxs("div",{className:"flex-1 space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-2",children:"Anzahl Kinder"}),e.jsx("select",{value:C.toString(),onChange:A=>E(parseInt(A.target.value,10)),className:"w-full h-12 px-4 rounded-lg text-base bg-background border border-border outline-none focus:border-primary",children:[0,1,2,3,4,5,6,7,8,9,10].map(A=>e.jsx("option",{value:A.toString(),children:A},A))})]}),C>0&&e.jsx("div",{className:"space-y-4",children:T.map((A,D)=>e.jsxs("div",{className:"space-y-2 p-4 border rounded-lg",children:[e.jsxs("label",{className:"block text-sm font-medium",children:["Kind ",D+1]}),e.jsx("input",{type:"text",value:A.name,onChange:$=>{const M=[...T];M[D].name=$.target.value,i(M)},placeholder:"Name des Kindes",className:"w-full h-12 px-4 rounded-lg text-base bg-background border border-border outline-none focus:border-primary",required:!0}),e.jsx("input",{type:"date",value:A.birthDate||"",onChange:$=>{const M=[...T];M[D].birthDate=$.target.value,i(M)},placeholder:"Geburtsdatum (optional)",className:"w-full h-12 px-4 rounded-lg text-base bg-background border border-border outline-none focus:border-primary"})]},D))})]}),c===3&&e.jsxs("div",{className:"flex-1 space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-2",children:"Anzahl weitere Haushaltsmitglieder"}),e.jsx("select",{value:m.toString(),onChange:A=>z(parseInt(A.target.value,10)),className:"w-full h-12 px-4 rounded-lg text-base bg-background border border-border outline-none focus:border-primary",children:[0,1,2,3,4,5,6,7,8,9,10].map(A=>e.jsx("option",{value:A.toString(),children:A},A))})]}),m>0&&e.jsx("div",{className:"space-y-4",children:H.map((A,D)=>e.jsxs("div",{className:"space-y-2 p-4 border rounded-lg",children:[e.jsxs("label",{className:"block text-sm font-medium",children:["Haushaltsmitglied ",D+1]}),e.jsx("input",{type:"text",value:A.name,onChange:$=>{const M=[...H];M[D].name=$.target.value,w(M)},placeholder:"Name",className:"w-full h-12 px-4 rounded-lg text-base bg-background border border-border outline-none focus:border-primary",required:!0}),e.jsx("input",{type:"email",value:A.email||"",onChange:$=>{const M=[...H];M[D].email=$.target.value,w(M)},placeholder:"E-Mail (optional)",className:"w-full h-12 px-4 rounded-lg text-base bg-background border border-border outline-none focus:border-primary"}),e.jsx("input",{type:"tel",value:A.phone||"",onChange:$=>{const M=[...H];M[D].phone=$.target.value,w(M)},placeholder:"Telefon (optional)",className:"w-full h-12 px-4 rounded-lg text-base bg-background border border-border outline-none focus:border-primary"})]},D))})]}),e.jsxs("div",{className:"flex justify-between gap-3 mt-6 pt-6 border-t",children:[e.jsx("div",{children:c>1&&e.jsx("button",{type:"button",onClick:ae,disabled:r,className:"h-12 px-6 rounded-lg font-medium text-base border border-border bg-background active:bg-muted disabled:opacity-50",children:"Zurück"})}),e.jsxs("div",{className:"flex gap-2",children:[c<3&&e.jsxs(e.Fragment,{children:[e.jsx("button",{type:"button",onClick:F,disabled:r,className:"h-12 px-6 rounded-lg font-medium text-base text-muted-foreground active:opacity-80 disabled:opacity-50",children:"Überspringen"}),e.jsx("button",{type:"button",onClick:U,disabled:r,className:"h-12 px-6 rounded-lg font-medium text-base bg-primary text-primary-foreground active:opacity-80 disabled:opacity-50",children:"Weiter"})]}),c===3&&e.jsx("button",{type:"button",onClick:K,disabled:r,className:"h-12 px-6 rounded-lg font-medium text-base bg-primary text-primary-foreground active:opacity-80 disabled:opacity-50",children:r?"Wird gespeichert...":"Abschliessen"})]})]})]})}function Vn(){const{t}=De(),[s,c]=x(!1),[a,r]=x(null),[d,v]=x(""),[j,g]=x("all"),[k,p]=x("all"),[y,C]=x(null),{data:E=[],isLoading:T,refetch:i}=ut(),[m,z]=x({title:"",type:"termin",dueDate:tt(new Date),isAllDay:!1,amount:"",currency:"CHF",notes:"",recurrenceRule:""}),[H,w]=x(Ue(new Date)),[U,ae]=x(!1),F=o=>as(o),K=o=>{switch(o){case"termin":return e.jsx(Is,{className:"w-4 h-4"});case"zahlung":return e.jsx(Bs,{className:"w-4 h-4"});case"aufgabe":return e.jsx(Fs,{className:"w-4 h-4"});default:return e.jsx(Ge,{className:"w-4 h-4"})}},A=o=>{switch(o){case"termin":return"Termin";case"zahlung":return"Zahlung";case"aufgabe":return"Aufgabe";default:return o}},D=(o,n)=>{const S=new Date,q=n instanceof Date?n:new Date(n);return o==="erledigt"?e.jsx(ke,{className:"bg-green-500 text-white",children:"Erledigt"}):q<S?e.jsx(ke,{className:"bg-red-500 text-white",children:"Überfällig"}):e.jsx(ke,{className:"bg-blue-500 text-white",children:"Offen"})},$=J(()=>{let o=[...E];if(j!=="all"&&(o=o.filter(n=>n.type===j)),k!=="all"&&(o=o.filter(n=>n.status===k)),d.trim()){const n=d.toLowerCase();o=o.filter(S=>S.title.toLowerCase().includes(n)||S.notes&&S.notes.toLowerCase().includes(n)||S.amount&&(S.amount/100).toString().includes(n))}return o.sort((n,S)=>{const q=n.dueDate instanceof Date?n.dueDate:new Date(n.dueDate),Z=S.dueDate instanceof Date?S.dueDate:new Date(S.dueDate),de=new Date;if(n.status==="erledigt"&&S.status!=="erledigt")return 1;if(S.status==="erledigt"&&n.status!=="erledigt")return-1;const l=n.status!=="erledigt"&&q<de,N=S.status!=="erledigt"&&Z<de;return l&&!N?-1:N&&!l?1:q.getTime()-Z.getTime()})},[E,j,k,d]),M=o=>{if(o){r(o);const n=o.dueDate instanceof Date?o.dueDate:new Date(o.dueDate);z({title:o.title,type:o.type,dueDate:tt(n),isAllDay:o.isAllDay,amount:o.amount?(o.amount/100).toString():"",currency:o.currency||"CHF",notes:o.notes||"",recurrenceRule:o.recurrenceRule||""})}else r(null),z({title:"",type:"termin",dueDate:new Date().toISOString().slice(0,16),isAllDay:!1,amount:"",currency:"CHF",notes:"",recurrenceRule:""});c(!0)},R=()=>{c(!1),r(null);const o=tt(new Date);z({title:"",type:"termin",dueDate:o,isAllDay:!1,amount:"",currency:"CHF",notes:"",recurrenceRule:""}),w(Ue(o))},L=async()=>{if(!m.title||!m.dueDate){h.error("Bitte füllen Sie alle Pflichtfelder aus.");return}try{ae(!0);const o=rs(m.dueDate),n={title:m.title,type:m.type,dueDate:o.toISOString(),isAllDay:m.isAllDay,amount:m.amount?Math.round(parseFloat(m.amount)*100):null,currency:m.currency,notes:m.notes||null,recurrenceRule:m.recurrenceRule||null};a?(await nt(a.id,n),h.success("Erinnerung aktualisiert")):(await Pt(n),h.success("Erinnerung erstellt")),await i(),R(),le()}catch(o){h.error(Se(o)),re()}finally{ae(!1)}},ce=async o=>{try{await is(o),h.success("Erinnerung gelöscht"),le(),await i(),C(null)}catch(n){h.error(Se(n)),re()}},f=async o=>{try{const n=o.status==="erledigt"?"offen":"erledigt";await nt(o.id,{status:n}),h.success(n==="erledigt"?"Als erledigt markiert":"Wieder geöffnet"),le(),await i()}catch(n){h.error(Se(n)),re()}},B=J(()=>{const o=E.length,n=E.filter(Z=>Z.status==="offen").length,S=E.filter(Z=>Z.status==="erledigt").length,q=E.filter(Z=>{const de=Z.dueDate instanceof Date?Z.dueDate:new Date(Z.dueDate);return Z.status==="offen"&&de<new Date}).length;return{total:o,open:n,done:S,overdue:q}},[E]);return e.jsxs(we,{title:"Erinnerungen",showSidebar:!0,children:[e.jsxs("div",{className:"grid grid-cols-2 gap-3 mb-4",children:[e.jsxs("div",{className:"mobile-card",children:[e.jsx("p",{className:"text-xs text-muted-foreground mb-1",children:"Gesamt"}),e.jsx("p",{className:"text-xl font-semibold",children:B.total})]}),e.jsxs("div",{className:"mobile-card",children:[e.jsx("p",{className:"text-xs text-muted-foreground mb-1",children:"Offen"}),e.jsx("p",{className:"text-xl font-semibold",children:B.open})]}),e.jsxs("div",{className:"mobile-card",children:[e.jsx("p",{className:"text-xs text-muted-foreground mb-1",children:"Erledigt"}),e.jsx("p",{className:"text-xl font-semibold",children:B.done})]}),e.jsxs("div",{className:"mobile-card",children:[e.jsx("p",{className:"text-xs text-muted-foreground mb-1",children:"Überfällig"}),e.jsx("p",{className:"text-xl font-semibold text-red-500",children:B.overdue})]})]}),e.jsx("div",{className:"mobile-card mb-4",children:e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{children:[e.jsx(I,{className:"text-xs text-muted-foreground mb-2 block",children:"Suche"}),e.jsxs("div",{className:"relative",children:[e.jsx(Xe,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-4 h-4 text-muted-foreground"}),e.jsx(X,{placeholder:"Suchen...",value:d,onChange:o=>v(o.target.value),className:"pl-10 h-10 min-h-[44px]"})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[e.jsxs("div",{children:[e.jsx(I,{className:"text-xs text-muted-foreground mb-2 block",children:"Typ"}),e.jsxs(ee,{value:j,onValueChange:g,children:[e.jsx(te,{className:"h-10 min-h-[44px]",children:e.jsx(se,{})}),e.jsxs(ne,{children:[e.jsx(P,{value:"all",children:"Alle"}),e.jsx(P,{value:"termin",children:"Termine"}),e.jsx(P,{value:"zahlung",children:"Zahlungen"}),e.jsx(P,{value:"aufgabe",children:"Aufgaben"})]})]})]}),e.jsxs("div",{children:[e.jsx(I,{className:"text-xs text-muted-foreground mb-2 block",children:"Status"}),e.jsxs(ee,{value:k,onValueChange:p,children:[e.jsx(te,{className:"h-10 min-h-[44px]",children:e.jsx(se,{})}),e.jsxs(ne,{children:[e.jsx(P,{value:"all",children:"Alle"}),e.jsx(P,{value:"offen",children:"Offen"}),e.jsx(P,{value:"erledigt",children:"Erledigt"})]})]})]})]})]})}),e.jsxs("div",{className:"flex gap-3 mb-4",children:[e.jsxs(O,{onClick:()=>{_(),M()},className:"w-auto mx-auto h-12 min-h-[44px]",children:[e.jsx(Fe,{className:"w-5 h-5 mr-2"}),"Erinnerung hinzufügen"]}),$.length>0&&e.jsx("button",{onClick:()=>{_(),Cn($),le()},className:"px-4 rounded-lg bg-muted hover:bg-muted/80 transition-colors flex items-center justify-center min-h-[48px]","aria-label":"Als CSV exportieren",children:e.jsx(dt,{className:"w-5 h-5"})})]}),T?e.jsx("div",{className:"space-y-3",children:[1,2,3].map(o=>e.jsx("div",{className:"mobile-card p-4",children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx(Q,{className:"w-4 h-4 rounded mt-1"}),e.jsxs("div",{className:"flex-1 space-y-2",children:[e.jsx(Q,{className:"h-4 w-3/4"}),e.jsx(Q,{className:"h-3 w-1/2"}),e.jsx(Q,{className:"h-3 w-2/3"}),e.jsxs("div",{className:"flex gap-2 mt-3",children:[e.jsx(Q,{className:"h-8 flex-1"}),e.jsx(Q,{className:"h-8 w-8"}),e.jsx(Q,{className:"h-8 w-8"})]})]})]})},o))}):$.length===0?e.jsx("div",{className:"mobile-card text-center py-8",children:e.jsx("p",{className:"text-muted-foreground",children:"Keine Erinnerungen gefunden"})}):e.jsx("div",{className:"space-y-3",children:$.map(o=>{const n=o.dueDate instanceof Date?o.dueDate:new Date(o.dueDate);return e.jsx(Re,{className:"mobile-card",children:e.jsx(Pe,{className:"p-4",children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("div",{className:"mt-1",children:K(o.type)}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-start justify-between gap-2 mb-2",children:[e.jsx("h3",{className:"font-semibold text-sm flex-1",children:o.title}),D(o.status,n)]}),e.jsxs("div",{className:"space-y-1 text-xs text-muted-foreground",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Ge,{className:"w-3 h-3"}),e.jsx("span",{children:F(n)}),!o.isAllDay&&o.dueDate&&e.jsx("span",{children:new Date(o.dueDate).toLocaleTimeString("de-CH",{hour:"2-digit",minute:"2-digit"})})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{children:A(o.type)}),o.amount&&e.jsxs("span",{children:["• CHF ",(o.amount/100).toFixed(2)]})]}),o.notes&&e.jsx("p",{className:"line-clamp-2",children:o.notes})]}),e.jsxs("div",{className:"flex items-center gap-2 mt-3",children:[e.jsx(O,{variant:"outline",size:"sm",onClick:()=>{_(),f(o)},className:"h-8 min-h-[44px] flex-1",children:o.status==="erledigt"?e.jsxs(e.Fragment,{children:[e.jsx(vt,{className:"w-4 h-4 mr-1"}),"Wieder öffnen"]}):e.jsxs(e.Fragment,{children:[e.jsx(vt,{className:"w-4 h-4 mr-1"}),"Als erledigt markieren"]})}),e.jsx(O,{variant:"outline",size:"sm",onClick:()=>{_(),M(o)},className:"h-8 min-h-[44px]",children:e.jsx(Ut,{className:"w-4 h-4"})}),e.jsx(O,{variant:"outline",size:"sm",onClick:()=>{_(),C(o.id)},className:"h-8 min-h-[44px] text-red-500",children:e.jsx(Je,{className:"w-4 h-4"})})]})]})]})})},o.id)})}),e.jsx(pe,{open:s,onOpenChange:c,children:e.jsxs(fe,{className:"!fixed !top-[50%] !left-[50%] !right-auto !bottom-auto !translate-x-[-50%] !translate-y-[-50%] !w-[85vw] !max-w-sm !max-h-fit !rounded-3xl !m-0 !overflow-visible !shadow-2xl",children:[e.jsxs(be,{className:"px-5 pt-5 pb-3",children:[e.jsx(je,{className:"text-lg font-semibold",children:a?"Erinnerung bearbeiten":"Erinnerung hinzufügen"}),e.jsx(ye,{className:"sr-only",children:a?"Bearbeiten Sie die Details der Erinnerung":"Erstellen Sie eine neue Erinnerung mit Titel, Typ, Datum und optionalen Notizen"})]}),e.jsxs("div",{className:"space-y-3 px-5 pb-2",children:[e.jsxs("div",{children:[e.jsx(I,{children:"Titel *"}),e.jsx(X,{value:m.title,onChange:o=>z({...m,title:o.target.value}),placeholder:"Titel",className:"h-10 min-h-[44px] mt-1"})]}),e.jsxs("div",{children:[e.jsx(I,{children:"Typ *"}),e.jsxs(ee,{value:m.type,onValueChange:o=>z({...m,type:o}),children:[e.jsx(te,{className:"h-10 min-h-[44px] mt-1",children:e.jsx(se,{})}),e.jsxs(ne,{children:[e.jsx(P,{value:"termin",children:"Termin"}),e.jsx(P,{value:"zahlung",children:"Zahlung"}),e.jsx(P,{value:"aufgabe",children:"Aufgabe"})]})]})]}),e.jsxs("div",{children:[e.jsx(I,{children:"Datum & Uhrzeit *"}),e.jsx(X,{type:"text",placeholder:"DD.MM.YYYY HH:mm",value:H,onChange:o=>{const n=o.target.value;w(n);const S=ht(n);S&&z({...m,dueDate:S})},onBlur:o=>{const n=ht(o.target.value);n?(z({...m,dueDate:n}),w(Ue(n))):o.target.value&&w(Ue(m.dueDate))},className:"h-10 min-h-[44px] mt-1"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Rt,{checked:m.isAllDay,onCheckedChange:o=>z({...m,isAllDay:o})}),e.jsx(I,{children:"Ganztägig"})]}),m.type==="zahlung"&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{children:[e.jsx(I,{children:"Betrag"}),e.jsx(X,{type:"number",step:"0.01",value:m.amount,onChange:o=>z({...m,amount:o.target.value}),placeholder:"0.00",className:"h-10 min-h-[44px] mt-1"})]}),e.jsxs("div",{children:[e.jsx(I,{children:"Währung"}),e.jsxs(ee,{value:m.currency,onValueChange:o=>z({...m,currency:o}),children:[e.jsx(te,{className:"h-10 min-h-[44px] mt-1",children:e.jsx(se,{})}),e.jsxs(ne,{children:[e.jsx(P,{value:"CHF",children:"CHF"}),e.jsx(P,{value:"EUR",children:"EUR"}),e.jsx(P,{value:"USD",children:"USD"})]})]})]})]}),e.jsxs("div",{children:[e.jsx(I,{children:"Notizen"}),e.jsx(rt,{value:m.notes,onChange:o=>z({...m,notes:o.target.value}),placeholder:"Notizen...",className:"mt-1 min-h-[100px]"})]})]}),e.jsxs(ve,{className:"px-5 pb-3 pt-2 gap-2.5",children:[e.jsx(O,{variant:"outline",onClick:R,className:"h-11 min-h-[44px] flex-1 rounded-xl text-sm font-medium",children:"Abbrechen"}),e.jsx(O,{onClick:L,disabled:U,className:"h-11 min-h-[44px] flex-1 rounded-xl text-sm font-medium",children:U?"Speichert...":a?"Aktualisieren":"Erstellen"})]})]})}),y&&e.jsx(pe,{open:!!y,onOpenChange:()=>C(null),children:e.jsxs(fe,{className:`max-w-[320px] w-[90vw] \r
                       !fixed !top-[50%] !left-[50%] !right-auto !bottom-auto !translate-x-[-50%] !translate-y-[-50%]\r
                       rounded-lg\r
                       border\r
                       !h-auto !max-h-[auto]\r
                       flex flex-col\r
                       p-5 gap-4`,showCloseButton:!1,children:[e.jsxs(be,{className:"text-center",children:[e.jsx(je,{className:"text-lg font-semibold",children:"Erinnerung löschen?"}),e.jsx(ye,{className:"sr-only",children:"Bestätigen Sie das Löschen dieser Erinnerung. Diese Aktion kann nicht rückgängig gemacht werden."})]}),e.jsx("p",{className:"text-sm text-muted-foreground text-center leading-relaxed",children:"Möchten Sie diese Erinnerung wirklich löschen? Diese Aktion kann nicht rückgängig gemacht werden."}),e.jsxs(ve,{className:"flex-row gap-3 pt-2",children:[e.jsx(O,{variant:"outline",onClick:()=>C(null),className:"h-10 min-h-[44px] flex-1 text-sm font-medium",children:"Abbrechen"}),e.jsx(O,{variant:"destructive",onClick:()=>ce(y),className:"h-10 min-h-[44px] flex-1 text-sm font-medium",children:"Löschen"})]})]})})]})}function Kn({className:t,...s}){return e.jsx(ln,{"data-slot":"tabs",className:Le("flex flex-col gap-2",t),...s})}function $n({className:t,...s}){return e.jsx(on,{"data-slot":"tabs-list",className:Le("bg-muted text-muted-foreground inline-flex h-9 w-fit items-center justify-center rounded-lg p-[3px]",t),...s})}function Ct({className:t,...s}){return e.jsx(cn,{"data-slot":"tabs-trigger",className:Le("data-[state=active]:bg-background dark:data-[state=active]:text-foreground focus-visible:border-ring focus-visible:ring-ring/50 focus-visible:outline-ring dark:data-[state=active]:border-input dark:data-[state=active]:bg-input/30 text-foreground dark:text-muted-foreground inline-flex h-[calc(100%-1px)] flex-1 items-center justify-center gap-1.5 rounded-md border border-transparent px-2 py-1 text-sm font-medium whitespace-nowrap transition-[color,box-shadow] focus-visible:ring-[3px] focus-visible:outline-1 disabled:pointer-events-none disabled:opacity-50 data-[state=active]:shadow-sm [&_svg]:pointer-events-none [&_svg]:shrink-0 [&_svg:not([class*='size-'])]:size-4",t),...s})}function Et({className:t,...s}){return e.jsx(dn,{"data-slot":"tabs-content",className:Le("flex-1 outline-none",t),...s})}function qn(){const{t}=De(),[s,c]=x("household"),[a,r]=x(!1),[d,v]=x(!1),[j,g]=x(!1),[k,p]=x(null),[y,C]=x(null),[E,T]=x(""),[i,m]=x({name:"",email:"",phone:"",currency:"CHF",type:"household",relationship:"both",notes:""}),{data:z=[],isLoading:H,refetch:w}=Ft(),U=J(()=>z.filter(n=>!n.type||n.type==="household"||n.type==="child"),[z]),ae=J(()=>z.filter(n=>n.type==="external"),[z]),F=n=>n.map(S=>{const q=S.invoices||[],Z=q.filter(b=>(b.direction==="incoming"||!b.direction)&&(b.status==="open"||b.status==="postponed")).reduce((b,W)=>b+(W.amount||0),0),de=q.filter(b=>(b.direction==="incoming"||!b.direction)&&b.status==="paid").reduce((b,W)=>b+(W.amount||0),0),l=q.filter(b=>b.direction==="outgoing"&&(b.status==="open"||b.status==="postponed")).reduce((b,W)=>b+(W.amount||0),0),N=q.filter(b=>b.direction==="outgoing"&&b.status==="paid").reduce((b,W)=>b+(W.amount||0),0);return{...S,incomingOpen:Z,incomingPaid:de,outgoingOpen:l,outgoingPaid:N,totalOpen:Z+l,totalPaid:de+N,invoiceCount:q.length,hasOpenInvoices:Z>0||l>0}}),K=J(()=>F(U),[U]),A=J(()=>F(ae),[ae]),D=n=>n.filter(S=>S.name.toLowerCase().includes(E.toLowerCase())||S.email?.toLowerCase().includes(E.toLowerCase())||S.phone?.toLowerCase().includes(E.toLowerCase())),$=J(()=>D(K),[K,E]),M=J(()=>D(A),[A,E]),R=async()=>{const n=validateRequired(i.name,"Name");if(!n.valid){h.error(n.error||"Bitte geben Sie einen Namen ein");return}if(i.email&&i.email.trim()!==""){const S=validateEmail(i.email);if(!S.valid){h.error(S.error||"Ungültige E-Mail-Adresse");return}}if(i.phone&&i.phone.trim()!==""){const S=validatePhone(i.phone);if(!S.valid){h.error(S.error||"Ungültige Telefonnummer");return}}try{const S={name:i.name,currency:i.currency,type:i.type,notes:i.notes||null};i.type==="child"?(S.email=null,S.phone=null,S.relationship=null):i.type==="external"?(S.email=i.email||null,S.phone=i.phone||null,S.relationship=i.relationship):(S.email=i.email||null,S.phone=i.phone||null,S.relationship=null),await at(S),h.success("Person hinzugefügt"),r(!1),m({name:"",email:"",phone:"",currency:"CHF",type:"household",relationship:"both",notes:""}),await w()}catch(S){h.error("Fehler: "+(S.message||"Unbekannter Fehler"))}},L=async()=>{if(!k||!i.name){h.error("Bitte geben Sie einen Namen ein");return}try{const n={name:i.name,currency:i.currency,type:i.type,notes:i.notes||null};i.type==="child"?(n.email=null,n.phone=null,n.relationship=null):i.type==="external"?(n.email=i.email||null,n.phone=i.phone||null,n.relationship=i.relationship):(n.email=i.email||null,n.phone=i.phone||null,n.relationship=null),await ls(k.id,n),h.success("Person aktualisiert"),v(!1),p(null),await w()}catch(n){h.error("Fehler: "+(n.message||"Unbekannter Fehler"))}},ce=async()=>{if(y)try{await os(y),h.success("Person gelöscht"),C(null)}catch(n){h.error("Fehler: "+(n.message||"Unbekannter Fehler"))}},f=n=>{p(n),m({name:n.name||"",email:n.email||"",phone:n.phone||"",currency:n.currency||"CHF",type:n.type||"household",relationship:n.relationship||"both",notes:n.notes||""}),v(!0)},B=n=>`CHF ${(n/100).toFixed(2)}`,o=n=>{const S=n.type==="child";return e.jsx(Re,{className:"mobile-card",children:e.jsx(Pe,{className:"p-4",children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("div",{className:`w-10 h-10 rounded-full flex items-center justify-center flex-shrink-0 ${S?"bg-purple-100 text-purple-600":"bg-primary/10 text-primary"}`,children:S?e.jsx(Ts,{className:"w-5 h-5"}):e.jsx(yt,{className:"w-5 h-5"})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-start justify-between gap-2 mb-2",children:[e.jsx("h3",{className:"font-semibold text-sm",children:n.name}),S&&e.jsx(ke,{variant:"outline",className:"text-xs",children:"Kind"})]}),!S&&e.jsxs("div",{className:"space-y-1 text-xs text-muted-foreground",children:[n.email&&e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(zs,{className:"w-3 h-3"}),e.jsx("span",{className:"truncate",children:n.email})]}),n.phone&&e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(Ls,{className:"w-3 h-3"}),e.jsx("span",{children:n.phone})]})]}),n.hasOpenInvoices&&e.jsxs("div",{className:"mt-2 space-y-1",children:[n.incomingOpen>0&&e.jsxs("p",{className:"text-xs text-green-600",children:["Forderungen: ",B(n.incomingOpen)]}),n.outgoingOpen>0&&e.jsxs("p",{className:"text-xs text-red-600",children:["Verbindlichkeiten: ",B(n.outgoingOpen)]})]}),n.invoiceCount>0&&e.jsxs("p",{className:"text-xs text-muted-foreground mt-1",children:[n.invoiceCount," Rechnung(en)"]}),e.jsxs("div",{className:"flex items-center gap-2 mt-3",children:[n.invoiceCount>0&&e.jsxs(O,{variant:"outline",size:"sm",onClick:()=>{p(n),g(!0)},className:"h-8 min-h-[44px] flex-1",children:[e.jsx(Ht,{className:"w-4 h-4 mr-1"}),"Rechnungen"]}),e.jsx(O,{variant:"outline",size:"sm",onClick:()=>f(n),className:"h-8 min-h-[44px]",children:e.jsx(Ut,{className:"w-4 h-4"})}),e.jsx(O,{variant:"outline",size:"sm",onClick:()=>C(n.id),className:"h-8 min-h-[44px] text-red-500",children:e.jsx(Je,{className:"w-4 h-4"})})]})]})]})})},n.id)};return e.jsxs(we,{title:"Personen & Schulden",showSidebar:!0,children:[e.jsx("div",{className:"mobile-card mb-4",children:e.jsxs("div",{className:"relative",children:[e.jsx(Xe,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-4 h-4 text-muted-foreground"}),e.jsx(X,{placeholder:"Suchen...",value:E,onChange:n=>T(n.target.value),className:"pl-10 h-10 min-h-[44px]"})]})}),e.jsxs(O,{onClick:()=>{m({name:"",email:"",phone:"",currency:"CHF",type:"household",relationship:"both",notes:""}),r(!0)},className:"w-full mb-4 h-12 min-h-[44px]",children:[e.jsx(Fe,{className:"w-5 h-5 mr-2"}),"Person hinzufügen"]}),e.jsxs(Kn,{value:s,onValueChange:n=>c(n),className:"mb-4",children:[e.jsxs($n,{className:"grid w-full grid-cols-2 h-12 min-h-[44px]",children:[e.jsxs(Ct,{value:"household",className:"h-10 min-h-[44px]",children:[e.jsx(zt,{className:"w-4 h-4 mr-2"}),"Haushalt"]}),e.jsxs(Ct,{value:"external",className:"h-10 min-h-[44px]",children:[e.jsx(yt,{className:"w-4 h-4 mr-2"}),"Externe"]})]}),e.jsx(Et,{value:"household",className:"mt-4",children:H?e.jsx("div",{className:"text-center py-8 text-muted-foreground",children:"Lädt..."}):$.length===0?e.jsx("div",{className:"mobile-card text-center py-8",children:e.jsx("p",{className:"text-muted-foreground",children:"Keine Personen gefunden"})}):e.jsx("div",{className:"space-y-3",children:$.map(o)})}),e.jsx(Et,{value:"external",className:"mt-4",children:H?e.jsx("div",{className:"text-center py-8 text-muted-foreground",children:"Lädt..."}):M.length===0?e.jsx("div",{className:"mobile-card text-center py-8",children:e.jsx("p",{className:"text-muted-foreground",children:"Keine Personen gefunden"})}):e.jsx("div",{className:"space-y-3",children:M.map(o)})})]}),e.jsx(pe,{open:a,onOpenChange:r,children:e.jsxs(fe,{className:"!fixed !top-[50%] !left-[50%] !right-auto !bottom-auto !translate-x-[-50%] !translate-y-[-50%] !w-[85vw] !max-w-sm !max-h-fit !rounded-3xl !m-0 !overflow-visible !shadow-2xl",children:[e.jsxs(be,{className:"px-5 pt-5 pb-3",children:[e.jsx(je,{className:"text-lg font-semibold",children:"Person hinzufügen"}),e.jsx(ye,{className:"sr-only",children:"Erstellen Sie eine neue Person mit Name, E-Mail, Telefonnummer und optionalen Notizen"})]}),e.jsxs("div",{className:"space-y-3 px-5 pb-2",children:[e.jsxs("div",{children:[e.jsx(I,{children:"Name *"}),e.jsx(X,{value:i.name,onChange:n=>m({...i,name:n.target.value}),placeholder:"Name",className:"h-10 min-h-[44px] mt-1"})]}),e.jsxs("div",{children:[e.jsx(I,{children:"Typ *"}),e.jsxs(ee,{value:i.type,onValueChange:n=>m({...i,type:n}),children:[e.jsx(te,{className:"h-10 min-h-[44px] mt-1",children:e.jsx(se,{})}),e.jsxs(ne,{children:[e.jsx(P,{value:"household",children:"Haushalt"}),e.jsx(P,{value:"external",children:"Externe Person"}),e.jsx(P,{value:"child",children:"Kind"})]})]})]}),i.type!=="child"&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{children:[e.jsx(I,{children:"E-Mail"}),e.jsx(X,{type:"email",value:i.email,onChange:n=>m({...i,email:n.target.value}),placeholder:"email@example.com",className:"h-10 min-h-[44px] mt-1"})]}),e.jsxs("div",{children:[e.jsx(I,{children:"Telefon"}),e.jsx(X,{type:"tel",value:i.phone,onChange:n=>m({...i,phone:n.target.value}),placeholder:"+41 XX XXX XX XX",className:"h-10 min-h-[44px] mt-1"})]})]}),i.type==="external"&&e.jsxs("div",{children:[e.jsx(I,{children:"Beziehung"}),e.jsxs(ee,{value:i.relationship,onValueChange:n=>m({...i,relationship:n}),children:[e.jsx(te,{className:"h-10 min-h-[44px] mt-1",children:e.jsx(se,{})}),e.jsxs(ne,{children:[e.jsx(P,{value:"both",children:"Beides"}),e.jsx(P,{value:"creditor",children:"Gläubiger"}),e.jsx(P,{value:"debtor",children:"Schuldner"})]})]})]}),e.jsxs("div",{children:[e.jsx(I,{children:"Währung"}),e.jsxs(ee,{value:i.currency,onValueChange:n=>m({...i,currency:n}),children:[e.jsx(te,{className:"h-10 min-h-[44px] mt-1",children:e.jsx(se,{})}),e.jsxs(ne,{children:[e.jsx(P,{value:"CHF",children:"CHF"}),e.jsx(P,{value:"EUR",children:"EUR"}),e.jsx(P,{value:"USD",children:"USD"})]})]})]}),e.jsxs("div",{children:[e.jsx(I,{children:"Notizen"}),e.jsx(rt,{value:i.notes,onChange:n=>m({...i,notes:n.target.value}),placeholder:"Notizen...",className:"mt-1 min-h-[100px]"})]})]}),e.jsxs(ve,{className:"px-5 pb-3 pt-2 gap-2.5",children:[e.jsx(O,{variant:"outline",onClick:()=>r(!1),className:"h-11 min-h-[44px] flex-1 rounded-xl text-sm font-medium",children:"Abbrechen"}),e.jsx(O,{onClick:R,className:"h-10 min-h-[44px]",children:"Hinzufügen"})]})]})}),e.jsx(pe,{open:d,onOpenChange:v,children:e.jsxs(fe,{className:"!fixed !top-[50%] !left-[50%] !right-auto !bottom-auto !translate-x-[-50%] !translate-y-[-50%] !w-[85vw] !max-w-sm !max-h-fit !rounded-3xl !m-0 !overflow-visible !shadow-2xl",children:[e.jsxs(be,{className:"px-5 pt-5 pb-3",children:[e.jsx(je,{className:"text-lg font-semibold",children:"Person bearbeiten"}),e.jsx(ye,{className:"sr-only",children:"Bearbeiten Sie die Informationen der ausgewählten Person"})]}),e.jsxs("div",{className:"space-y-3 px-5 pb-2",children:[e.jsxs("div",{children:[e.jsx(I,{children:"Name *"}),e.jsx(X,{value:i.name,onChange:n=>m({...i,name:n.target.value}),placeholder:"Name",className:"h-10 min-h-[44px] mt-1"})]}),e.jsxs("div",{children:[e.jsx(I,{children:"Typ *"}),e.jsxs(ee,{value:i.type,onValueChange:n=>m({...i,type:n}),children:[e.jsx(te,{className:"h-10 min-h-[44px] mt-1",children:e.jsx(se,{})}),e.jsxs(ne,{children:[e.jsx(P,{value:"household",children:"Haushalt"}),e.jsx(P,{value:"external",children:"Externe Person"}),e.jsx(P,{value:"child",children:"Kind"})]})]})]}),i.type!=="child"&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{children:[e.jsx(I,{children:"E-Mail"}),e.jsx(X,{type:"email",value:i.email,onChange:n=>m({...i,email:n.target.value}),placeholder:"email@example.com",className:"h-10 min-h-[44px] mt-1"})]}),e.jsxs("div",{children:[e.jsx(I,{children:"Telefon"}),e.jsx(X,{type:"tel",value:i.phone,onChange:n=>m({...i,phone:n.target.value}),placeholder:"+41 XX XXX XX XX",className:"h-10 min-h-[44px] mt-1"})]})]}),i.type==="external"&&e.jsxs("div",{children:[e.jsx(I,{children:"Beziehung"}),e.jsxs(ee,{value:i.relationship,onValueChange:n=>m({...i,relationship:n}),children:[e.jsx(te,{className:"h-10 min-h-[44px] mt-1",children:e.jsx(se,{})}),e.jsxs(ne,{children:[e.jsx(P,{value:"both",children:"Beides"}),e.jsx(P,{value:"creditor",children:"Gläubiger"}),e.jsx(P,{value:"debtor",children:"Schuldner"})]})]})]}),e.jsxs("div",{children:[e.jsx(I,{children:"Währung"}),e.jsxs(ee,{value:i.currency,onValueChange:n=>m({...i,currency:n}),children:[e.jsx(te,{className:"h-10 min-h-[44px] mt-1",children:e.jsx(se,{})}),e.jsxs(ne,{children:[e.jsx(P,{value:"CHF",children:"CHF"}),e.jsx(P,{value:"EUR",children:"EUR"}),e.jsx(P,{value:"USD",children:"USD"})]})]})]}),e.jsxs("div",{children:[e.jsx(I,{children:"Notizen"}),e.jsx(rt,{value:i.notes,onChange:n=>m({...i,notes:n.target.value}),placeholder:"Notizen...",className:"mt-1 min-h-[100px]"})]})]}),e.jsxs(ve,{className:"px-5 pb-3 pt-2 gap-2.5",children:[e.jsx(O,{variant:"outline",onClick:()=>v(!1),className:"h-11 min-h-[44px] flex-1 rounded-xl text-sm font-medium",children:"Abbrechen"}),e.jsx(O,{onClick:L,className:"h-11 min-h-[44px] flex-1 rounded-xl text-sm font-medium",children:"Aktualisieren"})]})]})}),y&&e.jsx(pe,{open:!!y,onOpenChange:()=>C(null),children:e.jsxs(fe,{className:"max-w-sm",children:[e.jsxs(be,{children:[e.jsx(je,{children:"Person löschen?"}),e.jsx(ye,{className:"sr-only",children:"Bestätigen Sie das Löschen dieser Person. Diese Aktion kann nicht rückgängig gemacht werden."})]}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Möchten Sie diese Person wirklich löschen? Diese Aktion kann nicht rückgängig gemacht werden."}),e.jsxs(ve,{className:"px-5 pb-3 pt-2 gap-2.5",children:[e.jsx(O,{variant:"outline",onClick:()=>C(null),className:"h-11 min-h-[44px] flex-1 rounded-xl text-sm font-medium",children:"Abbrechen"}),e.jsx(O,{variant:"destructive",onClick:ce,className:"h-11 min-h-[44px] flex-1 rounded-xl text-sm font-medium",children:"Löschen"})]})]})}),k&&j&&e.jsx(pe,{open:j,onOpenChange:g,children:e.jsxs(fe,{className:"!fixed !top-[50%] !left-[50%] !right-auto !bottom-auto !translate-x-[-50%] !translate-y-[-50%] !w-[85vw] !max-w-sm !max-h-fit !rounded-3xl !m-0 !overflow-visible !shadow-2xl",children:[e.jsxs(be,{className:"px-5 pt-5 pb-3",children:[e.jsxs(je,{className:"text-lg font-semibold",children:["Rechnungen - ",k.name]}),e.jsx(ye,{className:"sr-only",children:"Verwalten Sie Rechnungen für diese Person"})]}),e.jsx("div",{className:"px-5 pb-2",children:e.jsx("p",{className:"text-sm text-muted-foreground",children:"Die Rechnungsverwaltung wird in einer zukünftigen Version verfügbar sein."})}),e.jsx(ve,{className:"px-5 pb-3 pt-2",children:e.jsx(O,{variant:"outline",onClick:()=>g(!1),className:"h-11 min-h-[44px] w-full rounded-xl text-sm font-medium",children:"Schliessen"})})]})})]})}function Wn({className:t,value:s,...c}){return e.jsx(un,{"data-slot":"progress",className:Le("bg-primary/20 relative h-2 w-full overflow-hidden rounded-full",t),...c,children:e.jsx(mn,{"data-slot":"progress-indicator",className:"bg-primary h-full w-full flex-1 transition-all",style:{transform:`translateX(-${100-(s||0)}%)`}})})}function Gn(){const{t}=De();let s=[],c=!1,a=null;try{const u=Ft();s=Array.isArray(u.data)?u.data:[],c=u.isLoading||!1,a=u.error||null}catch(u){console.error("[Documents] Error in usePeople hook:",u),s=[],c=!1,a=u}const r=Ne(null);oe(()=>{a&&console.error("[Documents] Error loading people:",a)},[a]);const[d,v]=x([]),[j,g]=x(!0),[k,p]=x("all"),[y,C]=x("all"),[E,T]=x(""),[i,m]=x(!1),[z,H]=x(0),[w,U]=x(null),[ae,F]=x(!1),[K,A]=x(null),[D,$]=x(null),[M,R]=x(""),[L,ce]=x("Sonstiges"),[f,B]=x(!1),[o,n]=x(null),[S,q]=x(!1),Z=[{value:"all",label:"Alle Ordner"},{value:"Rechnungen",label:"Rechnungen"},{value:"Termine",label:"Termine"},{value:"Verträge",label:"Verträge"},{value:"Sonstiges",label:"Sonstiges"}],de=[{value:"Rechnungen",label:"Rechnungen"},{value:"Termine",label:"Termine"},{value:"Verträge",label:"Verträge"},{value:"Sonstiges",label:"Sonstiges"}],l=Zs(async()=>{try{g(!0),console.log("[Documents] Starting fetchDocuments, folder:",y);const u=Ve(He,"getAllDocuments");console.log("[Documents] Calling getAllDocuments function...");const V=await u({folder:y==="all"?null:y});if(console.log("[Documents] Function call successful, result:",V),!V||!V.data){console.warn("[Documents] No data in result, setting empty array"),v([]);return}const Y=V.data;console.log("[Documents] Data received:",{hasDocuments:!!Y.documents,count:Y.documents?.length||0,total:Y.total});const he=Array.isArray(Y.documents)?Y.documents:[];console.log("[Documents] Processing",he.length,"documents");const me=he.map((G,Me)=>{try{return!G||typeof G!="object"?(console.warn(`[Documents] Invalid document at index ${Me}:`,G),null):{...G,id:G.id||`doc-${Me}`,personId:G.personId||"",personName:G.personName||"Unbekannt",fileName:G.fileName||"Unbenannt",fileType:G.fileType||"",fileUrl:G.fileUrl||"",folder:G.folder||"Sonstiges",status:G.status||"uploaded",createdAt:G.createdAt?typeof G.createdAt=="string"?G.createdAt:new Date(G.createdAt).toISOString():null,updatedAt:G.updatedAt?typeof G.updatedAt=="string"?G.updatedAt:new Date(G.updatedAt).toISOString():null}}catch(Oe){return console.error(`[Documents] Error mapping document at index ${Me}:`,Oe,G),null}}).filter(G=>G!==null&&G.id!=="");console.log("[Documents] Successfully mapped",me.length,"documents"),v(me)}catch(u){console.error("[Documents] Error in fetchDocuments:",u),console.error("[Documents] Error details:",{message:u?.message,code:u?.code,details:u?.details,stack:u?.stack});const V=u?.message||u?.code||"Unbekannter Fehler";h.error("Fehler beim Laden der Dokumente: "+V),v([])}finally{g(!1)}},[y]);oe(()=>{let u=!0;return(async()=>{try{await l()}catch(Y){u&&console.error("Failed to load documents:",Y)}})(),()=>{u=!1}},[l]);const N=J(()=>{try{if(!Array.isArray(d))return console.warn("[Documents] documents is not an array in filteredDocuments useMemo"),[];let u=d.filter(V=>V&&V.id);if(k!=="all"&&(u=u.filter(V=>V.personId===k)),y!=="all"&&(u=u.filter(V=>V.folder===y)),E.trim()){const V=E.toLowerCase();u=u.filter(Y=>{try{return(Y.fileName||"").toLowerCase().includes(V)||(Y.personName||"").toLowerCase().includes(V)||(Y.folder||"").toLowerCase().includes(V)}catch(he){return console.error("[Documents] Error filtering by search query:",he,Y),!1}})}return u.sort((V,Y)=>{try{const he=V.updatedAt||V.createdAt||"";return(Y.updatedAt||Y.createdAt||"").localeCompare(he)}catch(he){return console.error("[Documents] Error sorting documents:",he),0}})}catch(u){return console.error("[Documents] Error in filteredDocuments useMemo:",u),[]}},[d,k,y,E]),b=async u=>{if(!u)return;const V=10*1024*1024;if(u.size>V){h.error("Datei ist zu gross. Maximal 10MB erlaubt.");return}try{m(!0),H(0),U(u);const Y=new FileReader;Y.onload=async()=>{try{const me=Y.result.split(",")[1];$(me);const Oe=(await Ve(He,"analyzeDocument")({fileData:me,fileName:u.name,fileType:u.type})).data;A(Oe),F(!0),H(100)}catch(me){h.error("Fehler bei der Analyse: "+(me.message||"Unbekannter Fehler")),m(!1)}},Y.onerror=()=>{h.error("Fehler beim Lesen der Datei"),m(!1)},Y.readAsDataURL(u);const he=setInterval(()=>{H(me=>me>=90?(clearInterval(he),90):me+10)},200)}catch(Y){h.error("Fehler: "+(Y.message||"Unbekannter Fehler")),m(!1)}},W=async()=>{if(!D||!M||!w){h.error("Bitte füllen Sie alle Felder aus");return}try{B(!0),await Ve(He,"uploadDocument")({fileData:D,fileName:w.name,fileType:w.type,personId:M,folder:L}),h.success("Dokument gespeichert"),F(!1),U(null),$(null),A(null),R(""),ce("Sonstiges"),m(!1),H(0),await l()}catch(u){h.error("Fehler beim Speichern: "+(u.message||"Unbekannter Fehler"))}finally{B(!1)}},ue=async u=>{try{await Ve(He,"deleteDocument")({documentId:u}),h.success("Dokument gelöscht"),await l()}catch(V){h.error("Fehler: "+(V.message||"Unbekannter Fehler"))}},Ae=u=>{n(u.fileUrl),q(!0)},et=u=>{if(!u)return"N/A";try{return hn(new Date(u),"dd.MM.yyyy",{locale:xn})}catch{return"N/A"}},Zt=u=>u.startsWith("image/")?e.jsx(Us,{className:"w-5 h-5"}):u.includes("pdf")?e.jsx(_e,{className:"w-5 h-5"}):e.jsx(Hs,{className:"w-5 h-5"});return e.jsxs(we,{title:"Dokumente",showSidebar:!0,children:[e.jsx("div",{className:"mobile-card mb-4",children:e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{children:[e.jsx(I,{className:"text-xs text-muted-foreground mb-2 block",children:"Suche"}),e.jsxs("div",{className:"relative",children:[e.jsx(Xe,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-4 h-4 text-muted-foreground"}),e.jsx(X,{placeholder:"Suchen...",value:E,onChange:u=>T(u.target.value),className:"pl-10 h-10 min-h-[44px]"})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[e.jsxs("div",{children:[e.jsx(I,{className:"text-xs text-muted-foreground mb-2 block",children:"Person"}),e.jsxs(ee,{value:k,onValueChange:p,children:[e.jsx(te,{className:"h-10 min-h-[44px]",children:e.jsx(se,{})}),e.jsxs(ne,{children:[e.jsx(P,{value:"all",children:"Alle"}),Array.isArray(s)&&s.map(u=>!u||!u.id?null:e.jsx(P,{value:u.id,children:u.name||"Unbekannt"},u.id))]})]})]}),e.jsxs("div",{children:[e.jsx(I,{className:"text-xs text-muted-foreground mb-2 block",children:"Ordner"}),e.jsxs(ee,{value:y,onValueChange:C,children:[e.jsx(te,{className:"h-10 min-h-[44px]",children:e.jsx(se,{})}),e.jsx(ne,{children:Z.map(u=>e.jsx(P,{value:u.value,children:u.label},u.value))})]})]})]})]})}),e.jsx(O,{onClick:()=>r.current?.click(),className:"w-full mb-4 h-12 min-h-[44px]",disabled:i,children:i?e.jsxs(e.Fragment,{children:[e.jsx(Ms,{className:"w-5 h-5 mr-2 animate-spin"}),"Lädt..."]}):e.jsxs(e.Fragment,{children:[e.jsx(Mt,{className:"w-5 h-5 mr-2"}),"Dokument hochladen"]})}),i&&e.jsx("div",{className:"mobile-card mb-4",children:e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center justify-between text-sm",children:[e.jsx("span",{children:"Upload Fortschritt"}),e.jsxs("span",{children:[z,"%"]})]}),e.jsx(Wn,{value:z})]})}),e.jsx("input",{ref:r,type:"file",className:"hidden",accept:"image/*,.pdf,.doc,.docx",onChange:u=>{const V=u.target.files?.[0];V&&b(V),u.target.value=""}}),j||c?e.jsx("div",{className:"space-y-3",children:Array.from({length:5}).map((u,V)=>e.jsx(Re,{className:"mobile-card",children:e.jsx(Pe,{className:"p-4",children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx(Q,{className:"w-5 h-5 rounded"}),e.jsxs("div",{className:"flex-1 space-y-2",children:[e.jsx(Q,{className:"h-4 w-3/4"}),e.jsx(Q,{className:"h-3 w-1/2"})]})]})})},V))}):N.length===0?e.jsx("div",{className:"mobile-card text-center py-8",children:e.jsx("p",{className:"text-muted-foreground",children:"Keine Dokumente gefunden"})}):e.jsx("div",{className:"space-y-3",children:N.map(u=>!u||!u.id?(console.warn("[Documents] Skipping invalid document in render:",u),null):e.jsx(Re,{className:"mobile-card",children:e.jsx(Pe,{className:"p-4",children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("div",{className:"mt-1",children:Zt(u.fileType)}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("h3",{className:"font-semibold text-sm mb-1 truncate",children:u.fileName}),e.jsxs("div",{className:"space-y-1 text-xs text-muted-foreground",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Ot,{className:"w-3 h-3"}),e.jsx("span",{children:u.personName})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Os,{className:"w-3 h-3"}),e.jsx("span",{children:u.folder})]}),u.updatedAt&&e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Ge,{className:"w-3 h-3"}),e.jsx("span",{children:et(u.updatedAt)})]})]}),e.jsxs("div",{className:"flex items-center gap-2 mt-3",children:[e.jsxs(O,{variant:"outline",size:"sm",onClick:()=>Ae(u),className:"h-8 min-h-[44px] flex-1","aria-label":`Dokument ${u.fileName} ansehen`,children:[e.jsx(Ht,{className:"w-4 h-4 mr-1","aria-hidden":"true"}),"Ansehen"]}),e.jsx(O,{variant:"outline",size:"sm",onClick:()=>ue(u.id),className:"h-8 min-h-[44px] text-red-500","aria-label":`Dokument ${u.fileName} löschen`,children:e.jsx(Je,{className:"w-4 h-4","aria-hidden":"true"})})]})]})]})})},u.id))}),e.jsx(pe,{open:ae,onOpenChange:F,children:e.jsxs(fe,{className:"!fixed !top-[50%] !left-[50%] !right-auto !bottom-auto !translate-x-[-50%] !translate-y-[-50%] !w-[85vw] !max-w-sm !max-h-fit !rounded-3xl !m-0 !overflow-visible !shadow-2xl",children:[e.jsxs(be,{className:"px-5 pt-5 pb-3",children:[e.jsx(je,{className:"text-lg font-semibold",children:"Dokument zuordnen"}),e.jsx(ye,{children:"Wählen Sie eine Person und einen Ordner für dieses Dokument"})]}),e.jsxs("div",{className:"px-5 pb-2",children:[K&&e.jsx("div",{className:"space-y-3 mb-4",children:e.jsxs("div",{className:"p-3 bg-muted rounded-lg",children:[e.jsx("p",{className:"text-xs font-semibold mb-2",children:"Analyse-Ergebnis"}),K.extractedData.amount&&e.jsxs("p",{className:"text-sm",children:["Betrag: CHF ",(K.extractedData.amount/100).toFixed(2)]}),K.extractedData.dueDate&&e.jsxs("p",{className:"text-sm",children:["Fälligkeitsdatum: ",et(K.extractedData.dueDate)]}),K.extractedData.description&&e.jsxs("p",{className:"text-sm",children:["Beschreibung: ",K.extractedData.description]})]})}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{children:[e.jsx(I,{children:"Person *"}),e.jsxs(ee,{value:M,onValueChange:R,children:[e.jsx(te,{className:"h-10 min-h-[44px] mt-1",children:e.jsx(se,{placeholder:"Person auswählen"})}),e.jsx(ne,{children:Array.isArray(s)&&s.map(u=>!u||!u.id?null:e.jsx(P,{value:u.id,children:u.name||"Unbekannt"},u.id))})]})]}),e.jsxs("div",{children:[e.jsx(I,{children:"Ordner *"}),e.jsxs(ee,{value:L,onValueChange:ce,children:[e.jsx(te,{className:"h-10 min-h-[44px] mt-1",children:e.jsx(se,{})}),e.jsx(ne,{children:de.map(u=>e.jsx(P,{value:u.value,children:u.label},u.value))})]})]})]})]}),e.jsxs(ve,{className:"px-5 pb-3 pt-2 gap-2.5",children:[e.jsx(O,{variant:"outline",onClick:()=>{F(!1),m(!1),H(0)},className:"h-10 min-h-[44px]",children:"Abbrechen"}),e.jsx(O,{onClick:W,disabled:f||!M,className:"h-10 min-h-[44px]",children:f?"Speichert...":"Speichern"})]})]})}),e.jsx(pe,{open:S,onOpenChange:q,children:e.jsxs(fe,{className:"!fixed !top-[50%] !left-[50%] !right-auto !bottom-auto !translate-x-[-50%] !translate-y-[-50%] !w-[85vw] !max-w-sm !max-h-fit !rounded-3xl !m-0 !overflow-visible !shadow-2xl",children:[e.jsx(be,{className:"px-5 pt-5 pb-3",children:e.jsx(je,{className:"text-lg font-semibold",children:"Dokument Vorschau"})}),o&&e.jsx("div",{className:"w-full",children:o.includes("image")?e.jsx("img",{src:o,alt:"Preview",className:"w-full h-auto rounded-lg"}):e.jsx("iframe",{src:o,className:"w-full h-[60vh] rounded-lg",title:"Document Preview"})}),e.jsx(ve,{className:"px-5 pb-3 pt-2",children:e.jsx(O,{variant:"outline",onClick:()=>q(!1),className:"h-11 min-h-[44px] w-full rounded-xl text-sm font-medium",children:"Schliessen"})})]})})]})}const Qn={ZH:"Zürich",BE:"Bern",LU:"Luzern",UR:"Uri",SZ:"Schwyz",OW:"Obwalden",NW:"Nidwalden",GL:"Glarus",ZG:"Zug",FR:"Freiburg",SO:"Solothurn",BS:"Basel-Stadt",BL:"Basel-Landschaft",SH:"Schaffhausen",AR:"Appenzell Ausserrhoden",AI:"Appenzell Innerrhoden",SG:"St. Gallen",GR:"Graubünden",AG:"Aargau",TG:"Thurgau",TI:"Tessin",VD:"Waadt",VS:"Wallis",NE:"Neuenburg",GE:"Genf",JU:"Jura"};function Zn(){const{t}=De(),[s,c]=x(0),{data:a,isLoading:r,error:d}=cs(s),[v,j]=x(!1),[g,k]=x(null),[p,y]=x(null),C=w=>{switch(w){case"unvollständig":return e.jsx(ke,{variant:"outline",className:"bg-yellow-50 text-yellow-700 border-yellow-200",children:"Unvollständig"});case"vollständig":return e.jsx(ke,{variant:"outline",className:"bg-blue-50 text-blue-700 border-blue-200",children:"Vollständig"});case"eingereicht":return e.jsx(ke,{variant:"outline",className:"bg-green-50 text-green-700 border-green-200",children:"Eingereicht"});default:return e.jsx(ke,{variant:"outline",children:w})}},E=w=>w==null?"-":new Intl.NumberFormat("de-CH",{style:"currency",currency:"CHF"}).format(w),T=w=>{if(!w)return"-";try{return new Date(w).toLocaleDateString("de-CH",{day:"2-digit",month:"2-digit",year:"numeric"})}catch{return"-"}},i=async()=>{if(p)try{await ds(p),h.success("Steuerprofil gelöscht"),y(null),c(w=>w+1)}catch(w){h.error("Fehler: "+(w.message||"Unbekannter Fehler"))}},m=w=>{k(w),j(!0)},z=()=>{k(null),j(!0)},H=()=>{j(!1),k(null),c(w=>w+1)};return d?e.jsx(we,{title:"Steuern",showSidebar:!0,children:e.jsx("div",{className:"mobile-card text-center py-8",children:e.jsx("p",{className:"text-red-500",children:"Fehler beim Laden der Steuerprofile"})})}):e.jsxs(we,{title:"Steuern",showSidebar:!0,children:[e.jsxs(O,{onClick:z,className:"w-full mb-4 h-12 min-h-[44px]",children:[e.jsx(Fe,{className:"w-5 h-5 mr-2"}),"Steuerprofil hinzufügen"]}),r?e.jsx("div",{className:"text-center py-8 text-muted-foreground",children:"Lädt..."}):!a||a.length===0?e.jsxs("div",{className:"mobile-card text-center py-8",children:[e.jsx("p",{className:"text-muted-foreground",children:"Keine Steuerprofile gefunden"}),e.jsx("p",{className:"text-sm text-muted-foreground mt-2",children:"Erstellen Sie ein neues Steuerprofil, um Ihre Steuern zu verwalten"})]}):e.jsx("div",{className:"space-y-3",children:a.map(w=>e.jsx(Re,{className:"mobile-card",children:e.jsx(Pe,{className:"p-4",children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("div",{className:"w-10 h-10 rounded-full bg-primary/10 text-primary flex items-center justify-center flex-shrink-0",children:e.jsx(_e,{className:"w-5 h-5"})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("div",{className:"flex items-start justify-between gap-2 mb-2",children:e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("h3",{className:"font-semibold text-sm truncate",children:[w.year," - ",w.canton?Qn[w.canton]||w.canton:"Schweiz"]}),w.status&&C(w.status)]})}),e.jsxs("div",{className:"space-y-1 text-xs text-muted-foreground",children:[w.taxableIncome!==null&&w.taxableIncome!==void 0&&e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Lt,{className:"w-3 h-3"}),e.jsxs("span",{children:["Einkommen: ",E(w.taxableIncome)]})]}),w.taxAmount!==null&&w.taxAmount!==void 0&&e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Vs,{className:"w-3 h-3"}),e.jsxs("span",{children:["Steuerbetrag: ",E(w.taxAmount)]})]}),w.submissionDate&&e.jsx("div",{className:"flex items-center gap-2",children:e.jsxs("span",{children:["Eingereicht: ",T(w.submissionDate)]})})]}),e.jsxs("div",{className:"flex items-center gap-2 mt-3",children:[e.jsxs(O,{variant:"outline",size:"sm",onClick:()=>m(w),className:"h-8 min-h-[44px] flex-1",children:[e.jsx(Ks,{className:"w-4 h-4 mr-1"}),"Bearbeiten"]}),e.jsx(O,{variant:"outline",size:"sm",onClick:()=>y(w.id),className:"h-8 min-h-[44px] text-red-500",children:e.jsx(Je,{className:"w-4 h-4"})})]})]})]})})},w.id))}),v&&e.jsx(pe,{open:v,onOpenChange:H,children:e.jsxs(fe,{className:"!fixed !top-[50%] !left-[50%] !right-auto !bottom-auto !translate-x-[-50%] !translate-y-[-50%] !w-[85vw] !max-w-sm !max-h-fit !rounded-3xl !m-0 !overflow-visible !shadow-2xl",children:[e.jsxs(be,{className:"px-5 pt-5 pb-3",children:[e.jsx(je,{children:g?"Steuerprofil bearbeiten":"Neues Steuerprofil"}),e.jsx(ye,{className:"sr-only",children:g?"Bearbeiten Sie die Details des Steuerprofils":"Erstellen Sie ein neues Steuerprofil für ein Steuerjahr"})]}),e.jsx("div",{className:"px-5 pb-2",children:e.jsx("p",{className:"text-sm text-muted-foreground",children:"Die Steuerprofil-Verwaltung wird in einer zukünftigen Version verfügbar sein. Bitte verwenden Sie die Web-Version für die Verwaltung von Steuerprofilen."})}),e.jsx(ve,{className:"px-5 pb-3 pt-2",children:e.jsx(O,{variant:"outline",onClick:H,className:"h-11 min-h-[44px] w-full rounded-xl text-sm font-medium",children:"Schliessen"})})]})}),p&&e.jsx(pe,{open:!!p,onOpenChange:()=>y(null),children:e.jsxs(fe,{className:"!fixed !top-[50%] !left-[50%] !right-auto !bottom-auto !translate-x-[-50%] !translate-y-[-50%] !w-[85vw] !max-w-sm !max-h-fit !rounded-3xl !m-0 !overflow-visible !shadow-2xl",children:[e.jsxs(be,{className:"px-5 pt-5 pb-3",children:[e.jsx(je,{className:"text-lg font-semibold",children:"Steuerprofil löschen?"}),e.jsx(ye,{className:"sr-only",children:"Bestätigen Sie das Löschen dieses Steuerprofils. Diese Aktion kann nicht rückgängig gemacht werden."})]}),e.jsx("div",{className:"px-5 pb-2",children:e.jsx("p",{className:"text-sm text-muted-foreground",children:"Möchten Sie dieses Steuerprofil wirklich löschen? Diese Aktion kann nicht rückgängig gemacht werden."})}),e.jsxs(ve,{className:"px-5 pb-3 pt-2 gap-2.5",children:[e.jsx(O,{variant:"outline",onClick:()=>y(null),className:"h-11 min-h-[44px] flex-1 rounded-xl text-sm font-medium",children:"Abbrechen"}),e.jsx(O,{variant:"destructive",onClick:i,className:"h-11 min-h-[44px] flex-1 rounded-xl text-sm font-medium",children:"Löschen"})]})]})})]})}function Yn({children:t}){const[s,c]=Ie(),{user:a,loading:r}=Be(),[d,v]=x(!1);return oe(()=>{(async()=>{if(!(r||!a)&&!(s==="/login"||s==="/register"||s==="/onboarding"))try{v(!0);const g=await Vt($e(Ke,"users",a.uid));(!g.exists()||!g.data().onboardingCompleted)&&c("/onboarding")}catch(g){console.error("Error checking onboarding status:",g)}finally{v(!1)}})()},[a,r,s,c]),r||d?e.jsx("div",{className:"min-h-screen flex items-center justify-center bg-background",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-primary mx-auto"}),e.jsx("p",{className:"mt-4 text-muted-foreground",children:"Lade..."})]})}):e.jsx(e.Fragment,{children:t})}function _n(){return e.jsx(Yn,{children:e.jsxs(fs,{children:[e.jsx(ie,{path:"/login",component:On}),e.jsx(ie,{path:"/register",component:Un}),e.jsx(ie,{path:"/onboarding",component:Hn}),e.jsx(ie,{path:"/",component:xt}),e.jsx(ie,{path:"/dashboard",component:Nn}),e.jsx(ie,{path:"/calendar",component:Ys}),e.jsx(ie,{path:"/reminders",component:Vn}),e.jsx(ie,{path:"/finance",component:En}),e.jsx(ie,{path:"/people",component:qn}),e.jsx(ie,{path:"/bills",component:An}),e.jsx(ie,{path:"/documents",component:Gn}),e.jsx(ie,{path:"/shopping",component:rn}),e.jsx(ie,{path:"/taxes",component:Zn}),e.jsx(ie,{path:"/settings",component:Mn}),e.jsx(ie,{children:e.jsx(xt,{})})]})})}function Xn(){return e.jsx(vn,{children:e.jsx(fn,{defaultTheme:"light",switchable:!0,children:e.jsxs(us,{children:[e.jsx(_n,{}),e.jsx(pn,{position:"top-center",richColors:!0})]})})})}typeof window<"u"&&setTimeout(async()=>{try{await st(()=>import("./eventBus-CWDWdm45.js"),[]),await st(()=>import("./backgroundTaskManager-DuxFkiIE.js"),__vite__mapDeps([0,1])),await st(()=>import("./workflowOrchestrator-BZtQc-WZ.js"),__vite__mapDeps([2,1,0]))}catch{}},100);"serviceWorker"in navigator&&window.addEventListener("load",()=>{qt().catch(t=>{console.error("[Main] Service Worker registration failed:",t)})});const Jn="UNAUTHORIZED",ea=()=>"/login",Qe=new $s({defaultOptions:{queries:{retry:(t,s)=>{if(s instanceof Ye){const c=s.data?.httpStatus;if(c>=400&&c<500)return!1}return t<2}}}}),ta=t=>{if(!(t instanceof Ye)||typeof window>"u"||!(t.message===Jn||t.data?.code==="UNAUTHORIZED"))return;const c=ea();window.location.href=c};Qe.getQueryCache().subscribe(t=>{if(t?.type==="updated"&&t?.query?.state?.error){const s=t.query.state.error;if(s instanceof Ye){const c=s.data?.requestId||s.meta?.requestId||null;console.error("[Query Error]",{message:s.message,code:s.data?.code,requestId:c,path:s.data?.path})}if(t.action?.type==="error"){const c=t.query.queryKey;Array.isArray(c)&&c[0]==="auth"&&c[1]==="me"&&ta(s)}}});Qe.getMutationCache().subscribe(t=>{if(t?.type==="updated"&&t?.mutation?.state?.error){const s=t.mutation.state.error;if(s instanceof Ye){const c=s.data?.requestId||s.meta?.requestId||null;console.error("[Mutation Error]",{message:s.message,code:s.data?.code,requestId:c,path:s.data?.path})}}});const sa=Bt.createClient({links:[gs({url:"/api/trpc",async fetch(t,s){let c=null;try{const r=ms.currentUser;r&&(c=await r.getIdToken())}catch{}const a=new Headers(s?.headers);c&&a.set("Authorization",`Bearer ${c}`);try{const r=await globalThis.fetch(t,{...s??{},headers:a,credentials:"include"}),d=r.headers.get("x-goog-request-id")||r.headers.get("x-cloud-trace-context")?.split("/")[0]||null;if(d&&!r.ok){const v=typeof t=="string"?t:t instanceof Request?t.url:String(t);console.error("[tRPC] Request failed with Request ID:",{requestId:d,status:r.status,statusText:r.statusText,url:v})}return r}catch(r){const d=typeof t=="string"?t:t instanceof Request?t.url:String(t);throw console.error("[tRPC] Network error:",{error:r instanceof Error?r.message:String(r),url:d}),r}}})]}),Ce=document.getElementById("root");if(!Ce)throw new Error("Root element not found");Ce.innerHTML='<div style="padding: 20px; text-align: center;"><p>Lädt...</p></div>';window.addEventListener("error",t=>{console.error("[Global Error]",t.error),Ce&&!Ce.querySelector("h1")&&(Ce.innerHTML=`
      <div style="padding: 20px; text-align: center; font-family: system-ui;">
        <h1>Fehler beim Laden</h1>
        <p>${t.error?.message||"Unbekannter Fehler"}</p>
        <button onclick="window.location.reload()" style="margin-top: 20px; padding: 10px 20px; background: #3b82f6; color: white; border: none; border-radius: 6px; cursor: pointer;">Seite neu laden</button>
      </div>
    `)});window.addEventListener("unhandledrejection",t=>{console.error("[Unhandled Rejection]",t.reason)});try{xs(Ce).render(e.jsx(Bt.Provider,{client:sa,queryClient:Qe,children:e.jsx(ps,{client:Qe,children:e.jsx(Xn,{})})})),console.log("[Main] App rendered successfully")}catch(t){console.error("[Main] Failed to render app:",t);const s=t instanceof Error?t.message:String(t);Ce.innerHTML=`
    <div style="padding: 20px; text-align: center; font-family: system-ui;">
      <h1>Fehler beim Laden</h1>
      <p>Die Anwendung konnte nicht geladen werden.</p>
      <p style="color: #666; font-size: 14px; margin-top: 10px; font-family: monospace;">${s}</p>
      <button onclick="window.location.reload()" style="margin-top: 20px; padding: 10px 20px; background: #3b82f6; color: white; border: none; border-radius: 6px; cursor: pointer;">Seite neu laden</button>
    </div>
  `}
