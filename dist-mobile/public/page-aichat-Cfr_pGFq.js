import*as Ne from"react";import pt,{createContext as bt,useContext as vt,useMemo as ce,useRef as O,useCallback as Y,useState as p,useEffect as q}from"react";import"./vendor-i18n-CxwOOByA.js";import{s as Vt,c as Zt,X as Le,W as yt,C as He,a as Qe,b as wt,S as jt,d as Jt,e as Yt,f as Xt,g as Ce,M as Qt,L as st,h as nt,B as qe,U as We,i as Re,j as Te,k as Be,F as Nt,l as $e,m as es,H as ts,T as ss,n as ns,o as Ct,p as kt,q as as,r as ot,P as rs,I as is,G as os,t as St,A as ls,u as cs,v as ds,w as us,x as ms,y as hs,E as gs,z as fs,D as xs,J as ps,K as bs,N as vs,O as lt,Q as ys}from"./vendor-misc-uScK91qn.js";import{u as _e,L as ws}from"./vendor-router-QfRsueAx.js";import{S as js,R as Ns,C as Cs,a as ks,T as Ss,D as Ds,P as Es,O as As,b as Is,c as Fs,d as Rs,I as Ts,V as zs,e as Ms,f as Ps,g as Bs,h as Ls,i as _s,j as Os,k as Us,l as Ks,m as Hs,n as Ws,o as $s,p as qs,q as Gs,r as Vs,s as Zs}from"./vendor-ui-CsWatXgV.js";import{t as Js,c as Ys}from"./vendor-utils-BNe0Xlio.js";import{i as Xs,g as Qs,a as en,b as tn,c as sn,d as nn,o as an,s as rn,G as on,e as ln,f as cn,h as dn,j as F,k as un,l as mn}from"./vendor-firebase-BO6NZuvD.js";import{t as b}from"./vendor-toast-CdQ6zwVl.js";import{c as hn}from"./vendor-api-DCNsh1JK.js";const gn="modulepreload",fn=function(s){return"/"+s},ct={},ka=function(t,n,i){let l=Promise.resolve();if(n&&n.length>0){let f=function(d){return Promise.all(d.map(h=>Promise.resolve(h).then(m=>({status:"fulfilled",value:m}),m=>({status:"rejected",reason:m}))))};document.getElementsByTagName("link");const c=document.querySelector("meta[property=csp-nonce]"),u=c?.nonce||c?.getAttribute("nonce");l=f(n.map(d=>{if(d=fn(d),d in ct)return;ct[d]=!0;const h=d.endsWith(".css"),m=h?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${d}"]${m}`))return;const g=document.createElement("link");if(g.rel=h?"stylesheet":gn,h||(g.as="script"),g.crossOrigin="",g.href=d,u&&g.setAttribute("nonce",u),document.head.appendChild(g),h)return new Promise((w,k)=>{g.addEventListener("load",w),g.addEventListener("error",()=>k(new Error(`Unable to preload CSS for ${d}`)))})}))}function o(c){const u=new Event("vite:preloadError",{cancelable:!0});if(u.payload=c,window.dispatchEvent(u),!u.defaultPrevented)throw c}return l.then(c=>{for(const u of c||[])u.status==="rejected"&&o(u.reason);return t().catch(o)})};var Sa=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function Da(s){return s&&s.__esModule&&Object.prototype.hasOwnProperty.call(s,"default")?s.default:s}var Ve={exports:{}},Me={};/**
 * @license React
 * react-jsx-runtime.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var dt;function xn(){if(dt)return Me;dt=1;var s=pt,t=Symbol.for("react.element"),n=Symbol.for("react.fragment"),i=Object.prototype.hasOwnProperty,l=s.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,o={key:!0,ref:!0,__self:!0,__source:!0};function c(u,f,d){var h,m={},g=null,w=null;d!==void 0&&(g=""+d),f.key!==void 0&&(g=""+f.key),f.ref!==void 0&&(w=f.ref);for(h in f)i.call(f,h)&&!o.hasOwnProperty(h)&&(m[h]=f[h]);if(u&&u.defaultProps)for(h in f=u.defaultProps,f)m[h]===void 0&&(m[h]=f[h]);return{$$typeof:t,type:u,key:g,ref:w,props:m,_owner:l.current}}return Me.Fragment=n,Me.jsx=c,Me.jsxs=c,Me}var ut;function pn(){return ut||(ut=1,Ve.exports=xn()),Ve.exports}var e=pn();const bn=(s,t,n,i)=>{const l=[n,{code:t,...i||{}}];if(s?.services?.logger?.forward)return s.services.logger.forward(l,"warn","react-i18next::",!0);ke(l[0])&&(l[0]=`react-i18next:: ${l[0]}`),s?.services?.logger?.warn?s.services.logger.warn(...l):console?.warn&&console.warn(...l)},mt={},Dt=(s,t,n,i)=>{ke(n)&&mt[n]||(ke(n)&&(mt[n]=new Date),bn(s,t,n,i))},Et=(s,t)=>()=>{if(s.isInitialized)t();else{const n=()=>{setTimeout(()=>{s.off("initialized",n)},0),t()};s.on("initialized",n)}},et=(s,t,n)=>{s.loadNamespaces(t,Et(s,n))},ht=(s,t,n,i)=>{if(ke(n)&&(n=[n]),s.options.preload&&s.options.preload.indexOf(t)>-1)return et(s,n,i);n.forEach(l=>{s.options.ns.indexOf(l)<0&&s.options.ns.push(l)}),s.loadLanguages(t,Et(s,i))},vn=(s,t,n={})=>!t.languages||!t.languages.length?(Dt(t,"NO_LANGUAGES","i18n.languages were undefined or empty",{languages:t.languages}),!0):t.hasLoadedNamespace(s,{lng:n.lng,precheck:(i,l)=>{if(n.bindI18n&&n.bindI18n.indexOf("languageChanging")>-1&&i.services.backendConnector.backend&&i.isLanguageChangingTo&&!l(i.isLanguageChangingTo,s))return!1}}),ke=s=>typeof s=="string",yn=s=>typeof s=="object"&&s!==null,wn=/&(?:amp|#38|lt|#60|gt|#62|apos|#39|quot|#34|nbsp|#160|copy|#169|reg|#174|hellip|#8230|#x2F|#47);/g,jn={"&amp;":"&","&#38;":"&","&lt;":"<","&#60;":"<","&gt;":">","&#62;":">","&apos;":"'","&#39;":"'","&quot;":'"',"&#34;":'"',"&nbsp;":" ","&#160;":" ","&copy;":"©","&#169;":"©","&reg;":"®","&#174;":"®","&hellip;":"…","&#8230;":"…","&#x2F;":"/","&#47;":"/"},Nn=s=>jn[s],Cn=s=>s.replace(wn,Nn);let tt={bindI18n:"languageChanged",bindI18nStore:"",transEmptyNodeValue:"",transSupportBasicHtmlNodes:!0,transWrapTextNodes:"",transKeepBasicHtmlNodesFor:["br","strong","i","p"],useSuspense:!0,unescape:Cn,transDefaultProps:void 0};const kn=(s={})=>{tt={...tt,...s}},Sn=()=>tt;let At;const Dn=s=>{At=s},En=()=>At,Ea={type:"3rdParty",init(s){kn(s.options.react),Dn(s)}},An=bt();class In{constructor(){this.usedNamespaces={}}addUsedNamespaces(t){t.forEach(n=>{this.usedNamespaces[n]||(this.usedNamespaces[n]=!0)})}getUsedNamespaces(){return Object.keys(this.usedNamespaces)}}const Fn=(s,t)=>ke(t)?t:yn(t)&&ke(t.defaultValue)?t.defaultValue:Array.isArray(s)?s[s.length-1]:s,Rn={t:Fn,ready:!1},Tn=()=>()=>{},It=(s,t={})=>{const{i18n:n}=t,{i18n:i,defaultNS:l}=vt(An)||{},o=n||i||En();o&&!o.reportNamespaces&&(o.reportNamespaces=new In),o||Dt(o,"NO_I18NEXT_INSTANCE","useTranslation: You will need to pass in an i18next instance by using initReactI18next");const c=ce(()=>({...Sn(),...o?.options?.react,...t}),[o,t]),{useSuspense:u,keyPrefix:f}=c,d=l||o?.options?.defaultNS,h=ke(d)?[d]:d||["translation"],m=ce(()=>h,h);o?.reportNamespaces?.addUsedNamespaces?.(m);const g=O(0),w=Y(j=>{if(!o)return Tn;const{bindI18n:v,bindI18nStore:E}=c,z=()=>{g.current+=1,j()};return v&&o.on(v,z),E&&o.store.on(E,z),()=>{v&&v.split(" ").forEach(K=>o.off(K,z)),E&&E.split(" ").forEach(K=>o.store.off(K,z))}},[o,c]),k=O(),y=Y(()=>{if(!o)return Rn;const j=!!(o.isInitialized||o.initializedStoreOnce)&&m.every(ne=>vn(ne,o,c)),v=t.lng||o.language,E=g.current,z=k.current;if(z&&z.ready===j&&z.lng===v&&z.keyPrefix===f&&z.revision===E)return z;const I={t:o.getFixedT(v,c.nsMode==="fallback"?m:m[0],f),ready:j,lng:v,keyPrefix:f,revision:E};return k.current=I,I},[o,m,f,c,t.lng]),[P,T]=p(0),{t:G,ready:V}=Vt.useSyncExternalStore(w,y,y);q(()=>{if(o&&!V&&!u){const j=()=>T(v=>v+1);t.lng?ht(o,t.lng,m,j):et(o,m,j)}},[o,t.lng,m,V,u,P]);const _=o||{},U=O(null),B=O(),se=j=>{const v=Object.getOwnPropertyDescriptors(j);v.__original&&delete v.__original;const E=Object.create(Object.getPrototypeOf(j),v);if(!Object.prototype.hasOwnProperty.call(E,"__original"))try{Object.defineProperty(E,"__original",{value:j,writable:!1,enumerable:!1,configurable:!1})}catch{}return E},re=ce(()=>{const j=_,v=j?.language;let E=j;j&&(U.current&&U.current.__original===j?B.current!==v?(E=se(j),U.current=E,B.current=v):E=U.current:(E=se(j),U.current=E,B.current=v));const z=[G,E,V];return z.t=G,z.i18n=E,z.ready=V,z},[G,_,V,_.resolvedLanguage,_.language,_.languages]);if(o&&u&&!V)throw new Promise(j=>{const v=()=>j();t.lng?ht(o,t.lng,m,v):et(o,m,v)});return re},zn=hn(),Mn={apiKey:"AIzaSyCZ8V17HUVMlBKXK0ftrMURS-XP2zIsOps",authDomain:"nexo-jtsky100.firebaseapp.com",projectId:"nexo-jtsky100",storageBucket:"nexo-jtsky100.firebasestorage.app",messagingSenderId:"859320186482",appId:"1:859320186482:web:0c9dcca5d8ce613aaf34eb",measurementId:"G-G8PX4GB2YF"},Ge=Xs(Mn),De=Qs(Ge),Pn=en(Ge),R=tn(Ge,"us-central1");typeof window<"u"&&sn(Ge);const Ft=bt(void 0);function Aa({children:s}){const[t,n]=p(null),[i,l]=p(!0),[o,c]=p(null);q(()=>(nn(De).then(y=>{y?.user&&n(y.user)}).catch(y=>{}),an(De,y=>{n(y),l(!1)})),[]);const u=async(k,y)=>{try{c(null);const P=await cn(De,k,y)}catch(P){let T="Anmeldung fehlgeschlagen";switch(P.code){case"auth/invalid-email":T="Ungültige E-Mail-Adresse";break;case"auth/user-disabled":T="Dieses Konto wurde deaktiviert";break;case"auth/user-not-found":T="Kein Konto mit dieser E-Mail gefunden";break;case"auth/wrong-password":T="Falsches Passwort";break;case"auth/invalid-credential":T="Ungültige Anmeldedaten";break;default:T=P.message||"Ein Fehler ist aufgetreten"}throw c(T),new Error(T)}},f=async(k,y)=>{try{c(null);const P=await dn(De,k,y)}catch(P){let T="Registrierung fehlgeschlagen";switch(P.code){case"auth/email-already-in-use":T="Diese E-Mail wird bereits verwendet";break;case"auth/invalid-email":T="Ungültige E-Mail-Adresse";break;case"auth/weak-password":T="Passwort ist zu schwach";break;default:T=P.message||"Ein Fehler ist aufgetreten"}throw c(T),new Error(T)}},d=async()=>{try{c(null);const k=new on;k.addScope("email"),k.addScope("profile"),k.setCustomParameters({prompt:"select_account"}),await ln(De,k)}catch(k){let y="Ein Fehler ist aufgetreten";switch(k.code){case"auth/unauthorized-domain":y="Diese Domain ist nicht autorisiert. Bitte kontaktieren Sie den Administrator.";break;case"auth/operation-not-allowed":y="Google Sign-In ist nicht aktiviert.";break;case"auth/network-request-failed":y="Netzwerkfehler. Bitte überprüfen Sie Ihre Internetverbindung.";break;default:y=k.message||"Ein unbekannter Fehler ist aufgetreten"}throw c(y),new Error(y)}},h=async()=>{try{await rn(De)}catch{throw new Error("Abmeldung fehlgeschlagen")}},m=u,g=d,w=h;return e.jsx(Ft.Provider,{value:{user:t,loading:i,error:o,signIn:u,signUp:f,signInWithGoogle:d,signOut:h,loginWithEmail:m,loginWithGoogle:g,logout:w},children:s})}function Rt(){const s=vt(Ft);if(s===void 0)throw new Error("useAuth must be used within an AuthProvider");return s}function D(...s){return Js(Ys(s))}const Bn=Zt("inline-flex items-center justify-center gap-2 whitespace-nowrap rounded-md text-sm font-medium transition-all disabled:pointer-events-none disabled:opacity-50 [&_svg]:pointer-events-none [&_svg:not([class*='size-'])]:size-4 shrink-0 [&_svg]:shrink-0 outline-none focus-visible:border-ring focus-visible:ring-ring/50 focus-visible:ring-[3px] aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive",{variants:{variant:{default:"bg-primary text-primary-foreground hover:bg-primary/90",destructive:"bg-destructive text-white hover:bg-destructive/90 focus-visible:ring-destructive/20 dark:focus-visible:ring-destructive/40 dark:bg-destructive/60",outline:"border bg-transparent shadow-xs hover:bg-accent dark:bg-transparent dark:border-input dark:hover:bg-input/50",secondary:"bg-secondary text-secondary-foreground hover:bg-secondary/80",ghost:"hover:bg-accent dark:hover:bg-accent/50",link:"text-primary underline-offset-4 hover:underline"},size:{default:"h-9 px-4 py-2 has-[>svg]:px-3",sm:"h-8 rounded-md gap-1.5 px-3 has-[>svg]:px-2.5",lg:"h-10 rounded-md px-6 has-[>svg]:px-4",icon:"size-9","icon-sm":"size-8","icon-lg":"size-10"}},defaultVariants:{variant:"default",size:"default"}});function L({className:s,variant:t,size:n,asChild:i=!1,...l}){const o=i?js:"button";return e.jsx(o,{"data-slot":"button",className:D(Bn({variant:t,size:n,className:s})),...l})}function Ln({className:s,...t}){return e.jsx("div",{"data-slot":"card",className:D("bg-card text-card-foreground flex flex-col gap-6 rounded-xl border py-6 shadow-sm",s),...t})}function Ia({className:s,...t}){return e.jsx("div",{"data-slot":"card-header",className:D("@container/card-header grid auto-rows-min grid-rows-[auto_auto] items-start gap-2 px-6 has-data-[slot=card-action]:grid-cols-[1fr_auto] [.border-b]:pb-6",s),...t})}function Fa({className:s,...t}){return e.jsx("div",{"data-slot":"card-title",className:D("leading-none font-semibold",s),...t})}function Ra({className:s,...t}){return e.jsx("div",{"data-slot":"card-description",className:D("text-muted-foreground text-sm",s),...t})}function _n({className:s,...t}){return e.jsx("div",{"data-slot":"card-content",className:D("px-6",s),...t})}const gt="glassEffectEnabled";function Tt(){const[s,t]=p(()=>{const i=localStorage.getItem(gt);return i!==null?i==="true":!0});return q(()=>{localStorage.setItem(gt,String(s))},[s]),{isEnabled:s,toggle:()=>{t(i=>!i)},setIsEnabled:t}}const zt=Ne.createContext({isComposing:()=>!1,setComposing:()=>{},justEndedComposing:()=>!1,markCompositionEnd:()=>{}}),at=()=>Ne.useContext(zt);function he({...s}){const t=Ne.useRef(!1),n=Ne.useRef(!1),i=Ne.useRef(null),l=Ne.useMemo(()=>({isComposing:()=>t.current,setComposing:o=>{t.current=o},justEndedComposing:()=>n.current,markCompositionEnd:()=>{n.current=!0,i.current&&clearTimeout(i.current),i.current=setTimeout(()=>{n.current=!1},150)}}),[]);return e.jsx(zt.Provider,{value:l,children:e.jsx(Ns,{"data-slot":"dialog",...s})})}function On({...s}){return e.jsx(Es,{"data-slot":"dialog-portal",...s})}function Mt({className:s,...t}){return e.jsx(As,{"data-slot":"dialog-overlay",className:D("data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 fixed inset-0 z-50 bg-black/50",s),...t})}Mt.displayName="DialogOverlay";function ge({className:s,children:t,showCloseButton:n=!0,onEscapeKeyDown:i,...l}){const{isComposing:o}=at(),c=Ne.useCallback(u=>{if(u.isComposing||o()){u.preventDefault();return}i?.(u)},[o,i]);return e.jsxs(On,{"data-slot":"dialog-portal",children:[e.jsx(Mt,{}),e.jsxs(Cs,{"data-slot":"dialog-content",className:D("bg-background data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 fixed top-0 left-0 right-0 bottom-0 z-50 flex flex-col w-full h-full border-0 shadow-lg duration-200 sm:top-[50%] sm:left-[50%] sm:right-auto sm:bottom-auto sm:translate-x-[-50%] sm:translate-y-[-50%] sm:max-w-lg sm:h-auto sm:max-h-[90vh] sm:rounded-lg sm:border sm:m-4 sm:flex sm:flex-col",s),onEscapeKeyDown:c,...l,children:[t,n&&e.jsxs(ks,{"data-slot":"dialog-close",className:"ring-offset-background focus:ring-ring data-[state=open]:bg-accent data-[state=open]:text-muted-foreground absolute top-4 right-4 rounded-xs opacity-70 transition-opacity hover:opacity-100 focus:ring-2 focus:ring-offset-2 focus:outline-hidden disabled:pointer-events-none [&_svg]:pointer-events-none [&_svg]:shrink-0 [&_svg:not([class*='size-'])]:size-4",children:[e.jsx(Le,{}),e.jsx("span",{className:"sr-only",children:"Close"})]})]})]})}function fe({className:s,...t}){return e.jsx("div",{"data-slot":"dialog-header",className:D("flex flex-col gap-2 text-center sm:text-left",s),...t})}function xe({className:s,...t}){return e.jsx("div",{"data-slot":"dialog-footer",className:D("flex flex-col-reverse gap-2 sm:flex-row sm:justify-end",s),...t})}function pe({className:s,...t}){return e.jsx(Ss,{"data-slot":"dialog-title",className:D("text-lg leading-none font-semibold",s),...t})}function Ta({className:s,...t}){return e.jsx(Ds,{"data-slot":"dialog-description",className:D("text-muted-foreground text-sm",s),...t})}const Un={maxRetries:3,initialDelay:1e3,maxDelay:1e4,backoffMultiplier:2,retryableErrors:["network","timeout","ECONNRESET","ETIMEDOUT","ENOTFOUND","EAI_AGAIN","500","502","503","504"]};function Kn(s,t){if(!s)return!1;const n=s.message?.toLowerCase()||"",i=s.code?.toLowerCase()||"",l=s.status?.toString()||"";return t.some(o=>{const c=o.toLowerCase();return n.includes(c)||i.includes(c)||l.includes(c)})}function Hn(s,t){const n=t.initialDelay*Math.pow(t.backoffMultiplier,s);return Math.min(n,t.maxDelay)}async function Wn(s,t={}){const n={...Un,...t};let i;for(let l=0;l<=n.maxRetries;l++)try{return await s()}catch(o){if(i=o,l>=n.maxRetries||!Kn(o,n.retryableErrors))break;const c=Hn(l,n);await new Promise(u=>setTimeout(u,c))}throw i}async function be(s,t,n={}){return Wn(async()=>(await s(t)).data,n)}const rt={maxRetries:3,initialDelay:1e3},Oe={maxRetries:2,initialDelay:500};function za(s){const[t,n]=p([]),[i,l]=p(!0),[o,c]=p(null),[u,f]=p(0);return q(()=>{(async()=>{try{l(!0);const k=(await F(R,"getReminders")(s||{})).data.reminders.map(y=>({...y,dueDate:y.dueDate?.toDate?y.dueDate.toDate():new Date(y.dueDate),createdAt:y.createdAt?.toDate?y.createdAt.toDate():new Date(y.createdAt),updatedAt:y.updatedAt?.toDate?y.updatedAt.toDate():new Date(y.updatedAt)}));n(k),c(null)}catch(m){c(m)}finally{l(!1)}})()},[s?.startDate,s?.endDate,s?.status,u]),{data:t,isLoading:i,error:o,refetch:()=>f(h=>h+1)}}async function Pt(s){const t=F(R,"createReminder");return be(t,s,rt)}async function Ma(s,t){const n=F(R,"updateReminder");await be(n,{id:s,...t},Oe)}async function Pa(s){const t=F(R,"deleteReminder");await be(t,{id:s},Oe)}function Ba(s){const[t,n]=p([]),[i,l]=p(!0),[o,c]=p(null),u=Y(async()=>{try{l(!0);const g=(await F(R,"getFinanceEntries")(s||{})).data.entries.map(w=>({...w,date:w.date?.toDate?w.date.toDate():new Date(w.date),createdAt:w.createdAt?.toDate?w.createdAt.toDate():new Date(w.createdAt),updatedAt:w.updatedAt?.toDate?w.updatedAt.toDate():new Date(w.updatedAt)}));n(g),c(null)}catch(d){c(d)}finally{l(!1)}},[s?.startDate,s?.endDate,s?.type]);q(()=>{u()},[u]);const f=Y(async()=>{await u()},[u]);return{data:t,isLoading:i,error:o,refetch:f}}async function Bt(s){const t=F(R,"createFinanceEntry");return be(t,s,rt)}async function La(s,t){const n=F(R,"updateFinanceEntry");await be(n,{id:s,...t},Oe)}function _a(s){const[t,n]=p([]),[i,l]=p(!0),[o,c]=p(null);return q(()=>{(async()=>{try{l(!0),c(null);const m=((await F(R,"getTaxProfiles")({})).data.profiles||[]).map(g=>({...g,createdAt:g.createdAt?.toDate?g.createdAt.toDate():g.createdAt?new Date(g.createdAt):new Date,updatedAt:g.updatedAt?.toDate?g.updatedAt.toDate():g.updatedAt?new Date(g.updatedAt):new Date}));n(m)}catch(f){console.error("Error fetching tax profiles:",f),c(f),n([])}finally{l(!1)}})()},[s]),{data:t,isLoading:i,error:o}}async function Oa(s){await F(R,"deleteTaxProfile")({id:s})}function Ua(){const[s,t]=p([]),[n,i]=p(!0),[l,o]=p(null);return q(()=>{(async()=>{try{i(!0);const h=(await F(R,"getPeople")({})).data.people.map(m=>({...m,createdAt:m.createdAt?.toDate?m.createdAt.toDate():new Date(m.createdAt),updatedAt:m.updatedAt?.toDate?m.updatedAt.toDate():new Date(m.updatedAt)}));t(h),o(null)}catch(u){o(u)}finally{i(!1)}})()},[]),{data:s,isLoading:n,error:l}}async function Ka(s){const t=F(R,"createPerson");return be(t,s,rt)}async function Ha(s,t){const n=F(R,"updatePerson");await be(n,{personId:s,...t},Oe)}async function Wa(s){const t=F(R,"deletePerson");await be(t,{personId:s},Oe)}function $a(s){const[t,n]=p([]),[i,l]=p(!0),[o,c]=p(null),[u,f]=p(0);return q(()=>{(async()=>{try{l(!0);const k=(await F(R,"getShoppingList")({status:s})).data.items.map(y=>({...y,boughtAt:y.boughtAt?.toDate?y.boughtAt.toDate():y.boughtAt?new Date(y.boughtAt):null,createdAt:y.createdAt?.toDate?y.createdAt.toDate():new Date(y.createdAt),updatedAt:y.updatedAt?.toDate?y.updatedAt.toDate():new Date(y.updatedAt)}));n(k),c(null)}catch(m){c(m)}finally{l(!1)}})()},[s,u]),{data:t,isLoading:i,error:o,refetch:()=>f(h=>h+1)}}async function $n(s){return(await F(R,"createShoppingItem")(s)).data}async function qa(s){await F(R,"deleteShoppingItem")({itemId:s})}async function Ga(s,t,n){return(await F(R,"markShoppingItemAsBought")({itemId:s,actualPrice:t,createExpense:n})).data}function qn(){const[s,t]=p([]),[n,i]=p(!0),[l,o]=p(null),{user:c}=Rt();return q(()=>{if(!c){t([]),i(!1);return}i(!0);const f=un(mn(Pn,"chatConversations"),d=>{try{const h=d.docs.filter(m=>m.data().userId===c.uid).map(m=>{const g=m.data();let w=new Date;g.createdAt&&(g.createdAt.toDate?w=g.createdAt.toDate().toISOString():typeof g.createdAt=="string"?w=g.createdAt:w=new Date(g.createdAt).toISOString());let k=new Date;return g.updatedAt&&(g.updatedAt.toDate?k=g.updatedAt.toDate().toISOString():typeof g.updatedAt=="string"?k=g.updatedAt:k=new Date(g.updatedAt).toISOString()),{id:m.id,userId:g.userId||c.uid,title:g.title||"Neue Konversation",messages:g.messages||[],createdAt:w,updatedAt:k}});h.sort((m,g)=>{const w=typeof m.updatedAt=="string"?new Date(m.updatedAt).getTime():m.updatedAt.getTime();return(typeof g.updatedAt=="string"?new Date(g.updatedAt).getTime():g.updatedAt.getTime())-w}),t(h),o(null)}catch(h){console.error("Error processing chat conversations:",h),o(h)}finally{i(!1)}},d=>{console.error("Firestore listener error:",d),o(d),i(!1)});return()=>f()},[c]),{data:s,isLoading:n,error:l,refetch:async()=>{if(c){i(!0);try{const d=await F(R,"getChatConversations")({});t(h=>[...h])}catch(f){o(f)}finally{i(!1)}}}}}function Lt(s,t){const[n,i]=p(null),[l,o]=p(!1),[c,u]=p(null);return q(()=>{if(!s){i(null);return}(async()=>{try{if(o(!0),u(null),!t)throw new Error("Location ist erforderlich. Bitte in den Einstellungen einen Standort eingeben.");const m=(await F(R,"getWeather")({date:s.toISOString(),location:t})).data,g=!1;if(m)i(m);else{const w=new Date;w.setHours(0,0,0,0);const k=new Date(s);k.setHours(0,0,0,0),k<w?u(new Error("Historische Wetterdaten sind nur aus dem Cache verfügbar.")):u(new Error("Keine Wetterdaten verfügbar. Bitte überprüfen Sie den Standort in den Einstellungen."))}}catch(d){console.error("[useWeather] Error:",d);const h=d?.message||d?.code||"Unbekannter Fehler beim Laden der Wetterdaten";u(new Error(h)),i(null)}finally{o(!1)}})()},[s,t]),{data:n,isLoading:l,error:c}}function _t(){const[s,t]=p(null),[n,i]=p(!0),[l,o]=p(null);q(()=>{(async()=>{try{i(!0),o(null);const h=(await F(R,"getUserSettings")({})).data;t(h)}catch(f){o(f)}finally{i(!1)}})()},[]);const c=Y(async u=>{try{return await F(R,"updateUserSettings")(u),t(d=>d?{...d,...u}:u),{success:!0}}catch(f){throw o(f),f}},[]);return{settings:s,isLoading:n,error:l,updateSettings:c}}async function Gn(s){return(await F(R,"createChatConversation")(s)).data}async function Vn(s,t){await F(R,"updateChatConversation")({id:s,...t})}async function Zn(){return(await F(R,"clearAllChatConversations")({})).data}function Jn({selectedDate:s}){const{settings:t,isLoading:n}=_t(),i=t?.weatherLocation||"Zurich, CH",{data:l,isLoading:o,error:c}=Lt(s,i);pt.useEffect(()=>{},[s,i,n,l,o,c]);const u=d=>{switch(d){case"sun":return e.jsx(jt,{className:"w-5 h-5"});case"cloud-sun":return e.jsx(wt,{className:"w-5 h-5"});case"cloud":return e.jsx(He,{className:"w-5 h-5"});case"rain":return e.jsx(Qe,{className:"w-5 h-5"});case"snow":return e.jsx(Qe,{className:"w-5 h-5"});default:return e.jsx(He,{className:"w-5 h-5"})}};if(!s)return null;const f=s.toLocaleDateString("de-CH",{weekday:"long",day:"numeric",month:"long"});return e.jsxs("div",{className:"p-3 border-b border-border",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("h4",{className:"text-xs font-semibold text-muted-foreground",children:"Wetter"}),e.jsx("span",{className:"text-[10px] text-muted-foreground",children:f})]}),o?e.jsx("div",{className:"flex items-center justify-center py-4",children:e.jsx("div",{className:"text-xs text-muted-foreground",children:"Lädt..."})}):l?e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[u(l.icon),e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-baseline gap-1",children:[e.jsxs("span",{className:"text-lg font-bold",children:[l.temperature,"°"]}),e.jsx("span",{className:"text-xs text-muted-foreground",children:"C"})]}),e.jsx("div",{className:"text-[10px] text-muted-foreground",children:l.condition})]})]}),l.humidity!==void 0&&l.windSpeed!==void 0&&e.jsxs("div",{className:"flex gap-3 text-[9px] text-muted-foreground pt-1 border-t border-border/50",children:[e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(yt,{className:"w-3 h-3"}),e.jsxs("span",{children:[l.windSpeed," km/h"]})]}),e.jsx("div",{children:e.jsxs("span",{children:["Luftfeuchtigkeit: ",l.humidity,"%"]})})]})]}):c?e.jsxs("div",{className:"space-y-1",children:[e.jsx("div",{className:"text-xs text-muted-foreground text-center py-2",children:c.message||"Fehler beim Laden der Wetterdaten"}),e.jsxs("div",{className:"text-[10px] text-muted-foreground/70 text-center",children:["Standort: ",i]})]}):n?e.jsx("div",{className:"flex items-center justify-center py-4",children:e.jsx("div",{className:"text-xs text-muted-foreground",children:"Lädt Einstellungen..."})}):e.jsxs("div",{className:"space-y-1",children:[e.jsx("div",{className:"text-xs text-muted-foreground text-center py-2",children:"Keine Wetterdaten verfügbar"}),e.jsxs("div",{className:"text-[10px] text-muted-foreground/70 text-center",children:["Standort: ",i]})]})]})}function Yn(){const[,s]=_e(),[t,n]=p(new Date),[i,l]=p([]),[o,c]=p(!1),[u,f]=p(null),[d,h]=p(null),[m,g]=p(!1),[w,k]=p(!1),[y,P]=p(!1),[T,G]=p(!1),{settings:V}=_t(),_=V?.weatherLocation||"Zurich, CH",U=u?new Date(u.getFullYear(),u.getMonth(),u.getDate()):null,{data:B,isLoading:se}=Lt(U,_);q(()=>{u||f(new Date)},[]);const re=["Januar","Februar","März","April","Mai","Juni","Juli","August","September","Oktober","November","Dezember"],j=["Mo","Di","Mi","Do","Fr","Sa","So"],v=Y(async()=>{try{c(!0);const a=F(R,"getCalendarEvents"),x=F(R,"getVacations"),N=F(R,"getSchoolSchedules"),M=F(R,"getSchoolHolidays"),S=new Date(t.getFullYear(),t.getMonth()-1,1),A=new Date(t.getFullYear(),t.getMonth()+2,0),[H,W,$,te]=await Promise.all([a({startDate:S.toISOString(),endDate:A.toISOString()}).catch(()=>({data:{events:[]}})),x({startDate:S.toISOString(),endDate:A.toISOString()}).catch(()=>({data:{vacations:[]}})),N({startDate:S.toISOString(),endDate:A.toISOString()}).catch(()=>({data:{schedules:[]}})),M({startDate:S.toISOString(),endDate:A.toISOString()}).catch(()=>({data:{holidays:[]}}))]),J=H.data,we=W.data,oe=$.data,ue=te.data,je=[...J.events||[],...(we.vacations||[]).map(Z=>({id:`vacation-${Z.id}`,type:"work",title:Z.title||"Ferien",date:Z.startDate,description:Z.description})),...(oe.schedules||[]).map(Z=>({id:`school-${Z.id}`,type:"school",title:Z.childName?`${Z.childName} - Schule`:"Schule",date:Z.date,schoolType:Z.type})),...(ue.holidays||[]).map(Z=>({id:`holiday-${Z.id}`,type:"school-holiday",title:Z.title||"Schulferien",date:Z.date}))];l(je)}catch{}finally{c(!1)}},[t]);q(()=>{v()},[v]);const E=a=>{const x=new Date(a),N=x.getDay(),M=x.getDate()-(N===0?6:N-1);return new Date(x.setDate(M))},z=ce(()=>{const a=E(t),x=[];for(let N=0;N<7;N++){const M=new Date(a);M.setDate(a.getDate()+N);const S=M.toISOString().split("T")[0];x.push({date:M,events:i.filter(A=>A.date===S)})}return x},[t,i]),K=()=>{const a=new Date(t);a.setDate(a.getDate()-7),n(a)},I=()=>{const a=new Date(t);a.setDate(a.getDate()+7),n(a)},ne=()=>{n(new Date)},ve=a=>{const x=new Date;return a.toDateString()===x.toDateString()},Se=a=>{f(a),g(!0)},ee=a=>{f(a)},ie=a=>{h(a),k(!0)},ye=ce(()=>{if(!u)return[];const a=u.toISOString().split("T")[0];return i.filter(x=>x.date===a)},[u,i]),de=a=>{switch(a){case"due":return"bg-pink-500";case"reminder":case"appointment":case"termin":return"bg-orange-500";case"work":return"bg-slate-400";case"vacation":case"frei":return"bg-emerald-400";case"school-holiday":return"bg-sky-400";case"school":return"bg-purple-400";case"hort":return"bg-fuchsia-500";default:return"bg-gray-500"}};return e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"p-2 border-b border-border",children:[e.jsxs("div",{className:"flex items-center justify-between mb-1.5",children:[e.jsx(L,{variant:"ghost",size:"sm",onClick:K,className:"h-5 w-5 p-0 min-w-0",children:e.jsx(Jt,{className:"w-3 h-3"})}),e.jsx("div",{className:"flex-1 text-center px-1",children:e.jsxs("h3",{className:"text-[11px] font-semibold leading-tight",children:[re[t.getMonth()]," ",t.getFullYear()]})}),e.jsx(L,{variant:"ghost",size:"sm",onClick:I,className:"h-5 w-5 p-0 min-w-0",children:e.jsx(Yt,{className:"w-3 h-3"})})]}),e.jsx("div",{className:"grid grid-cols-7 gap-0",children:j.map((a,x)=>{const N=z[x],M=N?ve(N.date):!1;return e.jsxs("div",{className:"flex flex-col items-center",children:[e.jsx("div",{className:"text-center text-[10px] font-medium text-muted-foreground mb-1 w-full",children:a}),N&&e.jsxs("button",{onClick:()=>{ee(N.date),Se(N.date)},className:D("w-full aspect-square min-h-[28px] max-h-[30px] rounded-sm transition-colors flex flex-col items-center justify-center relative","text-foreground",u&&N.date.toDateString()===u.toDateString()?"bg-primary/20 ring-1 ring-primary":M?"bg-primary text-primary-foreground font-semibold":"hover:bg-muted/50"),children:[e.jsx("span",{className:"text-[12px] leading-none font-medium",children:N.date.getDate()}),N.events.length>0&&e.jsx("div",{className:"absolute bottom-0.5 left-0 right-0 flex gap-0.5 justify-center",children:N.events.slice(0,2).map((S,A)=>e.jsx("div",{onClick:H=>{H.stopPropagation(),ie(S)},className:D("h-0.5 w-0.5 rounded-full",de(S.type)),title:S.title},A))})]})]},x)})}),e.jsx(L,{variant:"ghost",size:"sm",onClick:ne,className:"w-full h-6 mt-1.5 text-[10px]",children:"Heute"})]}),e.jsx(Jn,{selectedDate:u}),e.jsx(he,{open:m,onOpenChange:g,children:e.jsxs(ge,{className:"!fixed !top-[50%] !left-[50%] !right-auto !bottom-auto !translate-x-[-50%] !translate-y-[-50%] !w-[85vw] !max-w-sm !max-h-[85vh] !rounded-3xl !m-0 !overflow-y-auto !shadow-2xl",children:[e.jsx(fe,{className:"px-5 pt-5 pb-3 sticky top-0 bg-background z-10 border-b border-border",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx(pe,{className:"text-lg font-semibold",children:u?.toLocaleDateString("de-CH",{weekday:"long",day:"numeric",month:"long",year:"numeric"})}),e.jsx(L,{variant:"ghost",size:"sm",onClick:()=>g(!1),className:"h-8 w-8 p-0",children:e.jsx(Le,{className:"h-4 w-4"})})]})}),e.jsxs("div",{className:"space-y-4 px-5 pb-2",children:[e.jsxs("div",{className:"bg-muted/30 rounded-xl p-4 space-y-3",children:[e.jsx("div",{className:"flex items-center justify-between",children:e.jsxs("h3",{className:"text-sm font-semibold flex items-center gap-2",children:[e.jsx(He,{className:"w-4 h-4"}),"Wetter"]})}),se?e.jsx("div",{className:"flex items-center justify-center py-4",children:e.jsx("div",{className:"text-xs text-muted-foreground",children:"Lädt Wetterdaten..."})}):B?e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[B.icon==="sun"&&e.jsx(jt,{className:"w-6 h-6 text-yellow-500"}),B.icon==="cloud-sun"&&e.jsx(wt,{className:"w-6 h-6 text-gray-500"}),B.icon==="cloud"&&e.jsx(He,{className:"w-6 h-6 text-gray-500"}),B.icon==="rain"&&e.jsx(Qe,{className:"w-6 h-6 text-blue-500"}),e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-baseline gap-1",children:[e.jsxs("span",{className:"text-2xl font-bold",children:[B.temperature,"°"]}),e.jsx("span",{className:"text-sm text-muted-foreground",children:"C"})]}),e.jsx("div",{className:"text-xs text-muted-foreground",children:B.condition})]})]}),(B.humidity!==void 0||B.windSpeed!==void 0)&&e.jsxs("div",{className:"flex gap-4 text-xs text-muted-foreground pt-2 border-t border-border/50",children:[B.windSpeed!==void 0&&e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(yt,{className:"w-3 h-3"}),e.jsxs("span",{children:[B.windSpeed," km/h"]})]}),B.humidity!==void 0&&e.jsx("div",{children:e.jsxs("span",{children:["Luftfeuchtigkeit: ",B.humidity,"%"]})})]})]}):e.jsx("div",{className:"text-xs text-muted-foreground text-center py-2",children:"Keine Wetterdaten verfügbar"})]}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-sm font-semibold mb-2",children:"Termine & Events"}),ye.length===0?e.jsx("p",{className:"text-sm text-muted-foreground text-center py-4 bg-muted/30 rounded-lg",children:"Keine Events an diesem Tag"}):e.jsx("div",{className:"space-y-2",children:ye.map(a=>e.jsx(Ln,{className:"cursor-pointer hover:bg-muted/50 transition-colors",onClick:()=>{g(!1),ie(a)},children:e.jsx(_n,{className:"p-3",children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("div",{className:D("w-3 h-3 rounded-full mt-1 flex-shrink-0",de(a.type))}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("p",{className:"font-medium text-sm truncate",children:a.title}),a.time&&e.jsx("p",{className:"text-xs text-muted-foreground mt-1",children:a.time}),a.personName&&e.jsx("p",{className:"text-xs text-muted-foreground mt-1",children:a.personName})]})]})})},a.id))})]}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-sm font-semibold mb-2",children:"Schnellaktionen"}),e.jsxs("div",{className:"grid grid-cols-2 gap-2",children:[e.jsxs(L,{variant:"outline",onClick:()=>{P(!0)},className:"h-auto py-3 flex flex-col items-center gap-2 rounded-xl",children:[e.jsx(Xt,{className:"w-5 h-5"}),e.jsx("span",{className:"text-xs",children:"Termin erstellen"})]}),e.jsxs(L,{variant:"outline",onClick:()=>{G(!0)},className:"h-auto py-3 flex flex-col items-center gap-2 rounded-xl",children:[e.jsx(Ce,{className:"w-5 h-5"}),e.jsx("span",{className:"text-xs",children:"Finanz-Eintrag"})]})]})]})]}),e.jsxs(xe,{className:"px-5 pb-3 pt-2 sticky bottom-0 bg-background border-t border-border",children:[e.jsx(L,{variant:"outline",onClick:()=>{try{g(!1),setTimeout(()=>{try{s("/calendar")}catch(a){console.error("Navigation error:",a),b.error("Fehler beim Navigieren zum Kalender")}},100)}catch(a){console.error("Dialog close error:",a),b.error("Fehler beim Schließen des Dialogs")}},className:"h-11 min-h-[44px] flex-1 rounded-xl text-sm font-medium",children:"Zum Kalender"}),e.jsx(L,{variant:"default",onClick:()=>g(!1),className:"h-11 min-h-[44px] flex-1 rounded-xl text-sm font-medium",children:"Schließen"})]})]})}),e.jsx(he,{open:y,onOpenChange:P,children:e.jsxs(ge,{className:"!fixed !top-[50%] !left-[50%] !right-auto !bottom-auto !translate-x-[-50%] !translate-y-[-50%] !w-[85vw] !max-w-sm !max-h-fit !rounded-3xl !m-0 !overflow-visible !shadow-2xl",children:[e.jsx(fe,{className:"px-5 pt-5 pb-3",children:e.jsx(pe,{className:"text-lg font-semibold",children:"Termin erstellen"})}),e.jsxs("div",{className:"px-5 pb-2 space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium mb-1 block",children:"Titel"}),e.jsx("input",{type:"text",id:"reminder-title",placeholder:"z.B. Arzttermin",className:"w-full px-3 py-2 border border-border rounded-lg text-sm",autoFocus:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium mb-1 block",children:"Datum"}),e.jsx("input",{type:"date",id:"reminder-date",defaultValue:u?.toISOString().split("T")[0],className:"w-full px-3 py-2 border border-border rounded-lg text-sm"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium mb-1 block",children:"Uhrzeit (optional)"}),e.jsx("input",{type:"time",id:"reminder-time",className:"w-full px-3 py-2 border border-border rounded-lg text-sm"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium mb-1 block",children:"Notizen (optional)"}),e.jsx("textarea",{id:"reminder-notes",placeholder:"Weitere Details...",rows:3,className:"w-full px-3 py-2 border border-border rounded-lg text-sm resize-none"})]})]}),e.jsxs(xe,{className:"px-5 pb-3 pt-2",children:[e.jsx(L,{variant:"outline",onClick:()=>P(!1),className:"h-11 min-h-[44px] flex-1 rounded-xl text-sm font-medium",children:"Abbrechen"}),e.jsx(L,{variant:"default",onClick:async()=>{try{const a=document.getElementById("reminder-title"),x=document.getElementById("reminder-date"),N=document.getElementById("reminder-time"),M=document.getElementById("reminder-notes");if(!a.value.trim()){b.error("Bitte gib einen Titel ein");return}const S=new Date(x.value);if(N.value){const[A,H]=N.value.split(":");S.setHours(parseInt(A),parseInt(H))}else S.setHours(12,0);await Pt({title:a.value.trim(),type:"termin",dueDate:S,isAllDay:!N.value,notes:M.value.trim()||null}),b.success("Termin erstellt"),P(!1),g(!1),v()}catch(a){b.error(a.message||"Fehler beim Erstellen des Termins")}},className:"h-11 min-h-[44px] flex-1 rounded-xl text-sm font-medium",children:"Erstellen"})]})]})}),e.jsx(he,{open:T,onOpenChange:G,children:e.jsxs(ge,{className:"!fixed !top-[50%] !left-[50%] !right-auto !bottom-auto !translate-x-[-50%] !translate-y-[-50%] !w-[85vw] !max-w-sm !max-h-fit !rounded-3xl !m-0 !overflow-visible !shadow-2xl",children:[e.jsx(fe,{className:"px-5 pt-5 pb-3",children:e.jsx(pe,{className:"text-lg font-semibold",children:"Finanz-Eintrag erstellen"})}),e.jsxs("div",{className:"px-5 pb-2 space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium mb-1 block",children:"Beschreibung"}),e.jsx("input",{type:"text",id:"finance-description",placeholder:"z.B. Einkauf, Gehalt",className:"w-full px-3 py-2 border border-border rounded-lg text-sm",autoFocus:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium mb-1 block",children:"Betrag (CHF)"}),e.jsx("input",{type:"number",id:"finance-amount",placeholder:"0.00",step:"0.01",className:"w-full px-3 py-2 border border-border rounded-lg text-sm"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium mb-1 block",children:"Typ"}),e.jsxs("select",{id:"finance-type",className:"w-full px-3 py-2 border border-border rounded-lg text-sm",children:[e.jsx("option",{value:"einnahme",children:"Einnahme"}),e.jsx("option",{value:"ausgabe",children:"Ausgabe"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium mb-1 block",children:"Datum"}),e.jsx("input",{type:"date",id:"finance-date",defaultValue:u?.toISOString().split("T")[0],className:"w-full px-3 py-2 border border-border rounded-lg text-sm"})]})]}),e.jsxs(xe,{className:"px-5 pb-3 pt-2",children:[e.jsx(L,{variant:"outline",onClick:()=>G(!1),className:"h-11 min-h-[44px] flex-1 rounded-xl text-sm font-medium",children:"Abbrechen"}),e.jsx(L,{variant:"default",onClick:async()=>{try{const a=document.getElementById("finance-description"),x=document.getElementById("finance-amount"),N=document.getElementById("finance-type"),M=document.getElementById("finance-date");if(!a.value.trim()){b.error("Bitte gib eine Beschreibung ein");return}if(!x.value||parseFloat(x.value)<=0){b.error("Bitte gib einen gültigen Betrag ein");return}await Bt({description:a.value.trim(),amount:Math.round(parseFloat(x.value)*100),type:N.value,date:new Date(M.value),category:"Sonstiges",currency:"CHF",isRecurring:!1}),b.success("Finanz-Eintrag erstellt"),G(!1),g(!1)}catch(a){b.error(a.message||"Fehler beim Erstellen des Finanz-Eintrags")}},className:"h-11 min-h-[44px] flex-1 rounded-xl text-sm font-medium",children:"Erstellen"})]})]})}),e.jsx(he,{open:w,onOpenChange:k,children:e.jsxs(ge,{className:"!fixed !top-[50%] !left-[50%] !right-auto !bottom-auto !translate-x-[-50%] !translate-y-[-50%] !w-[85vw] !max-w-sm !max-h-fit !rounded-3xl !m-0 !overflow-visible !shadow-2xl",children:[e.jsx(fe,{className:"px-5 pt-5 pb-3",children:e.jsx(pe,{className:"text-lg font-semibold",children:d?.title})}),e.jsxs("div",{className:"space-y-3 px-5 pb-2",children:[d?.date&&e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-muted-foreground mb-1",children:"Datum"}),e.jsx("p",{className:"text-sm",children:new Date(d.date).toLocaleDateString("de-CH",{weekday:"long",day:"numeric",month:"long",year:"numeric"})})]}),d?.time&&e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-muted-foreground mb-1",children:"Uhrzeit"}),e.jsx("p",{className:"text-sm",children:d.time})]}),d?.description&&e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-muted-foreground mb-1",children:"Beschreibung"}),e.jsx("p",{className:"text-sm",children:d.description})]}),d?.personName&&e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-muted-foreground mb-1",children:"Person"}),e.jsx("p",{className:"text-sm",children:d.personName})]}),d?.amount&&e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-muted-foreground mb-1",children:"Betrag"}),e.jsxs("p",{className:"text-sm",children:["CHF ",d.amount.toFixed(2)]})]})]}),e.jsxs(xe,{className:"px-5 pb-3 pt-2",children:[e.jsx(L,{variant:"outline",onClick:()=>{k(!1),s("/calendar")},className:"h-11 min-h-[44px] w-full rounded-xl text-sm font-medium",children:"Zum Kalender"}),e.jsx(L,{variant:"outline",onClick:()=>k(!1),className:"h-11 min-h-[44px] w-full rounded-xl text-sm font-medium",children:"Schließen"})]})]})})]})}const Xn=[{path:"/",icon:Qt,label:"Assistent"},{path:"/dashboard",icon:st,label:"Dashboard"},{path:"/calendar",icon:nt,label:"Kalender"},{path:"/reminders",icon:qe,label:"Erinnerungen"},{path:"/finance",icon:Ce,label:"Finanzen"},{path:"/people",icon:We,label:"Personen"},{path:"/bills",icon:Re,label:"Rechnungen"},{path:"/documents",icon:Te,label:"Dokumente"},{path:"/shopping",icon:Be,label:"Einkaufen"},{path:"/taxes",icon:Nt,label:"Steuern"},{path:"/settings",icon:$e,label:"Einstellungen"}];function Qn({open:s,onClose:t,currentChatId:n,onSelectChat:i,onNewChat:l}){const[o]=_e(),{user:c}=Rt(),{isEnabled:u}=Tt(),f=()=>{if(c?.displayName){const d=c.displayName.split(" ");return d.length>=2?(d[0][0]+d[1][0]).toUpperCase():c.displayName.substring(0,2).toUpperCase()}return c?.email?c.email.substring(0,2).toUpperCase():"U"};return e.jsxs(e.Fragment,{children:[s&&e.jsx("div",{className:D("fixed inset-0 z-40 transition-opacity",u?"bg-black/5":"bg-black/50"),onClick:t}),e.jsx("aside",{className:D("fixed top-0 left-0 h-full w-full max-w-sm z-50 transform transition-transform duration-300 ease-in-out shadow-xl",s?"translate-x-0":"-translate-x-full",u?"bg-background/95 backdrop-blur-md":"bg-background"),"aria-label":"Hauptnavigation","aria-hidden":!s,children:e.jsxs("div",{className:"flex flex-col h-full",children:[e.jsx("div",{className:"p-4 border-b border-border",children:e.jsxs("div",{className:"flex items-center gap-3 mb-3",children:[e.jsx("button",{onClick:t,className:"p-2 hover:bg-muted rounded-lg transition-colors","aria-label":"Menü schließen",children:e.jsx(Le,{className:"w-5 h-5"})}),e.jsx("h2",{className:"text-lg font-semibold flex-1",children:"Menü"})]})}),e.jsxs("div",{className:"flex-1 overflow-y-auto",children:[e.jsxs("div",{className:"p-4 border-b border-border",children:[e.jsx("h3",{className:"text-xs font-semibold text-muted-foreground uppercase tracking-wider mb-3",children:"Navigation"}),e.jsx("nav",{className:"space-y-1",children:Xn.map(d=>{const h=d.icon,m=o===d.path;return e.jsx(ws,{href:d.path,children:e.jsxs("button",{onClick:t,className:D("w-full flex items-center gap-3 px-3 py-2.5 rounded-lg transition-colors text-left min-h-[44px]",m?"bg-primary/10 text-primary font-medium":"text-foreground hover:bg-muted"),"aria-label":`Zu ${d.label} navigieren`,"aria-current":m?"page":void 0,"aria-pressed":m,type:"button",role:"menuitem",children:[e.jsx(h,{className:"w-5 h-5 flex-shrink-0","aria-hidden":"true"}),e.jsx("span",{className:"text-sm",children:d.label})]})},d.path)})})]}),e.jsx(Yn,{})]}),e.jsx("div",{className:"p-4 border-t border-border",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-10 h-10 rounded-full bg-primary text-primary-foreground flex items-center justify-center flex-shrink-0 text-sm font-medium",children:c?.photoURL?e.jsx("img",{src:c.photoURL,alt:c?.displayName||"Benutzerprofilbild",className:"w-10 h-10 rounded-full object-cover"}):e.jsx("span",{"aria-label":"Benutzerinitialen",children:f()})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("p",{className:"text-sm font-medium truncate",children:c?.displayName||"Benutzer"}),e.jsx("p",{className:"text-xs text-muted-foreground truncate",children:c?.email||"Nicht angemeldet"})]})]})})]})})]})}function Ot(){return qn()}async function Ze(s){try{if(s.id&&!s.id.startsWith("chat_"))await Vn(s.id,{title:s.title,messages:s.messages});else{const t=await Gn({title:s.title,messages:s.messages});s.id=t.id}}catch(t){throw t}}async function ea(){try{return{deletedCount:(await Zn()).deletedCount}}catch(s){throw s}}function Je(s,t){return t.find(n=>n.id===s)||null}function ta(s){return s.length<=50?s:s.substring(0,50)+"..."}function ft(){const s=`chat_${Date.now()}_${Math.random().toString(36).substring(2,9)}`,t=new Date().toISOString();return{id:s,userId:"",title:"Neue Konversation",messages:[],createdAt:t,updatedAt:t}}function sa({title:s,showSidebar:t=!1,showQuickActions:n=!1,quickActions:i=[],currentChatId:l,onSelectChat:o,onNewChat:c,sidebarOpen:u,onSidebarToggle:f}){_e();const[d,h]=p(!1),{isEnabled:m}=Tt(),[g,w]=p(!1),[k,y]=p(!1),[P,T]=p(!1),{data:G,refetch:V}=Ot(),_=O(null),U=u!==void 0?u:d,B=f||h;q(()=>{g&&V()},[g,V]),q(()=>{const j=v=>{_.current&&!_.current.contains(v.target)&&w(!1)};return document.addEventListener("mousedown",j),()=>document.removeEventListener("mousedown",j)},[]);const se=j=>{const v=typeof j=="string"?new Date(j):typeof j=="number"?new Date(j):j,z=new Date().getTime()-v.getTime(),K=Math.floor(z/(1e3*60*60*24));return K===0?"Heute":K===1?"Gestern":K<7?`${K} Tage`:v.toLocaleDateString("de-DE",{day:"2-digit",month:"2-digit"})},re=async()=>{if(G.length===0){b.info("Keine Chats zum Löschen vorhanden");return}T(!0);try{const j=await ea();b.success(`${j.deletedCount} Chat${j.deletedCount!==1?"s":""} gelöscht`),y(!1),w(!1),await V(),c&&c()}catch(j){console.error("Fehler beim Löschen aller Chats:",j),b.error("Fehler beim Löschen der Chats")}finally{T(!1)}};return e.jsxs(e.Fragment,{children:[t&&e.jsx(Qn,{open:U,onClose:()=>B(!1),currentChatId:l,onSelectChat:o,onNewChat:c}),e.jsx("header",{className:D("fixed top-0 left-0 right-0 z-40 border-b safe-top",m?"bg-background/95 backdrop-blur-md border-border/30":"bg-background border-border"),children:e.jsxs("div",{className:"px-4 h-14 flex items-center gap-3",children:[e.jsx("div",{className:"flex-1 flex items-center justify-center",children:e.jsx("h1",{className:"text-lg font-semibold text-center",children:s})}),c&&e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{onClick:()=>{c&&c()},className:"p-2 hover:bg-muted rounded-lg transition-colors","aria-label":"Neue Konversation",children:e.jsx(es,{className:"w-5 h-5"})}),e.jsxs("div",{className:"relative",ref:_,children:[e.jsx("button",{onClick:()=>{w(!g),g||V()},className:"p-2 hover:bg-muted rounded-lg transition-colors","aria-label":"Chat-Verlauf",children:e.jsx(ts,{className:"w-5 h-5"})}),g&&e.jsxs("div",{className:"absolute top-full right-0 mt-2 w-72 bg-background border border-border rounded-lg shadow-lg z-50 overflow-hidden max-h-[60vh] flex flex-col",children:[e.jsxs("div",{className:"p-3 border-b border-border flex items-center justify-between",children:[e.jsx("h3",{className:"text-sm font-semibold",children:"Chat-Verlauf"}),e.jsx("button",{onClick:()=>w(!1),className:"p-1 hover:bg-muted rounded transition-colors",children:e.jsx(Le,{className:"w-4 h-4"})})]}),e.jsx("div",{className:"overflow-y-auto",children:G.length===0?e.jsx("p",{className:"text-sm text-muted-foreground py-4 px-3 text-center",children:"Noch keine Konversationen"}):e.jsx("div",{className:"p-2",children:G.map(j=>{const v=l===j.id;return e.jsx("button",{onClick:()=>{o&&o(j.id),w(!1)},className:D("w-full flex items-center justify-between gap-2 px-3 py-2.5 rounded-lg transition-colors text-left",v?"bg-primary/10 text-primary":"hover:bg-muted"),children:e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("p",{className:D("text-sm truncate",v&&"font-medium"),children:j.title}),e.jsx("p",{className:"text-xs text-muted-foreground mt-0.5",children:se(j.updatedAt)})]})},j.id)})})}),G.length>0&&e.jsx("div",{className:"p-3 border-t border-border",children:e.jsxs("button",{onClick:()=>y(!0),className:"w-full flex items-center justify-center gap-2 px-3 py-2 rounded-lg bg-destructive/10 hover:bg-destructive/20 text-destructive transition-colors text-sm font-medium",disabled:P,children:[e.jsx(ss,{className:"w-4 h-4"}),e.jsx("span",{children:"Alle löschen"})]})})]})]})]})]})}),k&&e.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black/50 p-4",children:e.jsxs("div",{className:"bg-background border border-border rounded-lg shadow-lg max-w-sm w-full p-6",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[e.jsx("div",{className:"p-2 rounded-full bg-destructive/10",children:e.jsx(ns,{className:"w-5 h-5 text-destructive"})}),e.jsx("h3",{className:"text-lg font-semibold",children:"Alle Chats löschen?"})]}),e.jsxs("p",{className:"text-sm text-muted-foreground mb-6",children:["Diese Aktion kann nicht rückgängig gemacht werden. Alle ",G.length," Chat",G.length!==1?"s":""," werden permanent gelöscht."]}),e.jsxs("div",{className:"flex gap-3",children:[e.jsx("button",{onClick:()=>y(!1),className:"flex-1 px-4 py-2 rounded-lg border border-border hover:bg-muted transition-colors text-sm font-medium",disabled:P,children:"Abbrechen"}),e.jsx("button",{onClick:re,className:"flex-1 px-4 py-2 rounded-lg bg-destructive text-destructive-foreground hover:bg-destructive/90 transition-colors text-sm font-medium",disabled:P,children:P?"Löschen...":"Ja, alle löschen"})]})]})})]})}function Ue(s){const t=O(s);t.current=s;const n=O(null);return n.current||(n.current=function(...i){return t.current.apply(this,i)}),n.current}function Ut(s={}){const{onKeyDown:t,onCompositionStart:n,onCompositionEnd:i}=s,l=O(!1),o=O(null),c=O(null),u=Ue(m=>{o.current&&(clearTimeout(o.current),o.current=null),c.current&&(clearTimeout(c.current),c.current=null),l.current=!0,n?.(m)}),f=Ue(m=>{o.current=setTimeout(()=>{c.current=setTimeout(()=>{l.current=!1})}),i?.(m)}),d=Ue(m=>{if(l.current&&(m.key==="Escape"||m.key==="Enter"&&!m.shiftKey)){m.stopPropagation();return}t?.(m)}),h=Ue(()=>l.current);return{onCompositionStart:u,onCompositionEnd:f,onKeyDown:d,isComposing:h}}function me({className:s,type:t,onKeyDown:n,onCompositionStart:i,onCompositionEnd:l,...o}){const c=at(),{onCompositionStart:u,onCompositionEnd:f,onKeyDown:d}=Ut({onKeyDown:h=>{const m=h.nativeEvent.isComposing||c.justEndedComposing();h.key==="Enter"&&m||n?.(h)},onCompositionStart:h=>{c.setComposing(!0),i?.(h)},onCompositionEnd:h=>{c.markCompositionEnd(),setTimeout(()=>{c.setComposing(!1)},100),l?.(h)}});return e.jsx("input",{type:t,"data-slot":"input",className:D("file:text-foreground placeholder:text-muted-foreground selection:bg-primary selection:text-primary-foreground dark:bg-input/30 border-input h-9 w-full min-w-0 rounded-md border bg-transparent px-3 py-1 text-base shadow-xs transition-[color,box-shadow] outline-none file:inline-flex file:h-7 file:border-0 file:bg-transparent file:text-sm file:font-medium disabled:pointer-events-none disabled:cursor-not-allowed disabled:opacity-50 md:text-sm","focus-visible:border-ring focus-visible:ring-ring/50 focus-visible:ring-[3px]","aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive",s),onCompositionStart:u,onCompositionEnd:f,onKeyDown:d,...o})}function Q({className:s,...t}){return e.jsx(Is,{"data-slot":"label",className:D("flex items-center gap-2 text-sm leading-none font-medium select-none group-data-[disabled=true]:pointer-events-none group-data-[disabled=true]:opacity-50 peer-disabled:cursor-not-allowed peer-disabled:opacity-50",s),...t})}function Ee({...s}){return e.jsx(Fs,{"data-slot":"select",...s})}function Ae({...s}){return e.jsx(zs,{"data-slot":"select-value",...s})}function Ie({className:s,size:t="default",children:n,...i}){return e.jsxs(Rs,{"data-slot":"select-trigger","data-size":t,className:D("border-input data-[placeholder]:text-muted-foreground [&_svg:not([class*='text-'])]:text-muted-foreground focus-visible:border-ring focus-visible:ring-ring/50 aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive dark:bg-input/30 dark:hover:bg-input/50 flex w-fit items-center justify-between gap-2 rounded-md border bg-transparent px-3 py-2 text-sm whitespace-nowrap shadow-xs transition-[color,box-shadow] outline-none focus-visible:ring-[3px] disabled:cursor-not-allowed disabled:opacity-50 data-[size=default]:h-9 data-[size=sm]:h-8 *:data-[slot=select-value]:line-clamp-1 *:data-[slot=select-value]:flex *:data-[slot=select-value]:items-center *:data-[slot=select-value]:gap-2 [&_svg]:pointer-events-none [&_svg]:shrink-0 [&_svg:not([class*='size-'])]:size-4",s),...i,children:[n,e.jsx(Ts,{asChild:!0,children:e.jsx(Ct,{className:"size-4 opacity-50"})})]})}function Fe({className:s,children:t,position:n="popper",align:i="center",...l}){return e.jsx(Ms,{children:e.jsxs(Ps,{"data-slot":"select-content",className:D("bg-popover text-popover-foreground data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 relative z-50 max-h-(--radix-select-content-available-height) min-w-[8rem] origin-(--radix-select-content-transform-origin) overflow-x-hidden overflow-y-auto rounded-md border shadow-md",n==="popper"&&"data-[side=bottom]:translate-y-1 data-[side=left]:-translate-x-1 data-[side=right]:translate-x-1 data-[side=top]:-translate-y-1",s),position:n,align:i,...l,children:[e.jsx(na,{}),e.jsx(Bs,{className:D("p-1",n==="popper"&&"h-[var(--radix-select-trigger-height)] w-full min-w-[var(--radix-select-trigger-width)] scroll-my-1"),children:t}),e.jsx(aa,{})]})})}function ae({className:s,children:t,...n}){return e.jsxs(Ls,{"data-slot":"select-item",className:D("focus:bg-accent focus:text-accent-foreground [&_svg:not([class*='text-'])]:text-muted-foreground relative flex w-full cursor-default items-center gap-2 rounded-sm py-1.5 pr-8 pl-2 text-sm outline-hidden select-none data-[disabled]:pointer-events-none data-[disabled]:opacity-50 [&_svg]:pointer-events-none [&_svg]:shrink-0 [&_svg:not([class*='size-'])]:size-4 *:[span]:last:flex *:[span]:last:items-center *:[span]:last:gap-2",s),...n,children:[e.jsx("span",{className:"absolute right-2 flex size-3.5 items-center justify-center",children:e.jsx(_s,{children:e.jsx(kt,{className:"size-4"})})}),e.jsx(Os,{children:t})]})}function na({className:s,...t}){return e.jsx(Us,{"data-slot":"select-scroll-up-button",className:D("flex cursor-default items-center justify-center py-1",s),...t,children:e.jsx(as,{className:"size-4"})})}function aa({className:s,...t}){return e.jsx(Ks,{"data-slot":"select-scroll-down-button",className:D("flex cursor-default items-center justify-center py-1",s),...t,children:e.jsx(Ct,{className:"size-4"})})}function ra({className:s,...t}){return e.jsx(Hs,{"data-slot":"switch",className:D("peer data-[state=checked]:bg-primary data-[state=unchecked]:bg-input focus-visible:border-ring focus-visible:ring-ring/50 dark:data-[state=unchecked]:bg-input/80 inline-flex h-[1.15rem] w-8 shrink-0 items-center rounded-full border border-transparent shadow-xs transition-all outline-none focus-visible:ring-[3px] disabled:cursor-not-allowed disabled:opacity-50",s),...t,children:e.jsx(Ws,{"data-slot":"switch-thumb",className:D("bg-background dark:data-[state=unchecked]:bg-foreground dark:data-[state=checked]:bg-primary-foreground pointer-events-none block size-4 rounded-full ring-0 transition-transform data-[state=checked]:translate-x-[calc(100%-2px)] data-[state=unchecked]:translate-x-0")})})}const ia={light:10,medium:20,heavy:30,success:[50,50,50],error:[100,50,100],warning:[50,100,50],selection:5};function it(s="medium"){if(!navigator.vibrate)return;const t=ia[s];try{navigator.vibrate(t)}catch{}}function Ye(){it("success")}function oa(){it("error")}function Va(){it("selection")}function la(s){const t=s,n=t?.data?.requestId||t?.requestId||null;if(t?.code==="unavailable"||t?.message?.includes("network")||t?.message?.includes("fetch"))return{title:"Verbindungsfehler",message:"Keine Internetverbindung. Bitte überprüfen Sie Ihre Netzwerkverbindung und versuchen Sie es erneut.",action:"Erneut versuchen",retryable:!0};if(t?.code==="deadline-exceeded"||t?.message?.includes("timeout"))return{title:"Zeitüberschreitung",message:"Die Anfrage hat zu lange gedauert. Bitte versuchen Sie es erneut.",action:"Erneut versuchen",retryable:!0};if(t?.code==="permission-denied"||t?.message?.includes("permission"))return{title:"Berechtigung verweigert",message:"Sie haben keine Berechtigung für diese Aktion. Bitte kontaktieren Sie den Administrator.",retryable:!1};if(t?.code==="unauthenticated"||t?.message?.includes("auth")||t?.message?.includes("login"))return{title:"Anmeldung erforderlich",message:"Bitte melden Sie sich an, um fortzufahren.",action:"Anmelden",retryable:!1};if(t?.code==="not-found"||t?.message?.includes("not found"))return{title:"Nicht gefunden",message:"Die angeforderte Ressource wurde nicht gefunden.",retryable:!1};if(t?.code==="invalid-argument"||t?.message?.includes("validation")||t?.message?.includes("invalid"))return{title:"Ungültige Eingabe",message:t?.message||"Bitte überprüfen Sie Ihre Eingabe und versuchen Sie es erneut.",retryable:!1};if(t?.code==="resource-exhausted"||t?.message?.includes("quota"))return{title:"Kontingent überschritten",message:"Das Tageslimit wurde erreicht. Bitte versuchen Sie es später erneut.",retryable:!1};if(t?.message?.includes("billing")||t?.message?.includes("Billing"))return{title:"Abrechnungsfehler",message:"Google Cloud Billing ist erforderlich. Bitte kontaktieren Sie den Administrator.",retryable:!1};if(t?.code?.startsWith("functions/"))return{title:"Server-Fehler",message:`Ein Fehler ist aufgetreten: ${t.code.replace("functions/","")}. Bitte versuchen Sie es später erneut.`,action:"Erneut versuchen",retryable:!0};let i=t?.message||t?.toString()||"Ein unbekannter Fehler ist aufgetreten.";return n&&(i+=`

Request ID: ${n.substring(0,8)}...`),{title:"Fehler",message:i.length>200?`${i.substring(0,200)}...`:i,action:"Erneut versuchen",retryable:!0,requestId:n||void 0}}function ca(s){return la(s).message}function da({className:s,children:t,...n}){return e.jsxs($s,{"data-slot":"scroll-area",className:D("relative",s),...n,children:[e.jsx(qs,{"data-slot":"scroll-area-viewport",className:"focus-visible:ring-ring/50 size-full rounded-[inherit] transition-[color,box-shadow] outline-none focus-visible:ring-[3px] focus-visible:outline-1",children:t}),e.jsx(ua,{}),e.jsx(Gs,{})]})}function ua({className:s,orientation:t="vertical",...n}){return e.jsx(Vs,{"data-slot":"scroll-area-scrollbar",orientation:t,className:D("hidden opacity-0 w-0 h-0 invisible pointer-events-none",s),...n,children:e.jsx(Zs,{"data-slot":"scroll-area-thumb",className:"hidden opacity-0 w-0 h-0"})})}const ma={"layout-dashboard":st,calendar:nt,bell:qe,wallet:Ce,users:We,"file-text":Nt,folder:Te,"scan-line":Te,"shopping-cart":Be,receipt:Re,"clipboard-list":Re,settings:$e,check:kt,plus:St,search:bs,edit:ps,trash:xs,clock:fs,euro:gs,"trending-up":hs,"trending-down":ms,info:us,"alert-circle":ds},ha={dashboard:{path:"/",icon:st},calendar:{path:"/calendar",icon:nt},reminders:{path:"/reminders",icon:qe},finances:{path:"/finance",icon:Ce},finance:{path:"/finance",icon:Ce},finanzen:{path:"/finance",icon:Ce},people:{path:"/people",icon:We},personen:{path:"/people",icon:We},invoices:{path:"/bills",icon:Re},bills:{path:"/bills",icon:Re},rechnungen:{path:"/bills",icon:Re},documents:{path:"/documents",icon:Te},dokumente:{path:"/documents",icon:Te},shopping:{path:"/shopping",icon:Be},einkaufsliste:{path:"/shopping",icon:Be},settings:{path:"/settings",icon:$e},einstellungen:{path:"/settings",icon:$e}};function ga({content:s,onNavigate:t}){const n=ce(()=>{const i=[],l=s.length>1e4?s.substring(0,1e4)+"...":s;let o=0,c=0;const u=/\[(nav|icon):([a-zA-Z0-9_-]+)(?:[|｜]([^\]]+))?\]/g;let f;const d=[];for(;(f=u.exec(l))!==null;)d.push({index:f.index,type:f[1],key:f[2],label:f[3],endIndex:f.index+f[0].length});for(const h of d){if(h.index>o){const m=l.slice(o,h.index);i.push(e.jsx("span",{dangerouslySetInnerHTML:{__html:Xe(m)}},`text-${c++}`))}if(h.type==="nav"&&h.label){const m=h.key,g=h.label,w=ha[m];if(w&&t){const k=w.icon;i.push(e.jsxs("button",{onClick:y=>{y.preventDefault(),y.stopPropagation();try{t(w.path)}catch{}},className:"inline-flex items-center gap-1.5 px-2 py-1 mx-0.5 rounded-lg bg-primary/10 hover:bg-primary/20 text-primary font-medium text-sm transition-all duration-200 cursor-pointer border border-primary/20 hover:border-primary/40 hover:shadow-sm",title:`Zu ${g} navigieren`,children:[e.jsx(k,{className:"size-4"}),e.jsx("span",{className:"underline decoration-dotted underline-offset-2",children:Ke(g)})]},`nav-${c++}`))}else i.push(e.jsx("span",{className:"font-medium text-primary",children:Ke(g)},`nav-text-${c++}`))}else if(h.type==="icon"){const m=h.key,g=ma[m];g?i.push(e.jsx(g,{className:"inline-block size-4 mx-0.5 align-text-bottom text-primary"},`icon-${c++}`)):i.push(e.jsxs("span",{children:["[",Ke(m),"]"]},`unknown-${c++}`))}o=h.endIndex}if(o<l.length){const h=l.slice(o);i.push(e.jsx("span",{dangerouslySetInnerHTML:{__html:Xe(h)}},`text-${c++}`))}return i.length>0?i:[e.jsx("span",{dangerouslySetInnerHTML:{__html:Xe(l)}},"full")]},[s,t]);return e.jsx("div",{className:"prose prose-sm max-w-none",children:n})}function Ke(s){const t=document.createElement("div");return t.textContent=s,t.innerHTML}function Xe(s){let t=Ke(s);return t=t.replace(/\*\*(.+?)\*\*/g,"<strong>$1</strong>").replace(/__(.+?)__/g,"<strong>$1</strong>"),t=t.replace(new RegExp("(?<!\\*)\\*(?!\\*)(.+?)(?<!\\*)\\*(?!\\*)","g"),"<em>$1</em>"),t=t.replace(/`(.+?)`/g,'<code class="bg-muted px-1.5 py-0.5 rounded text-sm font-mono">$1</code>'),t=t.replace(/\n/g,"<br />"),t}function fa({messages:s,onSendMessage:t,isLoading:n=!1,placeholder:i="Nachricht eingeben...",className:l,height:o="100%",emptyStateMessage:c="Beginne eine Unterhaltung mit dem Assistenten",suggestedPrompts:u}){const{t:f,i18n:d}=It(),[,h]=_e(),[m,g]=p(""),w=O(null),k=O(null),y=O(null),P=O(null),T=O(null),G=O(null),[V,_]=p(!1),[U,B]=p(null),[se,re]=p(!1),j=O(null),v=Y(a=>{localStorage.setItem("nexo_chat_messages",JSON.stringify(s)),localStorage.setItem("nexo_chat_open_popup","true"),localStorage.setItem("nexo_chat_from_route",a),h(a)},[s,h]),E=ce(()=>s.filter(a=>a.role!=="system"),[s]),z=ce(()=>u?u.map(a=>typeof a=="string"?{text:a,icon:"tag"}:a):[],[u]),K=Y(()=>{const a=w.current?.querySelector("[data-radix-scroll-area-viewport]");a&&requestAnimationFrame(()=>{a.scrollTo({top:a.scrollHeight,behavior:"smooth"})})},[]);q(()=>{E.length>0&&K()},[E.length,K]),q(()=>{const a=x=>{j.current&&!j.current.contains(x.target)&&re(!1)};if(se)return document.addEventListener("mousedown",a),()=>document.removeEventListener("mousedown",a)},[se]);const I=Y(a=>{a.preventDefault();const x=m.trim();if(!(!x||n)){if(x.length>1e4){b.error("Nachricht ist zu lang. Bitte kürze sie auf maximal 10.000 Zeichen.");return}if(n){b.info("Bitte warte auf die Antwort...");return}try{t(x),g(""),K(),P.current?.focus()}catch{b.error("Fehler beim Senden der Nachricht. Bitte versuche es erneut.")}}},[m,n,t,K]),ne=Y(a=>{a.key==="Enter"&&!a.shiftKey&&(a.preventDefault(),I(a))},[I]),ve=Y(a=>{n||(t(a),K())},[n,t,K]),Se=Y(async a=>{if(a.size>10485760){b.error(`Datei ist zu groß. Maximal ${(10485760/1024/1024).toFixed(0)}MB erlaubt.`);return}if(!a.name||a.name.length>255){b.error("Ungültiger Dateiname.");return}const N=b.loading("Datei wird hochgeladen...");try{const M=await Promise.race([new Promise((W,$)=>{const te=new FileReader;te.onload=()=>{const J=te.result;if(!J||!J.includes(",")){$(new Error("Ungültiges Dateiformat"));return}W(J.split(",")[1])},te.onerror=()=>$(new Error("Fehler beim Lesen der Datei")),te.readAsDataURL(a)}),new Promise((W,$)=>setTimeout(()=>$(new Error("Upload-Timeout")),3e4))]),S=F(R,"uploadAIChatFile"),A=await Promise.race([S({fileName:a.name,fileData:M,fileType:a.type}),new Promise((W,$)=>setTimeout(()=>$(new Error("Upload-Timeout")),6e4))]);if(!A?.data)throw new Error("Keine Antwort vom Server erhalten");const H=A.data;if(!H.fileUrl||!H.fileName)throw new Error("Ungültige Server-Antwort");b.dismiss(N),t(`[Datei: ${H.fileName}](${H.fileUrl})`),b.success("Datei erfolgreich hochgeladen")}catch(M){b.dismiss(N);const S=M.message||"Unbekannter Fehler";b.error(`Fehler beim Hochladen: ${S}`)}},[t]),ee=Y(async a=>{if(!a.type.startsWith("image/")){b.error("Bitte wähle ein Bild aus (JPG, PNG, GIF, etc.)");return}const x=5*1024*1024;if(a.size>x){b.error(`Bild ist zu groß. Maximal ${(x/1024/1024).toFixed(0)}MB erlaubt.`);return}if(!a.name||a.name.length>255){b.error("Ungültiger Dateiname.");return}const N=b.loading("Bild wird hochgeladen...");try{const M=await Promise.race([new Promise((W,$)=>{const te=new FileReader;te.onload=()=>{const J=te.result;if(!J||!J.includes(",")){$(new Error("Ungültiges Bildformat"));return}W(J.split(",")[1])},te.onerror=()=>$(new Error("Fehler beim Lesen des Bildes")),te.readAsDataURL(a)}),new Promise((W,$)=>setTimeout(()=>$(new Error("Upload-Timeout")),3e4))]),S=F(R,"uploadAIChatImage"),A=await Promise.race([S({fileName:a.name,fileData:M,fileType:a.type}),new Promise((W,$)=>setTimeout(()=>$(new Error("Upload-Timeout")),6e4))]);if(!A?.data)throw new Error("Keine Antwort vom Server erhalten");const H=A.data;if(!H.imageUrl||!H.fileName)throw new Error("Ungültige Server-Antwort");b.dismiss(N),t(`![${H.fileName}](${H.imageUrl})`),b.success("Bild erfolgreich hochgeladen")}catch(M){b.dismiss(N);const S=M.message||"Unbekannter Fehler";b.error(`Fehler beim Hochladen: ${S}`)}},[t]),ie=Y(async()=>{if(V&&U){try{U.stop(),_(!1),b.info("Aufnahme wird verarbeitet...")}catch{_(!1),b.error("Fehler beim Stoppen der Aufnahme")}return}try{if(!navigator.mediaDevices||!navigator.mediaDevices.getUserMedia){b.error("Mikrofon-Zugriff wird von diesem Browser nicht unterstützt.");return}const a=await Promise.race([navigator.mediaDevices.getUserMedia({audio:!0}),new Promise((S,A)=>setTimeout(()=>A(new Error("Mikrofon-Zugriff-Timeout")),1e4))]),x=new MediaRecorder(a),N=[];let M=null;x.ondataavailable=S=>{S.data.size>0&&N.push(S.data)},x.onstop=async()=>{M&&clearTimeout(M);const S=new Blob(N,{type:"audio/webm"}),A=10*1024*1024;if(S.size>A){b.error("Audio-Aufnahme ist zu groß. Bitte kürze die Aufnahme."),a.getTracks().forEach(W=>W.stop());return}const H=b.loading("Audio wird transkribiert...");try{const W=await Promise.race([new Promise((we,oe)=>{const ue=new FileReader;ue.onload=()=>{const je=ue.result;if(!je||!je.includes(",")){oe(new Error("Ungültiges Audioformat"));return}we(je.split(",")[1])},ue.onerror=()=>oe(new Error("Fehler beim Lesen der Audio-Datei")),ue.readAsDataURL(S)}),new Promise((we,oe)=>setTimeout(()=>oe(new Error("Audio-Verarbeitung-Timeout")),3e4))]),$=F(R,"transcribeAIChatAudio"),te=await Promise.race([$({audioData:W,mimeType:"audio/webm"}),new Promise((we,oe)=>setTimeout(()=>oe(new Error("Transkription-Timeout")),6e4))]);if(!te?.data)throw new Error("Keine Antwort vom Server erhalten");const J=te.data;if(J.transcription&&J.transcription.trim())g(J.transcription.trim()),P.current?.focus(),b.dismiss(H),b.success("Spracheingabe erfolgreich");else throw new Error("Keine Transkription erhalten")}catch(W){b.dismiss(H);const $=W.message||"Unbekannter Fehler";b.error(`Fehler bei der Transkription: ${$}`)}finally{a.getTracks().forEach(W=>W.stop())}},x.onerror=S=>{b.error("Fehler bei der Aufnahme"),_(!1),a.getTracks().forEach(A=>A.stop())},M=setTimeout(()=>{x.state==="recording"&&(x.stop(),b.warning("Maximale Aufnahmezeit erreicht (5 Minuten)"))},300*1e3),x.start(),B(x),_(!0),b.info("Aufnahme gestartet... (Klicke erneut zum Stoppen)")}catch(a){_(!1);const x=a.message||"Unbekannter Fehler";x.includes("permission")||x.includes("denied")?b.error("Mikrofon-Zugriff wurde verweigert. Bitte erlaube den Zugriff in den Browser-Einstellungen."):x.includes("not found")||x.includes("not available")?b.error("Kein Mikrofon gefunden. Bitte verbinde ein Mikrofon."):b.error(`Mikrofon-Fehler: ${x}`)}},[V,U]),ye=Y(()=>{const x=d.language==="de"?"en":"de";d.changeLanguage(x),localStorage.setItem("language",x),b.success(x==="de"?"Sprache auf Deutsch geändert":"Language changed to English")},[d]),de=()=>e.jsxs("form",{ref:y,onSubmit:I,className:"w-full",children:[e.jsx("input",{ref:T,type:"file",className:"hidden",onChange:a=>{const x=a.target.files?.[0];x&&Se(x),a.target.value=""},accept:"*/*"}),e.jsx("input",{ref:G,type:"file",className:"hidden",onChange:a=>{const x=a.target.files?.[0];x&&(ee(x),re(!1)),a.target.value=""},accept:"image/*"}),e.jsx("div",{className:"w-full max-w-full mx-auto",children:e.jsxs("div",{className:"flex items-center gap-2 px-2",style:{alignItems:"center"},children:[e.jsx("div",{className:"relative",ref:j,children:se&&e.jsxs("div",{className:"absolute bottom-full left-2 mb-2 bg-background border border-border rounded-lg shadow-lg z-50 min-w-[200px] overflow-hidden",children:[e.jsxs("button",{type:"button",onClick:()=>{T.current?.click()},className:"w-full flex items-center gap-3 px-4 py-3 hover:bg-muted transition-colors text-left",children:[e.jsx(rs,{className:"w-5 h-5 text-muted-foreground"}),e.jsx("span",{className:"text-sm",children:"Datei anhängen"})]}),e.jsxs("button",{type:"button",onClick:()=>{G.current?.click()},className:"w-full flex items-center gap-3 px-4 py-3 hover:bg-muted transition-colors text-left",children:[e.jsx(is,{className:"w-5 h-5 text-muted-foreground"}),e.jsx("span",{className:"text-sm",children:"Bild hinzufügen"})]}),e.jsxs("button",{type:"button",onClick:()=>{ye(),re(!1)},className:"w-full flex items-center gap-3 px-4 py-3 hover:bg-muted transition-colors text-left",children:[e.jsx(os,{className:"w-5 h-5 text-muted-foreground"}),e.jsx("span",{className:"text-sm",children:"Sprache wechseln"})]})]})}),e.jsxs("div",{className:"flex-1 relative",children:[e.jsx("button",{type:"button",onClick:()=>re(!se),className:"absolute left-2 top-1/2 -translate-y-1/2 w-8 h-8 rounded-full bg-transparent hover:bg-muted/50 transition-colors flex items-center justify-center active:scale-95 z-10","aria-label":"Mehr Optionen",disabled:n,children:e.jsx(St,{className:"w-4 h-4 text-muted-foreground"})}),e.jsx("textarea",{ref:P,value:m,onChange:a=>g(a.target.value),onKeyDown:ne,placeholder:i,rows:1,className:"w-full pl-10 pr-4 py-3 rounded-2xl bg-muted border-0 text-base text-foreground placeholder:text-muted-foreground focus:outline-none focus:ring-2 focus:ring-primary/20 transition-all resize-none overflow-y-auto min-h-[44px] max-h-[120px] leading-relaxed",style:{height:"auto",minHeight:"44px"},disabled:n,onInput:a=>{const x=a.target;x.style.height="auto",x.style.height=`${Math.min(x.scrollHeight,120)}px`}})]}),m.trim()?e.jsx("button",{type:"submit",disabled:n,className:"w-10 h-10 rounded-full bg-primary text-primary-foreground hover:bg-primary/90 transition-colors flex items-center justify-center active:scale-95 shadow-md self-center","aria-label":n?"Wird gesendet...":"Nachricht senden",children:n?e.jsx(ot,{className:"w-5 h-5 animate-spin"}):e.jsx(ls,{className:"w-5 h-5"})}):e.jsx("button",{type:"button",onClick:ie,className:D("transition-colors flex items-center justify-center active:scale-95 self-center p-2",V?"text-red-500 hover:text-red-600":"text-foreground hover:text-foreground/80"),"aria-label":"Spracheingabe",disabled:n,children:e.jsx(cs,{className:D("w-7 h-7",V?"text-red-500":"text-foreground")})})]})})]});return e.jsx("div",{ref:k,className:D("flex flex-col bg-background text-foreground",l),style:{height:o},children:E.length===0?e.jsxs("div",{className:"flex flex-col h-full animate-in fade-in duration-300 pb-20",children:[e.jsx("div",{className:"flex-1 flex items-center justify-center px-4",children:e.jsx("div",{className:"w-full max-w-2xl"})}),z.length>0&&e.jsx("div",{className:"fixed bottom-24 left-0 right-0 px-4 pb-2 z-20 pointer-events-none",children:e.jsx("div",{className:"w-full max-w-2xl mx-auto",children:e.jsx("div",{className:"overflow-x-auto scrollbar-hide -mx-4 px-4 pointer-events-auto",children:e.jsx("div",{className:"flex gap-3",style:{width:"max-content"},children:z.map((a,x)=>{const N=a.subtitle&&a.subtitle.trim().length>0;return e.jsxs("button",{onClick:()=>ve(a.text),disabled:n,className:"flex-shrink-0 w-[calc(40vw-1rem)] min-w-[140px] max-w-[160px] rounded-xl bg-muted hover:bg-muted/80 active:bg-muted/70 px-2.5 py-2 text-left transition-all duration-200 disabled:cursor-not-allowed disabled:opacity-50 shadow-sm",type:"button",children:[e.jsx("p",{className:"font-medium text-xs text-foreground mb-0.5 line-clamp-2 leading-tight",children:a.text}),N&&e.jsx("p",{className:"text-[10px] text-muted-foreground line-clamp-2 leading-tight",children:a.subtitle})]},x)})})})})}),e.jsx("div",{className:"fixed bottom-0 left-0 right-0 w-full bg-background px-4 py-3 safe-bottom",style:{paddingBottom:"max(0.75rem, env(safe-area-inset-bottom))"},children:e.jsx("div",{className:"w-full max-w-2xl mx-auto",children:de()})})]}):e.jsxs(e.Fragment,{children:[e.jsx("div",{ref:w,className:"flex-1 overflow-hidden pb-32",children:e.jsx(da,{className:"h-full [&>div>div]:!overflow-y-auto [&>div>div]:[-ms-overflow-style:none] [&>div>div]:[scrollbar-width:none] [&>div>div::-webkit-scrollbar]:hidden",children:e.jsxs("div",{className:"flex flex-col p-4 space-y-4 pb-6",children:[E.map((a,x)=>e.jsx("div",{className:D("flex gap-3 animate-in fade-in slide-in-from-bottom-2 duration-300",a.role==="user"?"justify-end":"justify-start"),children:e.jsx("div",{className:D("max-w-[85%] select-text",a.role==="user"?"bg-primary text-primary-foreground rounded-2xl px-4 py-3 text-base":"text-foreground text-base"),onClick:N=>{N.target.closest("button, a")||N.stopPropagation()},onMouseDown:N=>{N.target.closest("button, a")||N.stopPropagation()},children:a.role==="assistant"?e.jsx(ga,{content:a.content,onNavigate:v}):e.jsx("p",{className:"whitespace-pre-wrap leading-relaxed",children:a.content})})},x)),n&&e.jsx("div",{className:"flex items-start gap-4 justify-start animate-in fade-in duration-200",children:e.jsx("div",{className:"rounded-lg bg-muted px-4 py-3",children:e.jsx(ot,{className:"size-4 animate-spin text-muted-foreground"})})})]})})}),z.length>0&&e.jsx("div",{className:"fixed bottom-24 left-0 right-0 px-4 pb-2 z-20 pointer-events-none",children:e.jsx("div",{className:"w-full max-w-2xl mx-auto",children:e.jsx("div",{className:"overflow-x-auto scrollbar-hide -mx-4 px-4 pointer-events-auto",children:e.jsx("div",{className:"flex gap-3",style:{width:"max-content"},children:z.map((a,x)=>{const N=a.subtitle&&a.subtitle.trim().length>0;return e.jsxs("button",{onClick:()=>ve(a.text),disabled:n,className:"flex-shrink-0 w-[calc(40vw-1rem)] min-w-[140px] max-w-[160px] rounded-xl bg-muted hover:bg-muted/80 active:bg-muted/70 px-2.5 py-2 text-left transition-all duration-200 disabled:cursor-not-allowed disabled:opacity-50 shadow-sm",type:"button",children:[e.jsx("p",{className:"font-medium text-xs text-foreground mb-0.5 line-clamp-2 leading-tight",children:a.text}),N&&e.jsx("p",{className:"text-[10px] text-muted-foreground line-clamp-2 leading-tight",children:a.subtitle})]},x)})})})})}),e.jsx("div",{className:"fixed bottom-0 left-0 right-0 w-full bg-background/95 backdrop-blur-sm px-4 py-3 safe-bottom flex-shrink-0 z-30",style:{paddingBottom:"max(0.75rem, env(safe-area-inset-bottom))"},children:e.jsx("div",{className:"w-full max-w-2xl mx-auto",children:de()})})]})})}function xt({className:s,onKeyDown:t,onCompositionStart:n,onCompositionEnd:i,...l}){const o=at(),{onCompositionStart:c,onCompositionEnd:u,onKeyDown:f}=Ut({onKeyDown:d=>{const h=d.nativeEvent.isComposing||o.justEndedComposing();d.key==="Enter"&&!d.shiftKey&&h||t?.(d)},onCompositionStart:d=>{o.setComposing(!0),n?.(d)},onCompositionEnd:d=>{o.markCompositionEnd(),setTimeout(()=>{o.setComposing(!1)},100),i?.(d)}});return e.jsx("textarea",{"data-slot":"textarea",className:D("border-input placeholder:text-muted-foreground focus-visible:border-ring focus-visible:ring-ring/50 aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive dark:bg-input/30 flex field-sizing-content min-h-16 w-full rounded-md border bg-transparent px-3 py-2 text-base shadow-xs transition-[color,box-shadow] outline-none focus-visible:ring-[3px] disabled:cursor-not-allowed disabled:opacity-50 md:text-sm",s),onCompositionStart:c,onCompositionEnd:u,onKeyDown:f,...l})}const Pe={role:"system",content:"Du bist ein hilfreicher Assistent für die Nexo-Anwendung. Du hilfst Benutzern bei Fragen zu Finanzen, Rechnungen, Terminen und anderen Funktionen der App."};function Za(){const{t:s}=It();_e();const{data:t,isLoading:n,refetch:i}=Ot(),[l,o]=p(null),[c,u]=p(!1),[f,d]=p(!1),[h,m]=p(!1),[g,w]=p(!1),[k,y]=p(!1),[P,T]=p(!1),[G,V]=p(!1),[_,U]=p(null),B=O(null),se=O(null),re=O(null),j=O(null),[v,E]=p({title:"",type:"termin",dueDate:"",isAllDay:!1,amount:"",currency:"CHF",notes:""}),[z,K]=p(!1),[I,ne]=p({type:"ausgabe",amount:"",category:"",description:"",date:new Date().toISOString().split("T")[0],paymentMethod:"Karte"}),[ve,Se]=p(!1),[ee,ie]=p({name:"",quantity:"1",category:"Lebensmittel",store:""}),[ye,de]=p(!1),a=["Lebensmittel","Getränke","Haushalt","Hygiene","Tierbedarf","Sonstiges"],x=async()=>{if(!ee.name){b.error("Bitte Artikelname eingeben");return}de(!0);try{await $n({item:ee.name,quantity:parseInt(ee.quantity)||1,category:ee.category,estimatedPrice:0,currency:"EUR",unit:null}),b.success("Artikel zur Einkaufsliste hinzugefügt"),y(!1),ie({name:"",quantity:"1",category:"Lebensmittel",store:""})}catch(r){b.error("Fehler beim Hinzufügen des Artikels"),console.error(r)}finally{de(!1)}},N={income:["Gehalt","Freelance","Investitionen","Geschenk","Sonstiges"],expense:["Lebensmittel","Transport","Wohnen","Unterhaltung","Gesundheit","Kleidung","Bildung","Rechnung","Sonstiges"]},M=async()=>{if(!I.amount||!I.category){b.error("Bitte Betrag und Kategorie eingeben");return}Se(!0);try{await Bt({type:I.type,category:I.category,amount:Math.round(parseFloat(I.amount)*100),currency:"CHF",date:new Date(I.date),paymentMethod:I.paymentMethod,notes:I.description||"",status:I.type==="ausgabe"?"open":void 0}),b.success(I.type==="einnahme"?"Einnahme hinzugefügt":"Ausgabe hinzugefügt"),w(!1),ne({type:"ausgabe",amount:"",category:"",description:"",date:new Date().toISOString().split("T")[0],paymentMethod:"Karte"})}catch(r){b.error("Fehler beim Erstellen des Eintrags"),console.error(r)}finally{Se(!1)}};q(()=>{if(!n&&t.length>0&&!l)o(t[0].id);else if(!n&&t.length===0&&!l){const r=ft();Ze(r).then(()=>{i(),o(r.id)})}},[n,t,l,i]);const[S,A]=p([Pe]),H=O(null),W=O(!1);q(()=>{if(l&&l!==H.current)if(H.current=l,t.length>0){const r=Je(l,t);r&&r.messages.length>0?A(r.messages):A([Pe])}else A([Pe])},[l,t]),q(()=>{if(!W.current&&l&&S.length>1){const r=setTimeout(async()=>{W.current=!0;try{const C=Je(l,t);if(C){const X=S.find(le=>le.role==="user");X&&C.title==="Neue Konversation"&&(C.title=ta(X.content)),C.messages=S,C.updatedAt=new Date().toISOString(),await Ze(C)}}catch{}finally{W.current=!1}},1e3);return()=>clearTimeout(r)}},[S,l,t]);const $=Y(async()=>{try{const r=ft();await Ze(r),o(r.id),A([Pe]),await i(),b.success("Neue Konversation gestartet")}catch(r){console.error("Error creating new chat:",r);let C="Fehler beim Erstellen der neuen Konversation";r?.code==="unauthenticated"||r?.message?.includes("unauthenticated")?C="Bitte melde dich an, um eine neue Konversation zu erstellen":r?.code==="permission-denied"||r?.message?.includes("permission")?C="Keine Berechtigung zum Erstellen einer Konversation":r?.message?C=`Fehler: ${r.message}`:typeof r=="string"&&(C=`Fehler: ${r}`),b.error(C)}},[i]),te=Y(r=>{o(r);const C=Je(r,t);C&&C.messages.length>0?A(C.messages):A([Pe])},[t]),J=zn.ai.chat.useMutation({onSuccess:r=>{const C={role:"assistant",content:r.content};A(X=>[...X,C])},onError:r=>{let C="Ein unbekannter Fehler ist aufgetreten.";r.message.includes("<!doctype")||r.message.includes("Unexpected token")||r.message.includes("Failed to fetch")?C="Der Server ist nicht erreichbar oder gibt eine ungültige Antwort zurück. Bitte stelle sicher, dass der Server läuft und du eine Internetverbindung hast.":r.message.includes("Unable to transform")||r.message.includes("NetworkError")?C="Fehler bei der Datenübertragung. Bitte überprüfe deine Internetverbindung und versuche es erneut.":r.data?.code==="UNAUTHORIZED"||r.message.includes("unauthenticated")?C="Du bist nicht angemeldet. Bitte melde dich an.":r.data?.code==="INTERNAL_SERVER_ERROR"||r.message.includes("500")?C="Ein Serverfehler ist aufgetreten. Bitte versuche es später erneut.":r.message.includes("timeout")||r.message.includes("Timeout")?C="Die Anfrage hat zu lange gedauert. Bitte versuche es erneut.":r.message.includes("rate limit")||r.message.includes("429")?C="Zu viele Anfragen. Bitte warte einen Moment und versuche es erneut.":C=r.message||"Ein Fehler ist aufgetreten.";const X={role:"assistant",content:`**Fehler aufgetreten**

${C}

Bitte versuche es erneut oder starte eine neue Konversation.`};A(le=>[...le,X]),b.error("Fehler beim Senden der Nachricht")}}),we=Y(r=>{if(r.length>1e4){b.error("Nachricht ist zu lang. Bitte kürze sie auf maximal 10.000 Zeichen.");return}if(S.filter(X=>X.role==="user").length>=50){b.warning("Zu viele Nachrichten in dieser Konversation. Bitte starte eine neue Konversation.");return}try{const X={role:"user",content:r},le=[...S,X];A(le),J.mutate({messages:le})}catch{b.error("Fehler beim Senden der Nachricht. Bitte versuche es erneut.")}},[S,J]),oe=ce(()=>[{text:"Wie funktioniert die Rechnungsverwaltung?",subtitle:"Lerne die Rechnungsverwaltung kennen",icon:"receipt"},{text:"Wie erstelle ich eine Erinnerung?",subtitle:"Erstelle Termine und Erinnerungen",icon:"bell"},{text:"Wie verwalte ich meine Finanzen?",subtitle:"Verwalte Einnahmen und Ausgaben",icon:"wallet"},{text:"Was kann ich mit der Einkaufsliste machen?",subtitle:"Verwalte deine Einkaufsliste",icon:"shoppingCart"},{text:"Wie funktioniert das Raten-System?",subtitle:"Lerne Ratenzahlungen zu verwalten",icon:"calendar"},{text:"Wie scanne ich eine Rechnung?",subtitle:"Erfasse Rechnungen automatisch",icon:"scan"}],[]),ue=S.some(r=>r.role==="user"),je=()=>l&&t.length>0&&t.find(C=>C.id===l)?.title||"Assistent",Z=ce(()=>[{id:"reminder",label:"Erinnerung erstellen",path:"#",icon:qe,onClick:()=>d(!0)},{id:"scan",label:"Rechnung scannen",path:"#",icon:Te,onClick:()=>{m(!0),U(null)}},{id:"finance",label:"Finanzübersicht",path:"#",icon:Ce,onClick:()=>w(!0)},{id:"shopping",label:"Einkaufsliste",path:"#",icon:Be,onClick:()=>y(!0)}],[]),Kt=async()=>{if(!v.title||!v.dueDate){b.error("Bitte füllen Sie Titel und Datum aus");return}K(!0);try{const r=v.amount?Math.round(parseFloat(v.amount)*100):void 0;await Pt({title:v.title,type:v.type,dueDate:new Date(v.dueDate),isAllDay:v.isAllDay,amount:r,currency:v.currency,notes:v.notes||""}),b.success("Erinnerung erstellt"),d(!1),E({title:"",type:"termin",dueDate:"",isAllDay:!1,amount:"",currency:"CHF",notes:""})}catch(r){b.error("Fehler beim Erstellen der Erinnerung"),console.error(r)}finally{K(!1)}},Ht=async()=>{try{const r=await navigator.mediaDevices.getUserMedia({video:{facingMode:"environment"}});j.current=r,B.current&&(B.current.srcObject=r),T(!0),Ye()}catch(r){b.error(ca(r)),oa()}},ze=()=>{j.current&&(j.current.getTracks().forEach(r=>r.stop()),j.current=null),T(!1)},Wt=()=>{if(B.current&&se.current){const r=B.current,C=se.current;C.width=r.videoWidth,C.height=r.videoHeight;const X=C.getContext("2d");if(X){X.drawImage(r,0,0);const le=C.toDataURL("image/jpeg");U(le),ze(),Ye()}}},$t=r=>{const C=r.target.files?.[0];if(C){const X=new FileReader;X.onload=le=>{const Gt=le.target?.result;U(Gt),Ye()},X.readAsDataURL(C)}},qt=async()=>{if(_){const r={role:"user",content:`![Gescanntes Bild](${_})`};A(C=>[...C,r]),U(null),m(!1),b.success("Scan zum Chat hinzugefügt");try{J.mutate({messages:[...S,r]})}catch(C){console.error("Error sending scan to chat:",C)}}};return q(()=>()=>{h||ze()},[h]),e.jsxs("div",{className:"min-h-screen bg-background flex flex-col safe-area-inset",children:[e.jsx(sa,{title:je(),showSidebar:!0,showQuickActions:!0,quickActions:Z,currentChatId:l||void 0,onSelectChat:te,onNewChat:$,sidebarOpen:c,onSidebarToggle:u}),Z.length>0&&e.jsxs("div",{className:"fixed top-14 left-0 right-0 z-30 px-4 py-3 flex flex-row gap-3 justify-center safe-top",style:{paddingTop:"max(0.75rem, env(safe-area-inset-top))"},children:[e.jsx("button",{onClick:()=>u(!0),className:"w-12 h-12 rounded-full bg-background hover:bg-muted border border-border transition-colors flex items-center justify-center active:scale-95 shadow-sm","aria-label":"Menü öffnen","aria-expanded":c,"aria-controls":"sidebar-menu",title:"Menü öffnen",children:e.jsx(vs,{className:"w-5 h-5 text-foreground"})}),Z.map(r=>{const C=r.icon;return e.jsx("button",{onClick:r.onClick,className:"w-12 h-12 rounded-full bg-background hover:bg-muted border border-border transition-colors flex items-center justify-center active:scale-95 shadow-sm","aria-label":r.label,title:r.label,children:C&&e.jsx(C,{className:"w-5 h-5 text-foreground"})},r.id)})]}),e.jsx("div",{className:"flex-1 overflow-hidden flex flex-col bg-background",style:{paddingTop:Z.length>0?"7rem":"3.5rem"},children:e.jsx("div",{className:"flex-1 flex flex-col w-full overflow-hidden min-h-0",children:e.jsx(fa,{messages:S,onSendMessage:we,isLoading:J.isPending,placeholder:s("common.typeMessage","Nachricht eingeben..."),height:"100%",emptyStateMessage:"Wähle eine Frage oder stelle deine eigene",suggestedPrompts:ue?[]:oe})})}),e.jsx(he,{open:f,onOpenChange:d,children:e.jsxs(ge,{className:"!fixed !top-[50%] !left-[50%] !right-auto !bottom-auto !translate-x-[-50%] !translate-y-[-50%] !w-[85vw] !max-w-sm !max-h-fit !rounded-3xl !m-0 !overflow-visible !shadow-2xl",children:[e.jsx(fe,{className:"px-5 pt-5 pb-3",children:e.jsx(pe,{className:"text-lg font-semibold",children:"Erinnerung erstellen"})}),e.jsxs("div",{className:"space-y-3 px-5 pb-2",children:[e.jsxs("div",{children:[e.jsx(Q,{className:"text-sm font-medium",children:"Titel *"}),e.jsx(me,{value:v.title,onChange:r=>E({...v,title:r.target.value}),placeholder:"Titel",className:"h-11 min-h-[44px] mt-1.5 rounded-xl"})]}),e.jsxs("div",{children:[e.jsx(Q,{className:"text-sm font-medium",children:"Typ *"}),e.jsxs(Ee,{value:v.type,onValueChange:r=>E({...v,type:r}),children:[e.jsx(Ie,{className:"h-11 min-h-[44px] mt-1.5 rounded-xl",children:e.jsx(Ae,{})}),e.jsxs(Fe,{children:[e.jsx(ae,{value:"termin",children:"Termin"}),e.jsx(ae,{value:"zahlung",children:"Zahlung"}),e.jsx(ae,{value:"aufgabe",children:"Aufgabe"})]})]})]}),e.jsxs("div",{children:[e.jsx(Q,{className:"text-sm font-medium",children:"Datum & Uhrzeit *"}),e.jsx(me,{type:"datetime-local",value:v.dueDate,onChange:r=>E({...v,dueDate:r.target.value}),className:"h-11 min-h-[44px] mt-1.5 rounded-xl"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(ra,{checked:v.isAllDay,onCheckedChange:r=>E({...v,isAllDay:r})}),e.jsx(Q,{className:"text-sm font-medium",children:"Ganztägig"})]}),v.type==="zahlung"&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{children:[e.jsx(Q,{children:"Betrag"}),e.jsx(me,{type:"number",step:"0.01",value:v.amount,onChange:r=>E({...v,amount:r.target.value}),placeholder:"0.00",className:"h-10 min-h-[44px] mt-1"})]}),e.jsxs("div",{children:[e.jsx(Q,{className:"text-sm font-medium",children:"Währung"}),e.jsxs(Ee,{value:v.currency,onValueChange:r=>E({...v,currency:r}),children:[e.jsx(Ie,{className:"h-10 min-h-[44px] mt-1",children:e.jsx(Ae,{})}),e.jsxs(Fe,{children:[e.jsx(ae,{value:"CHF",children:"CHF"}),e.jsx(ae,{value:"EUR",children:"EUR"}),e.jsx(ae,{value:"USD",children:"USD"})]})]})]})]}),e.jsxs("div",{children:[e.jsx(Q,{className:"text-sm font-medium",children:"Notizen"}),e.jsx(xt,{value:v.notes,onChange:r=>E({...v,notes:r.target.value}),placeholder:"Notizen...",className:"mt-1.5 min-h-[90px] rounded-xl"})]})]}),e.jsxs(xe,{className:"px-5 pb-3 pt-2 gap-2.5",children:[e.jsx(L,{variant:"outline",onClick:()=>d(!1),className:"h-11 min-h-[44px] flex-1 rounded-xl text-sm font-medium",children:"Abbrechen"}),e.jsx(L,{onClick:Kt,disabled:z,className:"h-11 min-h-[44px] flex-1 rounded-xl text-sm font-medium",children:z?"Speichert...":"Erstellen"})]})]})}),e.jsx(he,{open:h,onOpenChange:r=>{m(r),r||(ze(),U(null))},children:e.jsxs(ge,{className:"!fixed !top-[50%] !left-[50%] !right-auto !bottom-auto !translate-x-[-50%] !translate-y-[-50%] !w-[85vw] !max-w-sm !max-h-fit !rounded-3xl !m-0 !overflow-visible !shadow-2xl",children:[e.jsx(fe,{className:"px-5 pt-5 pb-3",children:e.jsx(pe,{className:"text-lg font-semibold",children:"Rechnung scannen"})}),e.jsxs("div",{className:"space-y-3 px-5 pb-2",children:[!P&&!_&&e.jsxs("div",{className:"space-y-2.5",children:[e.jsxs(L,{onClick:Ht,className:"w-full h-11 flex items-center justify-center gap-2 rounded-xl text-sm font-medium",children:[e.jsx(lt,{className:"w-4 h-4"}),"Kamera öffnen"]}),e.jsxs("div",{className:"relative",children:[e.jsx("input",{ref:re,type:"file",accept:"image/*",onChange:$t,className:"hidden"}),e.jsxs(L,{variant:"outline",onClick:()=>re.current?.click(),className:"w-full h-11 flex items-center justify-center gap-2 rounded-xl text-sm font-medium",children:[e.jsx(ys,{className:"w-4 h-4"}),"Bild hochladen"]})]})]}),P&&e.jsxs("div",{className:"space-y-2.5",children:[e.jsxs("div",{className:"relative bg-black rounded-xl overflow-hidden aspect-video",children:[e.jsx("video",{ref:B,autoPlay:!0,playsInline:!0,className:"w-full h-full object-cover"}),e.jsx("canvas",{ref:se,className:"hidden"})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(L,{variant:"outline",onClick:ze,className:"flex-1 h-11 rounded-xl text-sm font-medium",children:[e.jsx(Le,{className:"w-4 h-4 mr-2"}),"Abbrechen"]}),e.jsxs(L,{onClick:Wt,className:"flex-1 h-11 rounded-xl text-sm font-medium",children:[e.jsx(lt,{className:"w-4 h-4 mr-2"}),"Aufnehmen"]})]})]}),_&&e.jsxs("div",{className:"space-y-2.5",children:[e.jsx("div",{className:"relative bg-black rounded-xl overflow-hidden",children:e.jsx("img",{src:_,alt:"Gescanntes Bild",className:"w-full h-auto"})}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(L,{variant:"outline",onClick:()=>{U(null),T(!1)},className:"flex-1 h-11 rounded-xl text-sm font-medium",children:"Neu scannen"}),e.jsx(L,{onClick:qt,className:"flex-1 h-11 rounded-xl text-sm font-medium",children:"Zum Chat hinzufügen"})]})]})]}),e.jsx(xe,{className:"px-5 pb-3 pt-2",children:e.jsx(L,{variant:"outline",onClick:()=>{m(!1),ze(),U(null)},className:"h-11 min-h-[44px] w-full rounded-xl text-sm font-medium",children:"Schließen"})})]})}),e.jsx(he,{open:g,onOpenChange:r=>{w(r),r||ne({type:"ausgabe",amount:"",category:"",description:"",date:new Date().toISOString().split("T")[0],paymentMethod:"Karte"})},children:e.jsxs(ge,{className:"!fixed !top-[50%] !left-[50%] !right-auto !bottom-auto !translate-x-[-50%] !translate-y-[-50%] !w-[85vw] !max-w-sm !max-h-fit !rounded-3xl !m-0 !overflow-visible !shadow-2xl",children:[e.jsx(fe,{className:"px-5 pt-5 pb-3",children:e.jsx(pe,{className:"text-lg font-semibold",children:"Einnahme / Ausgabe"})}),e.jsxs("div",{className:"space-y-3 px-5 pb-2",children:[e.jsxs("div",{children:[e.jsx(Q,{className:"text-sm font-medium",children:"Typ *"}),e.jsxs(Ee,{value:I.type,onValueChange:r=>{ne({...I,type:r,category:""})},children:[e.jsx(Ie,{className:"h-11 min-h-[44px] mt-1.5 rounded-xl",children:e.jsx(Ae,{})}),e.jsxs(Fe,{children:[e.jsx(ae,{value:"einnahme",children:"Einnahme"}),e.jsx(ae,{value:"ausgabe",children:"Ausgabe"})]})]})]}),e.jsxs("div",{children:[e.jsx(Q,{children:"Betrag *"}),e.jsx(me,{type:"number",step:"0.01",value:I.amount,onChange:r=>ne({...I,amount:r.target.value}),placeholder:"0.00",className:"h-11 min-h-[44px] mt-1.5 rounded-xl"})]}),e.jsxs("div",{children:[e.jsx(Q,{className:"text-sm font-medium",children:"Kategorie *"}),e.jsxs(Ee,{value:I.category,onValueChange:r=>ne({...I,category:r}),children:[e.jsx(Ie,{className:"h-11 min-h-[44px] mt-1.5 rounded-xl",children:e.jsx(Ae,{placeholder:"Kategorie wählen"})}),e.jsx(Fe,{children:(I.type==="einnahme"?N.income:N.expense).map(r=>e.jsx(ae,{value:r,children:r},r))})]})]}),e.jsxs("div",{children:[e.jsx(Q,{className:"text-sm font-medium",children:"Datum *"}),e.jsx(me,{type:"date",value:I.date,onChange:r=>ne({...I,date:r.target.value}),className:"h-11 min-h-[44px] mt-1.5 rounded-xl"})]}),e.jsxs("div",{children:[e.jsx(Q,{children:"Zahlungsmethode"}),e.jsxs(Ee,{value:I.paymentMethod,onValueChange:r=>ne({...I,paymentMethod:r}),children:[e.jsx(Ie,{className:"h-11 min-h-[44px] mt-1.5 rounded-xl",children:e.jsx(Ae,{})}),e.jsxs(Fe,{children:[e.jsx(ae,{value:"Karte",children:"Karte"}),e.jsx(ae,{value:"Bar",children:"Bar"}),e.jsx(ae,{value:"Überweisung",children:"Überweisung"}),e.jsx(ae,{value:"Andere",children:"Andere"})]})]})]}),e.jsxs("div",{children:[e.jsx(Q,{children:"Beschreibung"}),e.jsx(xt,{value:I.description,onChange:r=>ne({...I,description:r.target.value}),placeholder:"Beschreibung...",className:"mt-1 min-h-[80px]"})]})]}),e.jsxs(xe,{className:"px-5 pb-3 pt-2 gap-2.5",children:[e.jsx(L,{variant:"outline",onClick:()=>w(!1),className:"h-11 min-h-[44px] flex-1 rounded-xl text-sm font-medium",children:"Abbrechen"}),e.jsx(L,{onClick:M,disabled:ve,className:"h-11 min-h-[44px] flex-1 rounded-xl text-sm font-medium",children:ve?"Speichert...":"Erstellen"})]})]})}),e.jsx(he,{open:k,onOpenChange:r=>{y(r),r||ie({name:"",quantity:"1",category:"Lebensmittel",store:""})},children:e.jsxs(ge,{className:"!fixed !top-[50%] !left-[50%] !right-auto !bottom-auto !translate-x-[-50%] !translate-y-[-50%] !w-[85vw] !max-w-sm !max-h-fit !rounded-3xl !m-0 !overflow-visible !shadow-2xl",children:[e.jsx(fe,{className:"px-5 pt-5 pb-3",children:e.jsx(pe,{className:"text-lg font-semibold",children:"Artikel zur Einkaufsliste hinzufügen"})}),e.jsxs("div",{className:"space-y-3 px-5 pb-2",children:[e.jsxs("div",{children:[e.jsx(Q,{className:"text-sm font-medium",children:"Artikelname *"}),e.jsx(me,{value:ee.name,onChange:r=>ie({...ee,name:r.target.value}),placeholder:"z.B. Milch",className:"h-11 min-h-[44px] mt-1.5 rounded-xl"})]}),e.jsxs("div",{children:[e.jsx(Q,{className:"text-sm font-medium",children:"Menge"}),e.jsx(me,{type:"number",min:"1",value:ee.quantity,onChange:r=>ie({...ee,quantity:r.target.value}),placeholder:"1",className:"h-11 min-h-[44px] mt-1.5 rounded-xl"})]}),e.jsxs("div",{children:[e.jsx(Q,{className:"text-sm font-medium",children:"Kategorie"}),e.jsxs(Ee,{value:ee.category,onValueChange:r=>ie({...ee,category:r}),children:[e.jsx(Ie,{className:"h-11 min-h-[44px] mt-1.5 rounded-xl",children:e.jsx(Ae,{})}),e.jsx(Fe,{children:a.map(r=>e.jsx(ae,{value:r,children:r},r))})]})]}),e.jsxs("div",{children:[e.jsx(Q,{className:"text-sm font-medium",children:"Geschäft (optional)"}),e.jsx(me,{value:ee.store,onChange:r=>ie({...ee,store:r.target.value}),placeholder:"z.B. Migros",className:"h-11 min-h-[44px] mt-1.5 rounded-xl"})]})]}),e.jsxs(xe,{className:"px-5 pb-3 pt-2 gap-2.5",children:[e.jsx(L,{variant:"outline",onClick:()=>y(!1),className:"h-11 min-h-[44px] flex-1 rounded-xl text-sm font-medium",children:"Abbrechen"}),e.jsx(L,{onClick:x,disabled:ye,className:"h-11 min-h-[44px] flex-1 rounded-xl text-sm font-medium",children:ye?"Speichert...":"Hinzufügen"})]})]})})]})}export{Ta as $,ca as A,L as B,Qn as C,he as D,qa as E,Sa as F,Da as G,Ea as H,me as I,Ia as J,Fa as K,Q as L,Ra as M,Ba as N,ra as O,sa as P,La as Q,Ma as R,Ee as S,Rt as T,Tt as U,xt as V,Pa as W,Ua as X,Ka as Y,Ha as Z,Wa as _,za as a,_a as a0,Oa as a1,Aa as a2,Za as a3,ka as a4,zn as a5,_t as b,D as c,Lt as d,De as e,R as f,Ln as g,_n as h,ge as i,e as j,fe as k,pe as l,xe as m,Pt as n,Bt as o,$a as p,Ie as q,Ae as r,Fe as s,ae as t,It as u,$n as v,Ye as w,oa as x,Ga as y,Va as z};
