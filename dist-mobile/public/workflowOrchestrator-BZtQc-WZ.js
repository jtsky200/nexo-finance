import{eventBus as e,Events as t}from"./eventBus-CWDWdm45.js";import{backgroundTaskManager as i}from"./backgroundTaskManager-DuxFkiIE.js";class s{processedReminders=new Set;constructor(){this.setupEventListeners(),this.setupBackgroundTasks()}setupEventListeners(){e.on(t.REMINDER_CREATED,()=>{this.triggerDataSync("reminders")}),e.on(t.REMINDER_UPDATED,()=>{this.triggerDataSync("reminders")}),e.on(t.CHAT_REMINDER_RECEIVED,()=>{this.triggerDataSync("chatReminders")}),e.on(t.USER_ACTIVE,()=>{this.triggerDataSync("all")}),e.on(t.USER_VISIBILITY_CHANGE,a=>{a.visible&&this.triggerDataSync("all")})}setupBackgroundTasks(){i.registerTask({id:"chat-reminder-check",name:"Chat Reminder Check",interval:3e4,enabled:!0,callback:async()=>{await this.checkChatReminders()}}),i.registerTask({id:"data-sync",name:"Data Sync",interval:12e4,enabled:!0,callback:async()=>{await this.performDataSync()}})}async checkChatReminders(){try{e.emit(t.DATA_SYNC_START,{type:"chatReminders"})}catch(a){e.emit(t.DATA_SYNC_ERROR,{type:"chatReminders",error:a})}}lastSyncTime=new Map;triggerDataSync(a){const r=Date.now(),n=this.lastSyncTime.get(a)||0;r-n<1e3||(this.lastSyncTime.set(a,r),e.emit(t.DATA_SYNC_START,{type:a}))}async performDataSync(){try{e.emit(t.DATA_SYNC_START,{type:"all"}),await new Promise(a=>setTimeout(a,100)),e.emit(t.DATA_SYNC_COMPLETE,{type:"all"})}catch(a){e.emit(t.DATA_SYNC_ERROR,{type:"all",error:a})}}initialize(){e.emit(t.APP_READY)}}const c=new s;typeof window<"u"&&setTimeout(()=>{c.initialize()},500);export{c as workflowOrchestrator};
