import{x as la,y as ia,z as ca,A as jt,E as oa,F as da,G as g,H as h,I as w,J as Nt,j as e,S as ye,K as ke,M as Se,N as Ce,O as p,B as m,Q as _,D as wt,o as vt,p as yt,q as kt,r as St,R as ma,L as ls,s as Ct,T as Ue,g as Ie,U as ua,V as ha,W as xa,w as fa}from"./page-aichat-DvB7HPKg.js";import{useEffect as le,useState as l,useRef as R,useMemo as is,useCallback as Z}from"react";import{M as ga}from"./page-calendar-DA9EVRZE.js";import{t as r}from"./vendor-toast-CdQ6zwVl.js";import{m as Pe}from"./vendor-firebase-Dj6H5_d8.js";import{F as It,p as $,X as T,T as Le,k as Pt,V as Ge,Y as pa,N as Ve,t as _e,Z as ba,j as We,O as ja,_ as Na,q as Lt,o as At,h as wa,z as va,$ as cs,a0 as ya,a1 as ka,a2 as Sa}from"./vendor-misc-CSrXB4F2.js";const os=["Lebensmittel","Getränke","Haushalt","Hygiene","Tierbedarf","Sonstiges"];function Ua(){const{t:W}=la();le(()=>{const t=document.createElement("style");return t.textContent=`
      @keyframes scan-line {
        0% { transform: translateY(0); opacity: 0.3; }
        50% { transform: translateY(100%); opacity: 1; }
        100% { transform: translateY(0); opacity: 0.3; }
      }
    `,document.head.appendChild(t),()=>{document.head.contains(t)&&document.head.removeChild(t)}},[]);const{data:C=[],isLoading:ds}=ia(),[I,Ae]=l(null),[ms,Fe]=l(!1),[us,ze]=l(!1),[J,X]=l(""),[hs,Qe]=l(null);le(()=>{if(C.length>0&&!I){const t=C.find(s=>s.isDefault)||C[0];t&&Ae(t.id)}},[C,I]);const{data:q=[],isLoading:xs,refetch:b}=ca(I||void 0),[Ye,ie]=l([]),[Ca,ee]=l(new Set);le(()=>{(q.length>0||Ye.length===0)&&ie(q)},[q]),Ye.length>0;const[Ft,Ze]=l(!1),[zt,De]=l(!1),[v,ce]=l({name:"",quantity:"1",category:"Lebensmittel",store:""}),[j,K]=l([]),[Dt,Et]=l(!1),[oe,te]=l("camera"),[se,Ee]=l("receipt"),[N,Q]=l(!1),[o,Je]=l(null),[P,ae]=l([]),[L,H]=l([]),[fs,O]=l(0),[A,Te]=l(null),[de,me]=l(1),[Xe,gs]=l(!0),[et,ps]=l(!0),[tt,bs]=l(!0),x=R(null),ne=R(null),Tt=R(null),[d,ue]=l(null),[Mt,st]=l(!1),[he,at]=l(null),[Bt,Rt]=l(!1),U=R(null),nt=R(null),[$t,qt]=l(null),Me=R(null),[Kt,rt]=l(!1),[lt,it]=l(null),[ct,Ht]=l(!1),G=R(null),ot=R(null),[Ot,Ut]=l(null),re=is(()=>q.filter(t=>t.status==="not_bought"),[q]),V=is(()=>q.filter(t=>t.status==="bought"),[q]),[F,dt]=l(!1),[y,xe]=l(new Set),js=async()=>{if(!v.name.trim()){r.error("Bitte Artikelname eingeben");return}try{await Ue({listId:I||void 0,item:v.name.trim(),quantity:parseInt(v.quantity)||1,category:v.category,estimatedPrice:0,currency:"CHF",store:v.store||null}),r.success("Artikel hinzugefügt"),w(),Ze(!1),ce({name:"",quantity:"1",category:"Lebensmittel",store:""}),await b()}catch(t){r.error("Fehler: "+g(t)),h()}},Ns=()=>{const t={store:"",items:[]};K([...j,t])},ws=t=>{K(j.filter((s,a)=>a!==t))},vs=(t,s)=>{const a=[...j];a[t].store=s,K(a)},ys=t=>{const s=[...j];s[t].items.push({id:Date.now().toString()+Math.random().toString(36).substr(2,9),name:"",quantity:"1",category:"Lebensmittel",price:"",articleNumber:"",productInfo:null,saveToDatabase:!1}),K(s)},ks=(t,s)=>{const a=[...j];a[t].items=a[t].items.filter(n=>n.id!==s),K(a)},z=(t,s,a,n)=>{const c=[...j],i=c[t].items.findIndex(u=>u.id===s);i!==-1&&(c[t].items[i][a]=n,K(c))},Ss=(t,s)=>{at({groupIndex:t,itemId:s}),st(!0),setTimeout(()=>Cs(),100)},Cs=async()=>{try{if(!navigator.mediaDevices||!navigator.mediaDevices.getUserMedia){r.error("Kamera wird nicht unterstützt");return}const t=await navigator.mediaDevices.getUserMedia({video:{facingMode:"environment"}});qt(t),U.current&&(U.current.srcObject=t,await U.current.play()),Rt(!0),Is(),w()}catch(t){r.error("Kamera-Fehler: "+g(t)),h()}},Is=()=>{if(!("BarcodeDetector"in window)){r.error("Barcode-Erkennung nicht unterstützt");return}const t=new window.BarcodeDetector({formats:["ean_13","ean_8","code_128","code_39","upc_a","upc_e"]});Me.current=setInterval(async()=>{if(!U.current||!nt.current||!Bt)return;const s=U.current,a=nt.current,n=a.getContext("2d");if(!(!n||s.readyState!==4)){a.width=s.videoWidth,a.height=s.videoHeight,n.drawImage(s,0,0);try{const c=await t.detect(a);if(c.length>0){const i=c[0].rawValue;Gt(),he&&(z(he.groupIndex,he.itemId,"articleNumber",i),r.success(`Barcode gescannt: ${i}`),w(),await Ds(he.groupIndex,he.itemId,i)),st(!1),at(null)}}catch{}}},500)},Gt=()=>{Me.current&&(clearInterval(Me.current),Me.current=null),$t&&($t.getTracks().forEach(t=>t.stop()),qt(null)),U.current&&(U.current.srcObject=null),Rt(!1)},Ps=()=>{Gt(),st(!1),at(null)},Ls=(t,s)=>{it({groupIndex:t,itemId:s}),rt(!0),setTimeout(()=>As(),100)},As=async()=>{try{if(!navigator.mediaDevices||!navigator.mediaDevices.getUserMedia){r.error("Kamera wird nicht unterstützt");return}const t=await navigator.mediaDevices.getUserMedia({video:{facingMode:"environment"}});Ut(t),G.current&&(G.current.srcObject=t,await G.current.play()),w()}catch(t){r.error("Kamera-Fehler: "+g(t)),h()}},Fs=async()=>{if(!(!G.current||!ot.current||!lt)){Ht(!0);try{const t=G.current,s=ot.current;s.width=t.videoWidth,s.height=t.videoHeight;const a=s.getContext("2d");if(a){a.drawImage(t,0,0);const n=s.toDataURL("image/jpeg");await Es(lt.groupIndex,lt.itemId,n),Vt(),rt(!1),it(null)}}catch(t){r.error("Fehler beim Erfassen: "+g(t)),h()}finally{Ht(!1)}}},Vt=()=>{Ot&&(Ot.getTracks().forEach(t=>t.stop()),Ut(null)),G.current&&(G.current.srcObject=null)},zs=()=>{Vt(),rt(!1),it(null)},Ds=async(t,s,a)=>{try{if(!j[t]?.items.find(D=>D.id===s))return;const c=j[t]?.store||"",u=await Pe(Ie,"searchProductInfo")({articleNumber:a,store:c});u.data&&u.data.productInfo&&(z(t,s,"productInfo",u.data.productInfo),r.success("Produktinformationen gefunden"))}catch(n){console.log("Product info fetch failed:",n)}},Es=async(t,s,a)=>{try{const n=j[t]?.items.find(D=>D.id===s);if(!n)return;const c=j[t]?.store||"",u=await Pe(Ie,"analyzeProductImage")({imageData:a,store:c,articleNumber:n.articleNumber});u.data&&u.data.productInfo?(z(t,s,"productInfo",u.data.productInfo),u.data.articleNumber&&!n.articleNumber&&z(t,s,"articleNumber",u.data.articleNumber),r.success("Produktinformationen erkannt"),w()):r.info("Keine Produktinformationen erkannt")}catch(n){r.error("Fehler bei Analyse: "+g(n)),h()}},Ts=async(t,s)=>{Ss(t,s)},Ms=async(t,s)=>{Ls(t,s)},Bs=async()=>{try{let t=0;for(const s of j){if(!s.store){r.error("Bitte Laden für alle Gruppen angeben");return}for(const a of s.items){if(!a.name.trim()){r.error("Bitte Artikelname für alle Artikel eingeben");return}await Ue({listId:I||void 0,item:a.name.trim(),quantity:parseInt(a.quantity)||1,category:a.category,estimatedPrice:parseFloat(a.price||"0")*100,currency:"CHF",store:s.store,articleNumber:a.articleNumber||null,productInfo:a.productInfo||null,saveToDatabase:a.saveToDatabase||!1}),t++}}r.success(`${t} Artikel hinzugefügt`),w(),De(!1),K([]),await b()}catch(t){r.error("Fehler: "+g(t)),h()}},_t=async()=>{if(!J.trim()){r.error("Bitte Listenname eingeben");return}try{const t=await ua(J.trim(),C.length===0);r.success("Liste erstellt"),w(),ze(!1),X(""),Ae(t.id)}catch(t){r.error("Fehler: "+g(t)),h()}},Rs=async t=>{if(C.length<=1){r.error("Mindestens eine Liste muss vorhanden sein");return}try{if(await ha(t),r.success("Liste gelöscht"),w(),I===t){const s=C.find(a=>a.id!==t);Ae(s?.id||null)}}catch(s){r.error("Fehler: "+g(s)),h()}},$s=async(t,s,a)=>{try{await xa(t,{name:s,isDefault:a}),r.success("Liste aktualisiert"),w(),Qe(null)}catch(n){r.error("Fehler: "+g(n)),h()}},Wt=Z(async(t,s)=>{const a=s==="bought"?"not_bought":"bought";ie(n=>n.map(c=>c.id===t?{...c,status:a,boughtAt:a==="bought"?new Date:null}:c)),jt();try{a==="bought"?await oa(t):await da(t,{status:"not_bought"}),setTimeout(()=>b(),100)}catch(n){b(),r.error(g(n)),h()}},[b]),qs=Z(async t=>{ie(s=>s.filter(a=>a.id!==t)),ee(s=>new Set(s).add(t)),w();try{await Nt(t),setTimeout(()=>b(),100)}catch(s){b(),r.error(g(s)),h()}finally{ee(s=>{const a=new Set(s);return a.delete(t),a})}},[b]),Ks=Z(async()=>{if(y.size===0){r.error("Bitte wählen Sie mindestens einen Artikel aus");return}const t=Array.from(y);ie(s=>s.filter(a=>!y.has(a.id))),ee(s=>{const a=new Set(s);return t.forEach(n=>a.add(n)),a}),xe(new Set),dt(!1),w();try{const s=t.map(a=>Nt(a));await Promise.all(s),r.success(`${t.length} Artikel gelöscht`),setTimeout(()=>b(),100)}catch(s){b(),r.error(g(s)),h()}finally{ee(s=>{const a=new Set(s);return t.forEach(n=>a.delete(n)),a})}},[y,b]),Qt=Z(t=>{xe(s=>{const a=new Set(s);return a.has(t)?a.delete(t):a.add(t),a}),jt()},[]),Hs=Z(()=>{const t=new Set([...re.map(s=>s.id),...V.map(s=>s.id)]);y.size===t.size?xe(new Set):xe(t),jt()},[re,V,y.size]),Os=Z(()=>{dt(!1),xe(new Set)},[]),Us=Z(async()=>{const t=V.map(s=>s.id);ie(s=>s.filter(a=>!t.includes(a.id))),ee(s=>{const a=new Set(s);return t.forEach(n=>a.add(n)),a}),w();try{const s=t.map(a=>Nt(a));await Promise.all(s),r.success("Eingekaufte Artikel gelöscht"),setTimeout(()=>b(),100)}catch(s){b(),r.error(g(s)),h()}finally{ee(s=>{const a=new Set(s);return t.forEach(n=>a.delete(n)),a})}},[V,b]),[Ia,fe]=l("idle"),[Pa,Yt]=l(0),M=R(null),[La,Gs]=l({topLeft:{x:10,y:15},topRight:{x:90,y:15},bottomLeft:{x:10,y:75},bottomRight:{x:90,y:75}}),[Aa,Fa]=l(null),[za,Da]=l(!1),ge=async()=>{try{if(!navigator.mediaDevices||!navigator.mediaDevices.getUserMedia){r.error("Kamera wird nicht unterstützt"),te("upload");return}d&&(d.getTracks().forEach(a=>{a.stop()}),ue(null),await new Promise(a=>setTimeout(a,100))),x.current&&(x.current.srcObject=null);let t=null,s={video:{facingMode:"environment",width:{ideal:3840},height:{ideal:2160},aspectRatio:{ideal:16/9}},audio:!1};try{t=await navigator.mediaDevices.getUserMedia(s)}catch{s={video:{facingMode:"environment",width:{ideal:1920},height:{ideal:1080}},audio:!1};try{t=await navigator.mediaDevices.getUserMedia(s)}catch{t=await navigator.mediaDevices.getUserMedia({video:{facingMode:"environment"},audio:!1})}}if(!t||t.getVideoTracks().length===0)throw new Error("Kein Kamera-Stream erhalten");if(ue(t),fe("scanning"),await new Promise(a=>setTimeout(a,50)),x.current){const a=x.current;a.srcObject=t,await new Promise((n,c)=>{const i=setTimeout(()=>{c(new Error("Video-Timeout"))},5e3),u=()=>{clearTimeout(i),a.removeEventListener("loadedmetadata",u),a.removeEventListener("error",D),n()},D=ft=>{clearTimeout(i),a.removeEventListener("loadedmetadata",u),a.removeEventListener("error",D),c(new Error("Video-Fehler"))};if(a.readyState>=2){clearTimeout(i),n();return}a.addEventListener("loadedmetadata",u,{once:!0}),a.addEventListener("error",D,{once:!0})});try{await a.play(),r.success("Kamera aktiv"),Zt()}catch{r.success("Kamera aktiv"),Zt()}}}catch(t){d&&(d.getTracks().forEach(n=>n.stop()),ue(null)),x.current&&(x.current.srcObject=null);const s=t;let a="Kamera-Fehler";s.name==="NotAllowedError"||s.name==="PermissionDeniedError"?a="Kamera-Berechtigung verweigert. Bitte in den Browser-Einstellungen erlauben.":s.name==="NotFoundError"||s.name==="DevicesNotFoundError"?a="Keine Kamera gefunden":s.name==="NotReadableError"||s.name==="TrackStartError"?a="Kamera wird bereits verwendet":s.name==="OverconstrainedError"||s.name==="ConstraintNotSatisfiedError"?a="Kamera-Unterstützung nicht verfügbar":s.message==="Video-Timeout"?a="Kamera-Initialisierung zu langsam":a=`Kamera-Fehler: ${s.message||s.name}`,r.error(a),te("upload"),fe("idle")}},mt=()=>{M.current&&(cancelAnimationFrame(M.current),M.current=null),d&&(d.getTracks().forEach(t=>t.stop()),ue(null)),fe("idle"),Yt(0)},Zt=()=>{Gs({topLeft:{x:15,y:10},topRight:{x:85,y:10},bottomLeft:{x:15,y:85},bottomRight:{x:85,y:85}}),fe("scanning"),Yt(0)},Vs=()=>{if(!x.current||!ne.current)return;M.current&&(cancelAnimationFrame(M.current),M.current=null),fe("capturing");const t=x.current,s=ne.current;s.width=t.videoWidth,s.height=t.videoHeight;const a=s.getContext("2d");a&&(a.imageSmoothingEnabled=!1,a.drawImage(t,0,0),r.success("Foto aufgenommen!"),s.toBlob(async n=>{if(n){mt();const c=new File([n],"photo.jpg",{type:"image/jpeg"});await Jt(c)}},"image/jpeg",1))};le(()=>()=>{!d&&x.current&&x.current.srcObject&&(x.current.srcObject.getTracks().forEach(s=>s.stop()),x.current.srcObject=null)},[d]),le(()=>()=>{M.current&&(cancelAnimationFrame(M.current),M.current=null),d&&(d.getTracks().forEach(t=>t.stop()),ue(null)),x.current&&(x.current.srcObject=null)},[]);const _s=async t=>{const s=t.target.files?.[0];s&&await Jt(s)},Jt=async t=>{Q(!0),ae([]),Je(null);try{const s=new FileReader;s.onload=async()=>{try{const a=s.result.split(",")[1];r.info("Analysiere mit OCR...");const i=(await Pe(Ie,"analyzeReceipt")({fileData:a,fileType:t.type||"image/jpeg",fileName:t.name||"photo.jpg"})).data;i.success&&i.items&&i.items.length>0?(Je({store:i.store||{name:"Unbekannt"},purchase:i.purchase||{},items:i.items,totals:i.totals||{total:0},confidence:i.confidence||50}),ae(i.items.map(u=>({...u,selected:!0}))),r.success(`${i.items.length} Artikel erkannt!`)):i.error?.includes("Vision API")||i.error?.includes("PERMISSION_DENIED")?r.error("OCR nicht verfügbar. Google Cloud Vision API muss aktiviert werden.",{duration:5e3}):i.error?.includes("billing")?r.error("Google Cloud Billing erforderlich",{duration:5e3}):i.rawText?r.error("Text erkannt aber keine Artikel gefunden. Versuche bessere Bildqualität.",{duration:4e3}):r.error(i.error||"Keine Artikel erkannt. Bitte bessere Bildqualität verwenden.",{duration:4e3})}catch(a){r.error(g(a)),h()}Q(!1)},s.onerror=()=>{r.error("Datei konnte nicht gelesen werden"),h(),Q(!1)},s.readAsDataURL(t)}catch(s){r.error(g(s)),h(),Q(!1)}},[ut,pe]=l(null),[k,Xt]=l(!1),[Be,Re]=l(null),[Ws,Qs]=l(0),[ht,be]=l(new Set),[Ea,Ys]=l([]),xt=async()=>{if(!x.current||!ne.current||N)return;const t=Date.now();if(t-Ws<1500)return;Qs(t),Q(!0),pe(null);const s=x.current,a=ne.current,n=s.videoWidth||1920,c=s.videoHeight||1080,i=Math.max(n,1920),u=Math.max(c,1080);a.width=i,a.height=u;const D=a.getContext("2d",{willReadFrequently:!0,alpha:!1});D&&(D.drawImage(s,0,0,n,c,0,0,i,u),a.toBlob(async ft=>{if(ft)try{const $e=new FileReader;$e.onload=async()=>{const ra=$e.result.split(",")[1];try{const Ne=(await Pe(Ie,"analyzeReceipt")({fileData:ra,fileType:"image/jpeg",fileName:"live-scan-full.jpg"})).data;if(Ne.success&&Ne.items&&Ne.items.length>0){const gt=(Ne.rawText||"").split(/[\n\r]+/),qe=Ne.items.map((f,B)=>{const Ke=(f.name||"Unbekannt").toLowerCase().trim(),we=(f.unitPrice||f.totalPrice||0).toFixed(2),Y=f.articleNumber||"";let ve=-1;for(let E=0;E<gt.length;E++)if(gt[E].includes(f.name||"")||Y&&gt[E].includes(Y)){ve=E;break}const S=`${Ke}_${we}_${Y}_${ve>=0?ve:B}_${B}`;return{item:{name:f.name||"Unbekannt",articleNumber:f.articleNumber,quantity:f.quantity||1,unitPrice:f.unitPrice||f.totalPrice||0,totalPrice:f.totalPrice||f.unitPrice*(f.quantity||1),selected:!0},positionId:S}}).filter(({positionId:f})=>!ht.has(f));if(qe.length>0){const f=new Set(ht);qe.forEach(({positionId:B})=>{f.add(B)}),be(f),H(B=>{const Ke=new Set(B.map(S=>{const E=S.name.toLowerCase().trim(),He=S.unitPrice.toFixed(2),pt=S.articleNumber||"";return`${E}_${He}_${pt}`})),we=[...B];let Y=0;qe.forEach(({item:S,positionId:E})=>{const He=S.name.toLowerCase().trim(),pt=S.unitPrice.toFixed(2),bt=S.articleNumber||"",rs=`${He}_${pt}_${bt}`;Ke.has(rs)||bt&&B.some(Oe=>Oe.articleNumber===bt)||B.some(Oe=>Oe.name.toLowerCase().trim()===He&&Math.abs(Oe.unitPrice-S.unitPrice)<.01)||(we.push(S),Y++,Ke.add(rs))});const ve=we.reduce((S,E)=>S+E.totalPrice,0);return O(ve),Y>0?(r.success(`${Y} neue Artikel erkannt!`,{duration:1500}),navigator.vibrate&&navigator.vibrate(200)):qe.length>0&&(k||r.info("Alle Artikel bereits in Liste",{duration:1e3})),we})}else k||r.info("Alle Artikel bereits erkannt",{duration:1e3})}else k||pe("Keine Artikel erkannt")}catch(as){if(!k){const ns=g(as);pe(ns)}h()}Q(!1)},$e.readAsDataURL(ft)}catch{h(),Q(!1)}},"image/jpeg",.95))};le(()=>{if(k&&d&&se==="single"){const t=setTimeout(()=>{!N&&d&&xt()},500),s=setInterval(()=>{!N&&d&&xt()},2e3);return Re(s),()=>{clearInterval(s),clearTimeout(t),Re(null)}}else Be&&(clearInterval(Be),Re(null))},[k,d,se,N]);const Zs=async()=>{await xt()},Js=()=>{if(!A)return;const t={...A,quantity:de,totalPrice:A.unitPrice*de};H(s=>[...s,t]),O(s=>s+t.totalPrice),Te(null),me(1),r.success(`${t.name} (${de}x) hinzugefügt`),w()},Xs=()=>{Te(null),me(1)},es=t=>{H(s=>{const a=s[t];return O(n=>n-a.totalPrice),s.filter((n,c)=>c!==t)})},ts=(t,s)=>{if(s<1){es(t);return}H(a=>{const n=[...a],c=n[t],i=c.totalPrice;return n[t]={...c,quantity:s,totalPrice:c.unitPrice*s},O(u=>u-i+n[t].totalPrice),n})},ea=async()=>{if(L.length===0){r.error("Keine Artikel gescannt");return}try{for(const t of L)await Ue({listId:I||void 0,item:t.name,quantity:t.quantity||1,category:ss(t.name),estimatedPrice:(t.totalPrice||t.unitPrice||0)*100,currency:"CHF",store:o?.store?.name||null});r.success(`${L.length} Artikel hinzugefügt!`),H([]),O(0),je(),await b()}catch(t){r.error("Fehler: "+t.message)}},ta=async()=>{const t=P.filter(s=>s.selected);if(t.length===0){r.error("Bitte mindestens einen Artikel auswählen");return}try{for(const s of t)await Ue({listId:I||void 0,item:s.name,quantity:s.quantity||1,category:ss(s.name),estimatedPrice:(s.totalPrice||s.unitPrice||0)*100,currency:"CHF",store:o?.store?.name||null});r.success(`${t.length} Artikel hinzugefügt!`),je(),await b()}catch(s){r.error("Fehler: "+s.message)}},sa=async()=>{if(o)try{await Pe(Ie,"saveReceipt")({receiptData:o}),r.success("Quittung gespeichert!")}catch(t){r.error("Fehler: "+t.message)}},aa=async()=>{if(o)try{await fa({type:"ausgabe",amount:o.totals.total*100,category:"Lebensmittel",notes:`Einkauf bei ${o.store.name}`,date:o.purchase.date||new Date().toISOString().split("T")[0],paymentMethod:o.purchase.paymentMethod||"Karte",currency:"CHF",isRecurring:!1}),r.success("Zu Finanzen hinzugefügt!"),w(),je()}catch(t){r.error(g(t)),h()}},ss=t=>{const s=t.toLowerCase(),a={Getränke:["bier","wein","saft","wasser","cola","fanta","sprite","energy","shot","drink"],"Obst & Gemüse":["apfel","orange","banane","tomate","salat","gurke","karotte","bio oran","gemüse"],Milchprodukte:["milch","joghurt","käse","butter","sahne","quark","naturejog"],Fleisch:["fleisch","steak","wurst","schinken","poulet","rind","schwein","ragout"],Backwaren:["brot","brötchen","toast","croissant","kuchen","keks","butterkeks"],Süsswaren:["schoko","bonbon","gummi","chips","zucker","gelatine"]};for(const[n,c]of Object.entries(a))if(c.some(i=>s.includes(i)))return n;return"Lebensmittel"},na=()=>{Et(!0),ae([]),te("camera"),setTimeout(()=>ge(),100)},je=()=>{mt(),Et(!1),ae([]),Je(null),H([]),O(0),Ee("receipt"),Te(null),me(1),pe(null),Xt(!1),be(new Set),Ys([]),Be&&(clearInterval(Be),Re(null))};return e.jsxs(ga,{title:W("nav.shopping","Einkaufsliste"),showSidebar:!0,children:[e.jsx("div",{className:"mb-4 flex items-center gap-2",children:F?e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"flex-1 flex items-center gap-2",children:[e.jsx(m,{variant:"outline",size:"sm",onClick:Hs,className:"h-11",children:y.size===re.length+V.length?"Alle abwählen":"Alle auswählen"}),e.jsxs("span",{className:"text-sm text-muted-foreground",children:[y.size," ausgewählt"]})]}),e.jsx(m,{variant:"outline",size:"icon",onClick:Os,className:"h-11 w-11",children:e.jsx(T,{className:"w-5 h-5"})}),y.size>0&&e.jsx(m,{variant:"destructive",size:"icon",onClick:Ks,className:"h-11 w-11",children:e.jsx(Le,{className:"w-5 h-5"})})]}):e.jsxs(e.Fragment,{children:[e.jsxs(ye,{value:I||"",onValueChange:t=>Ae(t),disabled:ds,children:[e.jsx(ke,{className:"flex-1 h-11",children:e.jsx(Se,{placeholder:"Liste wählen"})}),e.jsx(Ce,{children:C.map(t=>e.jsxs(p,{value:t.id,children:[t.name," ",t.isDefault&&"(Standard)"]},t.id))})]}),e.jsx(m,{variant:"outline",size:"icon",onClick:()=>Fe(!0),className:"h-11 w-11",children:e.jsx(It,{className:"w-5 h-5"})}),e.jsx(m,{variant:"outline",size:"icon",onClick:()=>dt(!0),className:"h-11 w-11",children:e.jsx($,{className:"w-5 h-5"})})]})}),e.jsxs("div",{className:"mobile-card mb-4 bg-primary text-primary-foreground",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-3",children:[e.jsx(Pt,{className:"w-6 h-6 opacity-70"}),e.jsx("p",{className:"text-sm opacity-70 font-medium",children:C.find(t=>t.id===I)?.name||W("shopping.list","Einkaufsliste")})]}),e.jsx("p",{className:"text-3xl font-semibold mb-2",children:re.length}),e.jsx("p",{className:"text-sm opacity-60",children:W("shopping.itemsOpen","Artikel offen")})]}),xs?e.jsx("div",{className:"text-center py-8 text-muted-foreground",children:W("common.loading","Laden...")}):re.length===0?e.jsxs("div",{className:"mobile-card text-center py-8",children:[e.jsx($,{className:"w-10 h-10 mx-auto status-success mb-2"}),e.jsx("p",{className:"text-muted-foreground",children:W("shopping.empty","Liste ist leer")})]}):e.jsx("div",{className:"space-y-3 mb-4",children:re.map(t=>e.jsxs("div",{className:`mobile-card flex items-center gap-4 py-3 ${F&&y.has(t.id)?"ring-2 ring-primary":""}`,onClick:F?()=>Qt(t.id):void 0,children:[F?e.jsx("div",{className:"w-6 h-6 rounded border-2 border-border flex items-center justify-center shrink-0",children:y.has(t.id)&&e.jsx($,{className:"w-4 h-4 text-primary"})}):e.jsx("button",{onClick:()=>Wt(t.id,t.status),className:"w-6 h-6 rounded border-2 border-border flex items-center justify-center shrink-0"}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("p",{className:"font-medium truncate",children:t.item}),e.jsxs("p",{className:"text-xs text-muted-foreground",children:[t.quantity>1&&`${t.quantity}x • `,t.category,t.store&&` • ${t.store}`]})]}),!F&&e.jsx("button",{onClick:()=>qs(t.id),className:"w-10 h-10 rounded-lg flex items-center justify-center text-muted-foreground active:opacity-80",children:e.jsx(Le,{className:"w-4 h-4"})})]},t.id))}),V.length>0&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsxs("p",{className:"text-xs font-medium text-muted-foreground uppercase tracking-wider",children:[W("shopping.bought","Eingekauft")," (",V.length,")"]}),!F&&e.jsx("button",{onClick:Us,className:"text-xs status-error active:opacity-80",children:W("shopping.clearBought","Löschen")})]}),e.jsx("div",{className:"space-y-3 opacity-60",children:V.map(t=>e.jsxs("div",{className:`mobile-card flex items-center gap-4 py-3 ${F&&y.has(t.id)?"ring-2 ring-primary opacity-100":""}`,onClick:F?()=>Qt(t.id):void 0,children:[F?e.jsx("div",{className:"w-6 h-6 rounded border-2 border-border flex items-center justify-center shrink-0",children:y.has(t.id)&&e.jsx($,{className:"w-4 h-4 text-primary"})}):e.jsx("button",{onClick:()=>Wt(t.id,t.status),className:"w-6 h-6 rounded bg-status-success flex items-center justify-center shrink-0",children:e.jsx($,{className:"w-4 h-4 status-success"})}),e.jsx("p",{className:"font-medium line-through flex-1 truncate",children:t.item})]},t.id))})]}),Ft&&e.jsx("div",{className:"fixed inset-0 z-50 bg-black/50 flex items-end",children:e.jsxs("div",{className:"bg-background w-full rounded-t-2xl p-6 safe-bottom animate-in slide-in-from-bottom",children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsx("h2",{className:"text-lg font-semibold",children:"Artikel hinzufügen"}),e.jsx("button",{onClick:()=>Ze(!1),className:"w-10 h-10 rounded-lg bg-muted flex items-center justify-center",children:e.jsx(T,{className:"w-5 h-5"})})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsx("div",{children:e.jsx(_,{value:v.name,onChange:t=>ce({...v,name:t.target.value}),placeholder:"Artikelname",className:"mobile-input",autoFocus:!0})}),e.jsxs("div",{className:"flex gap-3",children:[e.jsx("div",{className:"w-20",children:e.jsx(_,{type:"number",value:v.quantity,onChange:t=>ce({...v,quantity:t.target.value}),placeholder:"1",className:"mobile-input text-center",min:"1"})}),e.jsx("div",{className:"flex-1",children:e.jsxs(ye,{value:v.category,onValueChange:t=>ce({...v,category:t}),children:[e.jsx(ke,{className:"mobile-input",children:e.jsx(Se,{})}),e.jsx(Ce,{children:os.map(t=>e.jsx(p,{value:t,children:t},t))})]})})]}),e.jsx("div",{children:e.jsxs(ye,{value:v.store||"none",onValueChange:t=>ce({...v,store:t==="none"?"":t}),children:[e.jsx(ke,{className:"mobile-input",children:e.jsx(Se,{placeholder:"Laden (optional)"})}),e.jsxs(Ce,{children:[e.jsx(p,{value:"none",children:"Kein Laden"}),e.jsx(p,{value:"Migros",children:"Migros"}),e.jsx(p,{value:"Coop",children:"Coop"}),e.jsx(p,{value:"Aldi",children:"Aldi"}),e.jsx(p,{value:"Lidl",children:"Lidl"}),e.jsx(p,{value:"Denner",children:"Denner"})]})]})}),e.jsx(m,{onClick:js,className:"w-full mobile-btn bg-primary text-primary-foreground mt-4",children:"Hinzufügen"})]})]})}),e.jsx(wt,{open:zt,onOpenChange:De,children:e.jsxs(vt,{className:"!fixed !top-[50%] !left-[50%] !right-auto !bottom-auto !translate-x-[-50%] !translate-y-[-50%] !w-[90vw] !max-w-2xl !max-h-[90vh] !rounded-3xl !m-0 !overflow-hidden !shadow-2xl !flex !flex-col",children:[e.jsxs(yt,{className:"px-5 pt-5 pb-3 flex-shrink-0",children:[e.jsx(kt,{className:"text-lg font-semibold",children:"Mehrere Artikel hinzufügen"}),e.jsx(St,{className:"sr-only",children:"Fügen Sie mehrere Artikel gruppiert nach Laden hinzu"})]}),e.jsxs("div",{className:"px-5 pb-2 overflow-y-auto flex-1 min-h-0 space-y-4",children:[j.length===0&&e.jsxs("div",{className:"text-center py-8 text-muted-foreground",children:[e.jsx(Ge,{className:"w-12 h-12 mx-auto mb-3 opacity-50"}),e.jsx("p",{children:"Keine Laden-Gruppen vorhanden"}),e.jsx("p",{className:"text-sm mt-1",children:'Klicken Sie auf "Laden hinzufügen" um zu beginnen'})]}),j.map((t,s)=>e.jsxs("div",{className:"border rounded-xl p-4 space-y-3 bg-muted/30",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Ge,{className:"w-4 h-4 text-muted-foreground"}),e.jsxs(ye,{value:t.store||"none",onValueChange:a=>vs(s,a==="none"?"":a),children:[e.jsx(ke,{className:"flex-1 h-9",children:e.jsx(Se,{placeholder:"Laden wählen"})}),e.jsxs(Ce,{children:[e.jsx(p,{value:"none",children:"Laden wählen"}),e.jsx(p,{value:"Migros",children:"Migros"}),e.jsx(p,{value:"Coop",children:"Coop"}),e.jsx(p,{value:"Aldi",children:"Aldi"}),e.jsx(p,{value:"Lidl",children:"Lidl"}),e.jsx(p,{value:"Denner",children:"Denner"}),e.jsx(p,{value:"Volg",children:"Volg"}),e.jsx(p,{value:"Spar",children:"Spar"})]})]}),e.jsx(m,{variant:"ghost",size:"sm",onClick:()=>ws(s),className:"h-9 w-9 p-0",children:e.jsx(T,{className:"w-4 h-4"})})]}),e.jsxs("div",{className:"space-y-2",children:[t.items.map(a=>e.jsx("div",{className:"bg-background rounded-lg p-3 space-y-2 border",children:e.jsxs("div",{className:"flex items-start gap-2",children:[e.jsxs("div",{className:"flex-1 space-y-2",children:[e.jsxs("div",{className:"flex gap-2",children:[e.jsx(_,{placeholder:"Artikelname *",value:a.name,onChange:n=>z(s,a.id,"name",n.target.value),className:"flex-1 h-9"}),e.jsx(_,{type:"number",placeholder:"Menge",value:a.quantity,onChange:n=>z(s,a.id,"quantity",n.target.value),className:"w-20 h-9",min:"1"})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(ye,{value:a.category,onValueChange:n=>z(s,a.id,"category",n),children:[e.jsx(ke,{className:"flex-1 h-9",children:e.jsx(Se,{})}),e.jsx(Ce,{children:os.map(n=>e.jsx(p,{value:n,children:n},n))})]}),e.jsx(_,{type:"number",step:"0.01",placeholder:"Preis (CHF)",value:a.price,onChange:n=>z(s,a.id,"price",n.target.value),className:"w-24 h-9"})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(_,{placeholder:"Artikelnummer (EAN/Barcode)",value:a.articleNumber,onChange:n=>z(s,a.id,"articleNumber",n.target.value),className:"flex-1 h-9"}),e.jsx(m,{variant:"outline",size:"sm",onClick:()=>Ts(s,a.id),className:"h-9",title:"Barcode scannen",children:e.jsx(pa,{className:"w-4 h-4"})}),e.jsx(m,{variant:"outline",size:"sm",onClick:()=>Ms(s,a.id),className:"h-9",title:"Produktinfo scannen",children:e.jsx(Ve,{className:"w-4 h-4"})})]}),a.productInfo&&e.jsxs("div",{className:"bg-muted/50 rounded p-2 text-xs space-y-1",children:[a.productInfo.brand&&e.jsxs("p",{children:[e.jsx("strong",{children:"Marke:"})," ",a.productInfo.brand]}),a.productInfo.description&&e.jsxs("p",{children:[e.jsx("strong",{children:"Beschreibung:"})," ",a.productInfo.description]}),a.productInfo.price&&e.jsxs("p",{children:[e.jsx("strong",{children:"Preis:"})," CHF ",a.productInfo.price]}),a.productInfo.imageUrl&&e.jsx("img",{src:a.productInfo.imageUrl,alt:"Produkt",className:"w-full h-24 object-contain mt-2 rounded"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(ma,{checked:a.saveToDatabase||!1,onCheckedChange:n=>z(s,a.id,"saveToDatabase",n)}),e.jsx(ls,{className:"text-xs",children:"Für zukünftige Käufe speichern"})]})]}),e.jsx(m,{variant:"ghost",size:"sm",onClick:()=>ks(s,a.id),className:"h-9 w-9 p-0",children:e.jsx(Le,{className:"w-4 h-4"})})]})},a.id)),e.jsxs(m,{variant:"outline",size:"sm",onClick:()=>ys(s),className:"w-full h-9",children:[e.jsx(_e,{className:"w-4 h-4 mr-2"}),"Artikel hinzufügen"]})]})]},s)),e.jsxs(m,{variant:"outline",onClick:Ns,className:"w-full",children:[e.jsx(Ge,{className:"w-4 h-4 mr-2"}),"Laden hinzufügen"]})]}),e.jsxs(Ct,{className:"px-5 pb-3 pt-2 gap-2.5 flex-shrink-0",children:[e.jsx(m,{variant:"outline",onClick:()=>{De(!1),K([])},className:"h-11 min-h-[44px] flex-1 rounded-xl text-sm font-medium",children:"Abbrechen"}),e.jsxs(m,{onClick:Bs,disabled:j.length===0||j.every(t=>t.items.length===0),className:"h-11 min-h-[44px] flex-1 rounded-xl text-sm font-medium",children:[j.reduce((t,s)=>t+s.items.length,0)," Artikel hinzufügen"]})]})]})}),Dt&&e.jsxs("div",{className:"fixed inset-0 z-50 bg-black flex flex-col",children:[e.jsxs("div",{className:"flex items-center justify-between p-4 bg-black/50",children:[e.jsx("h2",{className:"text-white font-semibold",children:"Liste scannen"}),e.jsx("button",{onClick:je,className:"w-10 h-10 rounded-lg bg-white/20 flex items-center justify-center",children:e.jsx(T,{className:"w-5 h-5 text-white"})})]}),e.jsxs("div",{className:"flex gap-2 px-4 py-2",children:[e.jsxs("button",{onClick:()=>{Ee("receipt"),te("camera"),ge()},className:`flex-1 py-2 px-3 rounded-lg flex items-center justify-center gap-1.5 text-sm ${se==="receipt"&&oe==="camera"?"bg-white text-black":"bg-white/20 text-white"}`,children:[e.jsx(ba,{className:"w-4 h-4"}),"Quittung"]}),e.jsxs("button",{onClick:async()=>{Ee("single"),te("camera"),H([]),O(0),be(new Set),Te(null),pe(null),await ge()},className:`flex-1 py-2 px-3 rounded-lg flex items-center justify-center gap-1.5 text-sm ${se==="single"?"bg-white text-black":"bg-white/20 text-white"}`,children:[e.jsx(We,{className:"w-4 h-4"}),"Einzeln"]}),e.jsxs("button",{onClick:()=>{Ee("receipt"),te("upload"),mt()},className:`flex-1 py-2 px-3 rounded-lg flex items-center justify-center gap-1.5 text-sm ${oe==="upload"?"bg-white text-black":"bg-white/20 text-white"}`,children:[e.jsx(ja,{className:"w-4 h-4"}),"Upload"]})]}),oe==="camera"&&se==="receipt"&&P.length===0&&e.jsxs("div",{className:"flex-1 relative",children:[e.jsx("video",{ref:x,autoPlay:!0,playsInline:!0,muted:!0,preload:"auto",className:"absolute inset-0 w-full h-full object-cover"}),e.jsx("canvas",{ref:ne,className:"hidden"}),d&&e.jsxs("div",{className:"absolute inset-0 pointer-events-none",children:[e.jsx("div",{className:"absolute inset-8 border-2 border-white/60 rounded-lg"}),e.jsx("div",{className:"absolute top-8 left-8 w-6 h-6 border-t-4 border-l-4 border-white rounded-tl"}),e.jsx("div",{className:"absolute top-8 right-8 w-6 h-6 border-t-4 border-r-4 border-white rounded-tr"}),e.jsx("div",{className:"absolute bottom-8 left-8 w-6 h-6 border-b-4 border-l-4 border-white rounded-bl"}),e.jsx("div",{className:"absolute bottom-8 right-8 w-6 h-6 border-b-4 border-r-4 border-white rounded-br"})]}),e.jsx("div",{className:"absolute top-4 left-4 right-4 z-20",children:e.jsx("div",{className:"bg-black/60 rounded-lg p-3 text-center",children:e.jsx("p",{className:"text-white text-sm font-medium",children:N?"Analysiere...":"Quittung fotografieren"})})}),e.jsx("div",{className:"absolute bottom-8 left-0 right-0 z-20",children:d?e.jsxs("div",{className:"flex justify-center items-center gap-4",children:[e.jsx("button",{onClick:je,className:"w-12 h-12 rounded-full bg-white/20 flex items-center justify-center active:opacity-80",children:e.jsx(T,{className:"w-6 h-6 text-white"})}),e.jsx("button",{onClick:Vs,disabled:N,className:"w-20 h-20 rounded-full bg-white shadow-lg flex items-center justify-center active:opacity-80 border-4 border-white/50",children:N?e.jsx("div",{className:"w-8 h-8 border-3 border-gray-300 border-t-gray-600 rounded-full animate-spin"}):e.jsx("div",{className:"w-14 h-14 rounded-full bg-white"})}),e.jsx("div",{className:"w-12 h-12"})]}):e.jsx("div",{className:"flex justify-center",children:e.jsxs("button",{onClick:ge,className:"px-6 py-3 rounded-full bg-white shadow-lg flex items-center justify-center gap-2 active:opacity-80",children:[e.jsx(Ve,{className:"w-5 h-5 text-gray-800"}),e.jsx("span",{className:"font-medium text-gray-800",children:"Kamera starten"})]})})})]}),oe==="camera"&&se==="single"&&e.jsxs("div",{className:"flex-1 flex flex-col bg-background w-full h-full overflow-hidden",children:[e.jsx("div",{className:"w-full px-4 py-3 bg-background/95 backdrop-blur-sm border-b border-border/50 flex-shrink-0",children:e.jsxs("div",{className:"flex items-center justify-between gap-3",children:[e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[e.jsx("div",{className:`w-2 h-2 rounded-full ${d?"bg-green-500 animate-pulse":"bg-gray-400"}`}),e.jsx("p",{className:"text-xs font-medium text-muted-foreground",children:d?"Kamera aktiv":"Kamera inaktiv"})]}),e.jsx("p",{className:"text-sm font-bold truncate",children:N?"Analysiere...":k?`${ht.size} Positionen erkannt`:L.length>0?`${L.length} Artikel gescannt`:"Bereit zum Scannen"})]}),e.jsxs("button",{onClick:()=>Xt(!k),disabled:!d,className:`px-3 py-2 rounded-lg flex items-center gap-1.5 flex-shrink-0 transition-all ${k&&d?"bg-green-500 text-white shadow-lg":"bg-muted text-muted-foreground"} ${d?"":"opacity-50"}`,children:[e.jsx("div",{className:`w-2 h-2 rounded-full ${k&&d?"bg-white":"bg-foreground/50"}`}),e.jsx("span",{className:"text-xs font-semibold",children:"Auto"})]})]})}),e.jsxs("div",{className:"flex-1 flex flex-col w-full overflow-hidden min-h-0 relative",children:[e.jsxs("div",{className:"relative bg-black w-full flex-1 flex-shrink-0 min-h-0",children:[e.jsx("video",{ref:x,autoPlay:!0,playsInline:!0,muted:!0,preload:"auto",className:"absolute inset-0 w-full h-full object-cover",style:{minWidth:"100%",minHeight:"100%"}}),e.jsx("canvas",{ref:ne,className:"hidden"}),d&&k&&e.jsxs("div",{className:"absolute inset-0 pointer-events-none",children:[N&&e.jsx("div",{className:"absolute left-0 right-0 h-1 bg-green-500/50",style:{top:"50%",animation:"scan-line 1.5s ease-in-out infinite",boxShadow:"0 0 20px rgba(16, 185, 129, 0.6)",transform:"translateY(-50%)"}}),e.jsx("div",{className:"absolute top-4 left-1/2 transform -translate-x-1/2 z-10",children:e.jsxs("div",{className:"bg-green-500/90 backdrop-blur-sm text-white px-4 py-2 rounded-full text-xs font-semibold flex items-center gap-2 shadow-lg",children:[e.jsx("div",{className:"w-2 h-2 bg-white rounded-full animate-pulse"}),N?"Analysiere...":`Live-Scan (${L.length} Artikel)`]})})]}),d&&!k&&e.jsx("div",{className:"absolute top-4 left-1/2 transform -translate-x-1/2 z-10",children:e.jsx("div",{className:"bg-black/60 backdrop-blur-sm text-white px-4 py-2 rounded-full text-xs font-medium",children:"Quittung vollständig sichtbar machen"})}),d&&!A&&e.jsx("div",{className:"absolute bottom-0 left-0 right-0 z-20 p-4 bg-gradient-to-t from-black/80 via-black/40 to-transparent",children:e.jsx("button",{onClick:Zs,disabled:N,className:`w-full py-4 rounded-xl shadow-2xl flex items-center justify-center gap-3 transition-all transform ${N?"bg-gray-600/90":"bg-green-500 hover:bg-green-600 active:scale-95"}`,children:N?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"w-6 h-6 border-2 border-white/30 border-t-white rounded-full animate-spin"}),e.jsx("span",{className:"font-bold text-white text-lg",children:"Analysiere..."})]}):e.jsxs(e.Fragment,{children:[e.jsx(We,{className:"w-6 h-6 text-white"}),e.jsx("span",{className:"font-bold text-white text-lg",children:"ALLE SCANNEN"})]})})}),!d&&e.jsxs("div",{className:"absolute inset-0 flex flex-col items-center justify-center bg-gradient-to-b from-black/90 to-black/70",children:[e.jsxs("div",{className:"text-center mb-8",children:[e.jsx("div",{className:"w-20 h-20 mx-auto mb-4 rounded-full bg-white/10 backdrop-blur-sm flex items-center justify-center",children:e.jsx(Ve,{className:"w-10 h-10 text-white"})}),e.jsx("p",{className:"text-white text-lg font-semibold mb-2",children:"Kamera starten"}),e.jsx("p",{className:"text-white/70 text-sm",children:"Für das Scannen von Quittungen"})]}),e.jsxs("button",{onClick:ge,className:"px-8 py-4 rounded-xl bg-white shadow-2xl flex items-center justify-center gap-3 hover:bg-gray-50 active:scale-95 transition-all",children:[e.jsx(Ve,{className:"w-6 h-6 text-gray-800"}),e.jsx("span",{className:"font-bold text-gray-800 text-base",children:"Kamera aktivieren"})]})]})]}),e.jsxs("div",{className:"flex-1 overflow-y-auto bg-background w-full p-4 min-h-0",children:[ut&&!A&&e.jsxs("div",{className:"mb-4 p-4 bg-red-500/10 border border-red-500/30 rounded-xl backdrop-blur-sm",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx("div",{className:"w-2 h-2 rounded-full bg-red-500"}),e.jsx("p",{className:"text-red-600 font-semibold text-sm",children:"Fehler"})]}),e.jsx("p",{className:"text-red-600 font-medium text-center text-sm",children:ut}),e.jsx("p",{className:"text-red-500/70 text-xs text-center mt-1",children:"Quittung näher halten und erneut scannen"})]}),A&&e.jsxs("div",{className:"mb-4 p-5 bg-green-500/10 border border-green-500/40 rounded-xl backdrop-blur-sm",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-3",children:[e.jsx("div",{className:"w-2 h-2 rounded-full bg-green-500 animate-pulse"}),e.jsx("p",{className:"text-green-600 font-bold text-sm",children:"ERKANNT"})]}),e.jsxs("div",{className:"bg-background/80 backdrop-blur-sm rounded-lg p-4 mb-4 border border-border/50",children:[e.jsx("p",{className:"font-bold text-base mb-1",children:A.name}),e.jsxs("p",{className:"text-xs text-muted-foreground",children:["CHF ",A.unitPrice.toFixed(2)," pro Stück"]})]}),e.jsxs("div",{className:"flex items-center justify-center gap-4 mb-4",children:[e.jsx("button",{onClick:()=>me(t=>Math.max(1,t-1)),className:"w-11 h-11 rounded-full bg-muted flex items-center justify-center text-xl font-bold active:scale-95 transition-transform",children:"−"}),e.jsx("div",{className:"w-16 h-11 rounded-lg bg-background border border-border flex items-center justify-center",children:e.jsx("span",{className:"text-2xl font-bold",children:de})}),e.jsx("button",{onClick:()=>me(t=>t+1),className:"w-11 h-11 rounded-full bg-muted flex items-center justify-center text-xl font-bold active:scale-95 transition-transform",children:"+"})]}),e.jsxs("div",{className:"text-center mb-4 p-3 bg-background/50 rounded-lg border border-border/50",children:[e.jsx("p",{className:"text-xs text-muted-foreground mb-1",children:"Total"}),e.jsxs("p",{className:"text-xl font-bold",children:["CHF ",(A.unitPrice*de).toFixed(2)]})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs("button",{onClick:Xs,className:"flex-1 py-3 rounded-lg bg-muted flex items-center justify-center gap-2 text-sm font-semibold active:scale-95 transition-transform",children:[e.jsx(T,{className:"w-4 h-4"}),"Abbrechen"]}),e.jsxs("button",{onClick:Js,className:"flex-1 py-3 rounded-lg bg-green-500 text-white flex items-center justify-center gap-2 text-sm font-semibold shadow-lg active:scale-95 transition-transform",children:[e.jsx($,{className:"w-4 h-4"}),"Hinzufügen"]})]})]}),!A&&L.length===0&&!ut&&e.jsxs("div",{className:"text-center py-8",children:[e.jsx("div",{className:"w-16 h-16 mx-auto mb-4 rounded-full bg-muted/50 flex items-center justify-center",children:e.jsx(We,{className:"w-8 h-8 text-muted-foreground/40"})}),e.jsx("p",{className:"text-base font-bold text-foreground mb-2",children:"Artikel scannen"}),e.jsx("p",{className:"text-xs text-muted-foreground/70 px-4",children:k?e.jsx(e.Fragment,{children:"Auto-Scan aktiv: Quittung in den Rahmen halten"}):e.jsx(e.Fragment,{children:'Quittung in den Rahmen halten und "ALLE SCANNEN" drücken'})})]}),L.length>0&&e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center justify-between mb-3 p-3 bg-green-500/10 rounded-xl border border-green-500/30 backdrop-blur-sm",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-8 h-8 rounded-full bg-green-500/20 flex items-center justify-center",children:e.jsx(Pt,{className:"w-4 h-4 text-green-600"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-muted-foreground",children:"Gesamt"}),e.jsxs("p",{className:"font-bold text-sm",children:[L.reduce((t,s)=>t+s.quantity,0)," Artikel"]})]})]}),e.jsxs("div",{className:"text-right",children:[e.jsx("p",{className:"text-xs text-muted-foreground",children:"Total"}),e.jsxs("p",{className:"text-xl font-bold text-green-600",children:["CHF ",fs.toFixed(2)]})]})]}),e.jsx("div",{className:"space-y-2.5 mb-3",children:L.map((t,s)=>e.jsxs("div",{className:"p-3 bg-muted/80 backdrop-blur-sm rounded-xl border border-border/50",children:[e.jsxs("div",{className:"flex items-start justify-between mb-2.5",children:[e.jsxs("div",{className:"flex items-center gap-2.5 flex-1 min-w-0",children:[e.jsx("div",{className:"w-9 h-9 rounded-full bg-green-500 text-white text-xs font-bold flex items-center justify-center flex-shrink-0 shadow-sm",children:t.quantity}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("p",{className:"font-bold text-sm mb-0.5 truncate",children:t.name}),e.jsxs("p",{className:"text-xs text-muted-foreground",children:["CHF ",t.unitPrice.toFixed(2)," pro Stück"]})]})]}),e.jsx("button",{onClick:()=>es(s),className:"w-8 h-8 rounded-full bg-red-500/10 flex items-center justify-center flex-shrink-0 active:scale-95 transition-transform",children:e.jsx(T,{className:"w-4 h-4 text-red-500"})})]}),e.jsxs("div",{className:"flex items-center justify-between pt-2 border-t border-border/50",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{onClick:()=>ts(s,t.quantity-1),className:"w-9 h-9 rounded-full bg-background border border-border flex items-center justify-center text-lg font-bold active:scale-95 transition-transform",children:"−"}),e.jsx("div",{className:"w-10 h-9 rounded-lg bg-background border border-border flex items-center justify-center",children:e.jsx("span",{className:"text-lg font-bold",children:t.quantity})}),e.jsx("button",{onClick:()=>ts(s,t.quantity+1),className:"w-9 h-9 rounded-full bg-background border border-border flex items-center justify-center text-lg font-bold active:scale-95 transition-transform",children:"+"})]}),e.jsxs("div",{className:"text-right",children:[e.jsx("p",{className:"text-xs text-muted-foreground",children:"Total"}),e.jsxs("p",{className:"font-bold text-base",children:["CHF ",t.totalPrice.toFixed(2)]})]})]})]},s))}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs("button",{onClick:()=>{be(new Set),r.success("Positionen zurückgesetzt")},className:"px-3 py-2.5 rounded-lg bg-muted flex items-center justify-center gap-1.5 text-xs font-semibold active:scale-95 transition-transform",children:[e.jsx(Na,{className:"w-3.5 h-3.5"}),"Reset"]}),e.jsxs("button",{onClick:()=>{H([]),O(0),be(new Set)},className:"flex-1 py-2.5 rounded-lg bg-muted flex items-center justify-center gap-1.5 text-xs font-semibold active:scale-95 transition-transform",children:[e.jsx(Le,{className:"w-3.5 h-3.5"}),"Alle löschen"]}),e.jsxs("button",{onClick:ea,className:"flex-1 py-2.5 rounded-lg bg-primary text-primary-foreground flex items-center justify-center gap-1.5 text-xs font-semibold shadow-lg active:scale-95 transition-transform",children:[e.jsx($,{className:"w-3.5 h-3.5"}),"Fertig"]})]})]})]})]})]}),oe==="upload"&&P.length===0&&e.jsxs("div",{className:"flex-1 flex items-center justify-center p-4",children:[e.jsxs("button",{onClick:()=>Tt.current?.click(),className:"w-full max-w-sm p-8 border-2 border-dashed border-white/30 rounded-xl text-center",children:[e.jsx(It,{className:"w-12 h-12 mx-auto text-white/50 mb-4"}),e.jsx("p",{className:"text-white font-medium",children:"Foto auswählen"}),e.jsx("p",{className:"text-white/50 text-sm mt-2",children:"JPG, PNG oder PDF"})]}),e.jsx("input",{ref:Tt,type:"file",accept:"image/*,application/pdf",capture:"environment",className:"hidden",onChange:_s})]}),N&&e.jsx("div",{className:"flex-1 flex items-center justify-center",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"w-12 h-12 border-2 border-white/30 border-t-white rounded-full animate-spin mx-auto mb-4"}),e.jsx("p",{className:"text-white",children:"Analysiere Liste..."})]})}),o&&P.length>0&&e.jsx("div",{className:"flex-1 bg-background overflow-y-auto",children:e.jsxs("div",{className:"p-4 space-y-4",children:[e.jsxs("div",{className:"bg-muted rounded-xl overflow-hidden",children:[e.jsxs("button",{onClick:()=>gs(!Xe),className:"w-full p-3 flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Ge,{className:"w-4 h-4 text-primary"}),e.jsx("span",{className:"font-medium",children:"Geschäft"})]}),Xe?e.jsx(Lt,{className:"w-4 h-4"}):e.jsx(At,{className:"w-4 h-4"})]}),Xe&&e.jsxs("div",{className:"px-3 pb-3 space-y-1",children:[e.jsx("p",{className:"font-semibold text-lg",children:o.store.name}),o.store.address&&e.jsx("p",{className:"text-sm text-muted-foreground",children:o.store.address}),o.store.city&&e.jsxs("p",{className:"text-sm text-muted-foreground",children:[o.store.postalCode," ",o.store.city]}),e.jsxs("div",{className:"flex gap-4 mt-2 text-xs text-muted-foreground",children:[o.purchase.date&&e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx(wa,{className:"w-3 h-3"}),new Date(o.purchase.date).toLocaleDateString("de-CH")]}),o.purchase.time&&e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx(va,{className:"w-3 h-3"}),o.purchase.time]})]})]})]}),e.jsxs("div",{className:"bg-muted rounded-xl overflow-hidden",children:[e.jsxs("button",{onClick:()=>ps(!et),className:"w-full p-3 flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Pt,{className:"w-4 h-4 text-primary"}),e.jsxs("span",{className:"font-medium",children:["Artikel (",P.length,")"]}),e.jsxs("span",{className:"text-xs bg-primary text-primary-foreground px-2 py-0.5 rounded-full",children:[P.filter(t=>t.selected).length," ausgewählt"]})]}),et?e.jsx(Lt,{className:"w-4 h-4"}):e.jsx(At,{className:"w-4 h-4"})]}),et&&e.jsxs("div",{className:"px-3 pb-3",children:[e.jsx("div",{className:"flex justify-end mb-2",children:e.jsx("button",{onClick:()=>ae(t=>t.map(s=>({...s,selected:!P.every(a=>a.selected)}))),className:"text-xs text-primary",children:P.every(t=>t.selected)?"Alle abwählen":"Alle auswählen"})}),e.jsx("div",{className:"space-y-2 max-h-64 overflow-y-auto",children:P.map((t,s)=>e.jsx("div",{className:`p-2.5 rounded-lg border ${t.selected?"bg-background border-primary":"bg-background/50 border-border"}`,onClick:()=>ae(a=>a.map((n,c)=>c===s?{...n,selected:!n.selected}:n)),children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:`w-5 h-5 rounded border-2 ${t.selected?"bg-primary border-primary":"border-border"} flex items-center justify-center shrink-0`,children:t.selected&&e.jsx($,{className:"w-3 h-3 text-white"})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("p",{className:"font-medium text-sm truncate",children:t.name}),e.jsxs("p",{className:"text-xs text-muted-foreground",children:[t.articleNumber&&e.jsxs("span",{className:"mr-2",children:["#",t.articleNumber]}),t.quantity,"x à CHF ",t.unitPrice.toFixed(2)]})]}),e.jsxs("p",{className:"font-semibold text-sm shrink-0",children:["CHF ",t.totalPrice.toFixed(2)]})]})},s))})]})]}),e.jsxs("div",{className:"bg-muted rounded-xl overflow-hidden",children:[e.jsxs("button",{onClick:()=>bs(!tt),className:"w-full p-3 flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(cs,{className:"w-4 h-4 text-primary"}),e.jsx("span",{className:"font-medium",children:"Zahlung"})]}),tt?e.jsx(Lt,{className:"w-4 h-4"}):e.jsx(At,{className:"w-4 h-4"})]}),tt&&e.jsxs("div",{className:"px-3 pb-3 space-y-2",children:[o.totals.subtotal&&e.jsxs("div",{className:"flex justify-between text-sm",children:[e.jsx("span",{className:"text-muted-foreground",children:"Zwischensumme"}),e.jsxs("span",{children:["CHF ",o.totals.subtotal.toFixed(2)]})]}),o.totals.rounding&&e.jsxs("div",{className:"flex justify-between text-sm",children:[e.jsx("span",{className:"text-muted-foreground",children:"Rundung"}),e.jsxs("span",{children:["CHF ",o.totals.rounding.toFixed(2)]})]}),e.jsxs("div",{className:"flex justify-between font-semibold text-lg pt-2 border-t",children:[e.jsx("span",{children:"Total"}),e.jsxs("span",{children:["CHF ",o.totals.total.toFixed(2)]})]}),o.purchase.paymentMethod&&e.jsxs("div",{className:"flex items-center gap-2 text-xs text-muted-foreground",children:[e.jsx(cs,{className:"w-3 h-3"}),o.purchase.paymentMethod]})]})]}),e.jsxs("div",{className:"flex items-center justify-center gap-2 text-xs text-muted-foreground",children:[e.jsx("div",{className:`w-2 h-2 rounded-full ${o.confidence>=70?"bg-green-500":o.confidence>=40?"bg-yellow-500":"bg-red-500"}`}),"Erkennungsqualität: ",o.confidence,"%"]}),e.jsxs("div",{className:"space-y-2 pt-2",children:[e.jsxs(m,{onClick:ta,className:"w-full",children:[e.jsx(_e,{className:"w-4 h-4 mr-2"}),P.filter(t=>t.selected).length," Artikel zur Liste"]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(m,{variant:"outline",onClick:sa,className:"flex-1",children:[e.jsx(ya,{className:"w-4 h-4 mr-1"}),"Speichern"]}),e.jsxs(m,{variant:"outline",onClick:aa,className:"flex-1",children:[e.jsx(ka,{className:"w-4 h-4 mr-1"}),"Zu Finanzen"]})]})]})]})})]}),Mt&&e.jsxs("div",{className:"fixed inset-0 z-[100] bg-black flex flex-col",children:[e.jsxs("div",{className:"flex items-center justify-between p-4 bg-black/50",children:[e.jsx("h2",{className:"text-white font-semibold",children:"Barcode scannen"}),e.jsx("button",{onClick:Ps,className:"w-10 h-10 rounded-lg bg-white/20 flex items-center justify-center",children:e.jsx(T,{className:"w-5 h-5 text-white"})})]}),e.jsxs("div",{className:"flex-1 relative flex items-center justify-center",children:[e.jsx("video",{ref:U,autoPlay:!0,playsInline:!0,className:"w-full h-full object-cover"}),e.jsx("canvas",{ref:nt,className:"hidden"}),e.jsx("div",{className:"absolute inset-0 flex items-center justify-center",children:e.jsx("div",{className:"w-64 h-32 border-2 border-white rounded-lg"})}),Bt&&e.jsx("div",{className:"absolute bottom-20 left-0 right-0 text-center",children:e.jsx("p",{className:"text-white bg-black/50 px-4 py-2 rounded-lg inline-block",children:"Barcode in den Rahmen positionieren"})})]})]}),Kt&&e.jsxs("div",{className:"fixed inset-0 z-[100] bg-black flex flex-col",children:[e.jsxs("div",{className:"flex items-center justify-between p-4 bg-black/50",children:[e.jsx("h2",{className:"text-white font-semibold",children:"Produkt fotografieren"}),e.jsx("button",{onClick:zs,className:"w-10 h-10 rounded-lg bg-white/20 flex items-center justify-center",children:e.jsx(T,{className:"w-5 h-5 text-white"})})]}),e.jsxs("div",{className:"flex-1 relative flex items-center justify-center",children:[e.jsx("video",{ref:G,autoPlay:!0,playsInline:!0,className:"w-full h-full object-cover"}),e.jsx("canvas",{ref:ot,className:"hidden"}),ct&&e.jsx("div",{className:"absolute inset-0 flex items-center justify-center bg-black/50",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"w-12 h-12 border-2 border-white/30 border-t-white rounded-full animate-spin mx-auto mb-4"}),e.jsx("p",{className:"text-white",children:"Analysiere Produkt..."})]})})]}),e.jsx("div",{className:"p-4 bg-black/50",children:e.jsx(m,{onClick:Fs,disabled:ct,className:"w-full bg-primary text-primary-foreground",children:ct?"Analysiere...":"Foto aufnehmen"})})]}),e.jsx(wt,{open:ms,onOpenChange:Fe,children:e.jsxs(vt,{className:"!fixed !top-[50%] !left-[50%] !right-auto !bottom-auto !translate-x-[-50%] !translate-y-[-50%] !w-[85vw] !max-w-sm !max-h-[90vh] !rounded-3xl !m-0 !overflow-hidden !shadow-2xl !flex !flex-col",children:[e.jsxs(yt,{className:"px-5 pt-5 pb-3 flex-shrink-0",children:[e.jsx(kt,{className:"text-lg font-semibold",children:"Einkaufslisten"}),e.jsx(St,{className:"sr-only",children:"Verwalten Sie Ihre Einkaufslisten"})]}),e.jsx("div",{className:"px-5 pb-2 overflow-y-auto flex-1 min-h-0 space-y-2",children:C.map(t=>e.jsx("div",{className:"flex items-center gap-2 p-3 border rounded-lg",children:hs===t.id?e.jsxs("div",{className:"flex-1 flex items-center gap-2",children:[e.jsx(_,{value:J,onChange:s=>X(s.target.value),className:"flex-1 h-9",placeholder:"Listenname",autoFocus:!0}),e.jsx(m,{size:"sm",onClick:()=>$s(t.id,J),className:"h-9",children:e.jsx($,{className:"w-4 h-4"})}),e.jsx(m,{variant:"ghost",size:"sm",onClick:()=>{Qe(null),X("")},className:"h-9",children:e.jsx(T,{className:"w-4 h-4"})})]}):e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("p",{className:"font-medium",children:t.name}),t.isDefault&&e.jsx("p",{className:"text-xs text-muted-foreground",children:"Standard"})]}),e.jsx(m,{variant:"ghost",size:"sm",onClick:()=>{Qe(t.id),X(t.name)},className:"h-9 w-9 p-0",children:e.jsx(It,{className:"w-4 h-4"})}),!t.isDefault&&e.jsx(m,{variant:"ghost",size:"sm",onClick:()=>Rs(t.id),className:"h-9 w-9 p-0 text-red-500",children:e.jsx(Le,{className:"w-4 h-4"})})]})},t.id))}),e.jsxs(Ct,{className:"px-5 pb-3 pt-2 gap-2.5 flex-shrink-0",children:[e.jsx(m,{variant:"outline",onClick:()=>Fe(!1),className:"h-11 min-h-[44px] flex-1 rounded-xl text-sm font-medium",children:"Schließen"}),e.jsxs(m,{onClick:()=>{Fe(!1),ze(!0)},className:"h-11 min-h-[44px] flex-1 rounded-xl text-sm font-medium",children:[e.jsx(_e,{className:"w-4 h-4 mr-2"}),"Neue Liste"]})]})]})}),e.jsx(wt,{open:us,onOpenChange:ze,children:e.jsxs(vt,{className:"!fixed !top-[50%] !left-[50%] !right-auto !bottom-auto !translate-x-[-50%] !translate-y-[-50%] !w-[85vw] !max-w-sm !max-h-fit !rounded-3xl !m-0 !overflow-visible !shadow-2xl !flex !flex-col",children:[e.jsxs(yt,{className:"px-5 pt-5 pb-3 flex-shrink-0",children:[e.jsx(kt,{className:"text-lg font-semibold",children:"Neue Liste erstellen"}),e.jsx(St,{className:"sr-only",children:"Erstellen Sie eine neue Einkaufsliste"})]}),e.jsx("div",{className:"space-y-3 px-5 pb-2 overflow-y-auto flex-1 min-h-0",children:e.jsxs("div",{className:"w-full",children:[e.jsx(ls,{className:"text-sm font-medium",children:"Listenname *"}),e.jsx(_,{value:J,onChange:t=>X(t.target.value),placeholder:"z.B. Wochenendeinkauf",className:"h-11 min-h-[44px] mt-1.5 rounded-xl w-full",onKeyDown:t=>{t.key==="Enter"&&_t()}})]})}),e.jsxs(Ct,{className:"px-5 pb-3 pt-2 gap-2.5 flex-shrink-0",children:[e.jsx(m,{variant:"outline",onClick:()=>{ze(!1),X("")},className:"h-11 min-h-[44px] flex-1 rounded-xl text-sm font-medium",children:"Abbrechen"}),e.jsx(m,{onClick:_t,disabled:!J.trim(),className:"h-11 min-h-[44px] flex-1 rounded-xl text-sm font-medium",children:"Erstellen"})]})]})}),!Ft&&!Dt&&!zt&&!Mt&&!Kt&&!F&&e.jsxs("div",{className:"fixed right-4 bottom-20 flex flex-col gap-3 safe-bottom",children:[e.jsx("button",{onClick:na,className:"w-12 h-12 rounded-full bg-secondary text-secondary-foreground shadow-lg flex items-center justify-center active:opacity-80 transition-opacity",children:e.jsx(We,{className:"w-5 h-5"})}),e.jsx("button",{onClick:()=>De(!0),className:"w-12 h-12 rounded-full bg-secondary text-secondary-foreground shadow-lg flex items-center justify-center active:opacity-80 transition-opacity",title:"Mehrere Artikel hinzufügen",children:e.jsx(Sa,{className:"w-5 h-5"})}),e.jsx("button",{onClick:()=>Ze(!0),className:"w-14 h-14 rounded-full bg-primary text-primary-foreground shadow-lg flex items-center justify-center active:opacity-80 transition-opacity",children:e.jsx(_e,{className:"w-6 h-6"})})]})]})}export{Ua as M};
