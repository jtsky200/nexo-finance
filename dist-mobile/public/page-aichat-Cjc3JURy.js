import*as ke from"react";import _t,{createContext as Ut,useContext as $t,useMemo as xe,useRef as G,useCallback as ie,useState as w,useEffect as V}from"react";import"./vendor-i18n-CxwOOByA.js";import{s as fn,c as hn,X as Je,W as Ht,C as it,a as bt,b as Kt,S as Wt,d as gn,e as pn,f as xn,g as Ae,M as bn,L as wt,h as jt,B as ct,U as ot,i as Ke,j as We,k as Ze,F as Yt,l as lt,m as yn,H as vn,T as wn,n as jn,o as qt,p as Gt,q as Nn,P as Dn,I as Sn,r as Et,t as Vt,A as Cn,u as En,v as kn,w as An,x as In,y as Fn,E as Tn,z as Rn,D as zn,G as Mn,J as Ln,K as Pn,N as kt,O as Bn}from"./vendor-misc-CNnXDEWF.js";import{u as Xe,L as On}from"./vendor-router-CqlaLFHO.js";import{S as _n,R as Un,C as $n,a as Hn,D as Kn,T as Wn,P as Yn,O as qn,b as Gn,c as Vn,d as Zn,I as Jn,V as Xn,e as Qn,f as es,g as ts,h as ns,i as ss,j as as,k as rs,l as is,m as os,n as ls,o as cs,p as ds,q as us,r as ms,s as fs}from"./vendor-ui-DFoAMWof.js";import{t as hs,c as gs}from"./vendor-utils-BNe0Xlio.js";import{i as ps,g as xs,a as bs,b as ys,c as vs,d as ws,o as js,s as Ns,G as Ds,e as Ss,f as Cs,h as Es,u as ks,j as _,q as ue,w as pe,k as Ie,T as At,l as Qe,m as Fe}from"./vendor-firebase-BWqYINcm.js";import{t as j}from"./vendor-toast-CdQ6zwVl.js";import{c as As}from"./vendor-api-DUnF1PDn.js";const Is="modulepreload",Fs=function(t){return"/"+t},It={},Ts=function(n,s,r){let o=Promise.resolve();if(s&&s.length>0){let p=function(u){return Promise.all(u.map(g=>Promise.resolve(g).then(m=>({status:"fulfilled",value:m}),m=>({status:"rejected",reason:m}))))};document.getElementsByTagName("link");const l=document.querySelector("meta[property=csp-nonce]"),d=l?.nonce||l?.getAttribute("nonce");o=p(s.map(u=>{if(u=Fs(u),u in It)return;It[u]=!0;const g=u.endsWith(".css"),m=g?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${u}"]${m}`))return;const h=document.createElement("link");if(h.rel=g?"stylesheet":Is,g||(h.as="script"),h.crossOrigin="",h.href=u,d&&h.setAttribute("nonce",d),document.head.appendChild(h),g)return new Promise((y,a)=>{h.addEventListener("load",y),h.addEventListener("error",()=>a(new Error(`Unable to preload CSS for ${u}`)))})}))}function i(l){const d=new Event("vite:preloadError",{cancelable:!0});if(d.payload=l,window.dispatchEvent(d),!d.defaultPrevented)throw l}return o.then(l=>{for(const d of l||[])d.status==="rejected"&&i(d.reason);return n().catch(i)})};var Ha=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function Ka(t){return t&&t.__esModule&&Object.prototype.hasOwnProperty.call(t,"default")?t.default:t}var ht={exports:{}},qe={};/**
 * @license React
 * react-jsx-runtime.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var Ft;function Rs(){if(Ft)return qe;Ft=1;var t=_t,n=Symbol.for("react.element"),s=Symbol.for("react.fragment"),r=Object.prototype.hasOwnProperty,o=t.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,i={key:!0,ref:!0,__self:!0,__source:!0};function l(d,p,u){var g,m={},h=null,y=null;u!==void 0&&(h=""+u),p.key!==void 0&&(h=""+p.key),p.ref!==void 0&&(y=p.ref);for(g in p)r.call(p,g)&&!i.hasOwnProperty(g)&&(m[g]=p[g]);if(d&&d.defaultProps)for(g in p=d.defaultProps,p)m[g]===void 0&&(m[g]=p[g]);return{$$typeof:n,type:d,key:h,ref:y,props:m,_owner:o.current}}return qe.Fragment=s,qe.jsx=l,qe.jsxs=l,qe}var Tt;function zs(){return Tt||(Tt=1,ht.exports=Rs()),ht.exports}var e=zs();const Ms=(t,n,s,r)=>{const o=[s,{code:n,...r||{}}];if(t?.services?.logger?.forward)return t.services.logger.forward(o,"warn","react-i18next::",!0);Te(o[0])&&(o[0]=`react-i18next:: ${o[0]}`),t?.services?.logger?.warn?t.services.logger.warn(...o):console?.warn&&console.warn(...o)},Rt={},Zt=(t,n,s,r)=>{Te(s)&&Rt[s]||(Te(s)&&(Rt[s]=new Date),Ms(t,n,s,r))},Jt=(t,n)=>()=>{if(t.isInitialized)n();else{const s=()=>{setTimeout(()=>{t.off("initialized",s)},0),n()};t.on("initialized",s)}},yt=(t,n,s)=>{t.loadNamespaces(n,Jt(t,s))},zt=(t,n,s,r)=>{if(Te(s)&&(s=[s]),t.options.preload&&t.options.preload.indexOf(n)>-1)return yt(t,s,r);s.forEach(o=>{t.options.ns.indexOf(o)<0&&t.options.ns.push(o)}),t.loadLanguages(n,Jt(t,r))},Ls=(t,n,s={})=>!n.languages||!n.languages.length?(Zt(n,"NO_LANGUAGES","i18n.languages were undefined or empty",{languages:n.languages}),!0):n.hasLoadedNamespace(t,{lng:s.lng,precheck:(r,o)=>{if(s.bindI18n&&s.bindI18n.indexOf("languageChanging")>-1&&r.services.backendConnector.backend&&r.isLanguageChangingTo&&!o(r.isLanguageChangingTo,t))return!1}}),Te=t=>typeof t=="string",Ps=t=>typeof t=="object"&&t!==null,Bs=/&(?:amp|#38|lt|#60|gt|#62|apos|#39|quot|#34|nbsp|#160|copy|#169|reg|#174|hellip|#8230|#x2F|#47);/g,Os={"&amp;":"&","&#38;":"&","&lt;":"<","&#60;":"<","&gt;":">","&#62;":">","&apos;":"'","&#39;":"'","&quot;":'"',"&#34;":'"',"&nbsp;":" ","&#160;":" ","&copy;":"©","&#169;":"©","&reg;":"®","&#174;":"®","&hellip;":"…","&#8230;":"…","&#x2F;":"/","&#47;":"/"},_s=t=>Os[t],Us=t=>t.replace(Bs,_s);let vt={bindI18n:"languageChanged",bindI18nStore:"",transEmptyNodeValue:"",transSupportBasicHtmlNodes:!0,transWrapTextNodes:"",transKeepBasicHtmlNodesFor:["br","strong","i","p"],useSuspense:!0,unescape:Us,transDefaultProps:void 0};const $s=(t={})=>{vt={...vt,...t}},Hs=()=>vt;let Xt;const Ks=t=>{Xt=t},Ws=()=>Xt,Wa={type:"3rdParty",init(t){$s(t.options.react),Ks(t)}},Ys=Ut();class qs{constructor(){this.usedNamespaces={}}addUsedNamespaces(n){n.forEach(s=>{this.usedNamespaces[s]||(this.usedNamespaces[s]=!0)})}getUsedNamespaces(){return Object.keys(this.usedNamespaces)}}const Gs=(t,n)=>Te(n)?n:Ps(n)&&Te(n.defaultValue)?n.defaultValue:Array.isArray(t)?t[t.length-1]:t,Vs={t:Gs,ready:!1},Zs=()=>()=>{},Qt=(t,n={})=>{const{i18n:s}=n,{i18n:r,defaultNS:o}=$t(Ys)||{},i=s||r||Ws();i&&!i.reportNamespaces&&(i.reportNamespaces=new qs),i||Zt(i,"NO_I18NEXT_INSTANCE","useTranslation: You will need to pass in an i18next instance by using initReactI18next");const l=xe(()=>({...Hs(),...i?.options?.react,...n}),[i,n]),{useSuspense:d,keyPrefix:p}=l,u=o||i?.options?.defaultNS,g=Te(u)?[u]:u||["translation"],m=xe(()=>g,g);i?.reportNamespaces?.addUsedNamespaces?.(m);const h=G(0),y=ie(A=>{if(!i)return Zs;const{bindI18n:S,bindI18nStore:F}=l,Y=()=>{h.current+=1,A()};return S&&i.on(S,Y),F&&i.store.on(F,Y),()=>{S&&S.split(" ").forEach(te=>i.off(te,Y)),F&&F.split(" ").forEach(te=>i.store.off(te,Y))}},[i,l]),a=G(),b=ie(()=>{if(!i)return Vs;const A=!!(i.isInitialized||i.initializedStoreOnce)&&m.every(Z=>Ls(Z,i,l)),S=n.lng||i.language,F=h.current,Y=a.current;if(Y&&Y.ready===A&&Y.lng===S&&Y.keyPrefix===p&&Y.revision===F)return Y;const O={t:i.getFixedT(S,l.nsMode==="fallback"?m:m[0],p),ready:A,lng:S,keyPrefix:p,revision:F};return a.current=O,O},[i,m,p,l,n.lng]),[N,I]=w(0),{t:T,ready:ee}=fn.useSyncExternalStore(y,b,b);V(()=>{if(i&&!ee&&!d){const A=()=>I(S=>S+1);n.lng?zt(i,n.lng,m,A):yt(i,m,A)}},[i,n.lng,m,ee,d,N]);const W=i||{},J=G(null),ne=G(),X=A=>{const S=Object.getOwnPropertyDescriptors(A);S.__original&&delete S.__original;const F=Object.create(Object.getPrototypeOf(A),S);if(!Object.prototype.hasOwnProperty.call(F,"__original"))try{Object.defineProperty(F,"__original",{value:A,writable:!1,enumerable:!1,configurable:!1})}catch{}return F},oe=xe(()=>{const A=W,S=A?.language;let F=A;A&&(J.current&&J.current.__original===A?ne.current!==S?(F=X(A),J.current=F,ne.current=S):F=J.current:(F=X(A),J.current=F,ne.current=S));const Y=[T,F,ee];return Y.t=T,Y.i18n=F,Y.ready=ee,Y},[T,W,ee,W.resolvedLanguage,W.language,W.languages]);if(i&&d&&!ee)throw new Promise(A=>{const S=()=>A();n.lng?zt(i,n.lng,m,S):yt(i,m,S)});return oe},Js=As(),Xs={apiKey:"AIzaSyCZ8V17HUVMlBKXK0ftrMURS-XP2zIsOps",authDomain:"nexo-jtsky100.firebaseapp.com",projectId:"nexo-jtsky100",storageBucket:"nexo-jtsky100.firebasestorage.app",messagingSenderId:"859320186482",appId:"1:859320186482:web:0c9dcca5d8ce613aaf34eb",measurementId:"G-G8PX4GB2YF"},dt=ps(Xs),Be=xs(dt),Re=bs(dt),U=ys(dt,"us-central1");typeof window<"u"&&vs(dt);const en=Ut(void 0);function Ya({children:t}){const[n,s]=w(null),[r,o]=w(!0),[i,l]=w(null);V(()=>(ws(Be).then(b=>{b?.user&&s(b.user)}).catch(b=>{}),js(Be,b=>{s(b),o(!1)})),[]);const d=async(a,b)=>{try{l(null);const N=await Cs(Be,a,b)}catch(N){let I="Anmeldung fehlgeschlagen";switch(N.code){case"auth/invalid-email":I="Ungültige E-Mail-Adresse";break;case"auth/user-disabled":I="Dieses Konto wurde deaktiviert";break;case"auth/user-not-found":I="Kein Konto mit dieser E-Mail gefunden";break;case"auth/wrong-password":I="Falsches Passwort";break;case"auth/invalid-credential":I="Ungültige Anmeldedaten";break;default:I=N.message||"Ein Fehler ist aufgetreten"}throw l(I),new Error(I)}},p=async(a,b,N)=>{try{l(null);const I=await Es(Be,a,b);N&&I.user&&await ks(I.user,{displayName:N})}catch(I){let T="Registrierung fehlgeschlagen";switch(I.code){case"auth/email-already-in-use":T="Diese E-Mail wird bereits verwendet";break;case"auth/invalid-email":T="Ungültige E-Mail-Adresse";break;case"auth/weak-password":T="Passwort ist zu schwach";break;default:T=I.message||"Ein Fehler ist aufgetreten"}throw l(T),new Error(T)}},u=async()=>{try{l(null);const a=new Ds;a.addScope("email"),a.addScope("profile"),a.setCustomParameters({prompt:"select_account"}),await Ss(Be,a)}catch(a){let b="Ein Fehler ist aufgetreten";switch(a.code){case"auth/unauthorized-domain":b="Diese Domain ist nicht autorisiert. Bitte kontaktieren Sie den Administrator.";break;case"auth/operation-not-allowed":b="Google Sign-In ist nicht aktiviert.";break;case"auth/network-request-failed":b="Netzwerkfehler. Bitte überprüfen Sie Ihre Internetverbindung.";break;default:b=a.message||"Ein unbekannter Fehler ist aufgetreten"}throw l(b),new Error(b)}},g=async()=>{try{await Ns(Be)}catch{throw new Error("Abmeldung fehlgeschlagen")}},m=d,h=u,y=g;return e.jsx(en.Provider,{value:{user:n,loading:r,error:i,signIn:d,signUp:p,signInWithGoogle:u,signOut:g,loginWithEmail:m,loginWithGoogle:h,logout:y},children:t})}function Ye(){const t=$t(en);if(t===void 0)throw new Error("useAuth must be used within an AuthProvider");return t}const Qs={maxRetries:3,initialDelay:1e3,maxDelay:1e4,backoffMultiplier:2,retryableErrors:["network","timeout","ECONNRESET","ETIMEDOUT","ENOTFOUND","EAI_AGAIN","500","502","503","504"]};function ea(t,n){if(!t)return!1;const s=t.message?.toLowerCase()||"",r=t.code?.toLowerCase()||"",o=t.status?.toString()||"";return n.some(i=>{const l=i.toLowerCase();return s.includes(l)||r.includes(l)||o.includes(l)})}function ta(t,n){const s=n.initialDelay*Math.pow(n.backoffMultiplier,t);return Math.min(s,n.maxDelay)}async function na(t,n={}){const s={...Qs,...n};let r;for(let o=0;o<=s.maxRetries;o++)try{return await t()}catch(i){if(r=i,o>=s.maxRetries||!ea(i,s.retryableErrors))break;const l=ta(o,s);await new Promise(d=>setTimeout(d,l))}throw r}async function Ce(t,n,s={}){return na(async()=>(await t(n)).data,s)}const Nt={maxRetries:3,initialDelay:1e3},et={maxRetries:2,initialDelay:500};function sa(t){const[n,s]=w([]),[r,o]=w(!0),[i,l]=w(null),{user:d}=Ye();return V(()=>{if(!d){s([]),o(!1);return}o(!0);let u=ue(Ie(Re,"reminders"),pe("userId","==",d.uid));t?.status&&(u=ue(u,pe("status","==",t.status))),t?.startDate&&(u=ue(u,pe("dueDate",">=",At.fromDate(t.startDate)))),t?.endDate&&(u=ue(u,pe("dueDate","<=",At.fromDate(t.endDate)))),u=ue(u,Qe("dueDate"));const g=Fe(u,m=>{try{const h=m.docs.map(y=>{const a=y.data();if(!a)return null;let b=new Date;if(a.dueDate){if(a.dueDate.toDate&&typeof a.dueDate.toDate=="function")b=a.dueDate.toDate();else if(a.dueDate instanceof Date)b=a.dueDate;else if(typeof a.dueDate=="string"){const T=new Date(a.dueDate);isNaN(T.getTime())||(b=T)}}let N=new Date;if(a.createdAt){if(a.createdAt.toDate&&typeof a.createdAt.toDate=="function")N=a.createdAt.toDate();else if(a.createdAt instanceof Date)N=a.createdAt;else if(typeof a.createdAt=="string"){const T=new Date(a.createdAt);isNaN(T.getTime())||(N=T)}}let I=new Date;if(a.updatedAt){if(a.updatedAt.toDate&&typeof a.updatedAt.toDate=="function")I=a.updatedAt.toDate();else if(a.updatedAt instanceof Date)I=a.updatedAt;else if(typeof a.updatedAt=="string"){const T=new Date(a.updatedAt);isNaN(T.getTime())||(I=T)}}return{id:y.id,userId:a.userId||d.uid,title:a.title||"",type:a.type||"erinnerung",dueDate:b,isAllDay:a.isAllDay||!1,amount:a.amount||null,currency:a.currency||"CHF",notes:a.notes||null,recurrenceRule:a.recurrenceRule||null,personId:a.personId||null,personName:a.personName||null,status:a.status||"offen",createdAt:N,updatedAt:I}}).filter(y=>y!==null);s(h),l(null)}catch(h){l(h),console.error("[useReminders] Error processing snapshot:",h)}finally{o(!1)}},m=>{m?.code==="failed-precondition"&&(console.error("[useReminders] Firestore index missing:",m.message),j.error("Index fehlt - Bitte Firebase Console prüfen")),l(m),o(!1),console.error("[useReminders] Snapshot error:",m)});return()=>g()},[d,t?.startDate,t?.endDate,t?.status]),{data:n,isLoading:r,error:i,refetch:()=>{s(u=>[...u])}}}async function tn(t){const n=_(U,"createReminder");return Ce(n,t,Nt)}async function qa(t,n){const s=_(U,"updateReminder");await Ce(s,{id:t,...n},et)}async function Ga(t){const n=_(U,"deleteReminder");await Ce(n,{id:t},et)}function Va(t){const[n,s]=w([]),[r,o]=w(!0),[i,l]=w(null),{user:d}=Ye();return V(()=>{if(!d){s([]),o(!1);return}o(!0);let u=ue(Ie(Re,"financeEntries"),pe("userId","==",d.uid));u=ue(u,Qe("date","desc"));const g=Fe(u,m=>{try{const h=m.docs.map(y=>{const a=y.data();if(!a)return null;let b=new Date;if(a.date){if(a.date.toDate&&typeof a.date.toDate=="function")b=a.date.toDate();else if(a.date instanceof Date)b=a.date;else if(typeof a.date=="string"){const T=new Date(a.date);isNaN(T.getTime())||(b=T)}}let N=new Date;if(a.createdAt){if(a.createdAt.toDate&&typeof a.createdAt.toDate=="function")N=a.createdAt.toDate();else if(a.createdAt instanceof Date)N=a.createdAt;else if(typeof a.createdAt=="string"){const T=new Date(a.createdAt);isNaN(T.getTime())||(N=T)}}let I=new Date;if(a.updatedAt){if(a.updatedAt.toDate&&typeof a.updatedAt.toDate=="function")I=a.updatedAt.toDate();else if(a.updatedAt instanceof Date)I=a.updatedAt;else if(typeof a.updatedAt=="string"){const T=new Date(a.updatedAt);isNaN(T.getTime())||(I=T)}}return{id:y.id,userId:a.userId||d.uid,type:a.type||"ausgabe",category:a.category||"",description:a.description||"",amount:a.amount||0,currency:a.currency||"CHF",paymentMethod:a.paymentMethod||"Karte",date:b,isRecurring:a.isRecurring||!1,recurrenceRule:a.recurrenceRule||null,createdAt:N,updatedAt:I}}).filter(y=>y!==null);s(h),l(null)}catch(h){l(h),console.error("[useFinanceEntries] Error processing snapshot:",h)}finally{o(!1)}},m=>{m?.code==="failed-precondition"&&(console.error("[useFinanceEntries] Firestore index missing:",m.message),j.error("Index fehlt - Bitte Firebase Console prüfen")),l(m),o(!1),console.error("[useFinanceEntries] Snapshot error:",m)});return()=>g()},[d,t?.startDate,t?.endDate,t?.type]),{data:n,isLoading:r,error:i,refetch:()=>{s(u=>[...u])}}}async function nn(t){const n=_(U,"createFinanceEntry");return Ce(n,t,Nt)}async function Za(t,n){const s=_(U,"updateFinanceEntry");await Ce(s,{id:t,...n},et)}function Ja(t){const[n,s]=w([]),[r,o]=w(!0),[i,l]=w(null);return V(()=>{(async()=>{try{o(!0),l(null);const m=((await _(U,"getTaxProfiles")({})).data.profiles||[]).map(h=>({...h,createdAt:h.createdAt?.toDate?h.createdAt.toDate():h.createdAt?new Date(h.createdAt):new Date,updatedAt:h.updatedAt?.toDate?h.updatedAt.toDate():h.updatedAt?new Date(h.updatedAt):new Date}));s(m)}catch(p){console.error("Error fetching tax profiles:",p),l(p),s([])}finally{o(!1)}})()},[t]),{data:n,isLoading:r,error:i}}async function Xa(t){await _(U,"deleteTaxProfile")({id:t})}function Qa(){const[t,n]=w([]),[s,r]=w(!0),[o,i]=w(null),{user:l}=Ye();return V(()=>{if(!l){n([]),r(!1);return}r(!0);let p=ue(Ie(Re,"people"),pe("userId","==",l.uid));try{p=ue(p,Qe("createdAt","desc"))}catch{console.warn("[usePeople] Index missing for createdAt, using unsorted query")}const u=Fe(p,g=>{try{const h=g.docs.map(y=>{const a=y.data();if(!a)return null;let b=new Date;if(a.createdAt){if(a.createdAt.toDate&&typeof a.createdAt.toDate=="function")b=a.createdAt.toDate();else if(a.createdAt instanceof Date)b=a.createdAt;else if(typeof a.createdAt=="string"){const I=new Date(a.createdAt);isNaN(I.getTime())||(b=I)}}let N=new Date;if(a.updatedAt){if(a.updatedAt.toDate&&typeof a.updatedAt.toDate=="function")N=a.updatedAt.toDate();else if(a.updatedAt instanceof Date)N=a.updatedAt;else if(typeof a.updatedAt=="string"){const I=new Date(a.updatedAt);isNaN(I.getTime())||(N=I)}}return{id:y.id,userId:a.userId||l.uid,name:a.name||"",email:a.email||null,phone:a.phone||null,totalOwed:a.totalOwed||0,currency:a.currency||"CHF",createdAt:b,updatedAt:N}}).filter(y=>y!==null).sort((y,a)=>a.createdAt.getTime()-y.createdAt.getTime());n(h),i(null)}catch(m){i(m),console.error("[usePeople] Error processing snapshot:",m)}finally{r(!1)}},g=>{if(g?.code==="failed-precondition"){console.error("[usePeople] Firestore index missing:",g.message);const m=ue(Ie(Re,"people"),pe("userId","==",l.uid)),h=Fe(m,y=>{try{const a=y.docs.map(b=>{const N=b.data();return N?{id:b.id,userId:N.userId||l.uid,name:N.name||"",email:N.email||null,phone:N.phone||null,totalOwed:N.totalOwed||0,currency:N.currency||"CHF",createdAt:N.createdAt?.toDate?.()||new Date,updatedAt:N.updatedAt?.toDate?.()||new Date}:null}).filter(b=>b!==null);n(a.sort((b,N)=>N.createdAt.getTime()-b.createdAt.getTime())),i(null)}catch(a){i(a),console.error("[usePeople] Error processing fallback snapshot:",a)}finally{r(!1)}},y=>{i(y),r(!1),console.error("[usePeople] Fallback snapshot error:",y)});return()=>h()}else i(g),r(!1),console.error("[usePeople] Snapshot error:",g)});return()=>u()},[l]),{data:t,isLoading:s,error:o,refetch:()=>{n(p=>[...p])}}}async function er(t){const n=_(U,"createPerson");return Ce(n,t,Nt)}async function tr(t,n){const s=_(U,"updatePerson");await Ce(s,{personId:t,...n},et)}async function nr(t){const n=_(U,"deletePerson");await Ce(n,{personId:t},et)}function sr(){const[t,n]=w([]),[s,r]=w(!0),[o,i]=w(null),{user:l}=Ye();return V(()=>{if(!l){n([]),r(!1);return}r(!0);let d=ue(Ie(Re,"shoppingLists"),pe("userId","==",l.uid));try{d=ue(d,Qe("createdAt","desc"))}catch{console.warn("[useShoppingLists] Index missing for createdAt, using unsorted query")}const p=Fe(d,u=>{try{const g=u.docs.map(m=>{const h=m.data();return h?{id:m.id,userId:h.userId,name:h.name,isDefault:h.isDefault||!1,createdAt:h.createdAt?.toDate?h.createdAt.toDate():new Date(h.createdAt),updatedAt:h.updatedAt?.toDate?h.updatedAt.toDate():new Date(h.updatedAt)}:null}).filter(m=>m!==null);g.sort((m,h)=>h.createdAt.getTime()-m.createdAt.getTime()),n(g),i(null)}catch(g){console.error("[useShoppingLists] Error mapping lists:",g),i(g)}finally{r(!1)}},u=>{if(console.error("[useShoppingLists] Snapshot error:",u),u?.code==="failed-precondition"){console.warn("[useShoppingLists] Index missing, trying without orderBy");const g=ue(Ie(Re,"shoppingLists"),pe("userId","==",l.uid)),m=Fe(g,h=>{try{const y=h.docs.map(a=>{const b=a.data();return b?{id:a.id,userId:b.userId,name:b.name,isDefault:b.isDefault||!1,createdAt:b.createdAt?.toDate?b.createdAt.toDate():new Date(b.createdAt),updatedAt:b.updatedAt?.toDate?b.updatedAt.toDate():new Date(b.updatedAt)}:null}).filter(a=>a!==null);y.sort((a,b)=>b.createdAt.getTime()-a.createdAt.getTime()),n(y),i(null)}catch(y){console.error("[useShoppingLists] Error mapping lists (fallback):",y),i(y)}finally{r(!1)}},h=>{console.error("[useShoppingLists] Fallback snapshot error:",h),i(h),r(!1)});return()=>m()}else i(u),r(!1)});return()=>p()},[l]),{data:t,isLoading:s,error:o}}function ar(t,n){const[s,r]=w([]),[o,i]=w(!0),[l,d]=w(null),[p,u]=w(0);return V(()=>{t?(async()=>{try{i(!0);const b=(await _(U,"getShoppingList")({listId:t,status:n})).data.items.map(N=>({...N,boughtAt:N.boughtAt?.toDate?N.boughtAt.toDate():N.boughtAt?new Date(N.boughtAt):null,createdAt:N.createdAt?.toDate?N.createdAt.toDate():new Date(N.createdAt),updatedAt:N.updatedAt?.toDate?N.updatedAt.toDate():new Date(N.updatedAt)}));r(b),d(null)}catch(h){d(h)}finally{i(!1)}})():(r([]),i(!1))},[t,n,p]),{data:s,isLoading:o,error:l,refetch:()=>u(m=>m+1)}}async function rr(t,n){return(await _(U,"createShoppingList")({name:t,isDefault:n})).data}async function ir(t,n){await _(U,"updateShoppingList")({listId:t,...n})}async function or(t){await _(U,"deleteShoppingList")({listId:t})}async function aa(t){return(await _(U,"createShoppingItem")(t)).data}async function lr(t,n){await _(U,"updateShoppingItem")({itemId:t,...n})}async function cr(t){await _(U,"deleteShoppingItem")({itemId:t})}async function dr(t,n,s){return(await _(U,"markShoppingItemAsBought")({itemId:t,actualPrice:n,createExpense:s})).data}function ra(){const[t,n]=w([]),[s,r]=w(!0),[o,i]=w(null),{user:l}=Ye();return V(()=>{if(!l){n([]),r(!1);return}r(!0);const p=ue(Ie(Re,"chatConversations"),pe("userId","==",l.uid),Qe("updatedAt","desc")),u=Fe(p,g=>{try{const m=g.docs.map(h=>{const y=h.data();let a=new Date;y.createdAt&&(y.createdAt.toDate?a=y.createdAt.toDate().toISOString():typeof y.createdAt=="string"?a=y.createdAt:a=new Date(y.createdAt).toISOString());let b=new Date;return y.updatedAt&&(y.updatedAt.toDate?b=y.updatedAt.toDate().toISOString():typeof y.updatedAt=="string"?b=y.updatedAt:b=new Date(y.updatedAt).toISOString()),{id:h.id,userId:y.userId||l.uid,title:y.title||"Neue Konversation",messages:y.messages||[],createdAt:a,updatedAt:b}});m.sort((h,y)=>{const a=typeof h.updatedAt=="string"?new Date(h.updatedAt).getTime():h.updatedAt.getTime();return(typeof y.updatedAt=="string"?new Date(y.updatedAt).getTime():y.updatedAt.getTime())-a}),n(m),i(null)}catch(m){console.error("Error processing chat conversations:",m),i(m)}finally{r(!1)}},g=>{g.code==="permission-denied"?console.warn("[useChatConversations] Permission denied - user may not be authenticated"):g.code==="failed-precondition"?(console.warn("[useChatConversations] Index missing - query may need an index"),j.error("Index fehlt. Bitte warten Sie, bis der Index erstellt wurde.")):console.error("[useChatConversations] Firestore listener error:",g),i(g),r(!1),n([])});return()=>u()},[l]),{data:t,isLoading:s,error:o,refetch:async()=>{}}}const Ge=new Map,ia=300*1e3,oa=500;function sn(t,n){const[s,r]=w(null),[o,i]=w(!1),[l,d]=w(null),p=G(null);return V(()=>{if(p.current&&(clearTimeout(p.current),p.current=null),!t){r(null),d(null),i(!1);return}const g=`${t.toISOString().split("T")[0]}_${n||"no-location"}`,m=Ge.get(g);if(m&&Date.now()-m.timestamp<ia){r(m.data),d(m.error),i(!1);return}return p.current=setTimeout(async()=>{try{if(i(!0),d(null),!n){const b=new Error("Location ist erforderlich. Bitte in den Einstellungen einen Standort eingeben.");d(b),r(null),i(!1),Ge.set(g,{data:null,timestamp:Date.now(),error:b});return}const a=(await _(U,"getWeather")({date:t.toISOString(),location:n})).data;if(a)r(a),d(null),Ge.set(g,{data:a,timestamp:Date.now(),error:null});else{const b=new Date;b.setHours(0,0,0,0);const N=new Date(t);N.setHours(0,0,0,0);const I=N<b?new Error("Historische Wetterdaten sind nur aus dem Cache verfügbar."):new Error("Keine Wetterdaten verfügbar. Bitte überprüfen Sie den Standort in den Einstellungen.");d(I),r(null),Ge.set(g,{data:null,timestamp:Date.now(),error:I})}}catch(h){h?.code!=="internal"&&!h?.message?.includes("ERR_INSUFFICIENT_RESOURCES")&&console.error("[useWeather] Error:",h);const y=h?.message||h?.code||"Unbekannter Fehler beim Laden der Wetterdaten",a=new Error(y);d(a),r(null),Ge.set(g,{data:null,timestamp:Date.now(),error:a})}finally{i(!1)}},oa),()=>{p.current&&(clearTimeout(p.current),p.current=null)}},[t?.toISOString(),n]),{data:s,isLoading:o,error:l}}function Dt(){const[t,n]=w(null),[s,r]=w(!0),[o,i]=w(null);V(()=>{(async()=>{try{r(!0),i(null);const g=(await _(U,"getUserSettings")({})).data;n(g)}catch(p){i(p)}finally{r(!1)}})()},[]);const l=ie(async d=>{try{return await _(U,"updateUserSettings")(d),n(u=>u?{...u,...d}:d),{success:!0}}catch(p){throw i(p),p}},[]);return{settings:t,isLoading:s,error:o,updateSettings:l}}async function la(t){return(await _(U,"createChatConversation")(t)).data}async function ca(t,n){await _(U,"updateChatConversation")({id:t,...n})}async function da(){return(await _(U,"clearAllChatConversations")({})).data}function M(...t){return hs(gs(t))}const ua=hn("inline-flex items-center justify-center gap-2 whitespace-nowrap rounded-md text-sm font-medium transition-all disabled:pointer-events-none disabled:opacity-50 [&_svg]:pointer-events-none [&_svg:not([class*='size-'])]:size-4 shrink-0 [&_svg]:shrink-0 outline-none focus-visible:border-ring focus-visible:ring-ring/50 focus-visible:ring-[3px] aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive",{variants:{variant:{default:"bg-primary text-primary-foreground hover:bg-primary/90",destructive:"bg-destructive text-white hover:bg-destructive/90 focus-visible:ring-destructive/20 dark:focus-visible:ring-destructive/40 dark:bg-destructive/60",outline:"border bg-transparent shadow-xs hover:bg-accent dark:bg-transparent dark:border-input dark:hover:bg-input/50",secondary:"bg-secondary text-secondary-foreground hover:bg-secondary/80",ghost:"hover:bg-accent dark:hover:bg-accent/50",link:"text-primary underline-offset-4 hover:underline"},size:{default:"h-9 px-4 py-2 has-[>svg]:px-3",sm:"h-8 rounded-md gap-1.5 px-3 has-[>svg]:px-2.5",lg:"h-10 rounded-md px-6 has-[>svg]:px-4",icon:"size-9","icon-sm":"size-8","icon-lg":"size-10"}},defaultVariants:{variant:"default",size:"default"}});function K({className:t,variant:n,size:s,asChild:r=!1,...o}){const i=r?_n:"button";return e.jsx(i,{"data-slot":"button",className:M(ua({variant:n,size:s,className:t})),...o})}function ma({className:t,...n}){return e.jsx("div",{"data-slot":"card",className:M("bg-card text-card-foreground flex flex-col gap-6 rounded-xl border py-6 shadow-sm",t),...n})}function ur({className:t,...n}){return e.jsx("div",{"data-slot":"card-header",className:M("@container/card-header grid auto-rows-min grid-rows-[auto_auto] items-start gap-2 px-6 has-data-[slot=card-action]:grid-cols-[1fr_auto] [.border-b]:pb-6",t),...n})}function mr({className:t,...n}){return e.jsx("div",{"data-slot":"card-title",className:M("leading-none font-semibold",t),...n})}function fr({className:t,...n}){return e.jsx("div",{"data-slot":"card-description",className:M("text-muted-foreground text-sm",t),...n})}function fa({className:t,...n}){return e.jsx("div",{"data-slot":"card-content",className:M("px-6",t),...n})}const tt="glassEffectEnabled";function an(){const{settings:t,updateSettings:n,isLoading:s}=Dt(),[r,o]=w(()=>{if(t?.glassEffectEnabled!==void 0)return t.glassEffectEnabled;const l=localStorage.getItem(tt);return l!==null?l==="true":!0});return V(()=>{if(!s&&t?.glassEffectEnabled!==void 0)o(t.glassEffectEnabled);else if(!s&&!t?.glassEffectEnabled){const l=localStorage.getItem(tt);if(l!==null){const d=l==="true";n({glassEffectEnabled:d}).then(()=>{localStorage.removeItem(tt)}).catch(console.error),o(d)}}},[t?.glassEffectEnabled,s,n]),V(()=>{!s&&n&&(n({glassEffectEnabled:r}).catch(console.error),localStorage.setItem(tt,String(r)))},[r,s,n]),{isEnabled:r,toggle:()=>{o(l=>!l)},setIsEnabled:o}}const rn=ke.createContext({isComposing:()=>!1,setComposing:()=>{},justEndedComposing:()=>!1,markCompositionEnd:()=>{}}),St=()=>ke.useContext(rn);function ve({...t}){const n=ke.useRef(!1),s=ke.useRef(!1),r=ke.useRef(null),o=ke.useMemo(()=>({isComposing:()=>n.current,setComposing:i=>{n.current=i},justEndedComposing:()=>s.current,markCompositionEnd:()=>{s.current=!0,r.current&&clearTimeout(r.current),r.current=setTimeout(()=>{s.current=!1},150)}}),[]);return e.jsx(rn.Provider,{value:o,children:e.jsx(Un,{"data-slot":"dialog",...t})})}function ha({...t}){return e.jsx(Yn,{"data-slot":"dialog-portal",...t})}function on({className:t,...n}){return e.jsx(qn,{"data-slot":"dialog-overlay",className:M("data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 fixed inset-0 z-50 bg-black/50",t),...n})}on.displayName="DialogOverlay";function we({className:t,children:n,showCloseButton:s=!0,onEscapeKeyDown:r,...o}){const{isComposing:i}=St(),l=ke.useCallback(d=>{if(d.isComposing||i()){d.preventDefault();return}r?.(d)},[i,r]);return e.jsxs(ha,{"data-slot":"dialog-portal",children:[e.jsx(on,{}),e.jsxs($n,{"data-slot":"dialog-content",className:M("bg-background data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 fixed top-0 left-0 right-0 bottom-0 z-50 flex flex-col w-full h-full border-0 shadow-lg duration-200 sm:top-[50%] sm:left-[50%] sm:right-auto sm:bottom-auto sm:translate-x-[-50%] sm:translate-y-[-50%] sm:max-w-lg sm:h-auto sm:max-h-[90vh] sm:rounded-lg sm:border sm:m-4 sm:flex sm:flex-col",t),onEscapeKeyDown:l,...o,children:[n,s&&e.jsxs(Hn,{"data-slot":"dialog-close",className:"ring-offset-background focus:ring-ring data-[state=open]:bg-accent data-[state=open]:text-muted-foreground absolute top-4 right-4 rounded-xs opacity-70 transition-opacity hover:opacity-100 focus:ring-2 focus:ring-offset-2 focus:outline-hidden disabled:pointer-events-none [&_svg]:pointer-events-none [&_svg]:shrink-0 [&_svg:not([class*='size-'])]:size-4",children:[e.jsx(Je,{}),e.jsx("span",{className:"sr-only",children:"Close"})]})]})]})}function je({className:t,...n}){return e.jsx("div",{"data-slot":"dialog-header",className:M("flex flex-col gap-2 text-center sm:text-left",t),...n})}function Ne({className:t,...n}){return e.jsx("div",{"data-slot":"dialog-footer",className:M("flex flex-col-reverse gap-2 sm:flex-row sm:justify-end",t),...n})}function De({className:t,...n}){return e.jsx(Wn,{"data-slot":"dialog-title",className:M("text-lg leading-none font-semibold",t),...n})}function Se({className:t,...n}){return e.jsx(Kn,{"data-slot":"dialog-description",className:M("text-muted-foreground text-sm",t),...n})}function ga({selectedDate:t}){const{settings:n,isLoading:s}=Dt(),r=n?.weatherLocation||"Zurich, CH",{data:o,isLoading:i,error:l}=sn(t,r);_t.useEffect(()=>{},[t,r,s,o,i,l]);const d=u=>{switch(u){case"sun":return e.jsx(Wt,{className:"w-5 h-5"});case"cloud-sun":return e.jsx(Kt,{className:"w-5 h-5"});case"cloud":return e.jsx(it,{className:"w-5 h-5"});case"rain":return e.jsx(bt,{className:"w-5 h-5"});case"snow":return e.jsx(bt,{className:"w-5 h-5"});default:return e.jsx(it,{className:"w-5 h-5"})}};if(!t)return null;const p=t.toLocaleDateString("de-CH",{weekday:"long",day:"numeric",month:"long"});return e.jsxs("div",{className:"p-3 border-b border-border",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("h4",{className:"text-xs font-semibold text-muted-foreground",children:"Wetter"}),e.jsx("span",{className:"text-[10px] text-muted-foreground",children:p})]}),i?e.jsx("div",{className:"flex items-center justify-center py-4",children:e.jsx("div",{className:"text-xs text-muted-foreground",children:"Lädt..."})}):o?e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[d(o.icon),e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-baseline gap-1",children:[e.jsxs("span",{className:"text-lg font-bold",children:[o.temperature,"°"]}),e.jsx("span",{className:"text-xs text-muted-foreground",children:"C"})]}),e.jsx("div",{className:"text-[10px] text-muted-foreground",children:o.condition})]})]}),o.humidity!==void 0&&o.windSpeed!==void 0&&e.jsxs("div",{className:"flex gap-3 text-[9px] text-muted-foreground pt-1 border-t border-border/50",children:[e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(Ht,{className:"w-3 h-3"}),e.jsxs("span",{children:[o.windSpeed," km/h"]})]}),e.jsx("div",{children:e.jsxs("span",{children:["Luftfeuchtigkeit: ",o.humidity,"%"]})})]})]}):l?e.jsxs("div",{className:"space-y-1",children:[e.jsx("div",{className:"text-xs text-muted-foreground text-center py-2",children:l.message||"Fehler beim Laden der Wetterdaten"}),e.jsxs("div",{className:"text-[10px] text-muted-foreground/70 text-center",children:["Standort: ",r]})]}):s?e.jsx("div",{className:"flex items-center justify-center py-4",children:e.jsx("div",{className:"text-xs text-muted-foreground",children:"Lädt Einstellungen..."})}):e.jsxs("div",{className:"space-y-1",children:[e.jsx("div",{className:"text-xs text-muted-foreground text-center py-2",children:"Keine Wetterdaten verfügbar"}),e.jsxs("div",{className:"text-[10px] text-muted-foreground/70 text-center",children:["Standort: ",r]})]})]})}function hr(t){if(!t||!t.includes("T"))throw new Error("Invalid datetime-local format. Expected: YYYY-MM-DDTHH:mm");const[n,s]=t.split("T"),[r,o,i]=n.split("-").map(Number),[l,d]=s?s.split(":").map(Number):[0,0];return new Date(r,o-1,i,l,d,0,0)}function gr(t,n){if(!t)return"N/A";try{let s;if(t?.toDate&&typeof t.toDate=="function")s=t.toDate();else if(typeof t=="string")s=new Date(t);else if(t instanceof Date)s=t;else return"N/A";if(isNaN(s.getTime()))return"N/A";const r=s.getDate().toString().padStart(2,"0"),o=(s.getMonth()+1).toString().padStart(2,"0"),i=s.getFullYear();return n?.includeTime,`${r}.${o}.${i}`}catch{return"N/A"}}function nt(t){if(!t)return nt(new Date);try{let n;if(t?.toDate&&typeof t.toDate=="function")n=t.toDate();else if(typeof t=="string")n=new Date(t);else if(t instanceof Date)n=t;else return nt(new Date);if(isNaN(n.getTime()))return nt(new Date);const s=n.getFullYear(),r=(n.getMonth()+1).toString().padStart(2,"0"),o=n.getDate().toString().padStart(2,"0"),i=n.getHours().toString().padStart(2,"0"),l=n.getMinutes().toString().padStart(2,"0");return`${s}-${r}-${o}T${i}:${l}`}catch{return nt(new Date)}}function Mt(t,n=!1){if(!t)return"N/A";try{let s;if(t?.toDate&&typeof t.toDate=="function")s=t.toDate();else if(typeof t=="string")s=new Date(t);else if(t instanceof Date)s=t;else return"N/A";if(isNaN(s.getTime()))return"N/A";const r=s.getHours().toString().padStart(2,"0"),o=s.getMinutes().toString().padStart(2,"0");if(n){const i=s.getSeconds().toString().padStart(2,"0");return`${r}:${o}:${i}`}return`${r}:${o}`}catch{return"N/A"}}function Lt(t){if(!t)return"";try{let n;if(typeof t=="object"&&t!==null&&"toDate"in t&&typeof t.toDate=="function")n=t.toDate();else if(t instanceof Date)n=t;else if(typeof t=="string"){if(!t.includes("T")&&t.match(/^\d{4}-\d{2}-\d{2}$/))return t;n=new Date(t)}else n=new Date(t);if(isNaN(n.getTime()))return"";const s=n.getFullYear(),r=String(n.getMonth()+1).padStart(2,"0"),o=String(n.getDate()).padStart(2,"0");return`${s}-${r}-${o}`}catch{return""}}function me(t){if(!(t instanceof Date)||isNaN(t.getTime()))throw new Error("Invalid date: must be a valid Date object");const n=t.getFullYear(),s=String(t.getMonth()+1).padStart(2,"0"),r=String(t.getDate()).padStart(2,"0");return`${n}-${s}-${r}`}function de(t){if(!t)return"";try{let n;if(typeof t=="string")if(t.match(/^\d{4}-\d{2}-\d{2}$/)){const[i,l,d]=t.split("-").map(Number);n=new Date(i,l-1,d)}else n=new Date(t);else if(t instanceof Date)n=t;else return"";if(isNaN(n.getTime()))return"";const s=String(n.getDate()).padStart(2,"0"),r=String(n.getMonth()+1).padStart(2,"0"),o=n.getFullYear();return`${s}.${r}.${o}`}catch{return""}}function He(t){if(!t)return"";try{t=t.trim();const n=t.split(".");if(n.length===3){const s=parseInt(n[0],10),r=parseInt(n[1],10),o=parseInt(n[2],10);if(isNaN(s)||isNaN(r)||isNaN(o))return"";const i=new Date(o,r-1,s);return i.getDate()!==s||i.getMonth()!==r-1||i.getFullYear()!==o?"":`${o}-${String(r).padStart(2,"0")}-${String(s).padStart(2,"0")}`}return t.match(/^\d{4}-\d{2}-\d{2}$/)?t:""}catch{return""}}function pr(t){if(!t)return"";try{let n;if(typeof t=="string")if(t.includes("T")){const[d,p]=t.split("T"),[u,g,m]=d.split("-").map(Number),[h,y]=p?p.split(":").map(Number):[0,0];n=new Date(u,g-1,m,h,y)}else if(t.match(/^\d{4}-\d{2}-\d{2}$/)){const[d,p,u]=t.split("-").map(Number);n=new Date(d,p-1,u)}else n=new Date(t);else if(t instanceof Date)n=t;else return"";if(isNaN(n.getTime()))return"";const s=String(n.getDate()).padStart(2,"0"),r=String(n.getMonth()+1).padStart(2,"0"),o=n.getFullYear(),i=String(n.getHours()).padStart(2,"0"),l=String(n.getMinutes()).padStart(2,"0");return`${s}.${r}.${o} ${i}:${l}`}catch{return""}}function xr(t){if(!t)return"";try{t=t.trim();const n=t.split(" ");if(n.length===2){const s=n[0],r=n[1],o=s.split(".");if(o.length===3){const i=parseInt(o[0],10),l=parseInt(o[1],10),d=parseInt(o[2],10),p=r.split(":"),u=p.length>=1?parseInt(p[0],10):0,g=p.length>=2?parseInt(p[1],10):0;if(isNaN(i)||isNaN(l)||isNaN(d)||isNaN(u)||isNaN(g))return"";const m=new Date(d,l-1,i,u,g);return m.getDate()!==i||m.getMonth()!==l-1||m.getFullYear()!==d?"":`${d}-${String(l).padStart(2,"0")}-${String(i).padStart(2,"0")}T${String(u).padStart(2,"0")}:${String(g).padStart(2,"0")}`}}return t.match(/^\d{4}-\d{2}-\d{2}T\d{2}:\d{2}/)?t:""}catch{return""}}function pa(){const[,t]=Xe(),[n,s]=w(new Date),[r,o]=w([]),[i,l]=w(!1),[d,p]=w(null),[u,g]=w(null),[m,h]=w(!1),[y,a]=w(!1),[b,N]=w(!1),[I,T]=w(!1),[ee,W]=w(de(new Date)),[J,ne]=w(de(new Date)),{data:X=[]}=sa(),{settings:oe}=Dt(),A=oe?.weatherLocation||"Zurich, CH",S=d?new Date(d.getFullYear(),d.getMonth(),d.getDate()):null,{data:F,isLoading:Y}=sn(S,A);V(()=>{if(!d){const f=new Date,v=new Date(f.getFullYear(),f.getMonth(),f.getDate());p(v)}},[]);const te=["Januar","Februar","März","April","Mai","Juni","Juli","August","September","Oktober","November","Dezember"],O=["Mo","Di","Mi","Do","Fr","Sa","So"],Z=ie(async()=>{try{l(!0);const f=_(U,"getCalendarEvents"),v=_(U,"getVacations"),E=_(U,"getSchoolSchedules"),B=_(U,"getSchoolHolidays"),z=new Date(n.getFullYear(),n.getMonth()-1,1),L=new Date(n.getFullYear(),n.getMonth()+2,0),[D,R,H,P]=await Promise.all([f({startDate:z.toISOString(),endDate:L.toISOString()}).catch(()=>({data:{events:[]}})),v({startDate:z.toISOString(),endDate:L.toISOString()}).catch(()=>({data:{vacations:[]}})),E({startDate:z.toISOString(),endDate:L.toISOString()}).catch(()=>({data:{schedules:[]}})),B({startDate:z.toISOString(),endDate:L.toISOString()}).catch(()=>({data:{holidays:[]}}))]),q=D.data,ae=R.data,ge=H.data,ut=P.data,mt=[...q.events||[],...(ae.vacations||[]).map(Q=>({id:`vacation-${Q.id}`,type:"work",title:Q.title||"Ferien",date:Q.startDate,description:Q.description})),...(ge.schedules||[]).map(Q=>({id:`school-${Q.id}`,type:"school",title:Q.childName?`${Q.childName} - Schule`:"Schule",date:Q.date,schoolType:Q.type})),...(ut.holidays||[]).map(Q=>({id:`holiday-${Q.id}`,type:"school-holiday",title:Q.title||"Schulferien",date:Q.date}))];o(mt)}catch{}finally{l(!1)}},[n]);V(()=>{Z()},[Z]);const ze=f=>{const v=new Date(f),E=v.getDay(),B=v.getDate()-(E===0?6:E-1);return new Date(v.setDate(B))},fe=xe(()=>{const f=ze(n),v=[],E=B=>{const z=me(B),L=r.filter(P=>{if(!P.date)return!1;let q=Lt(P.date);if(!q&&typeof P.date=="string"){const ae=P.date.split("T")[0];ae.match(/^\d{4}-\d{2}-\d{2}/)&&(q=ae)}return q===z}),R=X.filter(P=>{if(!P.dueDate)return!1;let q;if(P.dueDate instanceof Date)q=P.dueDate;else if(typeof P.dueDate=="string")q=new Date(P.dueDate);else return!1;return isNaN(q.getTime())?!1:me(q)===z}).map(P=>{let q="appointment";P.type==="termin"?q="appointment":P.type==="zahlung"?q="due":P.type==="aufgabe"&&(q="reminder");let ae;if(P.dueDate instanceof Date)ae=P.dueDate;else if(typeof P.dueDate=="string")ae=new Date(P.dueDate);else throw new Error(`Invalid dueDate for reminder ${P.id}`);return{id:`reminder-${P.id}`,type:q,title:P.title,date:me(ae),time:P.isAllDay?void 0:Mt(ae),description:P.notes||void 0,status:P.status}}),H=[...L];for(const P of R)H.some(q=>q.id===P.id)||H.push(P);return H};for(let B=0;B<7;B++){const z=new Date(f);z.setDate(f.getDate()+B);const L=E(z);v.push({date:z,events:L})}return v},[n,r,X]),be=()=>{const f=new Date(n);f.setDate(f.getDate()-7),s(f)},Me=()=>{const f=new Date(n);f.setDate(f.getDate()+7),s(f)},se=()=>{s(new Date)},he=f=>{const v=new Date;return f.toDateString()===v.toDateString()},Le=f=>{const v=new Date(f.getFullYear(),f.getMonth(),f.getDate());console.log("[SidebarCalendar] handleDayClick:",{originalDate:f.toISOString(),normalizedDate:v.toISOString(),dateStr:me(v)}),p(v),h(!0)},Pe=f=>{const v=new Date(f.getFullYear(),f.getMonth(),f.getDate());p(v)},Ee=f=>{g(f),a(!0)},x=xe(()=>{if(!d)return console.log("[SidebarCalendar] dayEvents - no selectedDate"),[];const f=new Date(d.getFullYear(),d.getMonth(),d.getDate()),v=me(f);console.log("[SidebarCalendar] dayEvents filter - START:",{selectedDate:d.toISOString(),normalizedSelectedDate:f.toISOString(),dateStr:v,totalEvents:r.length,totalReminders:X.length});const E=r.filter(D=>{if(!D.date)return console.log("[SidebarCalendar] Event skipped - no date:",D.title),!1;let R=Lt(D.date);if(!R&&typeof D.date=="string"){const P=D.date.split("T")[0];P.match(/^\d{4}-\d{2}-\d{2}/)&&(R=P,console.log("[SidebarCalendar] Using fallback date extraction for filter:",R))}if(!R)return console.log("[SidebarCalendar] Event skipped - invalid date:",D.title,D.date),!1;const H=R===v;return H&&console.log("[SidebarCalendar] Event matched:",{eventTitle:D.title,eventDate:D.date,eventDateStr:R,selectedDateStr:v}),H}),B=X.filter(D=>{if(!D.dueDate)return!1;let R;if(D.dueDate instanceof Date)R=D.dueDate;else if(typeof D.dueDate=="string")R=new Date(D.dueDate);else return!1;return isNaN(R.getTime())?!1:me(R)===v});console.log("[SidebarCalendar] Reminders for date:",{dateStr:v,remindersForDate:B.length,reminders:B.map(D=>({id:D.id,title:D.title,dueDate:D.dueDate}))});const z=B.map(D=>{let R="appointment";D.type==="termin"?R="appointment":D.type==="zahlung"?R="due":D.type==="aufgabe"&&(R="reminder");let H;if(D.dueDate instanceof Date)H=D.dueDate;else if(typeof D.dueDate=="string")H=new Date(D.dueDate);else throw new Error(`Invalid dueDate for reminder ${D.id}`);return{id:`reminder-${D.id}`,type:R,title:D.title,date:me(H),time:D.isAllDay?void 0:Mt(H),description:D.notes||void 0,status:D.status}}),L=[...E];for(const D of z)L.some(R=>R.id===D.id)||L.push(D);return console.log("[SidebarCalendar] dayEvents filter - RESULT:",{selectedDate:f.toISOString(),dateStr:v,filteredFromEvents:E.length,fromReminders:z.length,totalDayEvents:L.length,allDayEvents:L.map(D=>({id:D.id,title:D.title,date:D.date,type:D.type}))}),L},[d,r,X]),k=f=>{switch(f){case"due":return"bg-pink-500";case"reminder":case"appointment":case"termin":return"bg-orange-500";case"work":return"bg-slate-400";case"vacation":case"frei":return"bg-emerald-400";case"school-holiday":return"bg-sky-400";case"school":return"bg-purple-400";case"hort":return"bg-fuchsia-500";default:return"bg-gray-500"}};return e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"p-2 border-b border-border",children:[e.jsxs("div",{className:"flex items-center justify-between mb-1.5",children:[e.jsx(K,{variant:"ghost",size:"sm",onClick:be,className:"h-5 w-5 p-0 min-w-0",children:e.jsx(gn,{className:"w-3 h-3"})}),e.jsx("div",{className:"flex-1 text-center px-1",children:e.jsxs("h3",{className:"text-[11px] font-semibold leading-tight",children:[te[n.getMonth()]," ",n.getFullYear()]})}),e.jsx(K,{variant:"ghost",size:"sm",onClick:Me,className:"h-5 w-5 p-0 min-w-0",children:e.jsx(pn,{className:"w-3 h-3"})})]}),e.jsx("div",{className:"grid grid-cols-7 gap-0",children:O.map((f,v)=>{const E=fe[v],B=E?he(E.date):!1;return e.jsxs("div",{className:"flex flex-col items-center",children:[e.jsx("div",{className:"text-center text-[10px] font-medium text-muted-foreground mb-1 w-full",children:f}),E&&e.jsxs("button",{onClick:()=>{Pe(E.date),Le(E.date)},className:M("w-full aspect-square min-h-[28px] max-h-[30px] rounded-sm transition-colors flex flex-col items-center justify-center relative","text-foreground",d&&E.date.toDateString()===d.toDateString()?"bg-primary/20 ring-1 ring-primary":B?"bg-primary text-primary-foreground font-semibold":"hover:bg-muted/50"),children:[e.jsx("span",{className:"text-[12px] leading-none font-medium",children:E.date.getDate()}),E.events.length>0&&e.jsx("div",{className:"absolute bottom-0.5 left-0 right-0 flex gap-0.5 justify-center",children:E.events.slice(0,2).map((z,L)=>e.jsx("div",{onClick:D=>{D.stopPropagation(),Ee(z)},className:M("h-0.5 w-0.5 rounded-full",k(z.type)),title:z.title},L))})]})]},v)})}),e.jsx(K,{variant:"ghost",size:"sm",onClick:se,className:"w-full h-6 mt-1.5 text-[10px]",children:"Heute"})]}),e.jsx(ga,{selectedDate:d}),e.jsx(ve,{open:m,onOpenChange:h,children:e.jsxs(we,{className:"!fixed !top-[50%] !left-[50%] !right-auto !bottom-auto !translate-x-[-50%] !translate-y-[-50%] !w-[85vw] !max-w-sm !max-h-[85vh] !rounded-3xl !m-0 !overflow-y-auto !shadow-2xl",children:[e.jsxs(je,{className:"px-5 pt-5 pb-3 sticky top-0 bg-background z-10 border-b border-border",children:[e.jsx(Se,{className:"sr-only",children:"Details für den ausgewählten Tag mit Wetter, Terminen und Schnellaktionen"}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx(De,{className:"text-lg font-semibold",children:d?.toLocaleDateString("de-CH",{weekday:"long",day:"numeric",month:"long",year:"numeric"})}),e.jsx(K,{variant:"ghost",size:"sm",onClick:()=>h(!1),className:"h-8 w-8 p-0",children:e.jsx(Je,{className:"h-4 w-4"})})]})]}),e.jsxs("div",{className:"space-y-4 px-5 pb-2",children:[e.jsxs("div",{className:"bg-muted/30 rounded-xl p-4 space-y-3",children:[e.jsx("div",{className:"flex items-center justify-between",children:e.jsxs("h3",{className:"text-sm font-semibold flex items-center gap-2",children:[e.jsx(it,{className:"w-4 h-4"}),"Wetter"]})}),Y?e.jsx("div",{className:"flex items-center justify-center py-4",children:e.jsx("div",{className:"text-xs text-muted-foreground",children:"Lädt Wetterdaten..."})}):F?e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[F.icon==="sun"&&e.jsx(Wt,{className:"w-6 h-6 text-yellow-500"}),F.icon==="cloud-sun"&&e.jsx(Kt,{className:"w-6 h-6 text-gray-500"}),F.icon==="cloud"&&e.jsx(it,{className:"w-6 h-6 text-gray-500"}),F.icon==="rain"&&e.jsx(bt,{className:"w-6 h-6 text-blue-500"}),e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-baseline gap-1",children:[e.jsxs("span",{className:"text-2xl font-bold",children:[F.temperature,"°"]}),e.jsx("span",{className:"text-sm text-muted-foreground",children:"C"})]}),e.jsx("div",{className:"text-xs text-muted-foreground",children:F.condition})]})]}),(F.humidity!==void 0||F.windSpeed!==void 0)&&e.jsxs("div",{className:"flex gap-4 text-xs text-muted-foreground pt-2 border-t border-border/50",children:[F.windSpeed!==void 0&&e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(Ht,{className:"w-3 h-3"}),e.jsxs("span",{children:[F.windSpeed," km/h"]})]}),F.humidity!==void 0&&e.jsx("div",{children:e.jsxs("span",{children:["Luftfeuchtigkeit: ",F.humidity,"%"]})})]})]}):e.jsx("div",{className:"text-xs text-muted-foreground text-center py-2",children:"Keine Wetterdaten verfügbar"})]}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-sm font-semibold mb-2",children:"Termine & Events"}),x.length===0?e.jsx("p",{className:"text-sm text-muted-foreground text-center py-4 bg-muted/30 rounded-lg",children:"Keine Events an diesem Tag"}):e.jsx("div",{className:"space-y-2",children:x.map(f=>e.jsx(ma,{className:"cursor-pointer hover:bg-muted/50 transition-colors",onClick:()=>{h(!1),Ee(f)},children:e.jsx(fa,{className:"p-3",children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("div",{className:M("w-3 h-3 rounded-full mt-1 flex-shrink-0",k(f.type))}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("p",{className:"font-medium text-sm truncate",children:f.title}),f.time&&e.jsx("p",{className:"text-xs text-muted-foreground mt-1",children:f.time}),f.personName&&e.jsx("p",{className:"text-xs text-muted-foreground mt-1",children:f.personName})]})]})})},f.id))})]}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-sm font-semibold mb-2",children:"Schnellaktionen"}),e.jsxs("div",{className:"grid grid-cols-2 gap-2",children:[e.jsxs(K,{variant:"outline",onClick:()=>{N(!0)},className:"h-auto py-3 flex flex-col items-center gap-2 rounded-xl",children:[e.jsx(xn,{className:"w-5 h-5"}),e.jsx("span",{className:"text-xs",children:"Termin erstellen"})]}),e.jsxs(K,{variant:"outline",onClick:()=>{T(!0)},className:"h-auto py-3 flex flex-col items-center gap-2 rounded-xl",children:[e.jsx(Ae,{className:"w-5 h-5"}),e.jsx("span",{className:"text-xs",children:"Finanz-Eintrag"})]})]})]})]}),e.jsxs(Ne,{className:"px-5 pb-3 pt-2 sticky bottom-0 bg-background border-t border-border",children:[e.jsx(K,{variant:"outline",onClick:()=>{try{h(!1),setTimeout(()=>{try{t("/calendar")}catch(f){console.error("Navigation error:",f),j.error("Fehler beim Navigieren zum Kalender")}},100)}catch(f){console.error("Dialog close error:",f),j.error("Fehler beim Schliessen des Dialogs")}},className:"h-11 min-h-[44px] flex-1 rounded-xl text-sm font-medium",children:"Zum Kalender"}),e.jsx(K,{variant:"default",onClick:()=>h(!1),className:"h-11 min-h-[44px] flex-1 rounded-xl text-sm font-medium",children:"Schliessen"})]})]})}),e.jsx(ve,{open:b,onOpenChange:f=>{N(f),f&&W(de(d||new Date))},children:e.jsxs(we,{className:"!fixed !top-[50%] !left-[50%] !right-auto !bottom-auto !translate-x-[-50%] !translate-y-[-50%] !w-[85vw] !max-w-sm !max-h-fit !rounded-3xl !m-0 !overflow-visible !shadow-2xl",children:[e.jsxs(je,{className:"px-5 pt-5 pb-3",children:[e.jsx(De,{className:"text-lg font-semibold",children:"Termin erstellen"}),e.jsx(Se,{className:"sr-only",children:"Erstellen Sie einen neuen Termin mit Titel, Datum, Uhrzeit und optionalen Notizen"})]}),e.jsxs("div",{className:"px-5 pb-2 space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium mb-1 block",children:"Titel"}),e.jsx("input",{type:"text",id:"reminder-title",placeholder:"z.B. Arzttermin",className:"w-full px-3 py-2 border border-border rounded-lg text-sm",autoFocus:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium mb-1 block",children:"Datum"}),e.jsx("input",{type:"text",id:"reminder-date",placeholder:"DD.MM.YYYY",value:ee,onChange:f=>{const v=f.target.value;W(v)},onBlur:f=>{const v=He(f.target.value);v?W(de(v)):f.target.value&&d&&W(de(d))},className:"w-full px-3 py-2 border border-border rounded-lg text-sm"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium mb-1 block",children:"Uhrzeit (optional)"}),e.jsx("input",{type:"time",id:"reminder-time",className:"w-full px-3 py-2 border border-border rounded-lg text-sm"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium mb-1 block",children:"Notizen (optional)"}),e.jsx("textarea",{id:"reminder-notes",placeholder:"Weitere Details...",rows:3,className:"w-full px-3 py-2 border border-border rounded-lg text-sm resize-none"})]})]}),e.jsxs(Ne,{className:"px-5 pb-3 pt-2",children:[e.jsx(K,{variant:"outline",onClick:()=>N(!1),className:"h-11 min-h-[44px] flex-1 rounded-xl text-sm font-medium",children:"Abbrechen"}),e.jsx(K,{variant:"default",onClick:async()=>{try{const f=document.getElementById("reminder-title"),v=document.getElementById("reminder-date"),E=document.getElementById("reminder-time"),B=document.getElementById("reminder-notes");if(!f.value.trim()){j.error("Bitte gib einen Titel ein");return}const z=He(v.value);if(!z){j.error("Bitte gib ein gültiges Datum ein (DD.MM.YYYY)");return}const L=new Date(z);if(E.value){const[D,R]=E.value.split(":");L.setHours(parseInt(D),parseInt(R))}else L.setHours(12,0);await tn({title:f.value.trim(),type:"termin",dueDate:L,isAllDay:!E.value,notes:B.value.trim()||null}),j.success("Termin erstellt"),N(!1),h(!1),Z()}catch(f){j.error(f.message||"Fehler beim Erstellen des Termins")}},className:"h-11 min-h-[44px] flex-1 rounded-xl text-sm font-medium",children:"Erstellen"})]})]})}),e.jsx(ve,{open:I,onOpenChange:f=>{T(f),f&&ne(de(d||new Date))},children:e.jsxs(we,{className:"!fixed !top-[50%] !left-[50%] !right-auto !bottom-auto !translate-x-[-50%] !translate-y-[-50%] !w-[85vw] !max-w-sm !max-h-fit !rounded-3xl !m-0 !overflow-visible !shadow-2xl",children:[e.jsxs(je,{className:"px-5 pt-5 pb-3",children:[e.jsx(De,{className:"text-lg font-semibold",children:"Finanz-Eintrag erstellen"}),e.jsx(Se,{className:"sr-only",children:"Erstellen Sie einen neuen Finanz-Eintrag mit Beschreibung, Betrag, Typ und Datum"})]}),e.jsxs("div",{className:"px-5 pb-2 space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium mb-1 block",children:"Beschreibung"}),e.jsx("input",{type:"text",id:"finance-description",placeholder:"z.B. Einkauf, Gehalt",className:"w-full px-3 py-2 border border-border rounded-lg text-sm",autoFocus:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium mb-1 block",children:"Betrag (CHF)"}),e.jsx("input",{type:"number",id:"finance-amount",placeholder:"0.00",step:"0.01",className:"w-full px-3 py-2 border border-border rounded-lg text-sm"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium mb-1 block",children:"Typ"}),e.jsxs("select",{id:"finance-type",className:"w-full px-3 py-2 border border-border rounded-lg text-sm",children:[e.jsx("option",{value:"einnahme",children:"Einnahme"}),e.jsx("option",{value:"ausgabe",children:"Ausgabe"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium mb-1 block",children:"Datum"}),e.jsx("input",{type:"text",id:"finance-date",placeholder:"DD.MM.YYYY",value:J,onChange:f=>{const v=f.target.value;ne(v)},onBlur:f=>{const v=He(f.target.value);v?ne(de(v)):f.target.value&&d&&ne(de(d))},className:"w-full px-3 py-2 border border-border rounded-lg text-sm"})]})]}),e.jsxs(Ne,{className:"px-5 pb-3 pt-2",children:[e.jsx(K,{variant:"outline",onClick:()=>T(!1),className:"h-11 min-h-[44px] flex-1 rounded-xl text-sm font-medium",children:"Abbrechen"}),e.jsx(K,{variant:"default",onClick:async()=>{try{const f=document.getElementById("finance-description"),v=document.getElementById("finance-amount"),E=document.getElementById("finance-type"),B=document.getElementById("finance-date");if(!f.value.trim()){j.error("Bitte gib eine Beschreibung ein");return}const z=He(B.value);if(!z){j.error("Bitte gib ein gültiges Datum ein (DD.MM.YYYY)");return}if(!v.value||parseFloat(v.value)<=0){j.error("Bitte gib einen gültigen Betrag ein");return}await nn({description:f.value.trim(),amount:Math.round(parseFloat(v.value)*100),type:E.value,date:new Date(z),category:"Sonstiges",currency:"CHF",isRecurring:!1}),j.success("Finanz-Eintrag erstellt"),T(!1),h(!1)}catch(f){j.error(f.message||"Fehler beim Erstellen des Finanz-Eintrags")}},className:"h-11 min-h-[44px] flex-1 rounded-xl text-sm font-medium",children:"Erstellen"})]})]})}),e.jsx(ve,{open:y,onOpenChange:a,children:e.jsxs(we,{className:"!fixed !top-[50%] !left-[50%] !right-auto !bottom-auto !translate-x-[-50%] !translate-y-[-50%] !w-[85vw] !max-w-sm !max-h-fit !rounded-3xl !m-0 !overflow-visible !shadow-2xl",children:[e.jsxs(je,{className:"px-5 pt-5 pb-3",children:[e.jsx(De,{className:"text-lg font-semibold",children:u?.title}),e.jsx(Se,{className:"sr-only",children:"Detaillierte Informationen zum ausgewählten Event"})]}),e.jsxs("div",{className:"space-y-3 px-5 pb-2",children:[u?.date&&e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-muted-foreground mb-1",children:"Datum"}),e.jsx("p",{className:"text-sm",children:new Date(u.date).toLocaleDateString("de-CH",{weekday:"long",day:"numeric",month:"long",year:"numeric"})})]}),u?.time&&e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-muted-foreground mb-1",children:"Uhrzeit"}),e.jsx("p",{className:"text-sm",children:u.time})]}),u?.description&&e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-muted-foreground mb-1",children:"Beschreibung"}),e.jsx("p",{className:"text-sm",children:u.description})]}),u?.personName&&e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-muted-foreground mb-1",children:"Person"}),e.jsx("p",{className:"text-sm",children:u.personName})]}),u?.amount&&e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-muted-foreground mb-1",children:"Betrag"}),e.jsxs("p",{className:"text-sm",children:["CHF ",u.amount.toFixed(2)]})]})]}),e.jsxs(Ne,{className:"px-5 pb-3 pt-2",children:[e.jsx(K,{variant:"outline",onClick:()=>{a(!1),t("/calendar")},className:"h-11 min-h-[44px] w-full rounded-xl text-sm font-medium",children:"Zum Kalender"}),e.jsx(K,{variant:"outline",onClick:()=>a(!1),className:"h-11 min-h-[44px] w-full rounded-xl text-sm font-medium",children:"Schliessen"})]})]})})]})}const xa=[{path:"/",icon:bn,label:"Assistent"},{path:"/dashboard",icon:wt,label:"Dashboard"},{path:"/calendar",icon:jt,label:"Kalender"},{path:"/reminders",icon:ct,label:"Erinnerungen"},{path:"/finance",icon:Ae,label:"Finanzen"},{path:"/people",icon:ot,label:"Personen"},{path:"/bills",icon:Ke,label:"Rechnungen"},{path:"/documents",icon:We,label:"Dokumente"},{path:"/shopping",icon:Ze,label:"Einkaufen"},{path:"/taxes",icon:Yt,label:"Steuern"},{path:"/settings",icon:lt,label:"Einstellungen"}];function ba({open:t,onClose:n,currentChatId:s,onSelectChat:r,onNewChat:o}){const[i]=Xe(),{user:l}=Ye(),{isEnabled:d}=an(),p=()=>{if(l?.displayName){const u=l.displayName.split(" ");return u.length>=2?(u[0][0]+u[1][0]).toUpperCase():l.displayName.substring(0,2).toUpperCase()}return l?.email?l.email.substring(0,2).toUpperCase():"U"};return e.jsxs(e.Fragment,{children:[t&&e.jsx("div",{className:M("fixed inset-0 z-40 transition-opacity",d?"bg-black/5":"bg-black/50"),onClick:n}),e.jsx("aside",{className:M("fixed top-0 left-0 h-full w-full max-w-sm z-50 transform transition-transform duration-300 ease-in-out shadow-xl",t?"translate-x-0":"-translate-x-full",d?"bg-background/95 backdrop-blur-md":"bg-background"),"aria-label":"Hauptnavigation","aria-hidden":!t,children:e.jsxs("div",{className:"flex flex-col h-full",children:[e.jsx("div",{className:"p-4 border-b border-border",children:e.jsxs("div",{className:"flex items-center gap-3 mb-3",children:[e.jsx("button",{onClick:n,className:"p-2 hover:bg-muted rounded-lg transition-colors","aria-label":"Menü schliessen",tabIndex:t?0:-1,children:e.jsx(Je,{className:"w-5 h-5"})}),e.jsx("h2",{className:"text-lg font-semibold flex-1",children:"Menü"})]})}),e.jsxs("div",{className:"flex-1 overflow-y-auto",children:[e.jsxs("div",{className:"p-4 border-b border-border",children:[e.jsx("h3",{className:"text-xs font-semibold text-muted-foreground uppercase tracking-wider mb-3",children:"Navigation"}),e.jsx("nav",{className:"space-y-1",children:xa.map(u=>{const g=u.icon,m=i===u.path;return e.jsx(On,{href:u.path,children:e.jsxs("button",{onClick:n,className:M("w-full flex items-center gap-3 px-3 py-2.5 rounded-lg transition-colors text-left min-h-[44px]",m?"bg-primary/10 text-primary font-medium":"text-foreground hover:bg-muted"),"aria-label":`Zu ${u.label} navigieren`,"aria-current":m?"page":void 0,"aria-pressed":m,type:"button",role:"menuitem",tabIndex:t?0:-1,children:[e.jsx(g,{className:"w-5 h-5 flex-shrink-0","aria-hidden":"true"}),e.jsx("span",{className:"text-sm",children:u.label})]})},u.path)})})]}),e.jsx(pa,{})]}),e.jsx("div",{className:"p-4 border-t border-border",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-10 h-10 rounded-full bg-primary text-primary-foreground flex items-center justify-center flex-shrink-0 text-sm font-medium",children:l?.photoURL?e.jsx("img",{src:l.photoURL,alt:l?.displayName||"Benutzerprofilbild",className:"w-10 h-10 rounded-full object-cover"}):e.jsx("span",{"aria-label":"Benutzerinitialen",children:p()})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("p",{className:"text-sm font-medium truncate",children:l?.displayName||"Benutzer"}),e.jsx("p",{className:"text-xs text-muted-foreground truncate",children:l?.email||"Nicht angemeldet"})]})]})})]})})]})}function ln(){return ra()}async function st(t){try{if(t.id&&!t.id.startsWith("chat_"))await ca(t.id,{title:t.title,messages:t.messages});else{const n=await la({title:t.title,messages:t.messages});t.id=n.id}}catch(n){throw n}}async function ya(){try{return{deletedCount:(await da()).deletedCount}}catch(t){throw t}}function gt(t,n){return n.find(s=>s.id===t)||null}function Pt(t){return t.length<=50?t:t.substring(0,50)+"..."}function Bt(){const t=`chat_${Date.now()}_${Math.random().toString(36).substring(2,9)}`,n=new Date().toISOString();return{id:t,userId:"",title:"Neue Konversation",messages:[],createdAt:n,updatedAt:n}}function va({title:t,showSidebar:n=!1,showQuickActions:s=!1,quickActions:r=[],currentChatId:o,onSelectChat:i,onNewChat:l,sidebarOpen:d,onSidebarToggle:p}){Xe();const[u,g]=w(!1),{isEnabled:m}=an(),[h,y]=w(!1),[a,b]=w(!1),[N,I]=w(!1),{data:T,refetch:ee}=ln(),W=G(null),J=d!==void 0?d:u,ne=p||g;V(()=>{h&&ee()},[h,ee]),V(()=>{const A=S=>{W.current&&!W.current.contains(S.target)&&y(!1)};return document.addEventListener("mousedown",A),()=>document.removeEventListener("mousedown",A)},[]);const X=A=>{const S=typeof A=="string"?new Date(A):typeof A=="number"?new Date(A):A,Y=new Date().getTime()-S.getTime(),te=Math.floor(Y/(1e3*60*60*24));return te===0?"Heute":te===1?"Gestern":te<7?`${te} Tage`:S.toLocaleDateString("de-DE",{day:"2-digit",month:"2-digit"})},oe=async()=>{if(T.length===0){j.info("Keine Chats zum Löschen vorhanden");return}I(!0);try{const A=await ya();j.success(`${A.deletedCount} Chat${A.deletedCount!==1?"s":""} gelöscht`),b(!1),y(!1),await ee(),l&&l()}catch(A){console.error("Fehler beim Löschen aller Chats:",A),j.error("Fehler beim Löschen der Chats")}finally{I(!1)}};return e.jsxs(e.Fragment,{children:[n&&e.jsx(ba,{open:J,onClose:()=>ne(!1),currentChatId:o,onSelectChat:i,onNewChat:l}),e.jsx("header",{className:M("fixed top-0 left-0 right-0 z-40 border-b safe-top",m?"bg-background/95 backdrop-blur-md border-border/30":"bg-background border-border"),children:e.jsxs("div",{className:"px-4 h-14 flex items-center gap-3",children:[e.jsx("div",{className:"flex-1 flex items-center justify-center",children:e.jsx("h1",{className:"text-lg font-semibold text-center",children:t})}),l&&e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{onClick:()=>{l&&l()},className:"p-2 hover:bg-muted rounded-lg transition-colors","aria-label":"Neue Konversation",children:e.jsx(yn,{className:"w-5 h-5"})}),e.jsxs("div",{className:"relative",ref:W,children:[e.jsx("button",{onClick:()=>{y(!h),h||ee()},className:"p-2 hover:bg-muted rounded-lg transition-colors","aria-label":"Chat-Verlauf",children:e.jsx(vn,{className:"w-5 h-5"})}),h&&e.jsxs("div",{className:"absolute top-full right-0 mt-2 w-72 bg-background border border-border rounded-lg shadow-lg z-50 overflow-hidden max-h-[60vh] flex flex-col",children:[e.jsxs("div",{className:"p-3 border-b border-border flex items-center justify-between",children:[e.jsx("h3",{className:"text-sm font-semibold",children:"Chat-Verlauf"}),e.jsx("button",{onClick:()=>y(!1),className:"p-1 hover:bg-muted rounded transition-colors",children:e.jsx(Je,{className:"w-4 h-4"})})]}),e.jsx("div",{className:"overflow-y-auto",children:T.length===0?e.jsx("p",{className:"text-sm text-muted-foreground py-4 px-3 text-center",children:"Noch keine Konversationen"}):e.jsx("div",{className:"p-2",children:T.map(A=>{const S=o===A.id;return e.jsx("button",{onClick:()=>{i&&i(A.id),y(!1)},className:M("w-full flex items-center justify-between gap-2 px-3 py-2.5 rounded-lg transition-colors text-left",S?"bg-primary/10 text-primary":"hover:bg-muted"),children:e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("p",{className:M("text-sm truncate",S&&"font-medium"),children:A.title}),e.jsx("p",{className:"text-xs text-muted-foreground mt-0.5",children:X(A.updatedAt)})]})},A.id)})})}),T.length>0&&e.jsx("div",{className:"p-3 border-t border-border",children:e.jsxs("button",{onClick:()=>b(!0),className:"w-full flex items-center justify-center gap-2 px-3 py-2 rounded-lg bg-destructive/10 hover:bg-destructive/20 text-destructive transition-colors text-sm font-medium",disabled:N,children:[e.jsx(wn,{className:"w-4 h-4"}),e.jsx("span",{children:"Alle löschen"})]})})]})]})]})]})}),a&&e.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black/50 p-4",children:e.jsxs("div",{className:"bg-background border border-border rounded-lg shadow-lg max-w-sm w-full p-6",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[e.jsx("div",{className:"p-2 rounded-full bg-destructive/10",children:e.jsx(jn,{className:"w-5 h-5 text-destructive"})}),e.jsx("h3",{className:"text-lg font-semibold",children:"Alle Chats löschen?"})]}),e.jsxs("p",{className:"text-sm text-muted-foreground mb-6",children:["Diese Aktion kann nicht rückgängig gemacht werden. Alle ",T.length," Chat",T.length!==1?"s":""," werden permanent gelöscht."]}),e.jsxs("div",{className:"flex gap-3",children:[e.jsx("button",{onClick:()=>b(!1),className:"flex-1 px-4 py-2 rounded-lg border border-border hover:bg-muted transition-colors text-sm font-medium",disabled:N,children:"Abbrechen"}),e.jsx("button",{onClick:oe,className:"flex-1 px-4 py-2 rounded-lg bg-destructive text-destructive-foreground hover:bg-destructive/90 transition-colors text-sm font-medium",disabled:N,children:N?"Löschen...":"Ja, alle löschen"})]})]})})]})}function at(t){const n=G(t);n.current=t;const s=G(null);return s.current||(s.current=function(...r){return n.current.apply(this,r)}),s.current}function cn(t={}){const{onKeyDown:n,onCompositionStart:s,onCompositionEnd:r}=t,o=G(!1),i=G(null),l=G(null),d=at(m=>{i.current&&(clearTimeout(i.current),i.current=null),l.current&&(clearTimeout(l.current),l.current=null),o.current=!0,s?.(m)}),p=at(m=>{i.current=setTimeout(()=>{l.current=setTimeout(()=>{o.current=!1})}),r?.(m)}),u=at(m=>{if(o.current&&(m.key==="Escape"||m.key==="Enter"&&!m.shiftKey)){m.stopPropagation();return}n?.(m)}),g=at(()=>o.current);return{onCompositionStart:d,onCompositionEnd:p,onKeyDown:u,isComposing:g}}function ye({className:t,type:n,onKeyDown:s,onCompositionStart:r,onCompositionEnd:o,...i}){const l=St(),{onCompositionStart:d,onCompositionEnd:p,onKeyDown:u}=cn({onKeyDown:g=>{const m=g.nativeEvent.isComposing||l.justEndedComposing();g.key==="Enter"&&m||s?.(g)},onCompositionStart:g=>{l.setComposing(!0),r?.(g)},onCompositionEnd:g=>{l.markCompositionEnd(),setTimeout(()=>{l.setComposing(!1)},100),o?.(g)}});return e.jsx("input",{type:n,"data-slot":"input",className:M("file:text-foreground placeholder:text-muted-foreground selection:bg-primary selection:text-primary-foreground dark:bg-input/30 border-input h-9 w-full min-w-0 rounded-md border bg-transparent px-3 py-1 text-base shadow-xs transition-[color,box-shadow] outline-none file:inline-flex file:h-7 file:border-0 file:bg-transparent file:text-sm file:font-medium disabled:pointer-events-none disabled:cursor-not-allowed disabled:opacity-50 md:text-sm","focus-visible:border-ring focus-visible:ring-ring/50 focus-visible:ring-[3px]","aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive",t),onCompositionStart:d,onCompositionEnd:p,onKeyDown:u,...i})}function re({className:t,...n}){return e.jsx(Gn,{"data-slot":"label",className:M("flex items-center gap-2 text-sm leading-none font-medium select-none group-data-[disabled=true]:pointer-events-none group-data-[disabled=true]:opacity-50 peer-disabled:cursor-not-allowed peer-disabled:opacity-50",t),...n})}function Oe({...t}){return e.jsx(Vn,{"data-slot":"select",...t})}function _e({...t}){return e.jsx(Xn,{"data-slot":"select-value",...t})}function Ue({className:t,size:n="default",children:s,...r}){return e.jsxs(Zn,{"data-slot":"select-trigger","data-size":n,className:M("border-input data-[placeholder]:text-muted-foreground [&_svg:not([class*='text-'])]:text-muted-foreground focus-visible:border-ring focus-visible:ring-ring/50 aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive dark:bg-input/30 dark:hover:bg-input/50 flex w-fit items-center justify-between gap-2 rounded-md border bg-transparent px-3 py-2 text-sm whitespace-nowrap shadow-xs transition-[color,box-shadow] outline-none focus-visible:ring-[3px] disabled:cursor-not-allowed disabled:opacity-50 data-[size=default]:h-9 data-[size=sm]:h-8 *:data-[slot=select-value]:line-clamp-1 *:data-[slot=select-value]:flex *:data-[slot=select-value]:items-center *:data-[slot=select-value]:gap-2 [&_svg]:pointer-events-none [&_svg]:shrink-0 [&_svg:not([class*='size-'])]:size-4",t),...r,children:[s,e.jsx(Jn,{asChild:!0,children:e.jsx(qt,{className:"size-4 opacity-50"})})]})}function $e({className:t,children:n,position:s="popper",align:r="center",...o}){return e.jsx(Qn,{children:e.jsxs(es,{"data-slot":"select-content",className:M("bg-popover text-popover-foreground data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 relative z-50 max-h-(--radix-select-content-available-height) min-w-[8rem] origin-(--radix-select-content-transform-origin) overflow-x-hidden overflow-y-auto rounded-md border shadow-md",s==="popper"&&"data-[side=bottom]:translate-y-1 data-[side=left]:-translate-x-1 data-[side=right]:translate-x-1 data-[side=top]:-translate-y-1",t),position:s,align:r,...o,children:[e.jsx(wa,{}),e.jsx(ts,{className:M("p-1",s==="popper"&&"h-[var(--radix-select-trigger-height)] w-full min-w-[var(--radix-select-trigger-width)] scroll-my-1"),children:n}),e.jsx(ja,{})]})})}function ce({className:t,children:n,...s}){return e.jsxs(ns,{"data-slot":"select-item",className:M("focus:bg-accent focus:text-accent-foreground [&_svg:not([class*='text-'])]:text-muted-foreground relative flex w-full cursor-default items-center gap-2 rounded-sm py-1.5 pr-8 pl-2 text-sm outline-hidden select-none data-[disabled]:pointer-events-none data-[disabled]:opacity-50 [&_svg]:pointer-events-none [&_svg]:shrink-0 [&_svg:not([class*='size-'])]:size-4 *:[span]:last:flex *:[span]:last:items-center *:[span]:last:gap-2",t),...s,children:[e.jsx("span",{className:"absolute right-2 flex size-3.5 items-center justify-center",children:e.jsx(ss,{children:e.jsx(Gt,{className:"size-4"})})}),e.jsx(as,{children:n})]})}function wa({className:t,...n}){return e.jsx(rs,{"data-slot":"select-scroll-up-button",className:M("flex cursor-default items-center justify-center py-1",t),...n,children:e.jsx(Nn,{className:"size-4"})})}function ja({className:t,...n}){return e.jsx(is,{"data-slot":"select-scroll-down-button",className:M("flex cursor-default items-center justify-center py-1",t),...n,children:e.jsx(qt,{className:"size-4"})})}function Na({className:t,...n}){return e.jsx(os,{"data-slot":"switch",className:M("peer data-[state=checked]:bg-primary data-[state=unchecked]:bg-input focus-visible:border-ring focus-visible:ring-ring/50 dark:data-[state=unchecked]:bg-input/80 inline-flex h-[1.15rem] w-8 shrink-0 items-center rounded-full border border-transparent shadow-xs transition-all outline-none focus-visible:ring-[3px] disabled:cursor-not-allowed disabled:opacity-50",t),...n,children:e.jsx(ls,{"data-slot":"switch-thumb",className:M("bg-background dark:data-[state=unchecked]:bg-foreground dark:data-[state=checked]:bg-primary-foreground pointer-events-none block size-4 rounded-full ring-0 transition-transform data-[state=checked]:translate-x-[calc(100%-2px)] data-[state=unchecked]:translate-x-0")})})}const Da={light:10,medium:20,heavy:30,success:[50,50,50],error:[100,50,100],warning:[50,100,50],selection:5};function Ct(t="medium"){if(!navigator.vibrate)return;const n=Da[t];try{navigator.vibrate(n)}catch{}}function pt(){Ct("success")}function Sa(){Ct("error")}function br(){Ct("selection")}function Ca(t){const n=t,s=n?.data?.requestId||n?.requestId||null;if(n?.code==="unavailable"||n?.message?.includes("network")||n?.message?.includes("fetch"))return{title:"Verbindungsfehler",message:"Keine Internetverbindung. Bitte überprüfen Sie Ihre Netzwerkverbindung und versuchen Sie es erneut.",action:"Erneut versuchen",retryable:!0};if(n?.code==="deadline-exceeded"||n?.message?.includes("timeout"))return{title:"Zeitüberschreitung",message:"Die Anfrage hat zu lange gedauert. Bitte versuchen Sie es erneut.",action:"Erneut versuchen",retryable:!0};if(n?.code==="permission-denied"||n?.message?.includes("permission"))return{title:"Berechtigung verweigert",message:"Sie haben keine Berechtigung für diese Aktion. Bitte kontaktieren Sie den Administrator.",retryable:!1};if(n?.code==="unauthenticated"||n?.message?.includes("auth")||n?.message?.includes("login"))return{title:"Anmeldung erforderlich",message:"Bitte melden Sie sich an, um fortzufahren.",action:"Anmelden",retryable:!1};if(n?.code==="not-found"||n?.message?.includes("not found"))return{title:"Nicht gefunden",message:"Die angeforderte Ressource wurde nicht gefunden.",retryable:!1};if(n?.code==="invalid-argument"||n?.message?.includes("validation")||n?.message?.includes("invalid"))return{title:"Ungültige Eingabe",message:n?.message||"Bitte überprüfen Sie Ihre Eingabe und versuchen Sie es erneut.",retryable:!1};if(n?.code==="resource-exhausted"||n?.message?.includes("quota"))return{title:"Kontingent überschritten",message:"Das Tageslimit wurde erreicht. Bitte versuchen Sie es später erneut.",retryable:!1};if(n?.message?.includes("billing")||n?.message?.includes("Billing"))return{title:"Abrechnungsfehler",message:"Google Cloud Billing ist erforderlich. Bitte kontaktieren Sie den Administrator.",retryable:!1};if(n?.code?.startsWith("functions/"))return{title:"Server-Fehler",message:`Ein Fehler ist aufgetreten: ${n.code.replace("functions/","")}. Bitte versuchen Sie es später erneut.`,action:"Erneut versuchen",retryable:!0};let r=n?.message||n?.toString()||"Ein unbekannter Fehler ist aufgetreten.";return s&&(r+=`

Request ID: ${s.substring(0,8)}...`),{title:"Fehler",message:r.length>200?`${r.substring(0,200)}...`:r,action:"Erneut versuchen",retryable:!0,requestId:s||void 0}}function Ea(t){return Ca(t).message}function ka({className:t,children:n,...s}){return e.jsxs(cs,{"data-slot":"scroll-area",className:M("relative",t),...s,children:[e.jsx(ds,{"data-slot":"scroll-area-viewport",className:"focus-visible:ring-ring/50 size-full rounded-[inherit] transition-[color,box-shadow] outline-none focus-visible:ring-[3px] focus-visible:outline-1",children:n}),e.jsx(Aa,{}),e.jsx(us,{})]})}function Aa({className:t,orientation:n="vertical",...s}){return e.jsx(ms,{"data-slot":"scroll-area-scrollbar",orientation:n,className:M("hidden opacity-0 w-0 h-0 invisible pointer-events-none",t),...s,children:e.jsx(fs,{"data-slot":"scroll-area-thumb",className:"hidden opacity-0 w-0 h-0"})})}const Ia={"layout-dashboard":wt,calendar:jt,bell:ct,wallet:Ae,users:ot,"file-text":Yt,folder:We,"scan-line":We,"shopping-cart":Ze,receipt:Ke,"clipboard-list":Ke,settings:lt,check:Gt,plus:Vt,search:Ln,edit:Mn,trash:zn,clock:Rn,euro:Tn,"trending-up":Fn,"trending-down":In,info:An,"alert-circle":kn},Fa={dashboard:{path:"/",icon:wt},calendar:{path:"/calendar",icon:jt},reminders:{path:"/reminders",icon:ct},finances:{path:"/finance",icon:Ae},finance:{path:"/finance",icon:Ae},finanzen:{path:"/finance",icon:Ae},people:{path:"/people",icon:ot},personen:{path:"/people",icon:ot},invoices:{path:"/bills",icon:Ke},bills:{path:"/bills",icon:Ke},rechnungen:{path:"/bills",icon:Ke},documents:{path:"/documents",icon:We},dokumente:{path:"/documents",icon:We},shopping:{path:"/shopping",icon:Ze},einkaufsliste:{path:"/shopping",icon:Ze},settings:{path:"/settings",icon:lt},einstellungen:{path:"/settings",icon:lt}};function Ta({content:t,onNavigate:n}){const s=xe(()=>{const r=[],o=t.length>1e4?t.substring(0,1e4)+"...":t;let i=0,l=0;const d=/\[(nav|icon):([a-zA-Z0-9_-]+)(?:[|｜]([^\]]+))?\]/g;let p;const u=[];for(;(p=d.exec(o))!==null;)u.push({index:p.index,type:p[1],key:p[2],label:p[3],endIndex:p.index+p[0].length});for(const g of u){if(g.index>i){const m=o.slice(i,g.index);r.push(e.jsx("span",{dangerouslySetInnerHTML:{__html:xt(m)}},`text-${l++}`))}if(g.type==="nav"&&g.label){const m=g.key,h=g.label,y=Fa[m];if(y&&n){const a=y.icon;r.push(e.jsxs("button",{onClick:b=>{b.preventDefault(),b.stopPropagation();try{n(y.path)}catch{}},className:"inline-flex items-center gap-1.5 px-2 py-1 mx-0.5 rounded-lg bg-primary/10 hover:bg-primary/20 text-primary font-medium text-sm transition-all duration-200 cursor-pointer border border-primary/20 hover:border-primary/40 hover:shadow-sm",title:`Zu ${h} navigieren`,children:[e.jsx(a,{className:"size-4"}),e.jsx("span",{className:"underline decoration-dotted underline-offset-2",children:rt(h)})]},`nav-${l++}`))}else r.push(e.jsx("span",{className:"font-medium text-primary",children:rt(h)},`nav-text-${l++}`))}else if(g.type==="icon"){const m=g.key,h=Ia[m];h?r.push(e.jsx(h,{className:"inline-block size-4 mx-0.5 align-text-bottom text-primary"},`icon-${l++}`)):r.push(e.jsxs("span",{children:["[",rt(m),"]"]},`unknown-${l++}`))}i=g.endIndex}if(i<o.length){const g=o.slice(i);r.push(e.jsx("span",{dangerouslySetInnerHTML:{__html:xt(g)}},`text-${l++}`))}return r.length>0?r:[e.jsx("span",{dangerouslySetInnerHTML:{__html:xt(o)}},"full")]},[t,n]);return e.jsx("div",{className:"prose prose-sm max-w-none",children:s})}function rt(t){const n=document.createElement("div");return n.textContent=t,n.innerHTML}function xt(t){let n=rt(t);return n=n.replace(/\*\*(.+?)\*\*/g,"<strong>$1</strong>").replace(/__(.+?)__/g,"<strong>$1</strong>"),n=n.replace(new RegExp("(?<!\\*)\\*(?!\\*)(.+?)(?<!\\*)\\*(?!\\*)","g"),"<em>$1</em>"),n=n.replace(/`(.+?)`/g,'<code class="bg-muted px-1.5 py-0.5 rounded text-sm font-mono">$1</code>'),n=n.replace(/\n/g,"<br />"),n}function Ra({messages:t,onSendMessage:n,isLoading:s=!1,placeholder:r="Nachricht eingeben...",className:o,height:i="100%",emptyStateMessage:l="Beginne eine Unterhaltung mit dem Assistenten",suggestedPrompts:d}){const{t:p,i18n:u}=Qt(),[,g]=Xe(),[m,h]=w(""),y=G(null),a=G(null),b=G(null),N=G(null),I=G(null),T=G(null),[ee,W]=w(!1),[J,ne]=w(null),[X,oe]=w(!1),A=G(null),S=G(null),F=G(null),Y=ie(async x=>{g(x);const{eventBus:k,Events:f}=await Ts(async()=>{const{eventBus:v,Events:E}=await import("./eventBus-CWDWdm45.js");return{eventBus:v,Events:E}},[]);setTimeout(()=>{k.emit(f.CHAT_DIALOG_OPEN)},300)},[g]),te=xe(()=>t.filter(x=>x.role!=="system"),[t]),O=xe(()=>d?d.map(x=>typeof x=="string"?{text:x,icon:"tag"}:x):[],[d]),Z=ie(()=>{const x=y.current?.querySelector("[data-radix-scroll-area-viewport]");x&&requestAnimationFrame(()=>{x.scrollTo({top:x.scrollHeight,behavior:"smooth"})})},[]);V(()=>{te.length>0&&Z()},[te.length,Z]);const[ze,fe]=w({bottom:0,left:0});V(()=>{if(X&&S.current){const x=S.current.getBoundingClientRect();fe({bottom:window.innerHeight-x.top+8,left:x.left})}},[X]),V(()=>{const x=k=>{const f=k.target,v=F.current?.contains(f),E=S.current?.contains(f),B=A.current?.contains(f);!v&&!E&&!B&&oe(!1)};if(X)return document.addEventListener("mousedown",x),document.addEventListener("touchstart",x),()=>{document.removeEventListener("mousedown",x),document.removeEventListener("touchstart",x)}},[X]);const be=ie(x=>{x.preventDefault();const k=m.trim();if(!(!k||s)){if(k.length>1e4){j.error("Nachricht ist zu lang. Bitte kürze sie auf maximal 10.000 Zeichen.");return}if(s){j.info("Bitte warte auf die Antwort...");return}try{n(k),h(""),Z(),N.current?.focus()}catch{j.error("Fehler beim Senden der Nachricht. Bitte versuche es erneut.")}}},[m,s,n,Z]),Me=ie(x=>{x.key==="Enter"&&!x.shiftKey&&(x.preventDefault(),be(x))},[be]),se=ie(x=>{s||(n(x),Z())},[s,n,Z]),he=ie(async x=>{if(x.size>10485760){j.error(`Datei ist zu gross. Maximal ${(10485760/1024/1024).toFixed(0)}MB erlaubt.`);return}if(!x.name||x.name.length>255){j.error("Ungültiger Dateiname.");return}const f=j.loading("Datei wird hochgeladen...");try{const v=await Promise.race([new Promise((L,D)=>{const R=new FileReader;R.onload=()=>{const H=R.result;if(!H||!H.includes(",")){D(new Error("Ungültiges Dateiformat"));return}L(H.split(",")[1])},R.onerror=()=>D(new Error("Fehler beim Lesen der Datei")),R.readAsDataURL(x)}),new Promise((L,D)=>setTimeout(()=>D(new Error("Upload-Timeout")),3e4))]),E=_(U,"uploadAIChatFile"),B=await Promise.race([E({fileName:x.name,fileData:v,fileType:x.type}),new Promise((L,D)=>setTimeout(()=>D(new Error("Upload-Timeout")),6e4))]);if(!B?.data)throw new Error("Keine Antwort vom Server erhalten");const z=B.data;if(!z.fileUrl||!z.fileName)throw new Error("Ungültige Server-Antwort");j.dismiss(f),n(`[Datei: ${z.fileName}](${z.fileUrl})`),j.success("Datei erfolgreich hochgeladen")}catch(v){j.dismiss(f);const E=v.message||"Unbekannter Fehler";j.error(`Fehler beim Hochladen: ${E}`)}},[n]),Le=ie(async x=>{if(!x.type.startsWith("image/")){j.error("Bitte wähle ein Bild aus (JPG, PNG, GIF, etc.)");return}const k=5*1024*1024;if(x.size>k){j.error(`Bild ist zu gross. Maximal ${(k/1024/1024).toFixed(0)}MB erlaubt.`);return}if(!x.name||x.name.length>255){j.error("Ungültiger Dateiname.");return}const f=j.loading("Bild wird hochgeladen...");try{const v=await Promise.race([new Promise((L,D)=>{const R=new FileReader;R.onload=()=>{const H=R.result;if(!H||!H.includes(",")){D(new Error("Ungültiges Bildformat"));return}L(H.split(",")[1])},R.onerror=()=>D(new Error("Fehler beim Lesen des Bildes")),R.readAsDataURL(x)}),new Promise((L,D)=>setTimeout(()=>D(new Error("Upload-Timeout")),3e4))]),E=_(U,"uploadAIChatImage"),B=await Promise.race([E({fileName:x.name,fileData:v,fileType:x.type}),new Promise((L,D)=>setTimeout(()=>D(new Error("Upload-Timeout")),6e4))]);if(!B?.data)throw new Error("Keine Antwort vom Server erhalten");const z=B.data;if(!z.imageUrl||!z.fileName)throw new Error("Ungültige Server-Antwort");j.dismiss(f),n(`![${z.fileName}](${z.imageUrl})`),j.success("Bild erfolgreich hochgeladen")}catch(v){j.dismiss(f);const E=v.message||"Unbekannter Fehler";j.error(`Fehler beim Hochladen: ${E}`)}},[n]),Pe=ie(async()=>{if(ee&&J){try{J.stop(),W(!1),j.info("Aufnahme wird verarbeitet...")}catch{W(!1),j.error("Fehler beim Stoppen der Aufnahme")}return}try{if(!navigator.mediaDevices||!navigator.mediaDevices.getUserMedia){j.error("Mikrofon-Zugriff wird von diesem Browser nicht unterstützt.");return}const x=await Promise.race([navigator.mediaDevices.getUserMedia({audio:!0}),new Promise((E,B)=>setTimeout(()=>B(new Error("Mikrofon-Zugriff-Timeout")),1e4))]),k=new MediaRecorder(x),f=[];let v=null;k.ondataavailable=E=>{E.data.size>0&&f.push(E.data)},k.onstop=async()=>{v&&clearTimeout(v);const E=new Blob(f,{type:"audio/webm"}),B=10*1024*1024;if(E.size>B){j.error("Audio-Aufnahme ist zu gross. Bitte kürze die Aufnahme."),x.getTracks().forEach(L=>L.stop());return}const z=j.loading("Audio wird transkribiert...");try{const L=await Promise.race([new Promise((P,q)=>{const ae=new FileReader;ae.onload=()=>{const ge=ae.result;if(!ge||!ge.includes(",")){q(new Error("Ungültiges Audioformat"));return}P(ge.split(",")[1])},ae.onerror=()=>q(new Error("Fehler beim Lesen der Audio-Datei")),ae.readAsDataURL(E)}),new Promise((P,q)=>setTimeout(()=>q(new Error("Audio-Verarbeitung-Timeout")),3e4))]),D=_(U,"transcribeAIChatAudio"),R=await Promise.race([D({audioData:L,mimeType:"audio/webm"}),new Promise((P,q)=>setTimeout(()=>q(new Error("Transkription-Timeout")),6e4))]);if(!R?.data)throw new Error("Keine Antwort vom Server erhalten");const H=R.data;if(H.transcription&&H.transcription.trim())h(H.transcription.trim()),N.current?.focus(),j.dismiss(z),j.success("Spracheingabe erfolgreich");else throw new Error("Keine Transkription erhalten")}catch(L){j.dismiss(z);const D=L.message||"Unbekannter Fehler";j.error(`Fehler bei der Transkription: ${D}`)}finally{x.getTracks().forEach(L=>L.stop())}},k.onerror=E=>{j.error("Fehler bei der Aufnahme"),W(!1),x.getTracks().forEach(B=>B.stop())},v=setTimeout(()=>{k.state==="recording"&&(k.stop(),j.warning("Maximale Aufnahmezeit erreicht (5 Minuten)"))},300*1e3),k.start(),ne(k),W(!0),j.info("Aufnahme gestartet... (Klicke erneut zum Stoppen)")}catch(x){W(!1);const k=x.message||"Unbekannter Fehler";k.includes("permission")||k.includes("denied")?j.error("Mikrofon-Zugriff wurde verweigert. Bitte erlaube den Zugriff in den Browser-Einstellungen."):k.includes("not found")||k.includes("not available")?j.error("Kein Mikrofon gefunden. Bitte verbinde ein Mikrofon."):j.error(`Mikrofon-Fehler: ${k}`)}},[ee,J]);ie(()=>{const k=u.language==="de"?"en":"de";u.changeLanguage(k),localStorage.setItem("language",k),j.success(k==="de"?"Sprache auf Deutsch geändert":"Language changed to English")},[u]);const Ee=()=>e.jsxs("form",{ref:b,onSubmit:be,className:"w-full",children:[e.jsx("input",{ref:I,type:"file",className:"hidden",onChange:x=>{const k=x.target.files?.[0];k&&he(k),x.target.value=""},accept:"*/*"}),e.jsx("input",{ref:T,type:"file",className:"hidden",onChange:x=>{const k=x.target.files?.[0];k&&(Le(k),oe(!1)),x.target.value=""},accept:"image/*"}),e.jsx("div",{className:"w-full max-w-full mx-auto",children:e.jsxs("div",{className:"flex items-center gap-2 px-2",style:{alignItems:"center"},children:[e.jsxs("div",{className:"flex-1 relative",children:[e.jsx("button",{ref:S,type:"button",onClick:()=>oe(!X),className:"absolute left-2 top-1/2 -translate-y-1/2 w-8 h-8 rounded-full bg-transparent hover:bg-muted/50 transition-colors flex items-center justify-center active:scale-95 z-10","aria-label":"Mehr Optionen",disabled:s,children:e.jsx(Vt,{className:"w-4 h-4 text-muted-foreground"})}),e.jsx("textarea",{ref:N,value:m,onChange:x=>h(x.target.value),onKeyDown:Me,placeholder:r,rows:1,className:"w-full pl-10 pr-4 py-3 rounded-2xl bg-muted border-0 text-base text-foreground placeholder:text-muted-foreground focus:outline-none focus:ring-2 focus:ring-primary/20 transition-all resize-none overflow-y-auto min-h-[44px] max-h-[120px] leading-relaxed",style:{height:"auto",minHeight:"44px"},disabled:s,onInput:x=>{const k=x.target;k.style.height="auto",k.style.height=`${Math.min(k.scrollHeight,120)}px`}})]}),m.trim()?e.jsx("button",{type:"submit",disabled:s,className:"w-10 h-10 rounded-full bg-primary text-primary-foreground hover:bg-primary/90 transition-colors flex items-center justify-center active:scale-95 shadow-md self-center","aria-label":s?"Wird gesendet...":"Nachricht senden",children:s?e.jsx(Et,{className:"w-5 h-5 animate-spin"}):e.jsx(Cn,{className:"w-5 h-5"})}):e.jsx("button",{type:"button",onClick:Pe,className:M("transition-colors flex items-center justify-center active:scale-95 self-center p-2",ee?"text-red-500 hover:text-red-600":"text-foreground hover:text-foreground/80"),"aria-label":"Spracheingabe",disabled:s,children:e.jsx(En,{className:M("w-7 h-7",ee?"text-red-500":"text-foreground")})})]})})]});return e.jsxs(e.Fragment,{children:[X&&e.jsxs("div",{ref:F,className:"fixed bg-background border border-border rounded-lg shadow-2xl z-[99999] min-w-[200px] overflow-hidden",style:{bottom:`${ze.bottom}px`,left:`${ze.left}px`},children:[e.jsxs("button",{type:"button",onClick:()=>{I.current?.click(),oe(!1)},className:"w-full flex items-center gap-3 px-4 py-3 hover:bg-muted transition-colors text-left",children:[e.jsx(Dn,{className:"w-5 h-5 text-muted-foreground"}),e.jsx("span",{className:"text-sm",children:"Datei anhängen"})]}),e.jsxs("button",{type:"button",onClick:()=>{T.current?.click(),oe(!1)},className:"w-full flex items-center gap-3 px-4 py-3 hover:bg-muted transition-colors text-left",children:[e.jsx(Sn,{className:"w-5 h-5 text-muted-foreground"}),e.jsx("span",{className:"text-sm",children:"Bild hinzufügen"})]})]}),e.jsx("div",{ref:a,className:M("flex flex-col bg-background text-foreground",o),style:{height:i},children:te.length===0?e.jsxs("div",{className:"flex flex-col h-full animate-in fade-in duration-300 pb-20",children:[e.jsx("div",{className:"flex-1 flex items-center justify-center px-4",children:e.jsx("div",{className:"w-full max-w-2xl"})}),O.length>0&&e.jsx("div",{className:"fixed bottom-24 left-0 right-0 px-4 pb-2 z-[1] pointer-events-none",children:e.jsx("div",{className:"w-full max-w-2xl mx-auto",children:e.jsx("div",{className:"overflow-x-auto scrollbar-hide -mx-4 px-4 pointer-events-auto",children:e.jsx("div",{className:"flex gap-3",style:{width:"max-content"},children:O.map((x,k)=>{const f=x.subtitle&&x.subtitle.trim().length>0;return e.jsxs("button",{onClick:()=>se(x.text),disabled:s,className:"flex-shrink-0 w-[calc(40vw-1rem)] min-w-[140px] max-w-[160px] rounded-xl bg-muted hover:bg-muted/80 active:bg-muted/70 px-2.5 py-2 text-left transition-all duration-200 disabled:cursor-not-allowed disabled:opacity-50 shadow-sm",type:"button",children:[e.jsx("p",{className:"font-medium text-xs text-foreground mb-0.5 line-clamp-2 leading-tight",children:x.text}),f&&e.jsx("p",{className:"text-[10px] text-muted-foreground line-clamp-2 leading-tight",children:x.subtitle})]},k)})})})})}),e.jsx("div",{className:"fixed bottom-0 left-0 right-0 w-full bg-background px-4 py-3 safe-bottom",style:{paddingBottom:"max(0.75rem, env(safe-area-inset-bottom))"},children:e.jsx("div",{className:"w-full max-w-2xl mx-auto",children:Ee()})})]}):e.jsxs(e.Fragment,{children:[e.jsx("div",{ref:y,className:"flex-1 overflow-hidden pb-32",children:e.jsx(ka,{className:"h-full [&>div>div]:!overflow-y-auto [&>div>div]:[-ms-overflow-style:none] [&>div>div]:[scrollbar-width:none] [&>div>div::-webkit-scrollbar]:hidden",children:e.jsxs("div",{className:"flex flex-col p-4 space-y-4 pb-6",children:[te.map((x,k)=>e.jsx("div",{className:M("flex gap-3 animate-in fade-in slide-in-from-bottom-2 duration-300",x.role==="user"?"justify-end":"justify-start"),children:e.jsx("div",{className:M("max-w-[85%] select-text",x.role==="user"?"bg-primary text-primary-foreground rounded-2xl px-4 py-3 text-base":"text-foreground text-base"),onClick:f=>{f.target.closest("button, a")||f.stopPropagation()},onMouseDown:f=>{f.target.closest("button, a")||f.stopPropagation()},children:x.role==="assistant"?e.jsx(Ta,{content:x.content,onNavigate:Y}):e.jsx("p",{className:"whitespace-pre-wrap leading-relaxed",children:x.content})})},k)),s&&e.jsx("div",{className:"flex items-start gap-4 justify-start animate-in fade-in duration-200",children:e.jsx("div",{className:"rounded-lg bg-muted px-4 py-3",children:e.jsx(Et,{className:"size-4 animate-spin text-muted-foreground"})})})]})})}),O.length>0&&e.jsx("div",{className:"fixed bottom-24 left-0 right-0 px-4 pb-2 z-[1] pointer-events-none",children:e.jsx("div",{className:"w-full max-w-2xl mx-auto",children:e.jsx("div",{className:"overflow-x-auto scrollbar-hide -mx-4 px-4 pointer-events-auto",children:e.jsx("div",{className:"flex gap-3",style:{width:"max-content"},children:O.map((x,k)=>{const f=x.subtitle&&x.subtitle.trim().length>0;return e.jsxs("button",{onClick:()=>se(x.text),disabled:s,className:"flex-shrink-0 w-[calc(40vw-1rem)] min-w-[140px] max-w-[160px] rounded-xl bg-muted hover:bg-muted/80 active:bg-muted/70 px-2.5 py-2 text-left transition-all duration-200 disabled:cursor-not-allowed disabled:opacity-50 shadow-sm",type:"button",children:[e.jsx("p",{className:"font-medium text-xs text-foreground mb-0.5 line-clamp-2 leading-tight",children:x.text}),f&&e.jsx("p",{className:"text-[10px] text-muted-foreground line-clamp-2 leading-tight",children:x.subtitle})]},k)})})})})}),e.jsx("div",{className:"fixed bottom-0 left-0 right-0 w-full bg-background/95 backdrop-blur-sm px-4 py-3 safe-bottom flex-shrink-0 z-30",style:{paddingBottom:"max(0.75rem, env(safe-area-inset-bottom))"},children:e.jsx("div",{className:"w-full max-w-2xl mx-auto",children:Ee()})})]})})]})}function Ot({className:t,onKeyDown:n,onCompositionStart:s,onCompositionEnd:r,...o}){const i=St(),{onCompositionStart:l,onCompositionEnd:d,onKeyDown:p}=cn({onKeyDown:u=>{const g=u.nativeEvent.isComposing||i.justEndedComposing();u.key==="Enter"&&!u.shiftKey&&g||n?.(u)},onCompositionStart:u=>{i.setComposing(!0),s?.(u)},onCompositionEnd:u=>{i.markCompositionEnd(),setTimeout(()=>{i.setComposing(!1)},100),r?.(u)}});return e.jsx("textarea",{"data-slot":"textarea",className:M("border-input placeholder:text-muted-foreground focus-visible:border-ring focus-visible:ring-ring/50 aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive dark:bg-input/30 flex field-sizing-content min-h-16 w-full rounded-md border bg-transparent px-3 py-2 text-base shadow-xs transition-[color,box-shadow] outline-none focus-visible:ring-[3px] disabled:cursor-not-allowed disabled:opacity-50 md:text-sm",t),onCompositionStart:l,onCompositionEnd:d,onKeyDown:p,...o})}const Ve={role:"system",content:'Du bist ein hilfreicher Assistent für die Nexo-Anwendung. Du hilfst Benutzern bei Fragen zu Finanzen, Rechnungen, Terminen und anderen Funktionen der App. WICHTIG: Verwende IMMER "ss" statt "ß" in allen deutschen Texten (Schweizer Grammatik).'};function yr(){const{t}=Qt();Xe();const{data:n,isLoading:s,refetch:r}=ln(),[o,i]=w(null),[l,d]=w(!1),[p,u]=w(!1),[g,m]=w(!1),[h,y]=w(!1),[a,b]=w(!1),[N,I]=w(!1),[T,ee]=w(!1),[W,J]=w(null),ne=G(null),X=G(null),oe=G(null),A=G(null),[S,F]=w({title:"",type:"termin",dueDate:"",isAllDay:!1,amount:"",currency:"CHF",notes:""}),[Y,te]=w(!1),[O,Z]=w({type:"ausgabe",amount:"",category:"",description:"",date:me(new Date),paymentMethod:"Karte"}),[ze,fe]=w(de(new Date)),[be,Me]=w(!1),[se,he]=w({name:"",quantity:"1",category:"Lebensmittel",store:""}),[Le,Pe]=w(!1),Ee=["Lebensmittel","Getränke","Haushalt","Hygiene","Tierbedarf","Sonstiges"],x=async()=>{if(!se.name){j.error("Bitte Artikelname eingeben");return}Pe(!0);try{await aa({item:se.name,quantity:parseInt(se.quantity)||1,category:se.category,estimatedPrice:0,currency:"EUR",unit:null}),j.success("Artikel zur Einkaufsliste hinzugefügt"),b(!1),he({name:"",quantity:"1",category:"Lebensmittel",store:""})}catch(c){j.error("Fehler beim Hinzufügen des Artikels"),console.error(c)}finally{Pe(!1)}},k={income:["Gehalt","Freelance","Investitionen","Geschenk","Sonstiges"],expense:["Lebensmittel","Transport","Wohnen","Unterhaltung","Gesundheit","Kleidung","Bildung","Rechnung","Sonstiges"]},f=async()=>{if(!O.amount||!O.category){j.error("Bitte Betrag und Kategorie eingeben");return}Me(!0);try{await nn({type:O.type,category:O.category,amount:Math.round(parseFloat(O.amount)*100),currency:"CHF",date:new Date(O.date),paymentMethod:O.paymentMethod,notes:O.description||"",status:O.type==="ausgabe"?"open":void 0}),j.success(O.type==="einnahme"?"Einnahme hinzugefügt":"Ausgabe hinzugefügt");const c=me(new Date);y(!1),Z({type:"ausgabe",amount:"",category:"",description:"",date:c,paymentMethod:"Karte"}),fe(de(c))}catch(c){j.error("Fehler beim Erstellen des Eintrags"),console.error(c)}finally{Me(!1)}};V(()=>{!s&&n.length>0&&!o&&i(n[0].id)},[s,n,o]);const[v,E]=w([Ve]),B=G(null),z=G(!1);V(()=>{if(o&&o!==B.current)if(B.current=o,n.length>0){const c=gt(o,n);c&&c.messages.length>0?E(c.messages):E([Ve])}else E([Ve])},[o,n]),V(()=>{if(!z.current&&o&&v.length>1){const c=setTimeout(async()=>{z.current=!0;try{const C=gt(o,n);if(C){const $=v.find(le=>le.role==="user");$&&C.title==="Neue Konversation"&&(C.title=Pt($.content)),C.messages=v,C.updatedAt=new Date().toISOString(),await st(C)}else{const $=v.find(ft=>ft.role==="user"),le={id:o,userId:"",title:$?Pt($.content):"Neue Konversation",messages:v,createdAt:new Date().toISOString(),updatedAt:new Date().toISOString()};await st(le),le.id.startsWith("chat_")&&i(le.id)}}catch{}finally{z.current=!1}},1e3);return()=>clearTimeout(c)}},[v,o,n]);const L=ie(async()=>{try{const c=Bt();await st(c),i(c.id),E([Ve]),await r(),j.success("Neue Konversation gestartet")}catch(c){console.error("Error creating new chat:",c);let C="Fehler beim Erstellen der neuen Konversation";c?.code==="unauthenticated"||c?.message?.includes("unauthenticated")?C="Bitte melde dich an, um eine neue Konversation zu erstellen":c?.code==="permission-denied"||c?.message?.includes("permission")?C="Keine Berechtigung zum Erstellen einer Konversation":c?.message?C=`Fehler: ${c.message}`:typeof c=="string"&&(C=`Fehler: ${c}`),j.error(C)}},[r]),D=ie(c=>{i(c);const C=gt(c,n);C&&C.messages.length>0?E(C.messages):E([Ve])},[n]),R=Js.ai.chat.useMutation({onSuccess:c=>{const C={role:"assistant",content:c.content};E($=>[...$,C])},onError:c=>{let C="Ein unbekannter Fehler ist aufgetreten.";c.message.includes("<!doctype")||c.message.includes("Unexpected token")||c.message.includes("Failed to fetch")?C="Der Server ist nicht erreichbar oder gibt eine ungültige Antwort zurück. Bitte stelle sicher, dass der Server läuft und du eine Internetverbindung hast.":c.message.includes("Unable to transform")||c.message.includes("NetworkError")?C="Fehler bei der Datenübertragung. Bitte überprüfe deine Internetverbindung und versuche es erneut.":c.data?.code==="UNAUTHORIZED"||c.message.includes("unauthenticated")?C="Du bist nicht angemeldet. Bitte melde dich an.":c.data?.code==="INTERNAL_SERVER_ERROR"||c.message.includes("500")?C="Ein Serverfehler ist aufgetreten. Bitte versuche es später erneut.":c.message.includes("timeout")||c.message.includes("Timeout")?C="Die Anfrage hat zu lange gedauert. Bitte versuche es erneut.":c.message.includes("rate limit")||c.message.includes("429")?C="Zu viele Anfragen. Bitte warte einen Moment und versuche es erneut.":C=c.message||"Ein Fehler ist aufgetreten.";const $={role:"assistant",content:`**Fehler aufgetreten**

${C}

Bitte versuche es erneut oder starte eine neue Konversation.`};E(le=>[...le,$]),j.error("Fehler beim Senden der Nachricht")}}),H=ie(async c=>{if(c.length>1e4){j.error("Nachricht ist zu lang. Bitte kürze sie auf maximal 10.000 Zeichen.");return}if(!o)try{const $=Bt();await st($),i($.id),await r()}catch{j.error("Fehler beim Erstellen der Konversation");return}if(v.filter($=>$.role==="user").length>=50){j.warning("Zu viele Nachrichten in dieser Konversation. Bitte starte eine neue Konversation.");return}try{const $={role:"user",content:c},le=[...v,$];E(le),R.mutate({messages:le})}catch{j.error("Fehler beim Senden der Nachricht. Bitte versuche es erneut.")}},[v,R,o,r]),P=xe(()=>[{text:"Wie funktioniert die Rechnungsverwaltung?",subtitle:"Lerne die Rechnungsverwaltung kennen",icon:"receipt"},{text:"Wie erstelle ich eine Erinnerung?",subtitle:"Erstelle Termine und Erinnerungen",icon:"bell"},{text:"Wie verwalte ich meine Finanzen?",subtitle:"Verwalte Einnahmen und Ausgaben",icon:"wallet"},{text:"Was kann ich mit der Einkaufsliste machen?",subtitle:"Verwalte deine Einkaufsliste",icon:"shoppingCart"},{text:"Wie funktioniert das Raten-System?",subtitle:"Lerne Ratenzahlungen zu verwalten",icon:"calendar"},{text:"Wie scanne ich eine Rechnung?",subtitle:"Erfasse Rechnungen automatisch",icon:"scan"}],[]),q=v.some(c=>c.role==="user"),ae=()=>o&&n.length>0&&n.find(C=>C.id===o)?.title||"Assistent",ge=xe(()=>[{id:"reminder",label:"Erinnerung erstellen",path:"#",icon:ct,onClick:()=>u(!0)},{id:"scan",label:"Rechnung scannen",path:"#",icon:We,onClick:()=>{m(!0),J(null)}},{id:"finance",label:"Finanzübersicht",path:"#",icon:Ae,onClick:()=>y(!0)},{id:"shopping",label:"Einkaufsliste",path:"#",icon:Ze,onClick:()=>b(!0)}],[]),ut=async()=>{if(!S.title||!S.dueDate){j.error("Bitte füllen Sie Titel und Datum aus");return}te(!0);try{const c=S.amount?Math.round(parseFloat(S.amount)*100):void 0;await tn({title:S.title,type:S.type,dueDate:new Date(S.dueDate),isAllDay:S.isAllDay,amount:c,currency:S.currency,notes:S.notes||""}),j.success("Erinnerung erstellt"),u(!1),F({title:"",type:"termin",dueDate:"",isAllDay:!1,amount:"",currency:"CHF",notes:""})}catch(c){j.error("Fehler beim Erstellen der Erinnerung"),console.error(c)}finally{te(!1)}},mt=async()=>{try{const c=await navigator.mediaDevices.getUserMedia({video:{facingMode:"environment"}});A.current=c,ne.current&&(ne.current.srcObject=c),I(!0),pt()}catch(c){j.error(Ea(c)),Sa()}},Q=()=>{A.current&&(A.current.getTracks().forEach(c=>c.stop()),A.current=null),I(!1)},dn=()=>{if(ne.current&&X.current){const c=ne.current,C=X.current;C.width=c.videoWidth,C.height=c.videoHeight;const $=C.getContext("2d");if($){$.drawImage(c,0,0);const le=C.toDataURL("image/jpeg");J(le),Q(),pt()}}},un=c=>{const C=c.target.files?.[0];if(C){const $=new FileReader;$.onload=le=>{const ft=le.target?.result;J(ft),pt()},$.readAsDataURL(C)}},mn=async()=>{if(W){const c={role:"user",content:`![Gescanntes Bild](${W})`};E(C=>[...C,c]),J(null),m(!1),j.success("Scan zum Chat hinzugefügt");try{R.mutate({messages:[...v,c]})}catch(C){console.error("Error sending scan to chat:",C)}}};return V(()=>()=>{g||Q()},[g]),e.jsxs("div",{className:"min-h-screen bg-background flex flex-col safe-area-inset",children:[e.jsx(va,{title:ae(),showSidebar:!0,showQuickActions:!0,quickActions:ge,currentChatId:o||void 0,onSelectChat:D,onNewChat:L,sidebarOpen:l,onSidebarToggle:d}),ge.length>0&&e.jsxs("div",{className:"fixed top-14 left-0 right-0 z-30 px-4 py-3 flex flex-row gap-3 justify-center safe-top",style:{paddingTop:"max(0.75rem, env(safe-area-inset-top))"},children:[e.jsx("button",{onClick:()=>d(!0),className:"w-12 h-12 rounded-full bg-background hover:bg-muted border border-border transition-colors flex items-center justify-center active:scale-95 shadow-sm","aria-label":"Menü öffnen","aria-expanded":l,"aria-controls":"sidebar-menu",title:"Menü öffnen",children:e.jsx(Pn,{className:"w-5 h-5 text-foreground"})}),ge.map(c=>{const C=c.icon;return e.jsx("button",{onClick:c.onClick,className:"w-12 h-12 rounded-full bg-background hover:bg-muted border border-border transition-colors flex items-center justify-center active:scale-95 shadow-sm","aria-label":c.label,title:c.label,children:C&&e.jsx(C,{className:"w-5 h-5 text-foreground"})},c.id)})]}),e.jsx("div",{className:"flex-1 overflow-hidden flex flex-col bg-background",style:{paddingTop:ge.length>0?"7rem":"3.5rem"},children:e.jsx("div",{className:"flex-1 flex flex-col w-full overflow-hidden min-h-0",children:e.jsx(Ra,{messages:v,onSendMessage:H,isLoading:R.isPending,placeholder:t("common.typeMessage","Nachricht eingeben..."),height:"100%",emptyStateMessage:"Wähle eine Frage oder stelle deine eigene",suggestedPrompts:q?[]:P})})}),e.jsx(ve,{open:p,onOpenChange:c=>{u(c),c||F({title:"",type:"termin",dueDate:"",isAllDay:!1,amount:"",currency:"CHF",notes:""})},children:e.jsxs(we,{className:"!fixed !top-[50%] !left-[50%] !right-auto !bottom-auto !translate-x-[-50%] !translate-y-[-50%] !w-[85vw] !max-w-sm !max-h-fit !rounded-3xl !m-0 !overflow-visible !shadow-2xl",children:[e.jsxs(je,{className:"px-5 pt-5 pb-3",children:[e.jsx(De,{className:"text-lg font-semibold",children:"Erinnerung erstellen"}),e.jsx(Se,{className:"sr-only",children:"Erstellen Sie eine neue Erinnerung basierend auf der Chat-Konversation"})]}),e.jsxs("div",{className:"space-y-3 px-5 pb-2",children:[e.jsxs("div",{className:"w-full",children:[e.jsx(re,{className:"text-sm font-medium",children:"Titel *"}),e.jsx(ye,{value:S.title,onChange:c=>F({...S,title:c.target.value}),placeholder:"Titel",className:"h-11 min-h-[44px] mt-1.5 rounded-xl w-full"})]}),e.jsxs("div",{className:"w-full",children:[e.jsx(re,{className:"text-sm font-medium",children:"Typ *"}),e.jsxs(Oe,{value:S.type,onValueChange:c=>F({...S,type:c}),children:[e.jsx(Ue,{className:"h-11 min-h-[44px] mt-1.5 rounded-xl w-full",children:e.jsx(_e,{})}),e.jsxs($e,{children:[e.jsx(ce,{value:"termin",children:"Termin"}),e.jsx(ce,{value:"zahlung",children:"Zahlung"}),e.jsx(ce,{value:"aufgabe",children:"Aufgabe"})]})]})]}),e.jsxs("div",{className:"w-full",children:[e.jsx(re,{className:"text-sm font-medium",children:"Datum & Uhrzeit *"}),e.jsx("div",{className:"relative w-full mt-1.5",children:e.jsx(ye,{type:"datetime-local",placeholder:"Datum & Uhrzeit auswählen",value:S.dueDate,onChange:c=>{F({...S,dueDate:c.target.value})},className:"h-11 min-h-[44px] rounded-xl w-full",style:{boxSizing:"border-box",fontSize:"16px",height:"44px",minHeight:"44px",maxHeight:"44px",padding:"0.5rem 0.75rem",lineHeight:"1.5rem",appearance:"none",WebkitAppearance:"none",MozAppearance:"textfield"}})})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Na,{checked:S.isAllDay,onCheckedChange:c=>F({...S,isAllDay:c})}),e.jsx(re,{className:"text-sm font-medium",children:"Ganztägig"})]}),S.type==="zahlung"&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"w-full",children:[e.jsx(re,{className:"text-sm font-medium",children:"Betrag"}),e.jsx(ye,{type:"number",step:"0.01",value:S.amount,onChange:c=>F({...S,amount:c.target.value}),placeholder:"0.00",className:"h-11 min-h-[44px] mt-1.5 rounded-xl w-full"})]}),e.jsxs("div",{className:"w-full",children:[e.jsx(re,{className:"text-sm font-medium",children:"Währung"}),e.jsxs(Oe,{value:S.currency,onValueChange:c=>F({...S,currency:c}),children:[e.jsx(Ue,{className:"h-11 min-h-[44px] mt-1.5 rounded-xl w-full",children:e.jsx(_e,{})}),e.jsxs($e,{children:[e.jsx(ce,{value:"CHF",children:"CHF"}),e.jsx(ce,{value:"EUR",children:"EUR"}),e.jsx(ce,{value:"USD",children:"USD"})]})]})]})]}),e.jsxs("div",{className:"w-full",children:[e.jsx(re,{className:"text-sm font-medium",children:"Notizen"}),e.jsx(Ot,{value:S.notes,onChange:c=>F({...S,notes:c.target.value}),placeholder:"Notizen...",className:"mt-1.5 min-h-[80px] rounded-xl w-full"})]})]}),e.jsxs(Ne,{className:"px-5 pb-3 pt-2 gap-2.5",children:[e.jsx(K,{variant:"outline",onClick:()=>u(!1),className:"h-11 min-h-[44px] flex-1 rounded-xl text-sm font-medium",children:"Abbrechen"}),e.jsx(K,{onClick:ut,disabled:Y,className:"h-11 min-h-[44px] flex-1 rounded-xl text-sm font-medium",children:Y?"Speichert...":"Erstellen"})]})]})}),e.jsx(ve,{open:g,onOpenChange:c=>{m(c),c||(Q(),J(null))},children:e.jsxs(we,{className:"!fixed !top-[50%] !left-[50%] !right-auto !bottom-auto !translate-x-[-50%] !translate-y-[-50%] !w-[85vw] !max-w-sm !max-h-fit !rounded-3xl !m-0 !overflow-visible !shadow-2xl",children:[e.jsxs(je,{className:"px-5 pt-5 pb-3",children:[e.jsx(De,{className:"text-lg font-semibold",children:"Rechnung scannen"}),e.jsx(Se,{className:"sr-only",children:"Scannen Sie eine Rechnung mit der Kamera oder laden Sie ein Bild hoch"})]}),e.jsxs("div",{className:"space-y-3 px-5 pb-2",children:[!N&&!W&&e.jsxs("div",{className:"space-y-2.5",children:[e.jsxs(K,{onClick:mt,className:"w-full h-11 flex items-center justify-center gap-2 rounded-xl text-sm font-medium",children:[e.jsx(kt,{className:"w-4 h-4"}),"Kamera öffnen"]}),e.jsxs("div",{className:"relative",children:[e.jsx("input",{ref:oe,type:"file",accept:"image/*",onChange:un,className:"hidden"}),e.jsxs(K,{variant:"outline",onClick:()=>oe.current?.click(),className:"w-full h-11 flex items-center justify-center gap-2 rounded-xl text-sm font-medium",children:[e.jsx(Bn,{className:"w-4 h-4"}),"Bild hochladen"]})]})]}),N&&e.jsxs("div",{className:"space-y-2.5",children:[e.jsxs("div",{className:"relative bg-black rounded-xl overflow-hidden aspect-video",children:[e.jsx("video",{ref:ne,autoPlay:!0,playsInline:!0,className:"w-full h-full object-cover"}),e.jsx("canvas",{ref:X,className:"hidden"})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(K,{variant:"outline",onClick:Q,className:"flex-1 h-11 rounded-xl text-sm font-medium",children:[e.jsx(Je,{className:"w-4 h-4 mr-2"}),"Abbrechen"]}),e.jsxs(K,{onClick:dn,className:"flex-1 h-11 rounded-xl text-sm font-medium",children:[e.jsx(kt,{className:"w-4 h-4 mr-2"}),"Aufnehmen"]})]})]}),W&&e.jsxs("div",{className:"space-y-2.5",children:[e.jsx("div",{className:"relative bg-black rounded-xl overflow-hidden",children:e.jsx("img",{src:W,alt:"Gescanntes Bild",className:"w-full h-auto"})}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(K,{variant:"outline",onClick:()=>{J(null),I(!1)},className:"flex-1 h-11 rounded-xl text-sm font-medium",children:"Neu scannen"}),e.jsx(K,{onClick:mn,className:"flex-1 h-11 rounded-xl text-sm font-medium",children:"Zum Chat hinzufügen"})]})]})]}),e.jsx(Ne,{className:"px-5 pb-3 pt-2",children:e.jsx(K,{variant:"outline",onClick:()=>{m(!1),Q(),J(null)},className:"h-11 min-h-[44px] w-full rounded-xl text-sm font-medium",children:"Schliessen"})})]})}),e.jsx(ve,{open:h,onOpenChange:c=>{if(y(c),c){const C=me(new Date);Z($=>({...$,date:C})),fe(de(C))}else{const C=me(new Date);Z({type:"ausgabe",amount:"",category:"",description:"",date:C,paymentMethod:"Karte"}),fe(de(C))}},children:e.jsxs(we,{className:"!fixed !top-[50%] !left-[50%] !right-auto !bottom-auto !translate-x-[-50%] !translate-y-[-50%] !w-[85vw] !max-w-sm !max-h-fit !rounded-3xl !m-0 !overflow-visible !shadow-2xl",children:[e.jsxs(je,{className:"px-5 pt-5 pb-3",children:[e.jsx(De,{className:"text-lg font-semibold",children:"Einnahme / Ausgabe"}),e.jsx(Se,{className:"sr-only",children:"Erstellen Sie einen neuen Finanz-Eintrag für Einnahmen oder Ausgaben"})]}),e.jsxs("div",{className:"space-y-3 px-5 pb-2",children:[e.jsxs("div",{children:[e.jsx(re,{className:"text-sm font-medium",children:"Typ *"}),e.jsxs(Oe,{value:O.type,onValueChange:c=>{Z({...O,type:c,category:""})},children:[e.jsx(Ue,{className:"h-11 min-h-[44px] mt-1.5 rounded-xl",children:e.jsx(_e,{})}),e.jsxs($e,{children:[e.jsx(ce,{value:"einnahme",children:"Einnahme"}),e.jsx(ce,{value:"ausgabe",children:"Ausgabe"})]})]})]}),e.jsxs("div",{children:[e.jsx(re,{children:"Betrag *"}),e.jsx(ye,{type:"number",step:"0.01",value:O.amount,onChange:c=>Z({...O,amount:c.target.value}),placeholder:"0.00",className:"h-11 min-h-[44px] mt-1.5 rounded-xl"})]}),e.jsxs("div",{children:[e.jsx(re,{className:"text-sm font-medium",children:"Kategorie *"}),e.jsxs(Oe,{value:O.category,onValueChange:c=>Z({...O,category:c}),children:[e.jsx(Ue,{className:"h-11 min-h-[44px] mt-1.5 rounded-xl",children:e.jsx(_e,{placeholder:"Kategorie wählen"})}),e.jsx($e,{children:(O.type==="einnahme"?k.income:k.expense).map(c=>e.jsx(ce,{value:c,children:c},c))})]})]}),e.jsxs("div",{children:[e.jsx(re,{className:"text-sm font-medium",children:"Datum *"}),e.jsx(ye,{type:"text",placeholder:"DD.MM.YYYY",value:ze,onChange:c=>{const C=c.target.value;fe(C);const $=He(C);$&&Z({...O,date:$})},onBlur:c=>{const C=He(c.target.value);C?(Z({...O,date:C}),fe(de(C))):c.target.value&&fe(de(O.date))},className:"h-11 min-h-[44px] mt-1.5 rounded-xl"})]}),e.jsxs("div",{children:[e.jsx(re,{children:"Zahlungsmethode"}),e.jsxs(Oe,{value:O.paymentMethod,onValueChange:c=>Z({...O,paymentMethod:c}),children:[e.jsx(Ue,{className:"h-11 min-h-[44px] mt-1.5 rounded-xl",children:e.jsx(_e,{})}),e.jsxs($e,{children:[e.jsx(ce,{value:"Karte",children:"Karte"}),e.jsx(ce,{value:"Bar",children:"Bar"}),e.jsx(ce,{value:"Überweisung",children:"Überweisung"}),e.jsx(ce,{value:"Andere",children:"Andere"})]})]})]}),e.jsxs("div",{children:[e.jsx(re,{children:"Beschreibung"}),e.jsx(Ot,{value:O.description,onChange:c=>Z({...O,description:c.target.value}),placeholder:"Beschreibung...",className:"mt-1 min-h-[80px]"})]})]}),e.jsxs(Ne,{className:"px-5 pb-3 pt-2 gap-2.5",children:[e.jsx(K,{variant:"outline",onClick:()=>y(!1),className:"h-11 min-h-[44px] flex-1 rounded-xl text-sm font-medium",children:"Abbrechen"}),e.jsx(K,{onClick:f,disabled:be,className:"h-11 min-h-[44px] flex-1 rounded-xl text-sm font-medium",children:be?"Speichert...":"Erstellen"})]})]})}),e.jsx(ve,{open:a,onOpenChange:c=>{b(c),c||he({name:"",quantity:"1",category:"Lebensmittel",store:""})},children:e.jsxs(we,{className:"!fixed !top-[50%] !left-[50%] !right-auto !bottom-auto !translate-x-[-50%] !translate-y-[-50%] !w-[85vw] !max-w-sm !max-h-fit !rounded-3xl !m-0 !overflow-visible !shadow-2xl",children:[e.jsxs(je,{className:"px-5 pt-5 pb-3",children:[e.jsx(De,{className:"text-lg font-semibold",children:"Artikel zur Einkaufsliste hinzufügen"}),e.jsx(Se,{className:"sr-only",children:"Fügen Sie einen neuen Artikel zur Einkaufsliste hinzu"})]}),e.jsxs("div",{className:"space-y-3 px-5 pb-2",children:[e.jsxs("div",{children:[e.jsx(re,{className:"text-sm font-medium",children:"Artikelname *"}),e.jsx(ye,{value:se.name,onChange:c=>he({...se,name:c.target.value}),placeholder:"z.B. Milch",className:"h-11 min-h-[44px] mt-1.5 rounded-xl"})]}),e.jsxs("div",{children:[e.jsx(re,{className:"text-sm font-medium",children:"Menge"}),e.jsx(ye,{type:"number",min:"1",value:se.quantity,onChange:c=>he({...se,quantity:c.target.value}),placeholder:"1",className:"h-11 min-h-[44px] mt-1.5 rounded-xl"})]}),e.jsxs("div",{children:[e.jsx(re,{className:"text-sm font-medium",children:"Kategorie"}),e.jsxs(Oe,{value:se.category,onValueChange:c=>he({...se,category:c}),children:[e.jsx(Ue,{className:"h-11 min-h-[44px] mt-1.5 rounded-xl",children:e.jsx(_e,{})}),e.jsx($e,{children:Ee.map(c=>e.jsx(ce,{value:c,children:c},c))})]})]}),e.jsxs("div",{children:[e.jsx(re,{className:"text-sm font-medium",children:"Geschäft (optional)"}),e.jsx(ye,{value:se.store,onChange:c=>he({...se,store:c.target.value}),placeholder:"z.B. Migros",className:"h-11 min-h-[44px] mt-1.5 rounded-xl"})]})]}),e.jsxs(Ne,{className:"px-5 pb-3 pt-2 gap-2.5",children:[e.jsx(K,{variant:"outline",onClick:()=>b(!1),className:"h-11 min-h-[44px] flex-1 rounded-xl text-sm font-medium",children:"Abbrechen"}),e.jsx(K,{onClick:x,disabled:Le,className:"h-11 min-h-[44px] flex-1 rounded-xl text-sm font-medium",children:Le?"Speichert...":"Hinzufügen"})]})]})})]})}export{mr as $,br as A,K as B,ba as C,ve as D,dr as E,lr as F,Ea as G,Sa as H,pt as I,cr as J,Ue as K,re as L,_e as M,$e as N,ce as O,va as P,ye as Q,Na as R,Oe as S,aa as T,rr as U,or as V,ir as W,Ha as X,Ka as Y,Wa as Z,ur as _,Va as a,fr as a0,Za as a1,qa as a2,Ye as a3,an as a4,Re as a5,er as a6,nt as a7,pr as a8,gr as a9,xr as aa,Ot as ab,hr as ac,Ga as ad,tr as ae,nr as af,Ja as ag,Xa as ah,Ya as ai,yr as aj,Ts as ak,Js as al,Qa as b,M as c,Dt as d,sn as e,de as f,U as g,Be as h,me as i,e as j,Mt as k,ma as l,fa as m,Lt as n,we as o,je as p,De as q,Se as r,Ne as s,He as t,sa as u,tn as v,nn as w,Qt as x,sr as y,ar as z};
