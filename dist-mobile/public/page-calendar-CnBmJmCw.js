import{j as e,C as Pe,P as He,c as L,f as E,u as We,a as $e,b as Je,d as Ke,e as qe,g as ge,h as Y,n as O,i as k,k as pe,B as v,l as fe,m as be,D as q,o as G,p as V,q as Q,r as ne,s as Z,L as B,t as X,v as Ge,w as Ve}from"./page-aichat-B-wRe_Iy.js";import{useState as N,useMemo as _,useRef as Qe,useCallback as ve,useEffect as U}from"react";import{u as oe}from"./vendor-router-C0MnGj0q.js";import{L as Ze,h as ye,B as De,g as ie,k as Xe,M as _e,i as et,j as tt,Q as st,c as at,X as re,d as nt,e as rt,z as le,C as je,S as lt,b as it,a as ot,W as dt,f as ct,R as mt,n as ut}from"./vendor-misc-BEMpGvlw.js";import{S as xt}from"./vendor-ui-BGTRbCol.js";import{m as ht}from"./vendor-firebase-l0znGU8_.js";import{t as y}from"./vendor-toast-CdQ6zwVl.js";const gt=[{id:"dashboard",label:"Dashboard",path:"/dashboard",icon:Ze},{id:"calendar",label:"Kalender",path:"/calendar",icon:ye},{id:"reminders",label:"Erinnerungen",path:"/reminders",icon:De},{id:"finance",label:"Finanzen",path:"/finance",icon:ie},{id:"shopping",label:"Einkaufsliste",path:"/shopping",icon:Xe},{id:"chat",label:"Assistent",path:"/aichat",icon:_e},{id:"bills",label:"Rechnungen",path:"/bills",icon:et},{id:"documents",label:"Dokumente",path:"/documents",icon:tt}];function pt({currentPath:D,customActions:m}){const[w,g]=oe(),[f,F]=N(!1),S=m||gt,u=D||w;return e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"fixed top-14 left-0 right-0 z-30 px-4 py-3 flex flex-row gap-3 justify-center safe-top overflow-x-auto scrollbar-hide",style:{paddingTop:"max(0.75rem, env(safe-area-inset-top))"},children:[e.jsx("button",{onClick:()=>F(!0),className:"w-12 h-12 flex-shrink-0 rounded-full bg-background hover:bg-muted border border-border transition-colors flex items-center justify-center active:scale-95 shadow-sm","aria-label":"Menü öffnen","aria-expanded":f,"aria-controls":"sidebar-menu",title:"Menü öffnen",children:e.jsx(st,{className:"w-5 h-5 text-foreground"})}),S.map(j=>{const c=j.icon,ee=u===j.path;return e.jsx("button",{onClick:()=>{g(j.path)},className:`w-12 h-12 flex-shrink-0 rounded-full border transition-colors flex items-center justify-center active:scale-95 shadow-sm ${ee?"bg-primary text-primary-foreground border-primary":"bg-background hover:bg-muted border-border"}`,"aria-label":j.label,title:j.label,children:e.jsx(c,{className:"w-5 h-5"})},j.id)})]}),e.jsx(Pe,{open:f,onClose:()=>F(!1)})]})}function ft({children:D,title:m="Nexo",showSidebar:w=!1,showQuickActions:g=!1,quickActions:f=[],currentChatId:F,onSelectChat:S,onNewChat:u,hideQuickActions:j=!1}){const[c]=oe();return e.jsxs("div",{className:"min-h-screen bg-background flex flex-col",children:[e.jsx(He,{title:m,showSidebar:w,showQuickActions:g,quickActions:f,currentChatId:F,onSelectChat:S,onNewChat:u}),!j&&e.jsx(pt,{currentPath:c}),e.jsx("main",{className:"flex-1 overflow-y-auto",style:{paddingTop:j?"3.5rem":"7rem",touchAction:"pan-y"},children:e.jsx("div",{className:"mobile-container py-4",children:D})})]})}function bt({className:D,...m}){return e.jsx("div",{"data-slot":"skeleton",className:L("bg-accent animate-pulse rounded-md",D),...m})}const vt=at("inline-flex items-center justify-center rounded-md border px-2 py-0.5 text-xs font-medium w-fit whitespace-nowrap shrink-0 [&>svg]:size-3 gap-1 [&>svg]:pointer-events-none focus-visible:border-ring focus-visible:ring-ring/50 focus-visible:ring-[3px] aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive transition-[color,box-shadow] overflow-hidden",{variants:{variant:{default:"border-transparent bg-primary text-primary-foreground [a&]:hover:bg-primary/90",secondary:"border-transparent bg-secondary text-secondary-foreground [a&]:hover:bg-secondary/90",destructive:"border-transparent bg-destructive text-white [a&]:hover:bg-destructive/90 focus-visible:ring-destructive/20 dark:focus-visible:ring-destructive/40 dark:bg-destructive/60",outline:"text-foreground [a&]:hover:bg-accent [a&]:hover:text-accent-foreground"}},defaultVariants:{variant:"default"}});function Ne({className:D,variant:m,asChild:w=!1,...g}){const f=w?xt:"span";return e.jsx(f,{"data-slot":"badge",className:L(vt({variant:m}),D),...g})}function kt(){const[,D]=oe(),[m,w]=N(new Date),[g,f]=N([]),[F,S]=N(!0),[u,j]=N(null),[c,ee]=N(null),[we,A]=N(!1),[Ce,T]=N(!1),[Ee,P]=N(!1),[ke,H]=N(!1),[Se,W]=N(E(new Date)),[Te,$]=N(E(new Date)),{data:p=[]}=We(),{data:de=[]}=$e(),{data:ce=[]}=Je(),{settings:Me}=Ke(),J=Me?.weatherLocation||"Zurich, CH",te=_(()=>u?new Date(u.getFullYear(),u.getMonth(),u.getDate()):null,[u?.getFullYear(),u?.getMonth(),u?.getDate()]),{data:b,isLoading:se,error:z}=qe(te,J),I=Qe(""),R=ve(async()=>{try{if(S(!0),!ge){console.error("[Calendar] Firebase functions not available"),f([]);return}if(!Y.currentUser){console.warn("[Calendar] User not authenticated"),f([]);return}const t=ht(ge,"getCalendarEvents"),s=new Date(m.getFullYear(),m.getMonth()-6,1),o=new Date(m.getFullYear(),m.getMonth()+6,0);try{console.log("[Calendar] Calling getCalendarEvents with:",{startDate:s.toISOString(),endDate:o.toISOString()});const i=await t({startDate:s.toISOString(),endDate:o.toISOString()});console.log("[Calendar] Raw eventsResult:",i),console.log("[Calendar] eventsResult.data:",i.data);const d=i.data.events||[];console.log("[Calendar] loadedEvents count:",d.length),console.log("[Calendar] loadedEvents sample:",d.slice(0,3));const a=d.map(n=>{try{if(!n.date)return console.warn("[Calendar] Event has no date:",n),null;const x=O(n.date);if(!x){if(typeof n.date=="string"&&n.date.match(/^\d{4}-\d{2}-\d{2}/))return console.warn("[Calendar] Normalization failed, using original date string:",n.date),{...n,date:n.date.split("T")[0]};if(typeof n.date=="string"&&n.date.includes("T")){const h=n.date.split("T")[0];if(h.match(/^\d{4}-\d{2}-\d{2}/))return console.warn("[Calendar] Using fallback ISO date extraction:",h),{...n,date:h}}return console.warn("[Calendar] Event with invalid date skipped:",n),null}return{...n,date:x}}catch(x){if(console.error("[Calendar] Error normalizing event date:",x,n),typeof n.date=="string")try{const h=n.date.split("T")[0];if(h.match(/^\d{4}-\d{2}-\d{2}/))return console.warn("[Calendar] Using fallback date extraction:",h),{...n,date:h}}catch(h){console.error("[Calendar] Fallback also failed:",h)}return null}}).filter(n=>n!==null);if(console.log("[Calendar] normalizedEvents count:",a.length),console.log("[Calendar] normalizedEvents sample (first 5):",a.slice(0,5).map(n=>({id:n.id,title:n.title,date:n.date,type:n.type}))),a.length<d.length){console.warn(`[Calendar] WARNING: Lost ${d.length-a.length} events during normalization!`);const n=d.filter(x=>!a.find(C=>C.id===x.id));console.warn("[Calendar] Lost events:",n.map(x=>({title:x.title,date:x.date})))}const l=M(p,a);console.log("[Calendar] Final events count:",{normalizedEvents:a.length,totalEvents:l.length,sampleEvents:l.slice(0,5).map(n=>({id:n.id,title:n.title,date:n.date}))}),f(l)}catch(i){console.error("[Calendar] API Error:",{message:i?.message,code:i?.code,details:i?.details}),I.current===""&&(i?.code==="unauthenticated"||i?.message?.includes("UNAUTHORIZED")?y.error("Bitte anmelden"):(i?.code==="unavailable"||i?.message?.includes("network"))&&y.error("Netzwerkfehler - Bitte erneut versuchen")),console.log("[Calendar] API Error occurred, but still converting reminders to events");const d=M(p,[]);f(d)}}catch(t){console.error("[Calendar] Unexpected error:",t);const s=M(p,[]);f(s)}finally{S(!1)}},[m,p]),M=ve((t,s=[])=>{console.log("[Calendar] convertRemindersToEvents - START:",{remindersCount:t.length,existingEventsCount:s.length});const o=t.filter(r=>{if(!r.dueDate)return console.log("[Calendar] Reminder skipped - no dueDate:",r.title),!1;let d;if(r.dueDate instanceof Date)d=r.dueDate;else if(typeof r.dueDate=="string")d=new Date(r.dueDate);else return console.log("[Calendar] Reminder skipped - invalid dueDate type:",r.title,typeof r.dueDate),!1;if(isNaN(d.getTime()))return console.log("[Calendar] Reminder skipped - invalid date:",r.title,r.dueDate),!1;const a=k(d),l=s.some(n=>(O(n.date)||(typeof n.date=="string"?n.date.split("T")[0]:""))===a&&n.title===r.title);return l&&console.log("[Calendar] Reminder already in events, skipping:",r.title),!l}).map(r=>{let d;if(r.dueDate instanceof Date)d=r.dueDate;else if(typeof r.dueDate=="string")d=new Date(r.dueDate);else throw new Error(`Invalid dueDate for reminder ${r.id}`);let a="appointment";r.type==="termin"?a="appointment":r.type==="zahlung"?a="due":r.type==="aufgabe"&&(a="reminder");const l=k(d),n=r.isAllDay?void 0:pe(d);return{id:`reminder-${r.id}`,type:a,title:r.title,date:l,time:n,description:r.notes||void 0,status:r.status}});console.log("[Calendar] convertRemindersToEvents - RESULT:",{count:o.length,events:o.map(r=>({id:r.id,title:r.title,date:r.date}))});const i=[...s];for(const r of o)i.some(d=>d.id===r.id)||i.push(r);return i},[]);U(()=>{const t=JSON.stringify({reminders:p.map(s=>s.id).sort(),financeEntries:de.map(s=>s.id).sort(),people:ce.map(s=>s.id).sort()});if(I.current!==t&&I.current!==""){I.current=t;const s=setTimeout(()=>{Y.currentUser&&R().catch(o=>{console.error("[Calendar] Error refetching events:",o)})},1e3);return()=>clearTimeout(s)}else I.current===""&&(I.current=t)},[p,de,ce,R]),U(()=>{console.log("[Calendar] useEffect - Reminders changed:",{remindersCount:p.length,reminders:p.map(s=>({id:s.id,title:s.title,dueDate:s.dueDate}))});const t=M(p,[]);console.log("[Calendar] Converted reminders to events immediately:",{count:t.length,events:t.map(s=>({id:s.id,title:s.title,date:s.date}))}),f(s=>{const o=[...s];for(const i of t)o.some(r=>r.id===i.id)||o.push(i);return console.log("[Calendar] Updated events state:",{prevCount:s.length,newCount:o.length,added:t.length}),o})},[p,M]),U(()=>{console.log("[Calendar] Weather state:",{selectedDate:u?.toISOString(),weatherDate:te?.toISOString(),location:J,weatherData:b,isLoading:se,error:z?.message})},[u,te,J,b,se,z]),U(()=>{console.log("[Calendar] Reminders changed, converting to events:",{remindersCount:p.length,reminders:p.map(s=>({id:s.id,title:s.title,dueDate:s.dueDate}))});const t=M(p,[]);console.log("[Calendar] Converted reminders to events immediately:",{count:t.length,events:t.map(s=>({id:s.id,title:s.title,date:s.date}))}),f(s=>{const o=[...s];for(const i of t)o.some(r=>r.id===i.id)||o.push(i);return o})},[p,M]),U(()=>{console.log("[Calendar] useEffect for fetchEvents - auth check:",{isAuthenticated:!!Y.currentUser,userId:Y.currentUser?.uid}),Y.currentUser?(console.log("[Calendar] User authenticated, calling fetchEvents"),R().catch(t=>{console.error("[Calendar] Error in fetchEvents:",t)})):(console.log("[Calendar] User not authenticated, clearing events"),f([]),S(!1))},[R]);const Fe=["Januar","Februar","März","April","Mai","Juni","Juli","August","September","Oktober","November","Dezember"],ze=["Mo","Di","Mi","Do","Fr","Sa","So"],Ie=t=>new Date(t.getFullYear(),t.getMonth()+1,0).getDate(),Re=t=>{const s=new Date(t.getFullYear(),t.getMonth(),1).getDay();return s===0?6:s-1},Be=_(()=>{const t=Ie(m),s=Re(m),o=[];console.log("[Calendar] calendarDays useMemo - START:",{currentDate:m.toISOString(),eventsCount:g.length,events:g.map(l=>({id:l.id,title:l.title,date:l.date}))});const i=l=>{const n=k(l),x=g.filter(h=>{if(!h.date)return console.log("[Calendar] Event skipped - no date:",h.title),!1;let C=O(h.date);if(!C&&typeof h.date=="string"){const he=h.date.split("T")[0];he.match(/^\d{4}-\d{2}-\d{2}/)&&(C=he,console.log("[Calendar] Using fallback date extraction for event:",h.title,C))}if(!C)return console.log("[Calendar] Event skipped - invalid date:",h.title,h.date),!1;const xe=C===n;return xe&&console.log("[Calendar] Event matched for date:",{eventTitle:h.title,eventDate:h.date,eventDateStr:C,targetDateStr:n,date:l.toISOString()}),xe});return x.length>0&&console.log("[Calendar] Found events for date:",{date:n,count:x.length,events:x.map(h=>h.title)}),x},d=new Date(m.getFullYear(),m.getMonth()-1,0).getDate();for(let l=s-1;l>=0;l--){const n=new Date(m.getFullYear(),m.getMonth()-1,d-l),x=i(n);o.push({date:n,isCurrentMonth:!1,events:x})}for(let l=1;l<=t;l++){const n=new Date(m.getFullYear(),m.getMonth(),l),x=i(n);o.push({date:n,isCurrentMonth:!0,events:x})}const a=42-o.length;for(let l=1;l<=a;l++){const n=new Date(m.getFullYear(),m.getMonth()+1,l),x=i(n);o.push({date:n,isCurrentMonth:!1,events:x})}return o},[m,g]),Ye=()=>{w(new Date(m.getFullYear(),m.getMonth()-1,1))},Oe=()=>{w(new Date(m.getFullYear(),m.getMonth()+1,1))},Ue=()=>{w(new Date)},Le=t=>{const s=new Date;return t.toDateString()===s.toDateString()},Ae=t=>{const s=new Date(t.getFullYear(),t.getMonth(),t.getDate());j(s),T(!0)},ae=t=>{ee(t),A(!0)},me=_(()=>{if(!u)return console.log("[Calendar] dayEvents - no selectedDate"),[];const t=new Date(u.getFullYear(),u.getMonth(),u.getDate()),s=k(t);console.log("[Calendar] dayEvents filter - START:",{selectedDate:u.toISOString(),normalizedSelectedDate:t.toISOString(),dateStr:s,totalEvents:g.length,totalReminders:p.length,events:g.map(a=>({title:a.title,date:a.date,type:a.type}))});const o=g.filter(a=>{if(!a.date)return console.log("[Calendar] Event skipped - no date:",a.title),!1;let l=O(a.date);if(!l&&typeof a.date=="string"){const x=a.date.split("T")[0];x.match(/^\d{4}-\d{2}-\d{2}/)&&(l=x,console.log("[Calendar] Using fallback date extraction for filter:",l))}if(!l)return console.log("[Calendar] Event skipped - invalid date:",a.title,a.date),!1;const n=l===s;return n&&console.log("[Calendar] Event matched:",{eventTitle:a.title,eventDate:a.date,eventDateStr:l,selectedDateStr:s}),n}),i=p.filter(a=>{if(!a.dueDate)return!1;let l;if(a.dueDate instanceof Date)l=a.dueDate;else if(typeof a.dueDate=="string")l=new Date(a.dueDate);else return!1;return isNaN(l.getTime())?!1:k(l)===s});console.log("[Calendar] Reminders for date:",{dateStr:s,remindersForDate:i.length,reminders:i.map(a=>({id:a.id,title:a.title,dueDate:a.dueDate}))});const r=i.map(a=>{let l="appointment";a.type==="termin"?l="appointment":a.type==="zahlung"?l="due":a.type==="aufgabe"&&(l="reminder");let n;if(a.dueDate instanceof Date)n=a.dueDate;else if(typeof a.dueDate=="string")n=new Date(a.dueDate);else throw new Error(`Invalid dueDate for reminder ${a.id}`);return{id:`reminder-${a.id}`,type:l,title:a.title,date:k(n),time:a.isAllDay?void 0:pe(n),description:a.notes||void 0,status:a.status}}),d=[...o];for(const a of r)d.some(l=>l.id===a.id)||d.push(a);return console.log("[Calendar] dayEvents filter - RESULT:",{selectedDate:t.toISOString(),dateStr:s,filteredFromEvents:o.length,fromReminders:r.length,totalDayEvents:d.length,allDayEvents:d.map(a=>({id:a.id,title:a.title,date:a.date,type:a.type}))}),d},[u,g,p]),ue=_(()=>{const s=k(new Date);return g.filter(o=>{const i=O(o.date);return i!==""&&i===s})},[g]),K=t=>{switch(t){case"due":return"bg-pink-500";case"reminder":case"appointment":case"termin":return"bg-orange-500";case"work":return"bg-slate-400";case"vacation":case"frei":return"bg-emerald-400";case"school-holiday":return"bg-sky-400";case"school":return"bg-purple-400";case"hort":return"bg-fuchsia-500";default:return"bg-gray-500"}};return e.jsxs(ft,{title:"Kalender",showSidebar:!0,children:[e.jsx(v,{variant:"ghost",size:"icon",onClick:()=>D("/"),className:"fixed top-2 right-2 z-50 h-9 w-9 rounded-full bg-background/95 backdrop-blur-sm border border-border shadow-lg",children:e.jsx(re,{className:"h-4 w-4"})}),e.jsxs("div",{className:"mobile-card mb-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx(v,{variant:"outline",size:"sm",onClick:Ye,className:"h-10 min-h-[44px] px-3",children:e.jsx(nt,{className:"w-5 h-5"})}),e.jsx("div",{className:"flex-1 text-center",children:e.jsxs("h2",{className:"text-lg font-semibold",children:[Fe[m.getMonth()]," ",m.getFullYear()]})}),e.jsx(v,{variant:"outline",size:"sm",onClick:Oe,className:"h-10 min-h-[44px] px-3",children:e.jsx(rt,{className:"w-5 h-5"})})]}),e.jsx(v,{variant:"outline",size:"sm",onClick:Ue,className:"w-full h-10 min-h-[44px]",children:"Heute"})]}),e.jsxs("div",{className:"mobile-card",children:[e.jsx("div",{className:"grid grid-cols-7 gap-1 mb-2",children:ze.map((t,s)=>e.jsx("div",{className:"text-center text-xs font-medium text-muted-foreground py-2",children:t},s))}),F?e.jsx("div",{className:"grid grid-cols-7 gap-1",children:Array.from({length:42}).map((t,s)=>e.jsx(bt,{className:"aspect-square min-h-[44px] rounded-lg"},s))}):e.jsx("div",{className:"grid grid-cols-7 gap-1",children:Be.map((t,s)=>{const o=Le(t.date);return e.jsxs("button",{onClick:()=>Ae(t.date),className:`
                    aspect-square min-h-[44px] p-1 rounded-lg text-sm transition-colors
                    ${t.isCurrentMonth?"text-foreground":"text-muted-foreground/40"}
                    ${o?"bg-primary text-primary-foreground font-bold":"hover:bg-muted"}
                  `,children:[e.jsx("div",{className:"text-xs font-medium mb-1",children:t.date.getDate()}),e.jsxs("div",{className:"flex flex-col gap-0.5",children:[t.events.slice(0,2).map((i,r)=>e.jsx("div",{onClick:d=>{d.stopPropagation(),ae(i)},className:`h-1 rounded ${K(i.type)}`,title:i.title},r)),t.events.length>2&&e.jsxs("div",{className:"text-[10px] text-muted-foreground",children:["+",t.events.length-2]})]})]},s)})})]}),ue.length>0&&e.jsxs("div",{className:"mobile-card mt-4",children:[e.jsx("h3",{className:"text-sm font-semibold mb-3",children:"Heute - Termine & Events"}),e.jsx("div",{className:"space-y-2",children:ue.map(t=>e.jsx(fe,{className:"cursor-pointer hover:bg-muted/50 transition-colors",onClick:()=>{j(new Date(t.date.includes("T")?t.date.split("T")[0]:t.date)),ae(t)},children:e.jsx(be,{className:"p-3",children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("div",{className:L("w-3 h-3 rounded-full mt-1 flex-shrink-0",K(t.type))}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("p",{className:"font-medium text-sm truncate",children:t.title}),t.time&&e.jsxs("p",{className:"text-xs text-muted-foreground mt-1",children:[e.jsx(le,{className:"w-3 h-3 inline mr-1"}),t.time]}),t.personName&&e.jsx("p",{className:"text-xs text-muted-foreground mt-1",children:t.personName})]})]})})},t.id))})]}),e.jsx(q,{open:Ce,onOpenChange:T,children:e.jsxs(G,{className:"!fixed !top-[50%] !left-[50%] !right-auto !bottom-auto !translate-x-[-50%] !translate-y-[-50%] !w-[85vw] !max-w-sm !max-h-[85vh] !rounded-3xl !m-0 !overflow-y-auto !shadow-2xl",children:[e.jsx(V,{className:"px-5 pt-5 pb-3 sticky top-0 bg-background z-10 border-b border-border",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx(Q,{className:"text-lg font-semibold",children:u?.toLocaleDateString("de-CH",{weekday:"long",day:"numeric",month:"long",year:"numeric"})}),e.jsx(ne,{className:"sr-only",children:"Details für den ausgewählten Tag mit Wetter, Terminen und Schnellaktionen"}),e.jsx(v,{variant:"ghost",size:"icon",onClick:()=>T(!1),className:"h-8 w-8 rounded-full",children:e.jsx(re,{className:"h-4 w-4"})})]})}),e.jsxs("div",{className:"space-y-4 px-5 pb-2",children:[e.jsxs("div",{className:"bg-muted/30 rounded-xl p-4 space-y-3",children:[e.jsx("div",{className:"flex items-center justify-between",children:e.jsxs("h3",{className:"text-sm font-semibold flex items-center gap-2",children:[e.jsx(je,{className:"w-4 h-4"}),"Wetter"]})}),se?e.jsxs("div",{className:"flex flex-col items-center justify-center py-4",children:[e.jsx("div",{className:"text-xs text-muted-foreground",children:"Lädt Wetterdaten..."}),z&&e.jsxs("div",{className:"text-xs text-red-500 mt-2",children:["Fehler: ",z.message]})]}):z?e.jsxs("div",{className:"text-xs text-muted-foreground text-center py-2",children:[e.jsx("p",{className:"text-red-500 mb-1",children:"Fehler beim Laden"}),e.jsx("p",{className:"opacity-70",children:z.message}),!J]}):b?e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[b.icon==="sun"&&e.jsx(lt,{className:"w-6 h-6 text-yellow-500"}),b.icon==="cloud-sun"&&e.jsx(it,{className:"w-6 h-6 text-gray-500"}),b.icon==="cloud"&&e.jsx(je,{className:"w-6 h-6 text-gray-500"}),b.icon==="rain"&&e.jsx(ot,{className:"w-6 h-6 text-blue-500"}),e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-baseline gap-1",children:[e.jsxs("span",{className:"text-2xl font-bold",children:[b.temperature,"°"]}),e.jsx("span",{className:"text-sm text-muted-foreground",children:"C"})]}),e.jsx("div",{className:"text-xs text-muted-foreground",children:b.condition})]})]}),(b.humidity!==void 0||b.windSpeed!==void 0)&&e.jsxs("div",{className:"flex gap-4 text-xs text-muted-foreground pt-2 border-t border-border/50",children:[b.windSpeed!==void 0&&e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(dt,{className:"w-3 h-3"}),e.jsxs("span",{children:[b.windSpeed," km/h"]})]}),b.humidity!==void 0&&e.jsx("div",{children:e.jsxs("span",{children:["Luftfeuchtigkeit: ",b.humidity,"%"]})})]})]}):e.jsx("div",{className:"text-xs text-muted-foreground text-center py-2",children:"Keine Wetterdaten verfügbar"})]}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-sm font-semibold mb-2",children:"Termine & Events"}),me.length===0?e.jsxs("div",{className:"text-sm text-muted-foreground text-center py-3 bg-muted/30 rounded-lg",children:[e.jsx("p",{children:"Keine Events an diesem Tag"}),e.jsxs("p",{className:"text-xs mt-2 opacity-70",children:["Debug: ",g.length," Events geladen, ",u?`Datum: ${k(u)}`:"Kein Datum ausgewählt",g.length>0&&e.jsxs("span",{className:"block mt-1",children:["Event-Daten: ",JSON.stringify(g.slice(0,2).map(t=>({title:t.title,date:t.date})))]})]})]}):e.jsx("div",{className:"space-y-2",children:me.map(t=>e.jsx(fe,{className:"cursor-pointer hover:bg-muted/50 transition-colors",onClick:()=>{T(!1),ae(t)},children:e.jsx(be,{className:"p-3",children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("div",{className:L("w-3 h-3 rounded-full mt-1 flex-shrink-0",K(t.type))}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("p",{className:"font-medium text-sm truncate",children:t.title}),t.time&&e.jsxs("p",{className:"text-xs text-muted-foreground mt-1",children:[e.jsx(le,{className:"w-3 h-3 inline mr-1"}),t.time]}),t.personName&&e.jsx("p",{className:"text-xs text-muted-foreground mt-1",children:t.personName})]})]})})},t.id))})]}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-sm font-semibold mb-2",children:"Schnellaktionen"}),e.jsxs("div",{className:"grid grid-cols-2 gap-2",children:[e.jsxs(v,{variant:"outline",onClick:()=>{P(!0)},className:"h-auto py-3 flex flex-col items-center gap-2 rounded-xl",children:[e.jsx(ct,{className:"w-5 h-5"}),e.jsx("span",{className:"text-xs",children:"Termin erstellen"})]}),e.jsxs(v,{variant:"outline",onClick:()=>{H(!0)},className:"h-auto py-3 flex flex-col items-center gap-2 rounded-xl",children:[e.jsx(ie,{className:"w-5 h-5"}),e.jsx("span",{className:"text-xs",children:"Finanz-Eintrag"})]})]})]})]}),e.jsx(Z,{className:"px-5 pb-3 pt-2 sticky bottom-0 bg-background border-t border-border",children:e.jsx(v,{variant:"default",onClick:()=>T(!1),className:"h-11 min-h-[44px] w-full rounded-xl text-sm font-medium",children:"Schließen"})})]})}),e.jsx(q,{open:we,onOpenChange:A,children:e.jsxs(G,{className:"!fixed !top-[50%] !left-[50%] !right-auto !bottom-auto !translate-x-[-50%] !translate-y-[-50%] !w-[85vw] !max-w-sm !max-h-[85vh] !rounded-3xl !m-0 !overflow-y-auto !shadow-2xl",children:[e.jsxs(V,{className:"px-5 pt-5 pb-3 sticky top-0 bg-background z-10 border-b border-border relative",children:[e.jsx(v,{variant:"ghost",size:"icon",onClick:()=>A(!1),className:"absolute right-2 top-2 h-8 w-8 rounded-full z-20",children:e.jsx(re,{className:"h-4 w-4"})}),e.jsx("div",{className:"flex items-start gap-3 pr-8",children:e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx("div",{className:L("w-4 h-4 rounded-full flex-shrink-0",K(c?.type||""))}),e.jsxs(Ne,{variant:"outline",className:"text-xs",children:[c?.type==="due"&&"Fällig",c?.type==="reminder"&&"Erinnerung",c?.type==="appointment"&&"Termin",c?.type==="work"&&"Arbeit",c?.type==="school"&&"Schule",c?.type==="hort"&&"Hort",!c?.type&&"Event"]})]}),e.jsx(Q,{className:"text-lg font-semibold leading-tight",children:c?.title}),e.jsx(ne,{className:"sr-only",children:"Detaillierte Informationen zum ausgewählten Event"})]})})]}),c&&e.jsxs("div",{className:"space-y-4 px-5 pb-2",children:[e.jsxs("div",{className:"bg-muted/30 rounded-xl p-4 space-y-3",children:[c.date&&e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx(ye,{className:"w-5 h-5 text-muted-foreground mt-0.5 flex-shrink-0"}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx(B,{className:"text-xs text-muted-foreground block mb-1",children:"Datum"}),e.jsx("p",{className:"text-sm font-medium",children:new Date(c.date).toLocaleDateString("de-CH",{weekday:"long",day:"numeric",month:"long",year:"numeric"})})]})]}),c.time&&e.jsxs("div",{className:"flex items-start gap-3 pt-2 border-t border-border/50",children:[e.jsx(le,{className:"w-5 h-5 text-muted-foreground mt-0.5 flex-shrink-0"}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx(B,{className:"text-xs text-muted-foreground block mb-1",children:"Uhrzeit"}),e.jsx("p",{className:"text-sm font-medium",children:c.time})]})]})]}),c.description&&e.jsxs("div",{className:"bg-muted/30 rounded-xl p-4",children:[e.jsx(B,{className:"text-xs text-muted-foreground block mb-2",children:"Beschreibung"}),e.jsx("p",{className:"text-sm leading-relaxed whitespace-pre-wrap",children:c.description})]}),(c.amount||c.personName||c.status)&&e.jsxs("div",{className:"space-y-2",children:[c.amount&&e.jsxs("div",{className:"flex items-center gap-3 bg-muted/30 rounded-xl p-4",children:[e.jsx(ie,{className:"w-5 h-5 text-muted-foreground flex-shrink-0"}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx(B,{className:"text-xs text-muted-foreground block mb-1",children:"Betrag"}),e.jsxs("p",{className:"text-sm font-semibold",children:["CHF ",(c.amount/100).toFixed(2)]})]})]}),c.personName&&e.jsxs("div",{className:"flex items-center gap-3 bg-muted/30 rounded-xl p-4",children:[e.jsx(De,{className:"w-5 h-5 text-muted-foreground flex-shrink-0"}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx(B,{className:"text-xs text-muted-foreground block mb-1",children:"Person"}),e.jsx("p",{className:"text-sm font-medium",children:c.personName})]})]}),c.status&&e.jsxs("div",{className:"flex items-center gap-3 bg-muted/30 rounded-xl p-4",children:[e.jsx(mt,{className:"w-5 h-5 text-muted-foreground flex-shrink-0"}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx(B,{className:"text-xs text-muted-foreground block mb-1",children:"Status"}),e.jsx(Ne,{variant:c.status==="paid"?"default":"secondary",className:"text-xs",children:c.status==="paid"?"Bezahlt":c.status==="pending"?"Ausstehend":c.status})]})]}),c.isOverdue&&e.jsxs("div",{className:"flex items-center gap-3 bg-red-50 dark:bg-red-950/20 rounded-xl p-4 border border-red-200 dark:border-red-800",children:[e.jsx(ut,{className:"w-5 h-5 text-red-600 dark:text-red-400 flex-shrink-0"}),e.jsx("div",{className:"flex-1 min-w-0",children:e.jsx("p",{className:"text-sm font-medium text-red-600 dark:text-red-400",children:"Überfällig"})})]})]})]}),e.jsx(Z,{className:"px-5 pb-3 pt-2 sticky bottom-0 bg-background border-t border-border",children:e.jsx(v,{variant:"default",onClick:()=>A(!1),className:"h-11 min-h-[44px] w-full rounded-xl text-sm font-medium",children:"Schließen"})})]})}),e.jsx(q,{open:Ee,onOpenChange:t=>{P(t),t&&W(E(u||new Date))},children:e.jsxs(G,{className:"!fixed !top-[50%] !left-[50%] !right-auto !bottom-auto !translate-x-[-50%] !translate-y-[-50%] !w-[85vw] !max-w-sm !max-h-fit !rounded-3xl !m-0 !overflow-visible !shadow-2xl",children:[e.jsx(V,{className:"px-5 pt-4 pb-2",children:e.jsx(Q,{className:"text-lg font-semibold",children:"Termin erstellen"})}),e.jsxs("div",{className:"px-5 pb-2 space-y-3",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium mb-1 block",children:"Titel"}),e.jsx("input",{type:"text",id:"reminder-title",placeholder:"z.B. Arzttermin",className:"w-full px-3 py-2 border border-border rounded-lg text-sm",autoFocus:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium mb-1 block",children:"Datum"}),e.jsx("input",{type:"text",id:"reminder-date",placeholder:"DD.MM.YYYY",value:Se,onChange:t=>{const s=t.target.value;W(s)},onBlur:t=>{const s=X(t.target.value);s?W(E(s)):t.target.value&&u&&W(E(u))},className:"w-full px-3 py-2 border border-border rounded-lg text-sm"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium mb-1 block",children:"Uhrzeit (optional)"}),e.jsx("input",{type:"time",id:"reminder-time",className:"w-full px-3 py-2 border border-border rounded-lg text-sm"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium mb-1 block",children:"Notizen (optional)"}),e.jsx("textarea",{id:"reminder-notes",placeholder:"Weitere Details...",rows:2,className:"w-full px-3 py-2 border border-border rounded-lg text-sm resize-none"})]})]}),e.jsxs(Z,{className:"px-5 pb-3 pt-2 gap-2",children:[e.jsx(v,{variant:"outline",onClick:()=>P(!1),className:"h-11 min-h-[44px] flex-1 rounded-xl text-sm font-medium",children:"Abbrechen"}),e.jsx(v,{variant:"default",onClick:async()=>{try{const t=document.getElementById("reminder-title"),s=document.getElementById("reminder-date"),o=document.getElementById("reminder-time"),i=document.getElementById("reminder-notes");if(!t.value.trim()){y.error("Bitte gib einen Titel ein");return}const r=X(s.value);if(!r){y.error("Bitte gib ein gültiges Datum ein (DD.MM.YYYY)");return}const d=new Date(r);if(o.value){const[a,l]=o.value.split(":");d.setHours(parseInt(a),parseInt(l))}else d.setHours(12,0);await Ge({title:t.value.trim(),type:"termin",dueDate:d,isAllDay:!o.value,notes:i.value.trim()||null}),y.success("Termin erstellt"),P(!1),T(!1),await R(),u&&j(new Date(u))}catch(t){y.error(t.message||"Fehler beim Erstellen des Termins")}},className:"h-11 min-h-[44px] flex-1 rounded-xl text-sm font-medium",children:"Erstellen"})]})]})}),e.jsx(q,{open:ke,onOpenChange:t=>{H(t),t&&$(E(u||new Date))},children:e.jsxs(G,{className:"!fixed !top-[50%] !left-[50%] !right-auto !bottom-auto !translate-x-[-50%] !translate-y-[-50%] !w-[85vw] !max-w-sm !max-h-fit !rounded-3xl !m-0 !overflow-visible !shadow-2xl",children:[e.jsxs(V,{className:"px-5 pt-4 pb-2",children:[e.jsx(Q,{className:"text-lg font-semibold",children:"Finanz-Eintrag erstellen"}),e.jsx(ne,{className:"sr-only",children:"Erstellen Sie einen neuen Finanz-Eintrag mit Beschreibung, Betrag, Typ und Datum"})]}),e.jsxs("div",{className:"px-5 pb-2 space-y-3",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium mb-1 block",children:"Beschreibung"}),e.jsx("input",{type:"text",id:"finance-description",placeholder:"z.B. Einkauf, Gehalt",className:"w-full px-3 py-2 border border-border rounded-lg text-sm",autoFocus:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium mb-1 block",children:"Betrag (CHF)"}),e.jsx("input",{type:"number",id:"finance-amount",placeholder:"0.00",step:"0.01",className:"w-full px-3 py-2 border border-border rounded-lg text-sm"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium mb-1 block",children:"Typ"}),e.jsxs("select",{id:"finance-type",className:"w-full px-3 py-2 border border-border rounded-lg text-sm",children:[e.jsx("option",{value:"einnahme",children:"Einnahme"}),e.jsx("option",{value:"ausgabe",children:"Ausgabe"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium mb-1 block",children:"Datum"}),e.jsx("input",{type:"text",id:"finance-date",placeholder:"DD.MM.YYYY",value:Te,onChange:t=>{const s=t.target.value;$(s)},onBlur:t=>{const s=X(t.target.value);s?$(E(s)):t.target.value&&u&&$(E(u))},className:"w-full px-3 py-2 border border-border rounded-lg text-sm"})]})]}),e.jsxs(Z,{className:"px-5 pb-3 pt-2 gap-2",children:[e.jsx(v,{variant:"outline",onClick:()=>H(!1),className:"h-11 min-h-[44px] flex-1 rounded-xl text-sm font-medium",children:"Abbrechen"}),e.jsx(v,{variant:"default",onClick:async()=>{try{const t=document.getElementById("finance-description"),s=document.getElementById("finance-amount"),o=document.getElementById("finance-type"),i=document.getElementById("finance-date");if(!t.value.trim()){y.error("Bitte gib eine Beschreibung ein");return}const r=X(i.value);if(!r){y.error("Bitte gib ein gültiges Datum ein (DD.MM.YYYY)");return}if(!s.value||parseFloat(s.value)<=0){y.error("Bitte gib einen gültigen Betrag ein");return}await Ve({notes:t.value.trim(),amount:Math.round(parseFloat(s.value)*100),type:o.value,date:new Date(r),category:"Sonstiges",currency:"CHF",isRecurring:!1}),y.success("Finanz-Eintrag erstellt"),H(!1),T(!1),await R()}catch(t){y.error(t.message||"Fehler beim Erstellen des Finanz-Eintrags")}},className:"h-11 min-h-[44px] flex-1 rounded-xl text-sm font-medium",children:"Erstellen"})]})]})})]})}export{Ne as B,ft as M,bt as S,kt as a};
