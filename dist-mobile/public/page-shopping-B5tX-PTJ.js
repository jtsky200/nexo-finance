import{x as Ot,y as Vt,j as e,I as K,S as pe,z as be,A as je,E as Ne,F as h,B as N,D as _t,o as Ut,p as Qt,q as Wt,r as Yt,G as Zt,L as Jt,s as Xt,H as we,J as G,K as S,M as w,N as es,O as ts,Q as ss,R as dt,g as He,w as as}from"./page-aichat-D58eS9Bi.js";import{useEffect as ve,useState as c,useRef as ye,useMemo as mt}from"react";import{M as rs}from"./page-calendar-DDwRw0-e.js";import{t as n}from"./vendor-toast-CdQ6zwVl.js";import{m as Be}from"./vendor-firebase-B1cnVIMW.js";import{k as Ke,p as re,T as Ge,X as O,V as ke,Y as ns,t as Oe,Z as ls,j as Ce,O as is,N as Ve,_ as cs,F as os,q as _e,o as Ue,h as ds,z as ms,$ as ut,a0 as us,a1 as hs,a2 as xs}from"./vendor-misc-CBTJ0G7x.js";const ht=["Lebensmittel","Getränke","Haushalt","Hygiene","Tierbedarf","Sonstiges"];function Ts(){const{t:I}=Ot();ve(()=>{const t=document.createElement("style");return t.textContent=`
      @keyframes scan-line {
        0% { transform: translateY(0); opacity: 0.3; }
        50% { transform: translateY(100%); opacity: 1; }
        100% { transform: translateY(0); opacity: 0.3; }
      }
    `,document.head.appendChild(t),()=>{document.head.contains(t)&&document.head.removeChild(t)}},[]);const{data:ne=[],isLoading:xt,refetch:z}=Vt(),[Qe,Se]=c(!1),[We,le]=c(!1),[f,V]=c({name:"",quantity:"1",category:"Lebensmittel",store:""}),[b,P]=c([]),[Ye,Ze]=c(!1),[_,R]=c("camera"),[$,ie]=c("receipt"),[x,D]=c(!1),[l,Ae]=c(null),[v,q]=c([]),[y,L]=c([]),[ft,E]=c(0),[k,ce]=c(null),[U,Q]=c(1),[Fe,gt]=c(!0),[Pe,pt]=c(!0),[Le,bt]=c(!0),m=ye(null),H=ye(null),Je=ye(null),[o,W]=c(null),Ee=mt(()=>ne.filter(t=>t.status==="not_bought"),[ne]),oe=mt(()=>ne.filter(t=>t.status==="bought"),[ne]),jt=async()=>{if(!f.name.trim()){n.error("Bitte Artikelname eingeben");return}try{await we({item:f.name.trim(),quantity:parseInt(f.quantity)||1,category:f.category,estimatedPrice:0,currency:"CHF",store:f.store||null}),n.success("Artikel hinzugefügt"),G(),Se(!1),V({name:"",quantity:"1",category:"Lebensmittel",store:""}),await z()}catch(t){n.error("Fehler: "+S(t)),w()}},Nt=()=>{const t={store:"",items:[]};P([...b,t])},wt=t=>{P(b.filter((s,a)=>a!==t))},vt=(t,s)=>{const a=[...b];a[t].store=s,P(a)},yt=t=>{const s=[...b];s[t].items.push({id:Date.now().toString()+Math.random().toString(36).substr(2,9),name:"",quantity:"1",category:"Lebensmittel",price:"",articleNumber:"",productInfo:null,saveToDatabase:!1}),P(s)},kt=(t,s)=>{const a=[...b];a[t].items=a[t].items.filter(r=>r.id!==s),P(a)},T=(t,s,a,r)=>{const d=[...b],i=d[t].items.findIndex(j=>j.id===s);i!==-1&&(d[t].items[i][a]=r,P(d))},Ct=async(t,s)=>{try{n.info("Barcode-Scanner wird geöffnet...");const a={articleNumber:"1234567890123",productInfo:{brand:"Beispiel Marke",description:"Gescanntes Produkt"}};T(t,s,"articleNumber",a.articleNumber),T(t,s,"productInfo",a.productInfo),n.success("Artikel gescannt")}catch(a){n.error("Fehler beim Scannen: "+S(a))}},St=async()=>{try{let t=0;for(const s of b){if(!s.store){n.error("Bitte Laden für alle Gruppen angeben");return}for(const a of s.items){if(!a.name.trim()){n.error("Bitte Artikelname für alle Artikel eingeben");return}await we({item:a.name.trim(),quantity:parseInt(a.quantity)||1,category:a.category,estimatedPrice:parseFloat(a.price||"0")*100,currency:"CHF",store:s.store,articleNumber:a.articleNumber||null,productInfo:a.productInfo||null,saveToDatabase:a.saveToDatabase||!1}),t++}}n.success(`${t} Artikel hinzugefügt`),G(),le(!1),P([]),await z()}catch(t){n.error("Fehler: "+S(t)),w()}},Xe=async(t,s)=>{try{(s==="bought"?"not_bought":"bought")==="bought"?await es(t):await ts(t,{status:"not_bought"}),ss(),await z()}catch(a){n.error(S(a)),w()}},At=async t=>{try{await dt(t),G(),await z()}catch(s){n.error(S(s)),w()}},Ft=async()=>{try{for(const t of oe)await dt(t.id);n.success("Eingekaufte Artikel gelöscht"),G(),await z()}catch(t){n.error(S(t)),w()}},[fs,Y]=c("idle"),[gs,et]=c(0),A=ye(null),[ps,Pt]=c({topLeft:{x:10,y:15},topRight:{x:90,y:15},bottomLeft:{x:10,y:75},bottomRight:{x:90,y:75}}),[bs,js]=c(null),[Ns,ws]=c(!1),Z=async()=>{try{if(!navigator.mediaDevices||!navigator.mediaDevices.getUserMedia){n.error("Kamera wird nicht unterstützt"),R("upload");return}o&&(o.getTracks().forEach(a=>{a.stop()}),W(null),await new Promise(a=>setTimeout(a,100))),m.current&&(m.current.srcObject=null);let t=null,s={video:{facingMode:"environment",width:{ideal:3840},height:{ideal:2160},aspectRatio:{ideal:16/9}},audio:!1};try{t=await navigator.mediaDevices.getUserMedia(s)}catch{s={video:{facingMode:"environment",width:{ideal:1920},height:{ideal:1080}},audio:!1};try{t=await navigator.mediaDevices.getUserMedia(s)}catch{t=await navigator.mediaDevices.getUserMedia({video:{facingMode:"environment"},audio:!1})}}if(!t||t.getVideoTracks().length===0)throw new Error("Kein Kamera-Stream erhalten");if(W(t),Y("scanning"),await new Promise(a=>setTimeout(a,50)),m.current){const a=m.current;a.srcObject=t,await new Promise((r,d)=>{const i=setTimeout(()=>{d(new Error("Video-Timeout"))},5e3),j=()=>{clearTimeout(i),a.removeEventListener("loadedmetadata",j),a.removeEventListener("error",B),r()},B=Me=>{clearTimeout(i),a.removeEventListener("loadedmetadata",j),a.removeEventListener("error",B),d(new Error("Video-Fehler"))};if(a.readyState>=2){clearTimeout(i),r();return}a.addEventListener("loadedmetadata",j,{once:!0}),a.addEventListener("error",B,{once:!0})});try{await a.play(),n.success("Kamera aktiv"),tt()}catch{n.success("Kamera aktiv"),tt()}}}catch(t){o&&(o.getTracks().forEach(r=>r.stop()),W(null)),m.current&&(m.current.srcObject=null);const s=t;let a="Kamera-Fehler";s.name==="NotAllowedError"||s.name==="PermissionDeniedError"?a="Kamera-Berechtigung verweigert. Bitte in den Browser-Einstellungen erlauben.":s.name==="NotFoundError"||s.name==="DevicesNotFoundError"?a="Keine Kamera gefunden":s.name==="NotReadableError"||s.name==="TrackStartError"?a="Kamera wird bereits verwendet":s.name==="OverconstrainedError"||s.name==="ConstraintNotSatisfiedError"?a="Kamera-Unterstützung nicht verfügbar":s.message==="Video-Timeout"?a="Kamera-Initialisierung zu langsam":a=`Kamera-Fehler: ${s.message||s.name}`,n.error(a),R("upload"),Y("idle")}},Te=()=>{A.current&&(cancelAnimationFrame(A.current),A.current=null),o&&(o.getTracks().forEach(t=>t.stop()),W(null)),Y("idle"),et(0)},tt=()=>{Pt({topLeft:{x:15,y:10},topRight:{x:85,y:10},bottomLeft:{x:15,y:85},bottomRight:{x:85,y:85}}),Y("scanning"),et(0)},Lt=()=>{if(!m.current||!H.current)return;A.current&&(cancelAnimationFrame(A.current),A.current=null),Y("capturing");const t=m.current,s=H.current;s.width=t.videoWidth,s.height=t.videoHeight;const a=s.getContext("2d");a&&(a.imageSmoothingEnabled=!1,a.drawImage(t,0,0),n.success("Foto aufgenommen!"),s.toBlob(async r=>{if(r){Te();const d=new File([r],"photo.jpg",{type:"image/jpeg"});await st(d)}},"image/jpeg",1))};ve(()=>()=>{!o&&m.current&&m.current.srcObject&&(m.current.srcObject.getTracks().forEach(s=>s.stop()),m.current.srcObject=null)},[o]),ve(()=>()=>{A.current&&(cancelAnimationFrame(A.current),A.current=null),o&&(o.getTracks().forEach(t=>t.stop()),W(null)),m.current&&(m.current.srcObject=null)},[]);const Et=async t=>{const s=t.target.files?.[0];s&&await st(s)},st=async t=>{D(!0),q([]),Ae(null);try{const s=new FileReader;s.onload=async()=>{try{const a=s.result.split(",")[1];n.info("Analysiere mit OCR...");const i=(await Be(He,"analyzeReceipt")({fileData:a,fileType:t.type||"image/jpeg",fileName:t.name||"photo.jpg"})).data;i.success&&i.items&&i.items.length>0?(Ae({store:i.store||{name:"Unbekannt"},purchase:i.purchase||{},items:i.items,totals:i.totals||{total:0},confidence:i.confidence||50}),q(i.items.map(j=>({...j,selected:!0}))),n.success(`${i.items.length} Artikel erkannt!`)):i.error?.includes("Vision API")||i.error?.includes("PERMISSION_DENIED")?n.error("OCR nicht verfügbar. Google Cloud Vision API muss aktiviert werden.",{duration:5e3}):i.error?.includes("billing")?n.error("Google Cloud Billing erforderlich",{duration:5e3}):i.rawText?n.error("Text erkannt aber keine Artikel gefunden. Versuche bessere Bildqualität.",{duration:4e3}):n.error(i.error||"Keine Artikel erkannt. Bitte bessere Bildqualität verwenden.",{duration:4e3})}catch(a){n.error(S(a)),w()}D(!1)},s.onerror=()=>{n.error("Datei konnte nicht gelesen werden"),w(),D(!1)},s.readAsDataURL(t)}catch(s){n.error(S(s)),w(),D(!1)}},[Ie,J]=c(null),[g,at]=c(!1),[de,me]=c(null),[Tt,It]=c(0),[ze,X]=c(new Set),[vs,zt]=c([]),De=async()=>{if(!m.current||!H.current||x)return;const t=Date.now();if(t-Tt<1500)return;It(t),D(!0),J(null);const s=m.current,a=H.current,r=s.videoWidth||1920,d=s.videoHeight||1080,i=Math.max(r,1920),j=Math.max(d,1080);a.width=i,a.height=j;const B=a.getContext("2d",{willReadFrequently:!0,alpha:!1});B&&(B.drawImage(s,0,0,r,d,0,0,i,j),a.toBlob(async Me=>{if(Me)try{const ue=new FileReader;ue.onload=async()=>{const Gt=ue.result.split(",")[1];try{const te=(await Be(He,"analyzeReceipt")({fileData:Gt,fileType:"image/jpeg",fileName:"live-scan-full.jpg"})).data;if(te.success&&te.items&&te.items.length>0){const Re=(te.rawText||"").split(/[\n\r]+/),he=te.items.map((u,F)=>{const xe=(u.name||"Unbekannt").toLowerCase().trim(),se=(u.unitPrice||u.totalPrice||0).toFixed(2),M=u.articleNumber||"";let ae=-1;for(let C=0;C<Re.length;C++)if(Re[C].includes(u.name||"")||M&&Re[C].includes(M)){ae=C;break}const p=`${xe}_${se}_${M}_${ae>=0?ae:F}_${F}`;return{item:{name:u.name||"Unbekannt",articleNumber:u.articleNumber,quantity:u.quantity||1,unitPrice:u.unitPrice||u.totalPrice||0,totalPrice:u.totalPrice||u.unitPrice*(u.quantity||1),selected:!0},positionId:p}}).filter(({positionId:u})=>!ze.has(u));if(he.length>0){const u=new Set(ze);he.forEach(({positionId:F})=>{u.add(F)}),X(u),L(F=>{const xe=new Set(F.map(p=>{const C=p.name.toLowerCase().trim(),fe=p.unitPrice.toFixed(2),$e=p.articleNumber||"";return`${C}_${fe}_${$e}`})),se=[...F];let M=0;he.forEach(({item:p,positionId:C})=>{const fe=p.name.toLowerCase().trim(),$e=p.unitPrice.toFixed(2),qe=p.articleNumber||"",ot=`${fe}_${$e}_${qe}`;xe.has(ot)||qe&&F.some(ge=>ge.articleNumber===qe)||F.some(ge=>ge.name.toLowerCase().trim()===fe&&Math.abs(ge.unitPrice-p.unitPrice)<.01)||(se.push(p),M++,xe.add(ot))});const ae=se.reduce((p,C)=>p+C.totalPrice,0);return E(ae),M>0?(n.success(`${M} neue Artikel erkannt!`,{duration:1500}),navigator.vibrate&&navigator.vibrate(200)):he.length>0&&(g||n.info("Alle Artikel bereits in Liste",{duration:1e3})),se})}else g||n.info("Alle Artikel bereits erkannt",{duration:1e3})}else g||J("Keine Artikel erkannt")}catch(it){if(!g){const ct=S(it);J(ct)}w()}D(!1)},ue.readAsDataURL(Me)}catch{w(),D(!1)}},"image/jpeg",.95))};ve(()=>{if(g&&o&&$==="single"){const t=setTimeout(()=>{!x&&o&&De()},500),s=setInterval(()=>{!x&&o&&De()},2e3);return me(s),()=>{clearInterval(s),clearTimeout(t),me(null)}}else de&&(clearInterval(de),me(null))},[g,o,$,x]);const Dt=async()=>{await De()},Mt=()=>{if(!k)return;const t={...k,quantity:U,totalPrice:k.unitPrice*U};L(s=>[...s,t]),E(s=>s+t.totalPrice),ce(null),Q(1),n.success(`${t.name} (${U}x) hinzugefügt`),G()},Rt=()=>{ce(null),Q(1)},rt=t=>{L(s=>{const a=s[t];return E(r=>r-a.totalPrice),s.filter((r,d)=>d!==t)})},nt=(t,s)=>{if(s<1){rt(t);return}L(a=>{const r=[...a],d=r[t],i=d.totalPrice;return r[t]={...d,quantity:s,totalPrice:d.unitPrice*s},E(j=>j-i+r[t].totalPrice),r})},$t=async()=>{if(y.length===0){n.error("Keine Artikel gescannt");return}try{for(const t of y)await we({item:t.name,quantity:t.quantity||1,category:lt(t.name),estimatedPrice:(t.totalPrice||t.unitPrice||0)*100,currency:"CHF",store:l?.store?.name||null});n.success(`${y.length} Artikel hinzugefügt!`),L([]),E(0),ee(),await z()}catch(t){n.error("Fehler: "+t.message)}},qt=async()=>{const t=v.filter(s=>s.selected);if(t.length===0){n.error("Bitte mindestens einen Artikel auswählen");return}try{for(const s of t)await we({item:s.name,quantity:s.quantity||1,category:lt(s.name),estimatedPrice:(s.totalPrice||s.unitPrice||0)*100,currency:"CHF",store:l?.store?.name||null});n.success(`${t.length} Artikel hinzugefügt!`),ee(),await z()}catch(s){n.error("Fehler: "+s.message)}},Ht=async()=>{if(l)try{await Be(He,"saveReceipt")({receiptData:l}),n.success("Quittung gespeichert!")}catch(t){n.error("Fehler: "+t.message)}},Bt=async()=>{if(l)try{await as({type:"ausgabe",amount:l.totals.total*100,category:"Lebensmittel",notes:`Einkauf bei ${l.store.name}`,date:l.purchase.date||new Date().toISOString().split("T")[0],paymentMethod:l.purchase.paymentMethod||"Karte",currency:"CHF",isRecurring:!1}),n.success("Zu Finanzen hinzugefügt!"),G(),ee()}catch(t){n.error(S(t)),w()}},lt=t=>{const s=t.toLowerCase(),a={Getränke:["bier","wein","saft","wasser","cola","fanta","sprite","energy","shot","drink"],"Obst & Gemüse":["apfel","orange","banane","tomate","salat","gurke","karotte","bio oran","gemüse"],Milchprodukte:["milch","joghurt","käse","butter","sahne","quark","naturejog"],Fleisch:["fleisch","steak","wurst","schinken","poulet","rind","schwein","ragout"],Backwaren:["brot","brötchen","toast","croissant","kuchen","keks","butterkeks"],Süsswaren:["schoko","bonbon","gummi","chips","zucker","gelatine"]};for(const[r,d]of Object.entries(a))if(d.some(i=>s.includes(i)))return r;return"Lebensmittel"},Kt=()=>{Ze(!0),q([]),R("camera"),setTimeout(()=>Z(),100)},ee=()=>{Te(),Ze(!1),q([]),Ae(null),L([]),E(0),ie("receipt"),ce(null),Q(1),J(null),at(!1),X(new Set),zt([]),de&&(clearInterval(de),me(null))};return e.jsxs(rs,{title:I("nav.shopping","Einkaufsliste"),showSidebar:!0,children:[e.jsxs("div",{className:"mobile-card mb-4 bg-primary text-primary-foreground",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-3",children:[e.jsx(Ke,{className:"w-6 h-6 opacity-70"}),e.jsx("p",{className:"text-sm opacity-70 font-medium",children:I("shopping.list","Einkaufsliste")})]}),e.jsx("p",{className:"text-3xl font-semibold mb-2",children:Ee.length}),e.jsx("p",{className:"text-sm opacity-60",children:I("shopping.itemsOpen","Artikel offen")})]}),xt?e.jsx("div",{className:"text-center py-8 text-muted-foreground",children:I("common.loading","Laden...")}):Ee.length===0?e.jsxs("div",{className:"mobile-card text-center py-8",children:[e.jsx(re,{className:"w-10 h-10 mx-auto status-success mb-2"}),e.jsx("p",{className:"text-muted-foreground",children:I("shopping.empty","Liste ist leer")})]}):e.jsx("div",{className:"space-y-3 mb-4",children:Ee.map(t=>e.jsxs("div",{className:"mobile-card flex items-center gap-4 py-3",children:[e.jsx("button",{onClick:()=>Xe(t.id,t.status),className:"w-6 h-6 rounded border-2 border-border flex items-center justify-center shrink-0"}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("p",{className:"font-medium truncate",children:t.item}),e.jsxs("p",{className:"text-xs text-muted-foreground",children:[t.quantity>1&&`${t.quantity}x • `,t.category,t.store&&` • ${t.store}`]})]}),e.jsx("button",{onClick:()=>At(t.id),className:"w-10 h-10 rounded-lg flex items-center justify-center text-muted-foreground active:opacity-80",children:e.jsx(Ge,{className:"w-4 h-4"})})]},t.id))}),oe.length>0&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsxs("p",{className:"text-xs font-medium text-muted-foreground uppercase tracking-wider",children:[I("shopping.bought","Eingekauft")," (",oe.length,")"]}),e.jsx("button",{onClick:Ft,className:"text-xs status-error active:opacity-80",children:I("shopping.clearBought","Löschen")})]}),e.jsx("div",{className:"space-y-3 opacity-60",children:oe.map(t=>e.jsxs("div",{className:"mobile-card flex items-center gap-4 py-3",children:[e.jsx("button",{onClick:()=>Xe(t.id,t.status),className:"w-6 h-6 rounded bg-status-success flex items-center justify-center shrink-0",children:e.jsx(re,{className:"w-4 h-4 status-success"})}),e.jsx("p",{className:"font-medium line-through flex-1 truncate",children:t.item})]},t.id))})]}),Qe&&e.jsx("div",{className:"fixed inset-0 z-50 bg-black/50 flex items-end",children:e.jsxs("div",{className:"bg-background w-full rounded-t-2xl p-6 safe-bottom animate-in slide-in-from-bottom",children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsx("h2",{className:"text-lg font-semibold",children:"Artikel hinzufügen"}),e.jsx("button",{onClick:()=>Se(!1),className:"w-10 h-10 rounded-lg bg-muted flex items-center justify-center",children:e.jsx(O,{className:"w-5 h-5"})})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsx("div",{children:e.jsx(K,{value:f.name,onChange:t=>V({...f,name:t.target.value}),placeholder:"Artikelname",className:"mobile-input",autoFocus:!0})}),e.jsxs("div",{className:"flex gap-3",children:[e.jsx("div",{className:"w-20",children:e.jsx(K,{type:"number",value:f.quantity,onChange:t=>V({...f,quantity:t.target.value}),placeholder:"1",className:"mobile-input text-center",min:"1"})}),e.jsx("div",{className:"flex-1",children:e.jsxs(pe,{value:f.category,onValueChange:t=>V({...f,category:t}),children:[e.jsx(be,{className:"mobile-input",children:e.jsx(je,{})}),e.jsx(Ne,{children:ht.map(t=>e.jsx(h,{value:t,children:t},t))})]})})]}),e.jsx("div",{children:e.jsxs(pe,{value:f.store||"none",onValueChange:t=>V({...f,store:t==="none"?"":t}),children:[e.jsx(be,{className:"mobile-input",children:e.jsx(je,{placeholder:"Laden (optional)"})}),e.jsxs(Ne,{children:[e.jsx(h,{value:"none",children:"Kein Laden"}),e.jsx(h,{value:"Migros",children:"Migros"}),e.jsx(h,{value:"Coop",children:"Coop"}),e.jsx(h,{value:"Aldi",children:"Aldi"}),e.jsx(h,{value:"Lidl",children:"Lidl"}),e.jsx(h,{value:"Denner",children:"Denner"})]})]})}),e.jsx(N,{onClick:jt,className:"w-full mobile-btn bg-primary text-primary-foreground mt-4",children:"Hinzufügen"})]})]})}),e.jsx(_t,{open:We,onOpenChange:le,children:e.jsxs(Ut,{className:"!fixed !top-[50%] !left-[50%] !right-auto !bottom-auto !translate-x-[-50%] !translate-y-[-50%] !w-[90vw] !max-w-2xl !max-h-[90vh] !rounded-3xl !m-0 !overflow-hidden !shadow-2xl !flex !flex-col",children:[e.jsxs(Qt,{className:"px-5 pt-5 pb-3 flex-shrink-0",children:[e.jsx(Wt,{className:"text-lg font-semibold",children:"Mehrere Artikel hinzufügen"}),e.jsx(Yt,{className:"sr-only",children:"Fügen Sie mehrere Artikel gruppiert nach Laden hinzu"})]}),e.jsxs("div",{className:"px-5 pb-2 overflow-y-auto flex-1 min-h-0 space-y-4",children:[b.length===0&&e.jsxs("div",{className:"text-center py-8 text-muted-foreground",children:[e.jsx(ke,{className:"w-12 h-12 mx-auto mb-3 opacity-50"}),e.jsx("p",{children:"Keine Laden-Gruppen vorhanden"}),e.jsx("p",{className:"text-sm mt-1",children:'Klicken Sie auf "Laden hinzufügen" um zu beginnen'})]}),b.map((t,s)=>e.jsxs("div",{className:"border rounded-xl p-4 space-y-3 bg-muted/30",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(ke,{className:"w-4 h-4 text-muted-foreground"}),e.jsxs(pe,{value:t.store||"none",onValueChange:a=>vt(s,a==="none"?"":a),children:[e.jsx(be,{className:"flex-1 h-9",children:e.jsx(je,{placeholder:"Laden wählen"})}),e.jsxs(Ne,{children:[e.jsx(h,{value:"none",children:"Laden wählen"}),e.jsx(h,{value:"Migros",children:"Migros"}),e.jsx(h,{value:"Coop",children:"Coop"}),e.jsx(h,{value:"Aldi",children:"Aldi"}),e.jsx(h,{value:"Lidl",children:"Lidl"}),e.jsx(h,{value:"Denner",children:"Denner"}),e.jsx(h,{value:"Volg",children:"Volg"}),e.jsx(h,{value:"Spar",children:"Spar"})]})]}),e.jsx(N,{variant:"ghost",size:"sm",onClick:()=>wt(s),className:"h-9 w-9 p-0",children:e.jsx(O,{className:"w-4 h-4"})})]}),e.jsxs("div",{className:"space-y-2",children:[t.items.map(a=>e.jsx("div",{className:"bg-background rounded-lg p-3 space-y-2 border",children:e.jsxs("div",{className:"flex items-start gap-2",children:[e.jsxs("div",{className:"flex-1 space-y-2",children:[e.jsxs("div",{className:"flex gap-2",children:[e.jsx(K,{placeholder:"Artikelname *",value:a.name,onChange:r=>T(s,a.id,"name",r.target.value),className:"flex-1 h-9"}),e.jsx(K,{type:"number",placeholder:"Menge",value:a.quantity,onChange:r=>T(s,a.id,"quantity",r.target.value),className:"w-20 h-9",min:"1"})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(pe,{value:a.category,onValueChange:r=>T(s,a.id,"category",r),children:[e.jsx(be,{className:"flex-1 h-9",children:e.jsx(je,{})}),e.jsx(Ne,{children:ht.map(r=>e.jsx(h,{value:r,children:r},r))})]}),e.jsx(K,{type:"number",step:"0.01",placeholder:"Preis (CHF)",value:a.price,onChange:r=>T(s,a.id,"price",r.target.value),className:"w-24 h-9"})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(K,{placeholder:"Artikelnummer (EAN/Barcode)",value:a.articleNumber,onChange:r=>T(s,a.id,"articleNumber",r.target.value),className:"flex-1 h-9"}),e.jsx(N,{variant:"outline",size:"sm",onClick:()=>Ct(s,a.id),className:"h-9",children:e.jsx(ns,{className:"w-4 h-4"})})]}),a.productInfo&&e.jsxs("div",{className:"bg-muted/50 rounded p-2 text-xs space-y-1",children:[a.productInfo.brand&&e.jsxs("p",{children:[e.jsx("strong",{children:"Marke:"})," ",a.productInfo.brand]}),a.productInfo.description&&e.jsxs("p",{children:[e.jsx("strong",{children:"Beschreibung:"})," ",a.productInfo.description]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Zt,{checked:a.saveToDatabase||!1,onCheckedChange:r=>T(s,a.id,"saveToDatabase",r)}),e.jsx(Jt,{className:"text-xs",children:"Für zukünftige Käufe speichern"})]})]}),e.jsx(N,{variant:"ghost",size:"sm",onClick:()=>kt(s,a.id),className:"h-9 w-9 p-0",children:e.jsx(Ge,{className:"w-4 h-4"})})]})},a.id)),e.jsxs(N,{variant:"outline",size:"sm",onClick:()=>yt(s),className:"w-full h-9",children:[e.jsx(Oe,{className:"w-4 h-4 mr-2"}),"Artikel hinzufügen"]})]})]},s)),e.jsxs(N,{variant:"outline",onClick:Nt,className:"w-full",children:[e.jsx(ke,{className:"w-4 h-4 mr-2"}),"Laden hinzufügen"]})]}),e.jsxs(Xt,{className:"px-5 pb-3 pt-2 gap-2.5 flex-shrink-0",children:[e.jsx(N,{variant:"outline",onClick:()=>{le(!1),P([])},className:"h-11 min-h-[44px] flex-1 rounded-xl text-sm font-medium",children:"Abbrechen"}),e.jsxs(N,{onClick:St,disabled:b.length===0||b.every(t=>t.items.length===0),className:"h-11 min-h-[44px] flex-1 rounded-xl text-sm font-medium",children:[b.reduce((t,s)=>t+s.items.length,0)," Artikel hinzufügen"]})]})]})}),Ye&&e.jsxs("div",{className:"fixed inset-0 z-50 bg-black flex flex-col",children:[e.jsxs("div",{className:"flex items-center justify-between p-4 bg-black/50",children:[e.jsx("h2",{className:"text-white font-semibold",children:"Liste scannen"}),e.jsx("button",{onClick:ee,className:"w-10 h-10 rounded-lg bg-white/20 flex items-center justify-center",children:e.jsx(O,{className:"w-5 h-5 text-white"})})]}),e.jsxs("div",{className:"flex gap-2 px-4 py-2",children:[e.jsxs("button",{onClick:()=>{ie("receipt"),R("camera"),Z()},className:`flex-1 py-2 px-3 rounded-lg flex items-center justify-center gap-1.5 text-sm ${$==="receipt"&&_==="camera"?"bg-white text-black":"bg-white/20 text-white"}`,children:[e.jsx(ls,{className:"w-4 h-4"}),"Quittung"]}),e.jsxs("button",{onClick:async()=>{ie("single"),R("camera"),L([]),E(0),X(new Set),ce(null),J(null),await Z()},className:`flex-1 py-2 px-3 rounded-lg flex items-center justify-center gap-1.5 text-sm ${$==="single"?"bg-white text-black":"bg-white/20 text-white"}`,children:[e.jsx(Ce,{className:"w-4 h-4"}),"Einzeln"]}),e.jsxs("button",{onClick:()=>{ie("receipt"),R("upload"),Te()},className:`flex-1 py-2 px-3 rounded-lg flex items-center justify-center gap-1.5 text-sm ${_==="upload"?"bg-white text-black":"bg-white/20 text-white"}`,children:[e.jsx(is,{className:"w-4 h-4"}),"Upload"]})]}),_==="camera"&&$==="receipt"&&v.length===0&&e.jsxs("div",{className:"flex-1 relative",children:[e.jsx("video",{ref:m,autoPlay:!0,playsInline:!0,muted:!0,preload:"auto",className:"absolute inset-0 w-full h-full object-cover"}),e.jsx("canvas",{ref:H,className:"hidden"}),o&&e.jsxs("div",{className:"absolute inset-0 pointer-events-none",children:[e.jsx("div",{className:"absolute inset-8 border-2 border-white/60 rounded-lg"}),e.jsx("div",{className:"absolute top-8 left-8 w-6 h-6 border-t-4 border-l-4 border-white rounded-tl"}),e.jsx("div",{className:"absolute top-8 right-8 w-6 h-6 border-t-4 border-r-4 border-white rounded-tr"}),e.jsx("div",{className:"absolute bottom-8 left-8 w-6 h-6 border-b-4 border-l-4 border-white rounded-bl"}),e.jsx("div",{className:"absolute bottom-8 right-8 w-6 h-6 border-b-4 border-r-4 border-white rounded-br"})]}),e.jsx("div",{className:"absolute top-4 left-4 right-4 z-20",children:e.jsx("div",{className:"bg-black/60 rounded-lg p-3 text-center",children:e.jsx("p",{className:"text-white text-sm font-medium",children:x?"Analysiere...":"Quittung fotografieren"})})}),e.jsx("div",{className:"absolute bottom-8 left-0 right-0 z-20",children:o?e.jsxs("div",{className:"flex justify-center items-center gap-4",children:[e.jsx("button",{onClick:ee,className:"w-12 h-12 rounded-full bg-white/20 flex items-center justify-center active:opacity-80",children:e.jsx(O,{className:"w-6 h-6 text-white"})}),e.jsx("button",{onClick:Lt,disabled:x,className:"w-20 h-20 rounded-full bg-white shadow-lg flex items-center justify-center active:opacity-80 border-4 border-white/50",children:x?e.jsx("div",{className:"w-8 h-8 border-3 border-gray-300 border-t-gray-600 rounded-full animate-spin"}):e.jsx("div",{className:"w-14 h-14 rounded-full bg-white"})}),e.jsx("div",{className:"w-12 h-12"})]}):e.jsx("div",{className:"flex justify-center",children:e.jsxs("button",{onClick:Z,className:"px-6 py-3 rounded-full bg-white shadow-lg flex items-center justify-center gap-2 active:opacity-80",children:[e.jsx(Ve,{className:"w-5 h-5 text-gray-800"}),e.jsx("span",{className:"font-medium text-gray-800",children:"Kamera starten"})]})})})]}),_==="camera"&&$==="single"&&e.jsxs("div",{className:"flex-1 flex flex-col bg-background w-full h-full overflow-hidden",children:[e.jsx("div",{className:"w-full px-4 py-3 bg-background/95 backdrop-blur-sm border-b border-border/50 flex-shrink-0",children:e.jsxs("div",{className:"flex items-center justify-between gap-3",children:[e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[e.jsx("div",{className:`w-2 h-2 rounded-full ${o?"bg-green-500 animate-pulse":"bg-gray-400"}`}),e.jsx("p",{className:"text-xs font-medium text-muted-foreground",children:o?"Kamera aktiv":"Kamera inaktiv"})]}),e.jsx("p",{className:"text-sm font-bold truncate",children:x?"Analysiere...":g?`${ze.size} Positionen erkannt`:y.length>0?`${y.length} Artikel gescannt`:"Bereit zum Scannen"})]}),e.jsxs("button",{onClick:()=>at(!g),disabled:!o,className:`px-3 py-2 rounded-lg flex items-center gap-1.5 flex-shrink-0 transition-all ${g&&o?"bg-green-500 text-white shadow-lg":"bg-muted text-muted-foreground"} ${o?"":"opacity-50"}`,children:[e.jsx("div",{className:`w-2 h-2 rounded-full ${g&&o?"bg-white":"bg-foreground/50"}`}),e.jsx("span",{className:"text-xs font-semibold",children:"Auto"})]})]})}),e.jsxs("div",{className:"flex-1 flex flex-col w-full overflow-hidden min-h-0 relative",children:[e.jsxs("div",{className:"relative bg-black w-full flex-1 flex-shrink-0 min-h-0",children:[e.jsx("video",{ref:m,autoPlay:!0,playsInline:!0,muted:!0,preload:"auto",className:"absolute inset-0 w-full h-full object-cover",style:{minWidth:"100%",minHeight:"100%"}}),e.jsx("canvas",{ref:H,className:"hidden"}),o&&g&&e.jsxs("div",{className:"absolute inset-0 pointer-events-none",children:[x&&e.jsx("div",{className:"absolute left-0 right-0 h-1 bg-green-500/50",style:{top:"50%",animation:"scan-line 1.5s ease-in-out infinite",boxShadow:"0 0 20px rgba(16, 185, 129, 0.6)",transform:"translateY(-50%)"}}),e.jsx("div",{className:"absolute top-4 left-1/2 transform -translate-x-1/2 z-10",children:e.jsxs("div",{className:"bg-green-500/90 backdrop-blur-sm text-white px-4 py-2 rounded-full text-xs font-semibold flex items-center gap-2 shadow-lg",children:[e.jsx("div",{className:"w-2 h-2 bg-white rounded-full animate-pulse"}),x?"Analysiere...":`Live-Scan (${y.length} Artikel)`]})})]}),o&&!g&&e.jsx("div",{className:"absolute top-4 left-1/2 transform -translate-x-1/2 z-10",children:e.jsx("div",{className:"bg-black/60 backdrop-blur-sm text-white px-4 py-2 rounded-full text-xs font-medium",children:"Quittung vollständig sichtbar machen"})}),o&&!k&&e.jsx("div",{className:"absolute bottom-0 left-0 right-0 z-20 p-4 bg-gradient-to-t from-black/80 via-black/40 to-transparent",children:e.jsx("button",{onClick:Dt,disabled:x,className:`w-full py-4 rounded-xl shadow-2xl flex items-center justify-center gap-3 transition-all transform ${x?"bg-gray-600/90":"bg-green-500 hover:bg-green-600 active:scale-95"}`,children:x?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"w-6 h-6 border-2 border-white/30 border-t-white rounded-full animate-spin"}),e.jsx("span",{className:"font-bold text-white text-lg",children:"Analysiere..."})]}):e.jsxs(e.Fragment,{children:[e.jsx(Ce,{className:"w-6 h-6 text-white"}),e.jsx("span",{className:"font-bold text-white text-lg",children:"ALLE SCANNEN"})]})})}),!o&&e.jsxs("div",{className:"absolute inset-0 flex flex-col items-center justify-center bg-gradient-to-b from-black/90 to-black/70",children:[e.jsxs("div",{className:"text-center mb-8",children:[e.jsx("div",{className:"w-20 h-20 mx-auto mb-4 rounded-full bg-white/10 backdrop-blur-sm flex items-center justify-center",children:e.jsx(Ve,{className:"w-10 h-10 text-white"})}),e.jsx("p",{className:"text-white text-lg font-semibold mb-2",children:"Kamera starten"}),e.jsx("p",{className:"text-white/70 text-sm",children:"Für das Scannen von Quittungen"})]}),e.jsxs("button",{onClick:Z,className:"px-8 py-4 rounded-xl bg-white shadow-2xl flex items-center justify-center gap-3 hover:bg-gray-50 active:scale-95 transition-all",children:[e.jsx(Ve,{className:"w-6 h-6 text-gray-800"}),e.jsx("span",{className:"font-bold text-gray-800 text-base",children:"Kamera aktivieren"})]})]})]}),e.jsxs("div",{className:"flex-1 overflow-y-auto bg-background w-full p-4 min-h-0",children:[Ie&&!k&&e.jsxs("div",{className:"mb-4 p-4 bg-red-500/10 border border-red-500/30 rounded-xl backdrop-blur-sm",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx("div",{className:"w-2 h-2 rounded-full bg-red-500"}),e.jsx("p",{className:"text-red-600 font-semibold text-sm",children:"Fehler"})]}),e.jsx("p",{className:"text-red-600 font-medium text-center text-sm",children:Ie}),e.jsx("p",{className:"text-red-500/70 text-xs text-center mt-1",children:"Quittung näher halten und erneut scannen"})]}),k&&e.jsxs("div",{className:"mb-4 p-5 bg-green-500/10 border border-green-500/40 rounded-xl backdrop-blur-sm",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-3",children:[e.jsx("div",{className:"w-2 h-2 rounded-full bg-green-500 animate-pulse"}),e.jsx("p",{className:"text-green-600 font-bold text-sm",children:"ERKANNT"})]}),e.jsxs("div",{className:"bg-background/80 backdrop-blur-sm rounded-lg p-4 mb-4 border border-border/50",children:[e.jsx("p",{className:"font-bold text-base mb-1",children:k.name}),e.jsxs("p",{className:"text-xs text-muted-foreground",children:["CHF ",k.unitPrice.toFixed(2)," pro Stück"]})]}),e.jsxs("div",{className:"flex items-center justify-center gap-4 mb-4",children:[e.jsx("button",{onClick:()=>Q(t=>Math.max(1,t-1)),className:"w-11 h-11 rounded-full bg-muted flex items-center justify-center text-xl font-bold active:scale-95 transition-transform",children:"−"}),e.jsx("div",{className:"w-16 h-11 rounded-lg bg-background border border-border flex items-center justify-center",children:e.jsx("span",{className:"text-2xl font-bold",children:U})}),e.jsx("button",{onClick:()=>Q(t=>t+1),className:"w-11 h-11 rounded-full bg-muted flex items-center justify-center text-xl font-bold active:scale-95 transition-transform",children:"+"})]}),e.jsxs("div",{className:"text-center mb-4 p-3 bg-background/50 rounded-lg border border-border/50",children:[e.jsx("p",{className:"text-xs text-muted-foreground mb-1",children:"Total"}),e.jsxs("p",{className:"text-xl font-bold",children:["CHF ",(k.unitPrice*U).toFixed(2)]})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs("button",{onClick:Rt,className:"flex-1 py-3 rounded-lg bg-muted flex items-center justify-center gap-2 text-sm font-semibold active:scale-95 transition-transform",children:[e.jsx(O,{className:"w-4 h-4"}),"Abbrechen"]}),e.jsxs("button",{onClick:Mt,className:"flex-1 py-3 rounded-lg bg-green-500 text-white flex items-center justify-center gap-2 text-sm font-semibold shadow-lg active:scale-95 transition-transform",children:[e.jsx(re,{className:"w-4 h-4"}),"Hinzufügen"]})]})]}),!k&&y.length===0&&!Ie&&e.jsxs("div",{className:"text-center py-8",children:[e.jsx("div",{className:"w-16 h-16 mx-auto mb-4 rounded-full bg-muted/50 flex items-center justify-center",children:e.jsx(Ce,{className:"w-8 h-8 text-muted-foreground/40"})}),e.jsx("p",{className:"text-base font-bold text-foreground mb-2",children:"Artikel scannen"}),e.jsx("p",{className:"text-xs text-muted-foreground/70 px-4",children:g?e.jsx(e.Fragment,{children:"Auto-Scan aktiv: Quittung in den Rahmen halten"}):e.jsx(e.Fragment,{children:'Quittung in den Rahmen halten und "ALLE SCANNEN" drücken'})})]}),y.length>0&&e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center justify-between mb-3 p-3 bg-green-500/10 rounded-xl border border-green-500/30 backdrop-blur-sm",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-8 h-8 rounded-full bg-green-500/20 flex items-center justify-center",children:e.jsx(Ke,{className:"w-4 h-4 text-green-600"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-muted-foreground",children:"Gesamt"}),e.jsxs("p",{className:"font-bold text-sm",children:[y.reduce((t,s)=>t+s.quantity,0)," Artikel"]})]})]}),e.jsxs("div",{className:"text-right",children:[e.jsx("p",{className:"text-xs text-muted-foreground",children:"Total"}),e.jsxs("p",{className:"text-xl font-bold text-green-600",children:["CHF ",ft.toFixed(2)]})]})]}),e.jsx("div",{className:"space-y-2.5 mb-3",children:y.map((t,s)=>e.jsxs("div",{className:"p-3 bg-muted/80 backdrop-blur-sm rounded-xl border border-border/50",children:[e.jsxs("div",{className:"flex items-start justify-between mb-2.5",children:[e.jsxs("div",{className:"flex items-center gap-2.5 flex-1 min-w-0",children:[e.jsx("div",{className:"w-9 h-9 rounded-full bg-green-500 text-white text-xs font-bold flex items-center justify-center flex-shrink-0 shadow-sm",children:t.quantity}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("p",{className:"font-bold text-sm mb-0.5 truncate",children:t.name}),e.jsxs("p",{className:"text-xs text-muted-foreground",children:["CHF ",t.unitPrice.toFixed(2)," pro Stück"]})]})]}),e.jsx("button",{onClick:()=>rt(s),className:"w-8 h-8 rounded-full bg-red-500/10 flex items-center justify-center flex-shrink-0 active:scale-95 transition-transform",children:e.jsx(O,{className:"w-4 h-4 text-red-500"})})]}),e.jsxs("div",{className:"flex items-center justify-between pt-2 border-t border-border/50",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{onClick:()=>nt(s,t.quantity-1),className:"w-9 h-9 rounded-full bg-background border border-border flex items-center justify-center text-lg font-bold active:scale-95 transition-transform",children:"−"}),e.jsx("div",{className:"w-10 h-9 rounded-lg bg-background border border-border flex items-center justify-center",children:e.jsx("span",{className:"text-lg font-bold",children:t.quantity})}),e.jsx("button",{onClick:()=>nt(s,t.quantity+1),className:"w-9 h-9 rounded-full bg-background border border-border flex items-center justify-center text-lg font-bold active:scale-95 transition-transform",children:"+"})]}),e.jsxs("div",{className:"text-right",children:[e.jsx("p",{className:"text-xs text-muted-foreground",children:"Total"}),e.jsxs("p",{className:"font-bold text-base",children:["CHF ",t.totalPrice.toFixed(2)]})]})]})]},s))}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs("button",{onClick:()=>{X(new Set),n.success("Positionen zurückgesetzt")},className:"px-3 py-2.5 rounded-lg bg-muted flex items-center justify-center gap-1.5 text-xs font-semibold active:scale-95 transition-transform",children:[e.jsx(cs,{className:"w-3.5 h-3.5"}),"Reset"]}),e.jsxs("button",{onClick:()=>{L([]),E(0),X(new Set)},className:"flex-1 py-2.5 rounded-lg bg-muted flex items-center justify-center gap-1.5 text-xs font-semibold active:scale-95 transition-transform",children:[e.jsx(Ge,{className:"w-3.5 h-3.5"}),"Alle löschen"]}),e.jsxs("button",{onClick:$t,className:"flex-1 py-2.5 rounded-lg bg-primary text-primary-foreground flex items-center justify-center gap-1.5 text-xs font-semibold shadow-lg active:scale-95 transition-transform",children:[e.jsx(re,{className:"w-3.5 h-3.5"}),"Fertig"]})]})]})]})]})]}),_==="upload"&&v.length===0&&e.jsxs("div",{className:"flex-1 flex items-center justify-center p-4",children:[e.jsxs("button",{onClick:()=>Je.current?.click(),className:"w-full max-w-sm p-8 border-2 border-dashed border-white/30 rounded-xl text-center",children:[e.jsx(os,{className:"w-12 h-12 mx-auto text-white/50 mb-4"}),e.jsx("p",{className:"text-white font-medium",children:"Foto auswählen"}),e.jsx("p",{className:"text-white/50 text-sm mt-2",children:"JPG, PNG oder PDF"})]}),e.jsx("input",{ref:Je,type:"file",accept:"image/*,application/pdf",capture:"environment",className:"hidden",onChange:Et})]}),x&&e.jsx("div",{className:"flex-1 flex items-center justify-center",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"w-12 h-12 border-2 border-white/30 border-t-white rounded-full animate-spin mx-auto mb-4"}),e.jsx("p",{className:"text-white",children:"Analysiere Liste..."})]})}),l&&v.length>0&&e.jsx("div",{className:"flex-1 bg-background overflow-y-auto",children:e.jsxs("div",{className:"p-4 space-y-4",children:[e.jsxs("div",{className:"bg-muted rounded-xl overflow-hidden",children:[e.jsxs("button",{onClick:()=>gt(!Fe),className:"w-full p-3 flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(ke,{className:"w-4 h-4 text-primary"}),e.jsx("span",{className:"font-medium",children:"Geschäft"})]}),Fe?e.jsx(_e,{className:"w-4 h-4"}):e.jsx(Ue,{className:"w-4 h-4"})]}),Fe&&e.jsxs("div",{className:"px-3 pb-3 space-y-1",children:[e.jsx("p",{className:"font-semibold text-lg",children:l.store.name}),l.store.address&&e.jsx("p",{className:"text-sm text-muted-foreground",children:l.store.address}),l.store.city&&e.jsxs("p",{className:"text-sm text-muted-foreground",children:[l.store.postalCode," ",l.store.city]}),e.jsxs("div",{className:"flex gap-4 mt-2 text-xs text-muted-foreground",children:[l.purchase.date&&e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx(ds,{className:"w-3 h-3"}),new Date(l.purchase.date).toLocaleDateString("de-CH")]}),l.purchase.time&&e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx(ms,{className:"w-3 h-3"}),l.purchase.time]})]})]})]}),e.jsxs("div",{className:"bg-muted rounded-xl overflow-hidden",children:[e.jsxs("button",{onClick:()=>pt(!Pe),className:"w-full p-3 flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Ke,{className:"w-4 h-4 text-primary"}),e.jsxs("span",{className:"font-medium",children:["Artikel (",v.length,")"]}),e.jsxs("span",{className:"text-xs bg-primary text-primary-foreground px-2 py-0.5 rounded-full",children:[v.filter(t=>t.selected).length," ausgewählt"]})]}),Pe?e.jsx(_e,{className:"w-4 h-4"}):e.jsx(Ue,{className:"w-4 h-4"})]}),Pe&&e.jsxs("div",{className:"px-3 pb-3",children:[e.jsx("div",{className:"flex justify-end mb-2",children:e.jsx("button",{onClick:()=>q(t=>t.map(s=>({...s,selected:!v.every(a=>a.selected)}))),className:"text-xs text-primary",children:v.every(t=>t.selected)?"Alle abwählen":"Alle auswählen"})}),e.jsx("div",{className:"space-y-2 max-h-64 overflow-y-auto",children:v.map((t,s)=>e.jsx("div",{className:`p-2.5 rounded-lg border ${t.selected?"bg-background border-primary":"bg-background/50 border-border"}`,onClick:()=>q(a=>a.map((r,d)=>d===s?{...r,selected:!r.selected}:r)),children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:`w-5 h-5 rounded border-2 ${t.selected?"bg-primary border-primary":"border-border"} flex items-center justify-center shrink-0`,children:t.selected&&e.jsx(re,{className:"w-3 h-3 text-white"})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("p",{className:"font-medium text-sm truncate",children:t.name}),e.jsxs("p",{className:"text-xs text-muted-foreground",children:[t.articleNumber&&e.jsxs("span",{className:"mr-2",children:["#",t.articleNumber]}),t.quantity,"x à CHF ",t.unitPrice.toFixed(2)]})]}),e.jsxs("p",{className:"font-semibold text-sm shrink-0",children:["CHF ",t.totalPrice.toFixed(2)]})]})},s))})]})]}),e.jsxs("div",{className:"bg-muted rounded-xl overflow-hidden",children:[e.jsxs("button",{onClick:()=>bt(!Le),className:"w-full p-3 flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(ut,{className:"w-4 h-4 text-primary"}),e.jsx("span",{className:"font-medium",children:"Zahlung"})]}),Le?e.jsx(_e,{className:"w-4 h-4"}):e.jsx(Ue,{className:"w-4 h-4"})]}),Le&&e.jsxs("div",{className:"px-3 pb-3 space-y-2",children:[l.totals.subtotal&&e.jsxs("div",{className:"flex justify-between text-sm",children:[e.jsx("span",{className:"text-muted-foreground",children:"Zwischensumme"}),e.jsxs("span",{children:["CHF ",l.totals.subtotal.toFixed(2)]})]}),l.totals.rounding&&e.jsxs("div",{className:"flex justify-between text-sm",children:[e.jsx("span",{className:"text-muted-foreground",children:"Rundung"}),e.jsxs("span",{children:["CHF ",l.totals.rounding.toFixed(2)]})]}),e.jsxs("div",{className:"flex justify-between font-semibold text-lg pt-2 border-t",children:[e.jsx("span",{children:"Total"}),e.jsxs("span",{children:["CHF ",l.totals.total.toFixed(2)]})]}),l.purchase.paymentMethod&&e.jsxs("div",{className:"flex items-center gap-2 text-xs text-muted-foreground",children:[e.jsx(ut,{className:"w-3 h-3"}),l.purchase.paymentMethod]})]})]}),e.jsxs("div",{className:"flex items-center justify-center gap-2 text-xs text-muted-foreground",children:[e.jsx("div",{className:`w-2 h-2 rounded-full ${l.confidence>=70?"bg-green-500":l.confidence>=40?"bg-yellow-500":"bg-red-500"}`}),"Erkennungsqualität: ",l.confidence,"%"]}),e.jsxs("div",{className:"space-y-2 pt-2",children:[e.jsxs(N,{onClick:qt,className:"w-full",children:[e.jsx(Oe,{className:"w-4 h-4 mr-2"}),v.filter(t=>t.selected).length," Artikel zur Liste"]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(N,{variant:"outline",onClick:Ht,className:"flex-1",children:[e.jsx(us,{className:"w-4 h-4 mr-1"}),"Speichern"]}),e.jsxs(N,{variant:"outline",onClick:Bt,className:"flex-1",children:[e.jsx(hs,{className:"w-4 h-4 mr-1"}),"Zu Finanzen"]})]})]})]})})]}),!Qe&&!Ye&&!We&&e.jsxs("div",{className:"fixed right-4 bottom-20 flex flex-col gap-3 safe-bottom",children:[e.jsx("button",{onClick:Kt,className:"w-12 h-12 rounded-full bg-secondary text-secondary-foreground shadow-lg flex items-center justify-center active:opacity-80 transition-opacity",children:e.jsx(Ce,{className:"w-5 h-5"})}),e.jsx("button",{onClick:()=>le(!0),className:"w-12 h-12 rounded-full bg-secondary text-secondary-foreground shadow-lg flex items-center justify-center active:opacity-80 transition-opacity",title:"Mehrere Artikel hinzufügen",children:e.jsx(xs,{className:"w-5 h-5"})}),e.jsx("button",{onClick:()=>Se(!0),className:"w-14 h-14 rounded-full bg-primary text-primary-foreground shadow-lg flex items-center justify-center active:opacity-80 transition-opacity",children:e.jsx(Oe,{className:"w-6 h-6"})})]})]})}export{Ts as M};
